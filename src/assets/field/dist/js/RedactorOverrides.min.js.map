{"version":3,"sources":["RedactorOverrides.js"],"names":["imageResizeClass","$R","prototype","init","app","this","$doc","$win","$body","editor","toolbar","inspector","$target","isTarget","getTargetElement","attachLivePreview","hide","$editor","$","length","dom","detachLivePreview","Garnish","on","Craft","Preview","LivePreview","_init","_setResizerPosition","$resizer","targetOffset","offset","topOffset","top","scrollTop","leftOffset","left","pos","$resizableImage","width","height","resizerWidth","resizerHeight","css","Math","round","_build","e","find","remove","data","parse","target","getElement","isComponentType","$resizableBox","getImageElement","attr","z-index","append","_set","bind","off","rebuild","toolbarFixedClass","livePreview","$previousFixedTarget","$fixedTarget","_doFixed","uuid","$container","container","$toolbar","$wrapper","getWrapper","isSourceMode","parents","filter","node","getComputedStyle","display","isHeight","isEmpty","reset","pinIt","toolbarHeight","pinDistance","headerBuffer","bottomFromScreenTop","distanceFromScreenTop","position","detector","isDesktop","scrollOffset","boxOffset","opts","toolbarFixedTopOffset","isMobile","fixedScrollTimeout","clearTimeout","setTimeout","show","addClass","dropdown","getDropdown","updatePosition","broadcast","inputCleanerService","input","html","paragraphize","started","encodePreCode","replace","create","convert","convertRules","storeComponents","replaceTags","_setSpanAttr","_setStyleCache","removeTags","deniedTags","_removeScriptTag","_replaceScriptTag","removeComments","_isSpacedEmpty","emptyHtml","restoreComponents","_cleanWrapped","utils","buildWrapper","imageattrs","each","attributes","attrs","i","name","search","indexOf","removeAttribute","getWrapperHtml","toolbarDropdownClass","isFixed","btnHeight","$btn","btnWidth","parseFloat","leftPos","toolbarElement","maxHeight","cropHeight"],"mappings":"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","file":"RedactorOverrides.min.js","sourcesContent":["// Adjust the positioning of image resizer\n// =============================================================================\n\nvar imageResizeClass = $R['classes']['image.resize'];\n\nimageResizeClass.prototype.init = function (app) {\n    this.app = app;\n    this.$doc = app.$doc;\n    this.$win = app.$win;\n    this.$body = app.$body;\n    this.editor = app.editor;\n    this.toolbar = app.toolbar;\n    this.inspector = app.inspector;\n\n    // init\n    this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n\n    // Change the target according to LP\n    var attachLivePreview = () => {\n        this.hide();\n        var $editor = $('.lp-editor');\n        if ($editor.length) {\n            this.$target = $R.dom($editor[0]);\n        }\n    };\n\n    var detachLivePreview = () => {\n        this.hide();\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n    }\n\n    Garnish.on(Craft.Preview, 'open', attachLivePreview);\n    Garnish.on(Craft.LivePreview, 'enter', attachLivePreview);\n\n    Garnish.on(Craft.Preview, 'close', detachLivePreview);\n    Garnish.on(Craft.LivePreview, 'exit', detachLivePreview);\n\n    this._init();\n}\n// Position the image resizer correctly\nimageResizeClass.prototype._setResizerPosition = function () {\n    if (this.$resizer)\n    {\n        var isTarget = this.toolbar.isTarget();\n        var targetOffset = this.$target.offset();\n        var offsetFix = 7;\n        var topOffset = (isTarget) ? (offsetFix - targetOffset.top + this.$target.scrollTop()) : offsetFix;\n        var leftOffset = (isTarget) ? (offsetFix - targetOffset.left) : offsetFix;\n        var pos = this.$resizableImage.offset();\n        var width = this.$resizableImage.width();\n        var height = this.$resizableImage.height();\n        var resizerWidth =  this.$resizer.width();\n        var resizerHeight =  this.$resizer.height();\n\n        this.$resizer.css({ top: Math.round(pos.top + height - resizerHeight + topOffset) + 'px', left: Math.round(pos.left + width - resizerWidth + leftOffset) + 'px' });\n    }\n};\n\n// When scrolling, reposition the resizer\nimageResizeClass.prototype._build = function (e) {\n    this.$target.find('#redactor-image-resizer').remove();\n\n    var data = this.inspector.parse(e.target);\n    var $editor = this.editor.getElement();\n\n    if (data.isComponentType('image'))\n    {\n        this.$resizableBox = $editor;\n        this.$resizableImage = $R.dom(data.getImageElement());\n\n        this.$resizer = $R.dom('<span>');\n        this.$resizer.attr('id', 'redactor-image-resizer');\n        this.$resizer.css({'z-index': 100});\n\n        this.$target.append(this.$resizer);\n\n        this._setResizerPosition();\n        this.$resizer.on('mousedown touchstart', this._set.bind(this));\n    }\n};\n// Stop listening to scroll\nimageResizeClass.prototype.hide = function () {\n    this.$target.find('#redactor-image-resizer').remove();\n    if (this.toolbar.isTarget()) {\n        this.$target.off('scroll.resizer', this.rebuild.bind(this));\n    } else {\n        $R.dom('#content-container').off('scroll.resizer', this.rebuild.bind(this));\n    }\n};\n\n// Adjust the positioning of fixed toolbar\n// =============================================================================\n\nvar toolbarFixedClass = $R['classes']['toolbar.fixed'];\n\ntoolbarFixedClass.prototype.livePreview = false;\ntoolbarFixedClass.prototype.$previousFixedTarget = false;\n\ntoolbarFixedClass.prototype._init = function() {\n    this.$fixedTarget = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$win;\n    this._doFixed();\n\n    if (this.toolbar.isTarget())\n    {\n        this.$win.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        this.$win.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n    }\n\n    this.$fixedTarget.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n    this.$fixedTarget.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n\n    var attachLivePreview = () => {\n        var $editor = $('.lp-editor');\n        if ($editor.length) {\n            this.livePreview = true;\n            this.$previousFixedTarget = this.$fixedTarget;\n            $editor = $R.dom($editor[0]);\n            $editor.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n            this.$fixedTarget = $editor;\n        }\n    };\n\n    var detachLivePreview = () => {\n        this.livePreview = false;\n        this.$fixedTarget = this.$previousFixedTarget;\n        this.$previousFixedTarget = null;\n    }\n\n    Garnish.on(Craft.Preview, 'open', attachLivePreview);\n    Garnish.on(Craft.LivePreview, 'enter', attachLivePreview);\n\n    Garnish.on(Craft.Preview, 'close', detachLivePreview);\n    Garnish.on(Craft.LivePreview, 'exit', detachLivePreview);\n};\n\ntoolbarFixedClass.prototype._doFixed = function() {\n    var $editor = this.editor.getElement();\n    var $container = this.container.getElement();\n    var $toolbar = this.toolbar.getElement();\n    var $wrapper = this.toolbar.getWrapper();\n\n    if (this.editor.isSourceMode())\n    {\n        return;\n    }\n\n    var $targets = $container.parents().filter(function(node)\n    {\n        return (getComputedStyle(node, null).display === 'none') ? node : false;\n    });\n\n    // has hidden parent\n    if ($targets.length !== 0) return;\n\n    var isHeight = ($editor.height() < 100);\n    var isEmpty = this.editor.isEmpty();\n\n    if (isHeight || isEmpty) {\n        this.reset();\n        return;\n    }\n\n    var toolbarHeight = $toolbar.height();\n\n    var pinIt = false;\n    var pinDistance = 0;\n    var tolerance = 20;\n\n    if (this.livePreview) {\n        var headerBuffer = $('.lp-editor-container header.flex').length ? $('.lp-editor-container header.flex').height() : 0;\n        var distanceFromScreenTop = $editor.offset().top - headerBuffer;\n        var bottomFromScreenTop = distanceFromScreenTop + $editor.height() - toolbarHeight;\n    } else {\n        var headerBuffer = $('body.fixed-header #header').length ? $('body.fixed-header #header').height() : 0;\n        var distanceFromScreenTop = $editor.offset().top - this.$win.scrollTop() - headerBuffer;\n        var bottomFromScreenTop = distanceFromScreenTop + $editor.height() - toolbarHeight;\n    }\n\n    pinIt = distanceFromScreenTop  + tolerance < 0 && bottomFromScreenTop > 0;\n    pinDistance = $editor.scrollTop() + headerBuffer + tolerance;\n\n    // Figure out when to pin the toolbar\n\n    if (pinIt)\n    {\n        var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\n        pinDistance = (this.detector.isDesktop()) ? pinDistance : (scrollOffset - boxOffset + this.opts.toolbarFixedTopOffset);\n\n        if (this.detector.isMobile())\n        {\n            if (this.fixedScrollTimeout)\n            {\n                clearTimeout(this.fixedScrollTimeout);\n            }\n\n            $toolbar.hide();\n            this.fixedScrollTimeout = setTimeout(function()\n            {\n                $toolbar.show();\n            }, 250);\n        }\n\n        $wrapper.height(toolbarHeight);\n        $toolbar.addClass('redactor-toolbar-fixed');\n        $toolbar.css({\n            position: position,\n            top: (pinDistance + this.opts.toolbarFixedTopOffset) + 'px',\n            width: $container.width() + 'px'\n        });\n\n        var dropdown = this.toolbar.getDropdown();\n        if (dropdown) dropdown.updatePosition();\n\n        this.app.broadcast('toolbar.fixed');\n    }\n    else\n    {\n        this.reset();\n        this.app.broadcast('toolbar.unfixed');\n    }\n};\n\nvar inputCleanerService = $R['services']['cleaner'];\n\ninputCleanerService.prototype.input = function(html, paragraphize, started)\n{\n    // pre/code\n    html = this.encodePreCode(html);\n\n    // converting entity\n    html = html.replace(/\\$/g, '&#36;');\n    html = html.replace(/&amp;/g, '&');\n\n    // convert to figure\n    var converter = $R.create('cleaner.figure', this.app);\n    html = converter.convert(html, this.convertRules);\n\n    // store components\n    html = this.storeComponents(html);\n\n    // clean\n    html = this.replaceTags(html, this.opts.replaceTags);\n    html = this._setSpanAttr(html);\n    html = this._setStyleCache(html);\n    html = this.removeTags(html, this.deniedTags);\n    html = (this.opts.removeScript) ? this._removeScriptTag(html) : this._replaceScriptTag(html);\n    //html = (this.opts.removeScript) ? this._removeScriptTag(html) : html;\n    html = (this.opts.removeComments) ? this.removeComments(html) : html;\n    html = (this._isSpacedEmpty(html)) ? this.opts.emptyHtml : html;\n\n    // restore components\n    html = this.restoreComponents(html);\n\n    // clear wrapped components\n    html = this._cleanWrapped(html);\n\n    // remove image attributes\n    var $wrapper = this.utils.buildWrapper(html);\n    var imageattrs = ['alt', 'title', 'src', 'class', 'width', 'height', 'srcset', 'style'];\n    $wrapper.find('img').each(function(node) {\n        if (node.attributes.length > 0) {\n            var attrs = node.attributes;\n            for (var i = attrs.length - 1; i >= 0; i--) {\n                if (attrs[i].name.search(/^data\\-/) === -1 && imageattrs.indexOf(attrs[i].name) === -1) {\n                    node.removeAttribute(attrs[i].name);\n                }\n            }\n        }\n    });\n\n    // get wrapper html\n    html = this.utils.getWrapperHtml($wrapper);\n\n    // paragraphize\n    html = (paragraphize) ? this.paragraphize(html) : html;\n\n    return html;\n}\n\nvar toolbarDropdownClass = $R['classes']['toolbar.dropdown'];\n\ntoolbarDropdownClass.prototype.updatePosition = function ()\n{\n    var isFixed = this.toolbar.isFixed();\n    var isTarget = this.toolbar.isTarget();\n\n    var btnHeight = this.$btn.height();\n    var btnWidth = this.$btn.width();\n\n    var pos = this.$btn.offset();\n    var position = 'absolute';\n    var topOffset = 2;\n\n    if (isFixed) {\n        pos.top = (isTarget) ? this.$btn.offset().top : this.$btn.position().top;\n        position = 'fixed';\n        topOffset = topOffset + this.opts.toolbarFixedTopOffset;\n    }\n\n\n    var leftOffset = 0;\n    var left = (pos.left + leftOffset);\n    var width = parseFloat(this.css('width'));\n    var winWidth = this.$win.width();\n    var leftFix = (winWidth < (left + width)) ? (width - btnWidth) : 0;\n    var leftPos = (left - leftFix);\n    var top = (pos.top + btnHeight + topOffset);\n\n    if (isFixed) {\n        var toolbarElement = this.toolbar.getElement();\n        top = toolbarElement.position().top + toolbarElement.height();\n    }\n\n    leftPos = (leftPos < 0) ? 4 : leftPos;\n\n    this.css({\n        maxHeight: '',\n        position: position,\n        top: top + 'px',\n        left: leftPos + 'px'\n    });\n\n    // height adaptive\n    var heightTolerance = 10;\n    var winHeight = this.$win.height();\n    var scrollTop = this.$doc.scrollTop();\n    var cropHeight = winHeight - (top - scrollTop) - heightTolerance;\n\n    this.css('max-height', cropHeight + 'px');\n};\n"]}