window.livePreviewHideFullscreen=!1,function(c){Craft.RedactorInput=Garnish.Base.extend({id:null,linkOptions:null,volumes:null,elementSiteId:null,redactorConfig:null,$textarea:null,redactor:null,linkOptionModals:null,init:function(t){if(this.id=t.id,this.linkOptions=t.linkOptions,this.volumes=t.volumes,this.transforms=t.transforms,this.elementSiteId=t.elementSiteId,this.redactorConfig=t.redactorConfig,this.linkOptionModals=[],this.redactorConfig.lang||(this.redactorConfig.lang=t.redactorLang),this.redactorConfig.direction||(this.redactorConfig.direction=t.direction||Craft.orientation),this.redactorConfig.imageUpload=!1,this.redactorConfig.fileUpload=!1,typeof this.redactorConfig.plugins!=typeof[]&&(this.redactorConfig.plugins=[]),void 0===this.redactorConfig.removeNewLines&&(this.redactorConfig.removeNewLines=!0),this.redactorConfig.plugins.push("craftAssetImages"),this.redactorConfig.plugins.push("craftAssetFiles"),this.redactorConfig.plugins.push("craftEntryLinks"),this.redactorConfig.plugins.push("craftAssetImageEditor"),this.redactorConfig.buttons){-1!==(i=c.inArray("formatting",this.redactorConfig.buttons))&&this.redactorConfig.buttons.splice(i,1,"format");for(var e,o=["unorderedlist","orderedlist","undent","indent"],r=0;r<o.length;r++)-1!==(i=c.inArray(o[r],this.redactorConfig.buttons))&&(this.redactorConfig.buttons.splice(i,1),(void 0===e||i<e)&&(e=i));void 0!==e&&this.redactorConfig.buttons.splice(e,0,"lists")}else this.redactorConfig.buttons=[];var i;if(this.redactorConfig.buttonsAddFirst,this.redactorConfig.buttonsAddBefore)for(r=0;r<this.redactorConfig.buttons.length&&this.redactorConfig.buttons[r]!=this.redactorConfig.buttonsAddBefore.before;r++);if(this.redactorConfig.buttonsAddAfter)for(r=0;r<this.redactorConfig.buttons.length&&this.redactorConfig.buttons[r]!=this.redactorConfig.buttonsAddAfter.after;r++);this.redactorConfig.buttonsAdd,delete this.redactorConfig.buttonsAddFirst,delete this.redactorConfig.buttonsAddBefore,delete this.redactorConfig.buttonsAddAfter,delete this.redactorConfig.buttonsAdd,this.redactorConfig.callbacks={started:Craft.RedactorInput.handleRedactorInit,focus:this.onEditorFocus.bind(this),blur:this.onEditorBlur.bind(this),contextbar:this.showContextBar.bind(this)},this.initRedactor()},initRedactor:function(){var t="#"+this.id;if(this.$textarea=c(t),void 0===this.redactorConfig.toolbarFixed||this.redactorConfig.toolbarFixed){var e=this.$textarea.closest("#content, .lp-editor");e.length&&(this.redactorConfig.toolbarFixedTarget=e)}Craft.RedactorInput.currentInstance=this,console.log(this.redactorConfig.buttons),this.$textarea.redactor(this.redactorConfig)},onInitRedactor:function(t){this.redactor=t,this.redactor.container.getElement().addClass("focusable-input"),this.leaveFullscreenOnSaveShortcut(),this.redactor.opts.toolbarFixed&&!Craft.RedactorInput.scrollPageOnReady&&(Garnish.$doc.ready(function(){Garnish.$doc.trigger("scroll")}),Craft.RedactorInput.scrollPageOnReady=!0)},onEditorFocus:function(){this.redactor.container.getElement().trigger("focus")},onEditorBlur:function(){this.redactor.container.getElement().trigger("blur")},leaveFullscreenOnSaveShortcut:function(){void 0!==this.redactor.plugin.fullscreen&&"function"==typeof this.redactor.plugin.fullscreen.close&&Craft.cp.on("beforeSaveShortcut",c.proxy(function(){this.redactor.plugin.fullscreen.isOpen&&this.redactor.plugin.fullscreen.close()},this))},replaceRedactorButton:function(t,e){var o=this.redactor.toolbar.getButton(t);if(o){var r=o.$icon.get(0),i=t+"_placeholder",n=this.redactor.toolbar.addButtonAfter(t,i,{title:e});o.remove();var s=this.redactor.toolbar.addButtonAfter(i,t,{title:e});return n.remove(),s.setIcon(r),s}},showContextBar:function(o,r){if(this.justResized)this.justResized=!1;else{var t=this.redactor.selection.getCurrent(),e=this.redactor.inspector.parse(t),i=function(t,e){var o=t.clientY-e.$contextbar.height()-10,r={left:t.clientX-e.$contextbar.width()/2+"px",top:o+"px"};e.$contextbar.css(r)};if(!e.isFigcaption()&&e.isComponentType("image")){var n=e.getComponent(),s=c(n).find("img");if(1===s.length){var a=a=s.attr("src").match(/#asset:(\d+)/i);if(a){var d=a[1];Craft.postActionRequest("redactor",{assetId:d},function(t){if(t.success){var e={"image-editor":{title:this.redactor.lang.get("image-editor"),api:"plugin.craftAssetImageEditor.open",args:d},edit:{title:this.redactor.lang.get("edit"),api:"module.image.open"},remove:{title:this.redactor.lang.get("delete"),api:"module.image.remove",args:n}};r.set(o,n,e)}i(o,r)}.bind(this))}}}i(o,r)}}},{handleRedactorInit:function(){Craft.RedactorInput.currentInstance.onInitRedactor(this)}})}(jQuery);
//# sourceMappingURL=RedactorInput.min.js.map
