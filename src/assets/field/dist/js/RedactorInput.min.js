!function(n){Craft.RedactorInput=Garnish.Base.extend({id:null,linkOptions:null,volumes:null,elementSiteId:null,redactorConfig:null,$textarea:null,redactor:null,linkOptionModals:null,init:function(t){if(this.id=t.id,this.linkOptions=t.linkOptions,this.volumes=t.volumes,this.transforms=t.transforms,this.elementSiteId=t.elementSiteId,this.redactorConfig=t.redactorConfig,this.linkOptionModals=[],this.redactorConfig.lang||(this.redactorConfig.lang=t.redactorLang),this.redactorConfig.direction||(this.redactorConfig.direction=t.direction||Craft.orientation),this.redactorConfig.imageUpload=!0,this.redactorConfig.fileUpload=!0,this.redactorConfig.dragImageUpload=!1,this.redactorConfig.dragFileUpload=!1,typeof this.redactorConfig.plugins!=typeof[]&&(this.redactorConfig.plugins=[]),this.redactorConfig.plugins.push("craftAssetImages"),this.redactorConfig.plugins.push("craftAssetFiles"),this.redactorConfig.plugins.push("craftEntryLinks"),this.redactorConfig.buttons){var e;-1!==(e=n.inArray("html",this.redactorConfig.buttons))&&(this.redactorConfig.buttons.splice(e,1),this.redactorConfig.plugins.unshift("source")),-1!==(e=n.inArray("formatting",this.redactorConfig.buttons))&&this.redactorConfig.buttons.splice(e,1,"format");for(var i,r=["unorderedlist","orderedlist","undent","indent"],o=0;o<r.length;o++)-1!==(e=n.inArray(r[o],this.redactorConfig.buttons))&&(this.redactorConfig.buttons.splice(e,1),(void 0===i||e<i)&&(i=e));void 0!==i&&this.redactorConfig.buttons.splice(i,0,"lists")}this.redactorConfig.callbacks={started:Craft.RedactorInput.handleRedactorInit},this.initRedactor(),void 0!==Craft.livePreview&&(Craft.livePreview.on("beforeEnter beforeExit",n.proxy(function(){this.redactor.core.destroy()},this)),Craft.livePreview.on("enter slideOut",n.proxy(function(){this.initRedactor()},this)))},mergeCallbacks:function(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}},initRedactor:function(){var t="#"+this.id;if(this.$textarea=n(t),this.redactorConfig.toolbarFixed){var e=this.$textarea.closest("#content-container, .lp-editor");e.length&&(this.redactorConfig.toolbarFixedTarget=e)}(Craft.RedactorInput.currentInstance=this).$textarea.redactor(this.redactorConfig),this.redactor=$R(t),this.redactor.plugin.craftAssetImages.overrideButton("image"),this.redactor.plugin.craftAssetImages.setTransforms(this.transforms),this.redactor.plugin.craftAssetImages.setVolumes(this.volumes),this.redactor.plugin.craftAssetImages.setElementSiteId(this.elementSiteId),this.redactor.plugin.craftAssetFiles.overrideButton("file"),this.redactor.plugin.craftAssetFiles.setVolumes(this.volumes),this.redactor.plugin.craftAssetFiles.setElementSiteId(this.elementSiteId),this.redactor.plugin.craftEntryLinks.setElementSiteId(this.elementSiteId),this.linkOptions.length&&this.redactor.plugin.craftEntryLinks.setLinkOptions(this.linkOptions),delete Craft.RedactorInput.currentInstance},onInitRedactor:function(t){this.redactor=t,this.redactor.container.getElement().addClass("focusable-input"),this.redactor.opts.toolbar&&this.customizeToolbar(),this.leaveFullscreetOnSaveShortcut()},customizeToolbar:function(){if(this.volumes.length){var t=this.replaceRedactorButton("image",this.redactor.lang.get("image"));this.replaceRedactorButton("file",this.redactor.lang.get("file"));t&&t.$icon.on("cick",n.proxy(this,"onImageButtonClick"))}else if(this.redactor.button.remove("image"),this.redactor.button.remove("file"),this.linkOptions.length){var e=this.replaceRedactorButton("link",this.redactor.lang.get("link"));if(e){for(var i={},r=0;r<this.linkOptions.length;r++)i["link_option"+r]={title:this.linkOptions[r].optionTitle,func:n.proxy(this,"onLinkOptionClick",r)};n.extend(i,{link:{title:this.redactor.lang.get("link-insert"),func:"link.show",observe:{element:"a",in:{title:this.redactor.lang.get("link-edit")},out:{title:this.redactor.lang.get("link-insert")}}},unlink:{title:this.redactor.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}),this.redactor.button.addDropdown(e,i)}}},onImageButtonClick:function(){this.redactor.selection.save(),void 0===this.assetSelectionModal?this.assetSelectionModal=Craft.createElementSelectorModal("craft\\elements\\Asset",{storageKey:"RedactorInput.ChooseImage",multiSelect:!0,sources:this.volumes,criteria:{siteId:this.elementSiteId,kind:"image"},onSelect:n.proxy(function(t,e){if(t.length){this.redactor.selection.restore();for(var i=0;i<t.length;i++){var r=t[i],o=r.url+"#asset:"+r.id;e&&(o+=":transform:"+e),this.redactor.insert.node(n("<"+this.redactor.opts.imageTag+'><img src="'+o+'" /></figure>')[0]),this.redactor.code.sync()}this.redactor.observe.images()}},this),closeOtherModals:!1,transforms:this.transforms}):this.assetSelectionModal.show()},onFileButtonClick:function(){this.redactor.selection.save(),void 0===this.assetLinkSelectionModal?this.assetLinkSelectionModal=Craft.createElementSelectorModal("craft\\elements\\Asset",{storageKey:"RedactorInput.LinkToAsset",sources:this.volumes,criteria:{siteId:this.elementSiteId},onSelect:n.proxy(function(t){if(t.length){this.redactor.selection.restore();var e=t[0],i=e.url+"#asset:"+e.id,r=this.redactor.selection.text(),o=0<r.length?r:e.label;this.redactor.insert.node(n('<a href="'+i+'">'+o+"</a>")[0]),this.redactor.code.sync()}},this),closeOtherModals:!1,transforms:this.transforms}):this.assetLinkSelectionModal.show()},onLinkOptionClick:function(t){if(this.redactor.selection.save(),void 0===this.linkOptionModals[t]){var s=this.linkOptions[t];this.linkOptionModals[t]=Craft.createElementSelectorModal(s.elementType,{storageKey:s.storageKey||"RedactorInput.LinkTo."+s.elementType,sources:s.sources,criteria:n.extend({siteId:this.elementSiteId},s.criteria),onSelect:n.proxy(function(t){if(t.length){this.redactor.selection.restore();var e=t[0],i=e.url+"#"+s.refHandle+":"+e.id,r=this.redactor.selection.text(),o=0<r.length?r:e.label;this.redactor.insert.node(n('<a href="'+i+'">'+o+"</a>")[0]),this.redactor.code.sync()}},this),closeOtherModals:!1})}else this.linkOptionModals[t].show()},onEditorFocus:function(){this.redactor.core.box().addClass("focus"),this.redactor.core.box().trigger("focus")},onEditorBlur:function(){this.redactor.core.box().removeClass("focus"),this.redactor.core.box().trigger("blur")},leaveFullscreetOnSaveShortcut:function(){void 0!==this.redactor.fullscreen&&"function"==typeof this.redactor.fullscreen.disable&&Craft.cp.on("beforeSaveShortcut",n.proxy(function(){this.redactor.fullscreen.isOpen&&this.redactor.fullscreen.disable()},this))},replaceRedactorButton:function(t,e){var i=this.redactor.toolbar.getButtonsKeys();if(-1!=i.indexOf(t)){var r=this.redactor.toolbar.getButtonByIndex(i.indexOf(t)),o=r.$icon.get(0),s=t+"_placeholder",n=this.redactor.toolbar.addButtonAfter(t,s,{title:e});r.remove();var a=this.redactor.toolbar.addButtonAfter(s,t,{title:e});return n.remove(),a.setIcon(o),a}}},{handleRedactorInit:function(){}})}(jQuery);
//# sourceMappingURL=RedactorInput.min.js.map
