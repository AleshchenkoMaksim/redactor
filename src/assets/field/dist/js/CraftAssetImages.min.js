var plugin=$.extend({},Craft.Redactor.PluginBase,{title:"image",apiTarget:"plugin.craftAssetImages.showModal",icon:'<i class="re-icon-image"></i>',transforms:[],volumes:null,allowAllUploaders:!1,modalState:{selectedTransform:null},showModal:function(){if(this.app.selection.isCollapsed()?(this.app.selection.save(),this.app.selectionMarkers=!1):(this.app.selection.saveMarkers(),this.app.selectionMarkers=!0),void 0===this.assetSelectionModal){const e={siteId:this.elementSiteId,kind:"image"};this.allowAllUploaders&&(e.uploaderId=null),this.assetSelectionModal=Craft.createElementSelectorModal("craft\\elements\\Asset",{storageKey:"RedactorInput.ChooseImage",multiSelect:!0,sources:this.volumes,criteria:e,onSelect:function(e,s){if(e.length){this.app.selectionMarkers?this.app.selection.restoreMarkers():this.app.selection.restore(),this.app.selectionMarkers=!1;const a={};for(var t=0;t<e.length;t++){const o=e[t];a["asset"+o.id]={url:this._buildAssetUrl(o.id,o.url,s),id:o.id}}this.app.api("module.image.insert",a)}}.bind(this),closeOtherModals:!1,transforms:this.transforms})}else this.assetSelectionModal.show()},setTransforms:function(e){this.transforms=e},setVolumes:function(e){this.volumes=e},_buildAssetUrl:(e,s,t)=>s+"#asset:"+e+":"+(t?"transform:"+t:"url"),_getAssetUrlComponents:e=>{const s=e.match(/(.*)#asset:(\d+):(url|transform):?([a-zA-Z][a-zA-Z0-9_]*)?/);return s?{url:s[1],assetId:s[2],transform:"url"!==s[3]?s[4]:null}:null},onmodal:{imageedit:{open:function(e,s){this.modalState.selectedTransform=null;const t=this._getAssetUrlComponents(this.app.module.image.$image.$element.nodes[0].src);if(!t)return;const{transform:a}=t;this.modalState.selectedTransform=a;let o=[{handle:"",name:"No transform"}].concat(this.transforms);const n=$('<select id="modal-image-transform"></select>').on("change",function(e){this.modalState.selectedTransform=$(e.currentTarget).val()}.bind(this));for(optionIndex in o){let e=o[optionIndex],s=a&&e.handle==a;n.append('<option value="'+e.handle+'"'+(s?' selected="selected"':"")+">"+e.name+"</option>")}const l=$('<div class="form-item form-item-transform"><label for="modal-image-transform">Transform</label></div>').append(n);$(s.nodes[0]).append(l)}}},onimage:{changed:function(e){const s=$(e.$element.nodes[0]),t=this._getAssetUrlComponents(s.attr("src")),a=this.modalState.selectedTransform;if(!t)return;const{transform:o,assetId:n,url:l}=t;if(o!=a)if(s.fadeTo(100,.2),a.length){var r={assetId:n,handle:a};Craft.postActionRequest("assets/generate-transform",r,function(e,t){"success"===t&&e.url&&(s.prop("src",this._buildAssetUrl(n,e.url,a)),s.stop().fadeTo(0,1))}.bind(this))}else{let e=new RegExp("(.*)(_"+o+".*/)(.*)");s.prop("src",this._buildAssetUrl(n,l.replace(e,"$1$3"),a)),s.stop().fadeTo(0,1)}}}});Redactor.add("plugin","craftAssetImages",plugin);
//# sourceMappingURL=CraftAssetImages.min.js.map
