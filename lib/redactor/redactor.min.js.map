{"version":3,"sources":["redactor.js"],"names":["Ajax","settings","post","options","AjaxRequest","get","method","defaults","url","before","success","error","data","async","headers","this","p","extend","toUpperCase","prepareData","xhr","XMLHttpRequest","open","setHeaders","send","prototype","obj1","obj2","name","isFormData","toParams","setRequestHeader","window","FormData","isComplete","status","onload","loaded","bind","call","response","json","parseJson","statusText","str","replace","o","JSON","parse","e","obj","Object","keys","map","k","encodeURIComponent","join","DomCache","DomExpando","Date","DomDisplayCache","Dom","selector","context","ready","fn","document","readyState","addEventListener","dom","length","nodes","reHtmlTest","nodeType","childNodes","test","create","_query","_slice","html","createElement","RegExp","$1","elements","container","children","innerHTML","i","l","push","add","concat","_toArray","index","getAll","eq","first","last","contents","each","callback","len","is","filter","undefined","node","Node","indexOf","matches","msMatchesSelector","webkitMatchesSelector","not","find","ns","parent","parentNode","parents","_getContext","closest","isNode","next","nextSibling","nextElement","nextElementSibling","prev","previousSibling","prevElement","previousElementSibling","css","value","_getHeightOrWidth","getComputedStyle","key","style","attr","checked","getAttribute","removeAttribute","setAttribute","reDataAttr","attrs","attributes","nodeName","dataName","match","val","g","_isNumber","parseFloat","_getBooleanFromStr","el","type","removeAttr","split","forEach","removeData","dataset","dataindex","dataget","cacheIndex","nextCacheIndex","addClass","_eachClass","removeClass","toggleClass","hasClass","some","classList","contains","empty","append","text","textContent","after","_inject","frag","insertAdjacentHTML","elms","reverse","insertBefore","appendChild","prepend","firstChild","wrap","wrapper","unwrap","$node","replaceWith","docFrag","createDocumentFragment","result","replaceChild","remove","removeChild","clone","events","copy","_clone","_cloneEvents","show","_getRealDisplay","old","display","body","testElem","hide","scrollTop","isWindow","isDocument","scrollingElement","documentElement","pageYOffset","scrollTo","offset","_getDim","position","width","adjust","_getSize","height","outerWidth","_getInnerOrOuter","outerHeight","innerWidth","innerHeight","click","_triggerEvent","focus","trigger","names","ev","opts","bubbles","cancelable","CustomEvent","createEvent","initCustomEvent","dispatchEvent","on","handler","one","event","_getEventName","namespace","_getEventNamespace","_getOneHandler","_e","off","testEvent","testNamespace","testEventNamespace","testPositive","_offEvent","serialize","asObject","disabled","z","opt","selected","_toParams","ajax","_queryContext","querySelectorAll","element","getElementById","slice","getElementsByClassName","getElementsByTagName","querySelector","res","_events","cloneNode","self","apply","arguments","arr","condition","handlers","toString","removeEventListener","splice","_getDocSize","Math","max","captype","round","_adjustResultHeightOrWidth","charAt","$el","$targets","fixStyle","tmp","thisStyle","fix","isBorderBox","boxSizing","borderTopWidth","borderBottomWidth","marginTop","marginBottom","borderLeftWidth","borderRightWidth","marginLeft","marginRight","top","left","_getPosition","offsetTop","offsetLeft","_getOffset","rect","getBoundingClientRect","doc","ownerDocument","docElem","win","defaultView","clientTop","pageXOffset","clientLeft","NodeList","params","_encodeUri","isNaN","elem","currentStyle","getPropertyValue","uuid","$R","RedactorApp","version","modules","services","classes","plugins","mixins","modals","lang","keycodes","BACKSPACE","DELETE","UP","DOWN","ENTER","SPACE","ESC","TAB","CTRL","META","SHIFT","ALT","RIGHT","LEFT","env","plugin","module","service","class","mixin","jQuery","redactor","toArray","args","instance","Array","isArray","isApi","App","methodValue","isDestroy","unshift","api","translations","F","inherit","addLang","init","current","f","prop","__lookupGetter__","__defineGetter__","super","exception","extended","deep","hasOwnProperty","merge","animation","direction","spellcheck","structure","scrollTarget","styles","stylesClass","placeholder","source","showSource","inline","breakline","markup","enterKey","clickToEdit","clickToSave","clickToCancel","focusEnd","minHeight","maxHeight","maxWidth","callbacks","preClass","preSpaces","tabindex","tabAsSpaces","tabKey","autosave","autosaveName","autosaveData","toolbar","toolbarFixed","toolbarFixedTarget","toolbarFixedTopOffset","toolbarExternal","toolbarContext","air","formatting","formattingAdd","formattingHide","buttons","buttonsTextLabeled","buttonsAdd","buttonsAddFirst","buttonsAddAfter","buttonsAddBefore","buttonsHide","buttonsHideOnMobile","imageUpload","imageUploadParam","imageData","imageEditable","imageCaption","imagePosition","imageResizable","imageFloatMargin","imageFigure","fileUpload","fileUploadParam","fileData","fileAttachment","uploadData","dragUpload","multipleUpload","clipboardUpload","uploadBase64","linkTarget","linkTitle","linkNewTab","linkNofollow","linkSize","linkValidation","cleanOnEnter","cleanInlineOnEnter","paragraphize","removeScript","removeNewLines","removeComments","replaceTags","b","strike","pastePlainText","pasteLinkTarget","pasteImages","pasteLinks","pasteClean","pasteKeepStyle","pasteKeepClass","pasteKeepAttrs","pasteBlockTags","pasteInlineTags","activeButtons","strong","em","del","u","activeButtonsAdd","activeButtonsObservers","autoparse","autoparseStart","autoparsePaste","autoparseLinks","autoparseImages","autoparseVideo","shortcodes","p.","format","quote.","pre.","h1.","h2.","h3.","h4.","h5.","h6.","1.","*.","shortcodesAdd","shortcuts","ctrl+shift+m, meta+shift+m","ctrl+b, meta+b","ctrl+i, meta+i","ctrl+u, meta+u","ctrl+h, meta+h","ctrl+l, meta+l","ctrl+k, meta+k","ctrl+alt+0, meta+alt+0","ctrl+alt+1, meta+alt+1","ctrl+alt+2, meta+alt+2","ctrl+alt+3, meta+alt+3","ctrl+alt+4, meta+alt+4","ctrl+alt+5, meta+alt+5","ctrl+alt+6, meta+alt+6","ctrl+shift+7, meta+shift+7","ctrl+shift+8, meta+shift+8","shortcutsAdd","grammarly","bufferLimit","emptyHtml","markerChar","imageTypes","inlineTags","blockTags","regex","youtube","vimeo","imageurl","input","zindex","modes","original","image","file","link","bold","italic","deleted","underline","superscript","subscript","bold-abbr","italic-abbr","deleted-abbr","underline-abbr","superscript-abbr","subscript-abbr","lists","link-insert","link-edit","link-in-new-tab","unlink","cancel","close","insert","save","delete","edit","title","paragraph","quote","code","heading1","heading2","heading3","heading4","heading5","heading6","filename","optional","unorderedlist","orderedlist","outdent","indent","horizontalrule","upload","upload-label","accessibility-help-label","caption","bulletslist","numberslist","image-position","none","right","center","undo","redo","icon","dropdown","tag","blockquote","pre","h1","h2","h3","h4","h5","h6","tooltip","sup","sub","observe","ul","ol","line","instances","started","stopped","rootElement","rootOpts","dragInside","dragComponentInside","$win","$doc","$body","editorReadOnly","buildServices","buildModules","buildPlugins","start","broadcast","stop","isStarted","isStopped","core","bindable","inj","isDragInside","setDragInside","isDragComponentInside","setDragComponentInside","getDragComponentInside","isReadOnly","enableReadOnly","component","clearActive","disableButtons","disableReadOnly","enableButtons","callMessageHandler","func","utils","checkProperty","moduleName","isApp","isCallback","isService","isPlugin","isModule","callInstanceMethod","isInstanceExists","Error","buildArgs","applyArgs","selection","_clearAll","clearClass","tags","$elements","getElements","_unwrapSpanWithoutAttr","restore","clearStyle","clearAttr","_removeAllAttr","set","toggle","newVal","oldVal","isRgb","rgb2hex","hex2long","toLowerCase","_convertStyleQuotes","removeEmptyAttr","nodeAttr","removeAttributeNode","finalNodes","tagName","cmnt","app","vars","_build","rebuild","_set","_loop","path","animationOpt","duration","iterate","delay","timing","prefix","AnimatePlay","effect","hidableEffects","prefixes","buildAnimationOff","isInanimate","inanimate","animate","isHidable","buildHideClass","isAnimated","setTimeout","complete","clean","setStart","_setCaret","setEnd","setBefore","setAfter","isStart","_isStartOrEnd","isEnd","setAtEnd","inspector","getTag","range","createRange","_isInPage","textNode","createInvisibleChar","setStartBefore","collapse","selectNodeContents","setRange","setAtStart","isInline","isEmpty","insertNode","setAtBefore","setAtAfter","setStartAfter","setAtPrev","_isEmptyTextNode","setAtNext","getNode","_setStart","isText","editor","findFirstNode","item","getFirstElement","dataItem","isComponent","getComponent","isComponentType","isFigcaption","findLastNode","table","getTable","tableData","setActive","_setInline","_setEnd","getLastElement","_setBefore","isFirstTableCell","isFirstListItem","getList","isBlock","_setAfter","isLastTableCell","_hasInlineChild","_getStartEndNode","trimSpaces","isComponentEditable","end","size","pos","getFirstNode","getLastNode","isInlineTag","trim","removeInvisibleChars","getFigcaption","isTable","isList","sel","anchorNode","isInEditor","isEditor","isCollapsed","getRange","isBackwards","backwards","anchorOffset","focusNode","focusOffset","collapsed","detach","isIn","getCurrent","block","getBlock","blocks","getBlocks","isTableCellTag","isAll","isNonEditable","isActive","$editor","getElement","output","cleaner","getHtml","getText","hasNonEditable","$wrapper","getSelection","removeAllRanges","addRange","setAll","saveScroll","disableNonEditables","marker","build","restoreMarkers","getComponentCodeElement","enableNonEditables","restoreScroll","rangeCount","getRangeAt","getTextBeforeCaret","num","cloneRange","getTextAfterCaret","clonedRange","endContainer","endOffset","getPosition","startOffset","startContainer","bottom","getActive","getParent","isElement","getInline","_isInlineNode","getInlineFirst","getInlineAll","inlines","isBlockTag","getInlinesAllSelected","getInlines","all","textNodes","getNodes","textnodes","_isTextSelected","_filterNodesByTags","filteredNodes","_isInNodesArray","inside","_filterInlinesInside","_filterBlocksFirst","activeComponent","_getNodesComponent","_getRangeSelectedNodes","_filterServicesNodes","_filterEditor","_filterNodesTexts","_filterNodesElements","cloneContents","clear","collapseToStart","collapseToEnd","saveActiveComponent","savedComponent","restoreActiveComponent","_clearSaved","saved","savedElement","caret","saveMarkers","_getNextNode","hasChildNodes","startNode","endNode","getChildNodes","commonAncestorContainer","skip","keepbr","passtexts","nodeTag","isFirst","isCellParent","containsNode","search","$element","_buildType","isType","getType","scrolltop","pasting","isFocus","_isContenteditableFocus","startFocus","endFocus","isPasting","enablePasting","disablePasting","_getScrollTarget","$noneditables","isSourceMode","keeplists","isEmptyHtml","$active","activeElement","setEmpty","editableElement","$container","$source","content","_buildName","_buildStartedContent","getCode","getName","getStartedContent","setCode","insertion","isNameGenerated","sourceElement","$statusbar","items","update","$item","getItems","removeItems","dropdownOpened","buttonsObservers","_extendActiveButtons","stopObservers","$toolbar","setButtonsInactive","button","observer","getButton","_inlinesToTags","detector","isMobile","isAir","isFixed","isContextBar","isTarget","getWrapper","getDropdown","getTargetElement","$btn","_findButton","getButtonByIndex","getButtons","_findButtons","getButtonsKeys","addButton","btnObj","$button","addButtonFirst","addButtonAfter","addButtonBefore","addButtonObserver","setDropdown","$buttons","setInactive","setButtonsActive","disable","enable","_init","isDisabled","hasIcon","message","setMessage","setApi","setTitle","alt","aria-label","setTooltip","setIcon","$icon","_buildTooltip","hideTooltip","preventDefault","_parseTitle","_parseTooltip","_buildCallback","_buildAttributes","_buildObserver","_buildIcon","href","rel","role","isHtml","isDesktop","created","$items","isOpened","$dropdown","getItem","getItemsByClass","classname","_closeAll","_observe","_handleKeyboard","updatePosition","target","_isButton","_close","btnHeight","btnWidth","leftFix","_buildDom","_buildItems","_buildFormattingItems","which","$span","getTitle","storedComponents","storedImages","storedLinks","deniedTags","convertRules","unconvertRules","reComments","reSpacedEmpty","reScriptTag","addConvertRules","addUnconvertRules","encodePreCode","convert","storeComponents","_setSpanAttr","_setStyleCache","removeTags","_removeScriptTag","_replaceScriptTag","_isSpacedEmpty","restoreComponents","_cleanWrapped","removeMarkers","removeInvisibleSpaces","_isParagraphEmpty","removeServiceTagsAndAttrs","removeSpanWithoutAttributes","removeFirstBlockBreaklineInHtml","_unreplaceScriptTag","_setPreClass","_setLinkNofollow","cleanNewLines","unconvert","removeEmptyAttributes","cleanSpacesInPre","tidy","paste","isMsWord","_isHtmlMsWord","_cleanGDocs","_cleanMsWord","exceptedTags","removeTagsExcept","buildWrapper","$elms","filterStyle","filterClass","filterAttrs","$li","getWrapperHtml","storeLinks","storeImages","getPlainText","_replaceNlToBr","restoreLinks","restoreImages","getFlatText","$div","innerText","replaceToTag","replaceNbspToSpaces","replaceBlocksToBr","removeNl","removeBrAtEnd","denied","re","replacer","$0","except","encodeHtml","encodeEntities","matched","_encodeOuter","_encodePreCodeLine","_decodeMarkers","decodeEntities","encodePhpCode","String","getElementsFromHtml","_storeMatched","_restoreMatched","spaces","floor","exec","parseInt","_parseWordLists","hasAttribute","lines","space","lastLevel","pnt","currentLevel","txt","listTag","$list","stored","outerHTML","encoded","rules","_convertImage","_convertLine","_convertIframe","_convertTable","_convertForm","_convertCode","_convertWidget","_setContenteditableCode","_acceptExtraRules","_unconvertWidget","_unconvertForm","_unconvertTable","_unconvertImages","_removeTypes","lastChild","_isNonEditable","getRandomId","$link","$figure","_setFigure","_wrapFigure","src","isVideo","encodeURI","decodeURI","hasFigcaption","hasStyle","removed","$code","remStart","remEnd","paragraphizeTags","_isConverted","_convert","markupTag","_storeTags","_trimEmptyLines","_restoreTags","replacement","createTextNode","_isDisabled","_isEmptyHtml","userAgent","navigator","isWebkit","isFirefox","isIe","v","documentMode","ie","isIpad","trimmed","_getString","_setComponentOffset","charIndex","nodeStack","foundStart","pop","nextCharIndex","_isFigcaptionNext","nodeValue","_extendTags","_isTag","isHeadingTag","$component","getComponentType","isComponentActive","types","isPre","getPre","isCode","$parent","_getLastOrFirstListItem","isLastListItem","_getLastOrFirstTableCell","isHeading","getHeading","isBlockquote","getBlockquote","isDl","getDl","isParagraph","getParagraph","isLink","getLink","isFile","getFile","hasParent","_getClosestNode","getParentList","_getClosestUpNode","getListItem","getTableCell","$td","getImageElement","_getClosestElement","list","id","_getPos","className","buildHtml","side","atStart","cloned","setEndBefore","$context","$marker","_restoreInject","activeClass","findSiblings","cell","_find","$caret","_buildCaret","setOnEvent","contextmenu","executeScripts","scripts","eval","fragment","isFragment","createFragment","_collapseSelection","_insertFragment","_sendNodes","insertBreakLine","insertNewline","insertText","insertHtml","insertChar","charhtml","insertRaw","insertPoint","markerInserted","x","clientX","y","clientY","caretPositionFromPoint","offsetNode","caretRangeFromPoint","insertToPoint","point","lastNode","insertToOffset","parsedInput","parseHtml","_insertToAllSelected","dataCurrent","_getCleanedInput","isFigure","_isFigure","isComponentSpan","_isComponentSpan","isInsertedText","_insertToEmptyEditor","_insertToWidget","_insertToInline","splitNode","_insertToCode","_insertToPre","_hasBlocksAndImages","_isPlainHtml","_containsTags","_buildList","insertedHtml","dataInserted","normalizeTextNodes","deleteContents","isLastInline","_isLastInline","ucfirst","isPreformatted","_getContainer","createTmpContainer","parentListTag","_hasFigureOrTable","_hasBlocks","_isHtmlString","_prepareTag","_format","_getTags","_wrapInsideTable","clearFormat","replacedTag","nextBr","_getTextNodesData","_replaceBlocks","_getReplacedTag","_combinePre","_cleanBlocks","_isToggleFormatType","firstNode","count","combinedNodes","$current","$next","newline","headings","_isFormat","arrangeTag","formatCollapsed","formatUncollapsed","replaced","$secondPart","extractedContent","$inline","dataInline","hasSameArgs","insertInline","extractHtmlFromCaret","cloneAttributes","$breaked","$last","same","nodeAttrValue","origRules","styleToObj","innerCount","ruleName","ruleValue","_convertTags","_convertToStrike","execCommand","_clearDecoration","_revertToInlines","_clearEmptyStyle","_normalizeBlocks","_revertTags","_replaceToStrike","_forceRemoveClass","removeFromArrayByValue","textDecoration","textDecorationLine","_clearEmptyStyleAttr","escapeRegExp","$objects","$object","_isKey","singleReplace","reTags","imagesMatches","_formatLinks","_convertToRegExp","$img","setSrc","$video","$cloned","linkProtocol","regexB","substring","decodeURIComponent","observeImages","_addImage","observeFiles","_addFile","setStatus","getChanges","searchInvisibleChars","n","div","extractContents","createMarkup","exclude","elems","thisArg","newArr","recursive","nestedNodes","getChildElements","_getFirst","_getLast","$replaced","ax","a","elFrom","elTo","rule","extendData","serializedData","_setData","normalize","rgb","s","possible","random","$box","$bar","_is","_destroy","onstart","_startStop","onstop","onenable","ondisable","_buildModes","_buildMarkup","_redefineOptions","_isRootOption","autoparser","onenablefocus","_enableFocus","oncontextmenu","onclick","onkeyup","onenablereadonly","_enableReadOnly","ondisablereadonly","_disableReadOnly","onautoparseobserve","onplaceholder","_buildPlaceholder","_togglePlacehodler","_buildEvents","_buildOptions","_buildAccesibility","classesEditor","classesContainer","_destroyEvents","contenteditable","_disableBrowsersEditing","max-width","margin","aria-labelledby","_enableFocusSource","_enableFocusEditor","setSelectionRange","attachEvent","returnValue","destroy","_getEditables","blurNamespace","eventsList","isFocused","isBlured","blur","$target","targets","stopBlur","cut","_passSelectionToClipboard","drop","originalEvent","stopPropagation","_removeOverClass","$dragComponent","dataTransfer","getData","dragenter","dragstart","_setDragData","dragover","dragleave","detail","keydown","keyup","mouseup","touchstart","clipboard","clipboardData","setData","dt","effectAllowed","$label","aria-hidden","syncedHtml","onstartcode","sourceContent","startContent","syncContent","onstartcodeshow","ontrytosync","sync","_buildClasses","sourceSelection","editorHtml","insertMarkersToEditor","editorHeight","_onChangedSource","_onTabKey","_onFocus","setSelectionOffsetSource","_disableButtons","_setActiveSourceButton","insertMarkersToSource","_enableButtons","_setInactiveSourceButton","isOffset","isOffsetEnd","_isSync","timeout","clearTimeout","_syncing","keyCode","selectionStart","selectionEnd","markersOffset","markersOffsetEnd","_getHtmlAndRemoveMarkers","startMarker","endMarker","_strpos","markerStart","markerEnd","markerLength","_enlargeOffset","substr","haystack","needle","htmlLength","c","observerUnit","MutationObserver","subtree","childList","characterData","characterDataOldValue","disconnect","mutations","mutation","_iterate","onstartclicktoedit","_isEnabled","buttonSave","buttonCancel","_setFocus","objected","enabled","statusbar","oncontextbar","$contextbar","_buildPosition","barWidth","barHeight","docScrollTop","targetOffset","topFix","_buildTitle","_buildMessage","_toggle","toolbarModule","onsource","resetPosition","opened","createSourceHelper","destroySourceHelper","closed","openSelected","onobserve","onfocus","_setExternalOnFocus","onsourcefocus","onempty","_buildButtons","_initToolbar","_initButtons","_buildImageButton","_buildFileButton","_buildSourceButton","_buildAdditionalButtons","_buildHiddenButtons","_removeExistButtons","btns","setExternal","clicks","$airHelper","_isSelection","_open","_openCmd","_isOpened","dataTarget","isModalTarget","isButtonCall","_doOpen","containerOffset","isDropdownCall","$fixedTarget","reset","_doFixed","isHeight","toolbarHeight","boxOffset","scrollOffset","relativeTopPoint","abs","fixedScrollTimeout","isExternalMultiple","_findToolbars","$toolbars","$external","_buildExternal","_buildFixed","_initExternal","_hideToolbarsExceptFirst","contextbar","_buildWrapper","_buildElement","_initWrapper","data-redactor-type","isCurrentLink","currentText","onmodal","$modal","$form","_setFormData","_setFormFocus","_validateData","_update","_insert","_unlink","onbutton","_observeButton","ondropdown","_observeUnlink","_observeEdit","_getCurrent","$point","_truncateText","_buildCurrent","_getModalData","_getLinks","_resetCurrent","_setLinkData","links","_insertSingle","_removeInSelection","_insertMultiple","$clonedLink","_isCurrentTextChanged","_deleteContents","textContext","isTextChanged","linkData","commands","_isLink","handle","currentLink","setError","getField","reUrl","_get","_get_target","_get_url","_get_title","_get_text","_findDeepestChild","_set_target","_set_text","_set_title","_set_url","_cleanUrl","_isMailto","_isUrl","depth","child","childResult","$overlay","resize","setWidth","_buildDefaults","_openUrl","_openTemplate","template","_createModal","_buildModalBox","_buildOverlay","_buildModal","_buildModalForm","_buildModalCommands","_broadcast","_buildModalTabs","_opened","_handleEscape","getBody","_handleEnter","_needToClose","_closed","$modalForm","setHeight","$footer","getFooter","_handleCommand","$tabs","_showTab","getForm","isCloseNode","command","getHeader","$modalHeader","$modalBody","$modalFooter","margin-left","windowHeight","$modalClose","_buildClose","_buildHeader","_buildBody","_buildFooter","_buildTemplate","_getFieldEventName","_clearError","clearformat","clearstyle","clearclass","clearattr","onsynced","_send","_complete","lastShiftKey","onpaste","onkeydown","ctrlKey","metaKey","altKey","_selectAll","_isDeleteKey","_isArrowKey","shiftKey","_isRightLeftKey","_isExitVariable","_isRightDownKey","_isExitOnDownRight","_selectComponent","_isLeftUpKey","_isExitOnUpLeft","_removeInvisibleSpace","isEndEditor","_exitNextElement","isNext","sibling","siblingBlock","_selectComponentItem","_removeActiveComponent","_removeAllSelectedTable","_detectVariableOrNonEditable","_traverseBackspace","_traverseDelete","_removeUnwantedStyles","_removeEmptySpans","_removeSpanTagsInHeadings","_removeInlineTagsInPre","isBlockStart","isBlockEnd","isCurrentStart","isCurrentEnd","isCurrentStartSpace","isCurrentEndSpace","_isVariable","_getBlock","dataNext","isNextBlock","$currentList","$first","$lists","$prev","dataPrev","isPrevBlock","$newnode","_replaceBlock","$block","_isNeedToReplaceBlock","_insertBreak","_isExit","_traverse","_disable","isParagraphExit","_isExitableBlock","isBreaklineExit","_isExitableDblBreak","_exitFromElement","blockTag","_traverseDl","nextDd","nextDt","dd","_clearBlock","_isNeedToCleanBlockStyle","pasteHtml","pointInserted","dropPasted","isRawCode","_isPlainText","files","isFiles","getAsFile","_insertFiles","_restoreSelection","returned","isImage","isClipboard","worked","hotkeys","8","9","10","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","59","61","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","173","186","187","188","189","190","191","192","219","220","221","222","hotkeysShiftNums","`","1","2","3","4","5","6","7","0","-","=",";","'",",",".","/","\\","_handler","special","character","fromCharCode","modif","cmdKeys","specialKey","_insertHardTab","_tabCode","progress","paramName","_buildInput","_buildBox","$uploadbox","box","_onDropBox","_onDragOver","_onDragLeave","$placeholder","_onChange","_onClick","_onDrop","_clear","_setStatusDrop","_setStatusHover","_removeStatusHover","_setStatusError","_setStatusSuccess","_getUploadParam","_buildData","_sendData","Promise","$pre","_initElement","onform","_remove","imageedit","storage","justResized","oninsert","_observeImages","onstarted","resizer","ondropimage","onimageresizer","onupload","_uploadError","_change","imagedrop","imagereplace","_setUpload","$image","_save","onimage","resized","_isImage","_createImageAndStore","inserted","_removeSpaceBeforeFigure","img","align","modal","changeImage","$previewBox","_setReplaceUpload","_buildPreview","_buildPreviewUpload","$preview","$previewImg","$desc","_set_src","_set_id","_set_caption","$figcaption","_set_align","imageFloat","imageMargin","textAlign","positions","alignClass","float","text-align","_set_link","_findLink","_get_src","_get_id","_get_caption","_get_align","_get_link","_setResizerPosition","$resizableBox","$resizableImage","$resizer","topOffset","leftOffset","resizerWidth","resizerHeight","resizeHandle","pageX","pageY","ratio","h","targetTouches","_start","_move","_stop","_getResizableBoxWidth","ondropfile","filedrop","$file","_createFileAndStore","_insertAsAttachment","wrapAttachment","modalFormData","_truncateUrl","$remover","removeAttachment","$a","state","passed","keyPressed","savedHtml","savedOffset","undoStorage","redoStorage","_listen","onsyncing","onstate","_isUndo","_isRedo","_saveState","_getUndo","_getRedo","_setUndo","ctrl","cmd","_hasUndo","_removeOverStorage","_setRedo","buffer","_hasRedo","_observeDropdown","_getBlocks","_isUnformat","_unformat","$prevChild","$newList","nextItems","nextList","$listItem","$liItem","isTop","isMiddle","isBottom","_getAllNext","_createUnformatContainer","$childList","countLists","_uniteBlocks","_createList","_createListItem","$oldList","lastcell","$cell","_isUniteBlock","selectedItems","_unformatEntire","_getItemsPosition","_unformatAtSide","ci","$secondList","$innerLists","sFirst","sLast","_observeButtonsList","itemOutdent","itemIndent","_observeIndent","isIndent","param","Redactor"],"mappings":"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","file":"redactor.min.js","sourcesContent":["/*\n    Redactor\n    Version 3.0.8\n    Updated: April 16, 2018\n\n    http://imperavi.com/redactor/\n\n    Copyright (c) 2009-2018, Imperavi Ltd.\n    License: http://imperavi.com/redactor/license/\n*/\n(function() {\nvar Ajax = {};\n\nAjax.settings = {};\nAjax.post = function(options) { return new AjaxRequest('post', options); };\nAjax.get = function(options) { return new AjaxRequest('get', options); };\n\nvar AjaxRequest = function(method, options)\n{\n    var defaults = {\n        method: method,\n        url: '',\n        before: function() {},\n        success: function() {},\n        error: function() {},\n        data: false,\n        async: true,\n        headers: {}\n    };\n\n    this.p = this.extend(defaults, options);\n    this.p = this.extend(this.p, Ajax.settings);\n    this.p.method = this.p.method.toUpperCase();\n\n    this.prepareData();\n\n    this.xhr = new XMLHttpRequest();\n    this.xhr.open(this.p.method, this.p.url, this.p.async);\n\n    this.setHeaders();\n\n    var before = (typeof this.p.before === 'function') ? this.p.before(this.xhr) : true;\n    if (before !== false)\n    {\n        this.send();\n    }\n};\n\nAjaxRequest.prototype = {\n    extend: function(obj1, obj2)\n    {\n        if (obj2) for (var name in obj2) { obj1[name] = obj2[name]; }\n        return obj1;\n    },\n    prepareData: function()\n    {\n        if (this.p.method === 'POST' && !this.isFormData()) this.p.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        if (typeof this.p.data === 'object' && !this.isFormData()) this.p.data = this.toParams(this.p.data);\n        if (this.p.method === 'GET') this.p.url = this.p.url + '?' + this.p.data;\n    },\n    setHeaders: function()\n    {\n        this.xhr.setRequestHeader('X-Requested-With', this.p.headers['X-Requested-With'] || 'XMLHttpRequest');\n        for (var name in this.p.headers)\n        {\n            this.xhr.setRequestHeader(name, this.p.headers[name]);\n        }\n    },\n    isFormData: function()\n    {\n        return (typeof window.FormData !== 'undefined' && this.p.data instanceof window.FormData);\n    },\n    isComplete: function()\n    {\n        return !(this.xhr.status < 200 || this.xhr.status >= 300 && this.xhr.status !== 304);\n    },\n    send: function()\n    {\n        if (this.p.async)\n        {\n            this.xhr.onload = this.loaded.bind(this);\n            this.xhr.send(this.p.data);\n        }\n        else\n        {\n            this.xhr.send(this.p.data);\n            this.loaded.call(this);\n        }\n    },\n    loaded: function()\n    {\n        if (this.isComplete())\n        {\n            var response = this.xhr.response;\n            var json = this.parseJson(response);\n            response = (json) ? json : response;\n\n            if (typeof this.p.success === 'function') this.p.success(response, this.xhr);\n        }\n        else\n        {\n            if (typeof this.p.error === 'function') this.p.error(this.xhr.statusText);\n        }\n    },\n    parseJson: function(str)\n    {\n        try {\n            str = str.replace(/^\\[/, '');\n            str = str.replace(/\\]$/, '');\n\n            var o = JSON.parse(str);\n\n            if (o && typeof o === 'object')\n            {\n                return o;\n            }\n        } catch (e) {}\n\n        return false;\n    },\n    toParams: function (obj)\n    {\n        return Object.keys(obj).map(\n            function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]); }\n        ).join('&');\n    }\n};\nvar DomCache = [0];\nvar DomExpando = 'data' + new Date();\nvar DomDisplayCache = {};\n\nvar Dom = function(selector, context)\n{\n    return this.parse(selector, context);\n};\n\nDom.ready = function(fn)\n{\n    if (document.readyState != 'loading') fn();\n    else document.addEventListener('DOMContentLoaded', fn);\n};\n\nDom.prototype = {\n    get dom()\n    {\n        return true;\n    },\n    get length()\n    {\n        return this.nodes.length;\n    },\n    parse: function(selector, context)\n    {\n        var nodes;\n        var reHtmlTest = /^\\s*<(\\w+|!)[^>]*>/;\n\n        if (!selector)\n        {\n            nodes = [];\n        }\n        else if (selector.dom)\n        {\n            this.nodes = selector.nodes;\n            return selector;\n        }\n        else if (typeof selector !== 'string')\n        {\n            if (selector.nodeType && selector.nodeType === 11)\n            {\n                nodes = selector.childNodes;\n            }\n            else\n            {\n                nodes = (selector.nodeType || selector === window) ? [selector] : selector;\n            }\n        }\n        else if (reHtmlTest.test(selector))\n        {\n            nodes = this.create(selector);\n        }\n        else\n        {\n            nodes = this._query(selector, context);\n        }\n\n        this.nodes = this._slice(nodes);\n    },\n    create: function(html)\n    {\n        if (/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/.test(html))\n        {\n            return [document.createElement(RegExp.$1)];\n        }\n\n        var elements = [];\n        var container = document.createElement('div');\n        var children = container.childNodes;\n\n        container.innerHTML = html;\n\n        for (var i = 0, l = children.length; i < l; i++)\n        {\n            elements.push(children[i]);\n        }\n\n        return elements;\n    },\n\n    // add\n    add: function(nodes)\n    {\n        this.nodes = this.nodes.concat(this._toArray(nodes));\n    },\n\n    // get\n    get: function(index)\n    {\n        return this.nodes[(index || 0)] || false;\n    },\n    getAll: function()\n    {\n        return this.nodes;\n    },\n    eq: function(index)\n    {\n        return new Dom(this.nodes[index]) || false;\n    },\n    first: function()\n    {\n        return new Dom(this.nodes[0]) || false;\n    },\n    last: function()\n    {\n        return new Dom(this.nodes[this.nodes.length - 1]) || false;\n    },\n    contents: function()\n    {\n        return this.get().childNodes;\n    },\n\n    // loop\n    each: function(callback)\n    {\n        var len = this.nodes.length;\n        for (var i = 0; i < len; i++)\n        {\n            callback.call(this, (this.nodes[i].dom) ? this.nodes[i].get() : this.nodes[i], i);\n        }\n\n        return this;\n    },\n\n    // traversing\n    is: function(selector)\n    {\n        return (this.filter(selector).length > 0);\n    },\n    filter: function (selector)\n    {\n        var callback;\n        if (selector === undefined)\n        {\n            return this;\n        }\n        else if (typeof selector === 'function')\n        {\n            callback = selector;\n        }\n        else\n        {\n            callback = function(node)\n            {\n                if (selector instanceof Node)\n                {\n                    return (selector === node);\n                }\n                else if (selector && selector.dom)\n                {\n                    return ((selector.nodes).indexOf(node) !== -1);\n                }\n                else\n                {\n                    node.matches = node.matches || node.msMatchesSelector || node.webkitMatchesSelector;\n                    return (node.nodeType === 1) ? node.matches(selector || '*') : false;\n                }\n            };\n        }\n\n        return new Dom(this.nodes.filter(callback));\n    },\n    not: function(filter)\n    {\n        return this.filter(function(node)\n        {\n            return !new Dom(node).is(filter || true);\n        });\n    },\n    find: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var ns = this._query(selector || '*', node);\n            for (var i = 0; i < ns.length; i++)\n            {\n                nodes.push(ns[i]);\n            }\n        });\n\n        return new Dom(nodes);\n    },\n    children: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.children)\n            {\n                var ns = node.children;\n                for (var i = 0; i < ns.length; i++)\n                {\n                    nodes.push(ns[i]);\n                }\n            }\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parent: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.parentNode) nodes.push(node.parentNode);\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parents: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        var nodes = [];\n        this.each(function(node)\n        {\n            var parent = node.parentNode;\n            while (parent && parent !== context)\n            {\n                if (selector)\n                {\n                    if (new Dom(parent).is(selector)) { nodes.push(parent); }\n                }\n                else\n                {\n                    nodes.push(parent);\n                }\n\n                parent = parent.parentNode;\n            }\n        });\n\n        return new Dom(nodes);\n    },\n    closest: function(selector, context)\n    {\n        context = this._getContext(context);\n        selector = (selector.dom) ? selector.get() : selector;\n\n        var nodes = [];\n        var isNode = (selector && selector.nodeType);\n        this.each(function(node)\n        {\n            do {\n                if ((isNode && node === selector) || new Dom(node).is(selector)) return nodes.push(node);\n            } while ((node = node.parentNode) && node !== context);\n        });\n\n        return new Dom(nodes);\n    },\n    next: function()\n    {\n        return new Dom(this.get().nextSibling);\n    },\n    nextElement: function()\n    {\n        return new Dom(this.get().nextElementSibling);\n    },\n    prev: function()\n    {\n        return new Dom(this.get().previousSibling);\n    },\n    prevElement: function()\n    {\n        return new Dom(this.get().previousElementSibling);\n    },\n\n    // css\n    css: function(name, value)\n    {\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            var node = this.get();\n            if (name === 'width' || name === 'height')\n            {\n                return (node.style) ? this._getHeightOrWidth(name, node, false) + 'px' : undefined;\n            }\n            else\n            {\n                return (node.style) ? getComputedStyle(node, null)[name] : undefined;\n            }\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.style) node.style[key] = obj[key];\n            }\n        });\n    },\n\n    // attr\n    attr: function(name, value, data)\n    {\n        data = (data) ? 'data-' : '';\n\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            if (this.get().nodeType !== 3)\n            {\n                return (name === 'checked') ? this.get().checked : this.get().getAttribute(data + name);\n            }\n            else return;\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.nodeType !== 3)\n                {\n                    if (key === 'checked' && obj[key] === false) node.removeAttribute(key);\n                    else node.setAttribute(data + key, obj[key]);\n                }\n            }\n        });\n    },\n    data: function(name, value)\n    {\n        if (name === undefined)\n        {\n            var reDataAttr = /^data\\-(.+)$/;\n            var attrs = this.get().attributes;\n\n            var data = {};\n            var replacer = function (g) { return g[1].toUpperCase(); };\n\n            for (var key in attrs)\n            {\n                if (reDataAttr.test(attrs[key].nodeName))\n                {\n                    var dataName = attrs[key].nodeName.match(reDataAttr)[1];\n                    var val = attrs[key].value;\n                    dataName = dataName.replace(/-([a-z])/g, replacer);\n                    data[dataName] = (this._isNumber(val)) ? parseFloat(val) : this._getBooleanFromStr(val);\n                }\n            }\n\n            return data;\n        }\n\n        return this.attr(name, value, true);\n    },\n    val: function(value)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.type && el.type === 'checkbox') return el.checked;\n            else return el.value;\n        }\n\n        return this.each(function(node)\n        {\n            node.value = value;\n        });\n    },\n    removeAttr: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmAttr = function(name) { if (node.nodeType !== 3) node.removeAttribute(name); };\n            value.split(' ').forEach(rmAttr);\n        });\n    },\n    removeData: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmData = function(name) { if (node.nodeType !== 3) node.removeAttribute('data-' + name); };\n            value.split(' ').forEach(rmData);\n        });\n    },\n\n    // dataset/dataget\n    dataset: function(key, value)\n    {\n        return this.each(function(node)\n        {\n            DomCache[this.dataindex(node)][key] = value;\n        });\n    },\n    dataget: function(key)\n    {\n        return DomCache[this.dataindex(this.get())][key];\n    },\n    dataindex: function(el)\n    {\n        var cacheIndex = el[DomExpando];\n        var nextCacheIndex = DomCache.length;\n\n        if (!cacheIndex)\n        {\n            cacheIndex = el[DomExpando] = nextCacheIndex;\n            DomCache[cacheIndex] = {};\n        }\n\n        return cacheIndex;\n    },\n\n    // class\n    addClass: function(value)\n    {\n        return this._eachClass(value, 'add');\n    },\n    removeClass: function(value)\n    {\n        return this._eachClass(value, 'remove');\n    },\n    toggleClass: function(value)\n    {\n        return this._eachClass(value, 'toggle');\n    },\n    hasClass: function(value)\n    {\n        return this.nodes.some(function(node)\n        {\n            return (node.classList) ? node.classList.contains(value) : false;\n        });\n    },\n\n    // html & text\n    empty: function()\n    {\n        return this.each(function(node)\n        {\n            node.innerHTML = '';\n        });\n    },\n    html: function(html)\n    {\n        return (html === undefined) ? (this.get().innerHTML || '') : this.empty().append(html);\n    },\n    text: function(text)\n    {\n        return (text === undefined) ? (this.get().textContent || '') : this.each(function(node) { node.textContent = text; });\n    },\n\n    // manipulation\n    after: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('afterend', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag).reverse();\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.parentNode.insertBefore(elms[i], node.nextSibling);\n                }\n            }\n\n            return node;\n\n        });\n    },\n    before: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('beforebegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.parentNode.insertBefore(elms[i], node);\n                }\n            }\n\n            return node;\n        });\n    },\n    append: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('beforeend', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.appendChild(elms[i]);\n                }\n            }\n\n            return node;\n        });\n    },\n    prepend: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('afterbegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag).reverse();\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.insertBefore(elms[i], node.firstChild);\n                }\n            }\n\n            return node;\n        });\n    },\n    wrap: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var wrapper = (typeof frag === 'string') ? this.create(frag)[0] : (frag instanceof Node) ? frag : this._toArray(frag)[0];\n\n            if (node.parentNode)\n            {\n                node.parentNode.insertBefore(wrapper, node);\n            }\n\n            wrapper.appendChild(node);\n\n            return new Dom(wrapper);\n\n        });\n    },\n    unwrap: function()\n    {\n        return this.each(function(node)\n        {\n            var $node = new Dom(node);\n\n            return $node.replaceWith($node.contents());\n        });\n    },\n    replaceWith: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var docFrag = document.createDocumentFragment();\n            var elms = (typeof frag === 'string') ? this.create(frag) : (frag instanceof Node) ? [frag] : this._toArray(frag);\n\n            for (var i = 0; i < elms.length; i++)\n            {\n                docFrag.appendChild(elms[i]);\n            }\n\n            var result = docFrag.childNodes[0];\n            node.parentNode.replaceChild(docFrag, node);\n\n            return result;\n\n        });\n    },\n    remove: function()\n    {\n        return this.each(function(node)\n        {\n            if (node.parentNode) node.parentNode.removeChild(node);\n        });\n    },\n    clone: function(events)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var copy = this._clone(node);\n            if (events) copy = this._cloneEvents(node, copy);\n            nodes.push(copy);\n        });\n\n        return new Dom(nodes);\n    },\n\n    // show/hide\n    show: function()\n    {\n        return this.each(function(node)\n        {\n            if (node.style)\n            {\n                if (this._getRealDisplay(node) !== 'none') return;\n\n                var old = node.getAttribute('displayOld');\n                node.style.display = old || '';\n\n                if (this._getRealDisplay(node) === 'none')\n                {\n                    var nodeName = node.nodeName, body = document.body, display;\n\n                    if (DomDisplayCache[nodeName])\n                    {\n                        display = DomDisplayCache[nodeName];\n                    }\n                    else\n                    {\n                        var testElem = document.createElement(nodeName);\n                        body.appendChild(testElem);\n                        display = this._getRealDisplay(testElem);\n\n                        if (display === 'none') display = 'block';\n\n                        body.removeChild(testElem);\n                        DomDisplayCache[nodeName] = display;\n                    }\n\n                    node.setAttribute('displayOld', display);\n                    node.style.display = display;\n                }\n            }\n        }.bind(this));\n    },\n    hide: function()\n    {\n        return this.each(function(node)\n        {\n            if (node.style)\n            {\n                if (!node.getAttribute('displayOld') && node.style.display !== '')\n                {\n                    node.setAttribute(\"displayOld\", node.style.display);\n                }\n\n                node.style.display = 'none';\n            }\n        });\n    },\n\n    // dimensions\n    scrollTop: function(value)\n    {\n        var node = this.get();\n        var isWindow = (node === window);\n        var isDocument = (node.nodeType === 9);\n        var el = (isDocument) ? (document.scrollingElement || document.body.parentNode || document.body || document.documentElement) : node;\n\n        if (value !== undefined)\n        {\n            if (isWindow) window.scrollTo(0, value);\n            else el.scrollTop = value;\n            return;\n        }\n\n        if (isDocument)\n        {\n            return (typeof window.pageYOffset != 'undefined') ? window.pageYOffset : ((document.documentElement.scrollTop) ? document.documentElement.scrollTop : ((document.body.scrollTop) ? document.body.scrollTop : 0));\n        }\n        else\n        {\n            return (isWindow) ? window.pageYOffset : el.scrollTop;\n        }\n    },\n    offset: function()\n    {\n        return this._getDim('Offset');\n    },\n    position: function()\n    {\n        return this._getDim('Position');\n    },\n    width: function(value, adjust)\n    {\n        return this._getSize('width', 'Width', value, adjust);\n    },\n    height: function(value, adjust)\n    {\n        return this._getSize('height', 'Height', value, adjust);\n    },\n    outerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'outer');\n    },\n    outerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'outer');\n    },\n    innerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'inner');\n    },\n    innerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'inner');\n    },\n\n    // events\n    click: function()\n    {\n        return this._triggerEvent('click');\n    },\n    focus: function()\n    {\n        return this._triggerEvent('focus');\n    },\n    trigger: function(names)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var ev;\n                var opts = { bubbles: true, cancelable: true };\n\n                try {\n                    ev = new window.CustomEvent(events[i], opts);\n                } catch(e) {\n                    ev = document.createEvent('CustomEvent');\n                    ev.initCustomEvent(events[i], true, true);\n                }\n\n                node.dispatchEvent(ev);\n            }\n        });\n    },\n    on: function(names, handler, one)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                handler = (one) ? this._getOneHandler(handler, names) : handler;\n                node.addEventListener(event, handler);\n\n                node._e = node._e || {};\n                node._e[namespace] = node._e[namespace] || {};\n                node._e[namespace][event] = node._e[namespace][event] || [];\n                node._e[namespace][event].push(handler);\n            }\n\n        });\n    },\n    one: function(events, handler)\n    {\n        return this.on(events, handler, true);\n    },\n    off: function(names, handler)\n    {\n        var testEvent = function(name, key, event) { return (name === event); };\n        var testNamespace = function(name, key, event, namespace) { return (key === namespace); };\n        var testEventNamespace = function(name, key, event, namespace) { return (name === event && key === namespace); };\n        var testPositive = function() { return true; };\n\n        if (names === undefined)\n        {\n            // ALL\n            return this.each(function(node)\n            {\n                this._offEvent(node, false, false, handler, testPositive);\n            });\n        }\n\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                // 1) event without namespace\n                if (namespace === '_events') this._offEvent(node, event, namespace, handler, testEvent);\n                // 2) only namespace\n                else if (!event && namespace !== '_events') this._offEvent(node, event, namespace, handler, testNamespace);\n                // 3) event + namespace\n                else this._offEvent(node, event, namespace, handler, testEventNamespace);\n            }\n        });\n    },\n\n    // form\n    serialize: function(asObject)\n    {\n        var obj = {};\n        var elms = this.get().elements;\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = elms[i];\n            if (/(checkbox|radio)/.test(el.type) && !el.checked) continue;\n            if (!el.name || el.disabled || el.type === 'file') continue;\n\n            if (el.type === 'select-multiple')\n            {\n                for (var z = 0; z < el.options.length; z++)\n                {\n                    var opt = el.options[z];\n                    if (opt.selected) obj[el.name] = opt.value;\n                }\n            }\n\n            obj[el.name] = el.value;\n        }\n\n        return (asObject) ? obj : this._toParams(obj);\n    },\n    ajax: function(success, error)\n    {\n        if (typeof AjaxRequest !== 'undefined')\n        {\n            var method = this.attr('method') || 'post';\n            var options = {\n                url: this.attr('action'),\n                data: this.serialize(),\n                success: success,\n                error: error\n            };\n\n            return new AjaxRequest(method, options);\n        }\n    },\n\n    // private\n    _queryContext: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        return (context.nodeType !== 3 && typeof context.querySelectorAll === 'function') ? context.querySelectorAll(selector) : [];\n    },\n    _query: function(selector, context)\n    {\n        if (context)\n        {\n            return this._queryContext(selector, context);\n        }\n        else if (/^[.#]?[\\w-]*$/.test(selector))\n        {\n            if (selector[0] === '#')\n            {\n                var element = document.getElementById(selector.slice(1));\n                return element ? [element] : [];\n            }\n\n            if (selector[0] === '.')\n            {\n                return document.getElementsByClassName(selector.slice(1));\n            }\n\n            return document.getElementsByTagName(selector);\n        }\n\n        return document.querySelectorAll(selector);\n    },\n    _getContext: function(context)\n    {\n        context = (typeof context === 'string') ? document.querySelector(context) : context;\n\n        return (context && context.dom) ? context.get() : (context || document);\n    },\n    _inject: function(html, fn)\n    {\n        var len = this.nodes.length;\n        var nodes = [];\n        while (len--)\n        {\n            var res = (typeof html === 'function') ? html.call(this, this.nodes[len]) : html;\n            var el = (len === 0) ? res : this._clone(res);\n            var node = fn.call(this, el, this.nodes[len]);\n\n            if (node)\n            {\n                if (node.dom) nodes.push(node.get());\n                else nodes.push(node);\n            }\n        }\n\n        return new Dom(nodes);\n    },\n    _cloneEvents: function(node, copy)\n    {\n        var events = node._e;\n        if (events)\n        {\n            copy._e = events;\n            for (var name in events._events)\n            {\n                for (var i = 0; i < events._events[name].length; i++)\n                {\n                    copy.addEventListener(name, events._events[name][i]);\n                }\n            }\n        }\n\n        return copy;\n    },\n    _clone: function(node)\n    {\n        if (typeof node === 'undefined') return;\n        if (typeof node === 'string') return node;\n        else if (node instanceof Node) return node.cloneNode(true);\n        else if ('length' in node)\n        {\n            return [].map.call(this._toArray(node), function(el) { return el.cloneNode(true); });\n        }\n\n        return node;\n    },\n    _slice: function(obj)\n    {\n        return (!obj || obj.length === 0) ? [] : (obj.length) ? [].slice.call(obj.nodes || obj) : [obj];\n    },\n    _eachClass: function(value, type)\n    {\n        return this.each(function(node)\n        {\n            if (value)\n            {\n                var setClass = function(name) { if (node.classList) node.classList[type](name); };\n                value.split(' ').forEach(setClass);\n            }\n        });\n    },\n    _triggerEvent: function(name)\n    {\n        var node = this.get();\n        if (node && node.nodeType !== 3) node[name]();\n        return this;\n    },\n    _getOneHandler: function(handler, events)\n    {\n        var self = this;\n        return function()\n        {\n            handler.apply(this, arguments);\n            self.off(events);\n        };\n    },\n    _getEventNamespace: function(event)\n    {\n        var arr = event.split('.');\n        var namespace = (arr[1]) ? arr[1] : '_events';\n        return (arr[2]) ? namespace + arr[2] : namespace;\n    },\n    _getEventName: function(event)\n    {\n        return event.split('.')[0];\n    },\n    _offEvent: function(node, event, namespace, handler, condition)\n    {\n        for (var key in node._e)\n        {\n            for (var name in node._e[key])\n            {\n                if (condition(name, key, event, namespace))\n                {\n                    var handlers = node._e[key][name];\n                    for (var i = 0; i < handlers.length; i++)\n                    {\n                        if (typeof handler !== 'undefined' && handlers[i].toString() !== handler.toString())\n                        {\n                            continue;\n                        }\n\n                        node.removeEventListener(name, handlers[i]);\n                        node._e[key][name].splice(i, 1);\n\n                        if (node._e[key][name].length === 0) delete node._e[key][name];\n                        if (Object.keys(node._e[key]).length === 0) delete node._e[key];\n                    }\n                }\n            }\n        }\n    },\n    _getInnerOrOuter: function(method, type)\n    {\n        return this[method](undefined, type);\n    },\n    _getDocSize: function(node, type)\n    {\n        var body = node.body, html = node.documentElement;\n        return Math.max(body['scroll' + type], body['offset' + type], html['client' + type], html['scroll' + type], html['offset' + type]);\n    },\n    _getSize: function(type, captype, value, adjust)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.nodeType === 3)      value = 0;\n            else if (el.nodeType === 9) value = this._getDocSize(el, captype);\n            else if (el === window)     value = window['inner' + captype];\n            else                        value = this._getHeightOrWidth(type, el, adjust || 'normal');\n\n            return Math.round(value);\n        }\n\n        return this.each(function(node)\n        {\n            value = parseFloat(value);\n            value = value + this._adjustResultHeightOrWidth(type, node, adjust || 'normal');\n\n            new Dom(node).css(type, value + 'px');\n\n        }.bind(this));\n    },\n    _getHeightOrWidth: function(type, el, adjust)\n    {\n        var name = type.charAt(0).toUpperCase() + type.slice(1);\n        var style = getComputedStyle(el, null);\n        var $el = new Dom(el);\n        var result = 0;\n        var $targets = $el.parents().filter(function(node)\n        {\n            return (getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        if (style.display === 'none') $targets.add(el);\n        if ($targets.length !== 0)\n        {\n            var fixStyle = 'visibility: hidden !important; display: block !important;';\n            var tmp = [];\n\n            $targets.each(function(node)\n            {\n                var $node = new Dom(node);\n                var thisStyle = $node.attr('style');\n                if (thisStyle !== null) tmp.push(thisStyle);\n                $node.attr('style', (thisStyle !== null) ? thisStyle + ';' + fixStyle : fixStyle);\n            });\n\n            result = $el.get()['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n\n            $targets.each(function(node, i)\n            {\n                var $node = new Dom(node);\n                if (tmp[i] === undefined) $node.removeAttr('style');\n                else $node.attr('style', tmp[i]);\n            });\n        }\n        else\n        {\n            result = el['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n        }\n\n        return result;\n    },\n    _adjustResultHeightOrWidth: function(type, el, adjust)\n    {\n        if (!el || adjust === false) return 0;\n\n        var fix = 0;\n        var style = getComputedStyle(el, null);\n        var isBorderBox = (style.boxSizing === \"border-box\");\n\n        if (type === 'height')\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderTopWidth) || 0) + (parseFloat(style.borderBottomWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginTop) || 0) + (parseFloat(style.marginBottom) || 0);\n        }\n        else\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderLeftWidth) || 0) + (parseFloat(style.borderRightWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginLeft) || 0) + (parseFloat(style.marginRight) || 0);\n        }\n\n        return fix;\n    },\n    _getDim: function(type)\n    {\n        var node = this.get();\n        return (node.nodeType === 3) ? { top: 0, left: 0 } : this['_get' + type](node);\n    },\n    _getPosition: function(node)\n    {\n        return { top: node.offsetTop, left: node.offsetLeft };\n    },\n    _getOffset: function(node)\n    {\n        var rect = node.getBoundingClientRect();\n        var doc = node.ownerDocument;\n\t\tvar docElem = doc.documentElement;\n\t\tvar win = doc.defaultView;\n\n\t\treturn {\n\t\t\ttop: rect.top + win.pageYOffset - docElem.clientTop,\n\t\t\tleft: rect.left + win.pageXOffset - docElem.clientLeft\n\t\t};\n    },\n    _toArray: function(obj)\n    {\n        if (obj instanceof NodeList)\n        {\n            var arr = [];\n            for (var i = 0; i < obj.length; i++)\n            {\n                arr[i] = obj[i];\n            }\n\n            return arr;\n        }\n        else if (obj === undefined) return [];\n        else\n        {\n            return (obj.dom) ? obj.nodes : obj;\n        }\n    },\n    _toParams: function(obj)\n    {\n        var params = '';\n        for (var key in obj)\n        {\n            params += '&' + this._encodeUri(key) + '=' + this._encodeUri(obj[key]);\n        }\n\n        return params.replace(/^&/, '');\n    },\n    _encodeUri: function(str)\n    {\n        return encodeURIComponent(str).replace(/!/g, '%21').replace(/'/g, '%27').replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/\\*/g, '%2A').replace(/%20/g, '+');\n    },\n    _isNumber: function(str)\n    {\n        return !isNaN(str) && !isNaN(parseFloat(str));\n    },\n    _getBooleanFromStr: function(str)\n    {\n        if (str === 'true') return true;\n        else if (str === 'false') return false;\n\n        return str;\n    },\n    _getRealDisplay: function(elem)\n    {\n        if (elem.currentStyle) return elem.currentStyle.display;\n        else if (window.getComputedStyle)\n        {\n            var computedStyle = window.getComputedStyle(elem, null);\n            return computedStyle.getPropertyValue('display');\n        }\n    }\n};\n// Unique ID\nvar uuid = 0;\n\n// Wrapper\nvar $R = function(selector, options)\n{\n    return RedactorApp(selector, options, [].slice.call(arguments, 2));\n};\n\n// Globals\n$R.version = '3.0.8';\n$R.options = {};\n$R.modules = {};\n$R.services = {};\n$R.classes = {};\n$R.plugins = {};\n$R.mixins = {};\n$R.modals = {};\n$R.lang = {};\n$R.dom = function(selector, context) { return new Dom(selector, context); };\n$R.ajax = Ajax;\n$R.Dom = Dom;\n$R.keycodes = {\n\tBACKSPACE: 8,\n\tDELETE: 46,\n\tUP: 38,\n\tDOWN: 40,\n\tENTER: 13,\n\tSPACE: 32,\n\tESC: 27,\n\tTAB: 9,\n\tCTRL: 17,\n\tMETA: 91,\n\tSHIFT: 16,\n\tALT: 18,\n\tRIGHT: 39,\n\tLEFT: 37\n};\n$R.env = {\n    'plugin': 'plugins',\n    'module': 'modules',\n    'service': 'services',\n    'class': 'classes',\n    'mixin': 'mixins'\n};\n\n// jQuery Wrapper\n/*eslint-env jquery*/\nif (typeof jQuery !== 'undefined')\n{\n    (function($) { $.fn.redactor = function(options) { return RedactorApp(this.toArray(), options, [].slice.call(arguments, 1)); }; })(jQuery);\n}\n\n// Class\nvar RedactorApp = function(selector, options, args)\n{\n    var namespace = 'redactor';\n    var nodes = (Array.isArray(selector)) ? selector : (selector && selector.nodeType) ? [selector] : document.querySelectorAll(selector);\n    var isApi = (typeof options === 'string' || typeof options === 'function');\n    var value = [];\n    var instance;\n\n    for (var i = 0; i < nodes.length; i++)\n    {\n        var el = nodes[i];\n        var $el = $R.dom(el);\n\n        instance = $el.dataget(namespace);\n        if (!instance && !isApi)\n        {\n            // Initialization\n            $el.dataset(namespace, (instance = new App(el, options, uuid)));\n            uuid++;\n        }\n\n         // API\n        if (instance && isApi)\n        {\n            var isDestroy = (options === 'destroy');\n            options = (isDestroy) ? 'stop' : options;\n\n            var methodValue;\n            if (typeof options === 'function')\n            {\n                methodValue = options.apply(instance, args);\n            }\n            else\n            {\n                args.unshift(options);\n                methodValue = instance.api.apply(instance, args);\n            }\n            if (methodValue !== undefined) value.push(methodValue);\n\n            if (isDestroy) $el.dataset(namespace, false);\n        }\n    }\n\n    return (value.length === 0 || value.length === 1) ? ((value.length === 0) ? instance : value[0]) : value;\n};\n\n// add\n$R.add = function(type, name, obj)\n{\n    if (typeof $R.env[type] === 'undefined') return;\n\n    // translations\n    if (obj.translations)\n    {\n        $R.lang = $R.extend(true, {}, $R.lang, obj.translations);\n    }\n\n    // modals\n    if (obj.modals)\n    {\n        $R.modals = $R.extend(true, {}, $R.modals, obj.modals);\n    }\n\n    // mixin\n    if (type === 'mixin')\n    {\n        $R[$R.env[type]][name] = obj;\n    }\n    else\n    {\n        // prototype\n        var F = function() {};\n        F.prototype = obj;\n\n        // mixins\n        if (obj.mixins)\n        {\n            for (var i = 0; i < obj.mixins.length; i++)\n            {\n                $R.inherit(F, $R.mixins[obj.mixins[i]]);\n            }\n        }\n\n        $R[$R.env[type]][name] = F;\n    }\n};\n\n// add lang\n$R.addLang = function(lang, obj)\n{\n    if (typeof $R.lang[lang] === 'undefined')\n    {\n        $R.lang[lang] = {};\n    }\n\n    $R.lang[lang] = $R.extend($R.lang[lang], obj);\n};\n\n// create\n$R.create = function(name)\n{\n    var arr = name.split('.');\n    var args = [].slice.call(arguments, 1);\n\n    var type = 'classes';\n    if (typeof $R.env[arr[0]] !== 'undefined')\n    {\n        type = $R.env[arr[0]];\n        name = arr.slice(1).join('.');\n    }\n\n    // construct\n    var instance = new $R[type][name]();\n\n    // init\n    if (instance.init)\n    {\n        var res = instance.init.apply(instance, args);\n\n        return (res) ? res : instance;\n    }\n\n    return instance;\n};\n\n// inherit\n$R.inherit = function(current, parent)\n{\n    var F = function () {};\n    F.prototype = parent;\n    var f = new F();\n\n    for (var prop in current.prototype)\n    {\n        if (current.prototype.__lookupGetter__(prop)) f.__defineGetter__(prop, current.prototype.__lookupGetter__(prop));\n        else f[prop] = current.prototype[prop];\n    }\n\n    current.prototype = f;\n    current.prototype.super = parent;\n\n    return current;\n};\n\n// error\n$R.error = function(exception)\n{\n    throw exception;\n};\n\n// extend\n$R.extend = function()\n{\n    var extended = {};\n    var deep = false;\n    var i = 0;\n    var length = arguments.length;\n\n    if (Object.prototype.toString.call( arguments[0] ) === '[object Boolean]')\n    {\n        deep = arguments[0];\n        i++;\n    }\n\n    var merge = function(obj)\n    {\n        for (var prop in obj)\n        {\n            if (Object.prototype.hasOwnProperty.call(obj, prop))\n            {\n                if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') extended[prop] = $R.extend(true, extended[prop], obj[prop]);\n                else extended[prop] = obj[prop];\n            }\n        }\n    };\n\n    for (; i < length; i++ )\n    {\n        var obj = arguments[i];\n        merge(obj);\n    }\n\n    return extended;\n};\n$R.opts = {\n    animation: true,\n    lang: 'en',\n    direction: 'ltr',\n    spellcheck: true,\n    structure: false,\n    scrollTarget: false,\n    styles: true,\n    stylesClass: 'redactor-styles',\n    placeholder: false,\n\n    source: true,\n    showSource: false,\n\n    inline: false,\n\n    breakline: false,\n    markup: 'p',\n    enterKey: true,\n\n    clickToEdit: false,\n    clickToSave: false,\n    clickToCancel: false,\n\n    focus: false,\n    focusEnd: false,\n\n    minHeight: false, // string, '100px'\n    maxHeight: false, // string, '100px'\n    maxWidth: false, // string, '700px'\n\n    plugins: [], // array\n    callbacks: {},\n\n    // pre & tab\n    preClass: false, // string\n    preSpaces: 4, // or false\n    tabindex: false, // int\n    tabAsSpaces: false, // true or number of spaces\n    tabKey: true,\n\n    // autosave\n    autosave: false, // false or url\n    autosaveName: false,\n    autosaveData: false,\n\n    // toolbar\n    toolbar: true,\n    toolbarFixed: true,\n    toolbarFixedTarget: document,\n    toolbarFixedTopOffset: 0, // pixels\n    toolbarExternal: false, // ID selector\n    toolbarContext: true,\n\n    // air\n    air: false,\n\n    // formatting\n    formatting: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n    formattingAdd: false,\n    formattingHide: false,\n\n    // buttons\n    buttons: ['html', 'format', 'bold', 'italic', 'deleted', 'lists', 'image', 'file', 'link'],\n    // + 'line', 'redo', 'undo', 'underline', 'ol', 'ul', 'indent', 'outdent'\n    buttonsTextLabeled: false,\n    buttonsAdd: [],\n    buttonsAddFirst: [],\n    buttonsAddAfter: false,\n    buttonsAddBefore: false,\n    buttonsHide: [],\n    buttonsHideOnMobile: [],\n\n    // image\n    imageUpload: false,\n    imageUploadParam: 'file',\n    imageData: false,\n    imageEditable: true,\n    imageCaption: true,\n    imagePosition: false,\n    imageResizable: false,\n    imageFloatMargin: '10px',\n    imageFigure: true,\n\n    // file\n    fileUpload: false,\n    fileUploadParam: 'file',\n    fileData: false,\n    fileAttachment: false,\n\n    // upload opts\n    uploadData: false,\n    dragUpload: true,\n    multipleUpload: true,\n    clipboardUpload: true,\n    uploadBase64: false,\n\n    // link\n    linkTarget: false,\n    linkTitle: false,\n    linkNewTab: false,\n    linkNofollow: false,\n    linkSize: 30,\n    linkValidation: true,\n\n    // clean\n    cleanOnEnter: true,\n    cleanInlineOnEnter: false,\n    paragraphize: true,\n    removeScript: true,\n    removeNewLines: false,\n    removeComments: true,\n    replaceTags: {\n        'b': 'strong',\n        'i': 'em',\n        'strike': 'del'\n    },\n\n    // paste\n    pastePlainText: false,\n    pasteLinkTarget: false,\n    pasteImages: true,\n    pasteLinks: true,\n    pasteClean: true,\n    pasteKeepStyle: [],\n    pasteKeepClass: [],\n    pasteKeepAttrs: ['td', 'th'],\n    pasteBlockTags: ['pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'ul', 'ol', 'li', 'blockquote', 'p', 'figure', 'figcaption'],\n    pasteInlineTags: ['a', 'img', 'br', 'strong', 'ins', 'code', 'del', 'span', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'b', 'u', 'em', 'i', 'abbr'],\n\n    // active buttons\n    activeButtons: {\n        b: 'bold',\n        strong: 'bold',\n        i: 'italic',\n        em: 'italic',\n        del: 'deleted',\n        strike: 'deleted',\n        u: 'underline'\n    },\n    activeButtonsAdd: {},\n    activeButtonsObservers: {},\n\n    // autoparser\n    autoparse: true,\n    autoparseStart: true,\n    autoparsePaste: true,\n    autoparseLinks: true,\n    autoparseImages: true,\n    autoparseVideo: true,\n\n    // shortcodes\n    shortcodes: {\n        'p.': { format: 'p' },\n        'quote.': { format: 'blockquote' },\n        'pre.': { format: 'pre' },\n        'h1.': { format: 'h1' },\n        'h2.': { format: 'h2' },\n        'h3.': { format: 'h3' },\n        'h4.': { format: 'h4' },\n        'h5.': { format: 'h5' },\n        'h6.': { format: 'h6' },\n        '1.': { format: 'ol' },\n        '*.': { format: 'ul' }\n    },\n    shortcodesAdd: false, // object\n\n    // shortcuts\n    shortcuts: {\n        'ctrl+shift+m, meta+shift+m': { api: 'module.inline.clearformat' },\n        'ctrl+b, meta+b': { api: 'module.inline.format', args: 'b' },\n        'ctrl+i, meta+i': { api: 'module.inline.format', args: 'i' },\n        'ctrl+u, meta+u': { api: 'module.inline.format', args: 'u' },\n        'ctrl+h, meta+h': { api: 'module.inline.format', args: 'sup' },\n        'ctrl+l, meta+l': { api: 'module.inline.format', args: 'sub' },\n        'ctrl+k, meta+k': { api: 'module.link.open' },\n        'ctrl+alt+0, meta+alt+0': { api: 'module.block.format', args: 'p' },\n        'ctrl+alt+1, meta+alt+1': { api: 'module.block.format', args: 'h1' },\n        'ctrl+alt+2, meta+alt+2': { api: 'module.block.format', args: 'h2' },\n        'ctrl+alt+3, meta+alt+3': { api: 'module.block.format', args: 'h3' },\n        'ctrl+alt+4, meta+alt+4': { api: 'module.block.format', args: 'h4' },\n        'ctrl+alt+5, meta+alt+5': { api: 'module.block.format', args: 'h5' },\n        'ctrl+alt+6, meta+alt+6': { api: 'module.block.format', args: 'h6' },\n        'ctrl+shift+7, meta+shift+7': { api: 'module.list.toggle', args: 'ol' },\n        'ctrl+shift+8, meta+shift+8': { api: 'module.list.toggle', args: 'ul' }\n    },\n    shortcutsAdd: false, // object\n\n    // misc\n    grammarly: true,\n\n    // private\n    bufferLimit: 100,\n    emptyHtml: '<p></p>',\n    markerChar: '\\ufeff',\n    imageTypes: ['image/png', 'image/jpeg', 'image/gif'],\n    inlineTags: ['a', 'span', 'strong', 'strike', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'abbr'],\n    blockTags: ['pre', 'ul', 'ol', 'li', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',  'dl', 'dt', 'dd', 'div', 'table', 'tbody', 'thead', 'tfoot', 'tr', 'th', 'td', 'blockquote', 'output', 'figcaption', 'figure', 'address', 'section', 'header', 'footer', 'aside', 'article', 'iframe'],\n    regex: {\n        youtube: /https?:\\/\\/(?:[0-9A-Z-]+\\.)?(?:youtu\\.be\\/|youtube\\.com\\S*[^\\w\\-\\s])([\\w\\-]{11})(?=[^\\w\\-]|$)(?![?=&+%\\w.-]*(?:['\"][^<>]*>|<\\/a>))[?=&+%\\w.-]*/gi,\n        vimeo: /https?:\\/\\/(www\\.)?vimeo.com\\/(\\d+)($|\\/)/gi,\n        imageurl: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/gi,\n        url: /(https?:\\/\\/(?:www\\.|(?!www))[^\\s\\.]+\\.[^\\s]{2,}|www\\.[^\\s]+\\.[^\\s]{2,})/gi\n    },\n    input: true,\n    zindex: false,\n    modes: {\n        \"inline\": {\n            pastePlainText: true,\n            pasteImages: false,\n            enterKey: false,\n            toolbar: false,\n            autoparse: false,\n            source: false,\n            showSource: false,\n            styles: false,\n            air: false\n        },\n        \"original\": {\n            styles: false\n        }\n    }\n};\n$R.lang['en'] = {\n    \"format\": \"Format\",\n    \"image\": \"Image\",\n    \"file\": \"File\",\n    \"link\": \"Link\",\n    \"bold\": \"Bold\",\n    \"italic\": \"Italic\",\n    \"deleted\": \"Strikethrough\",\n    \"underline\": \"Underline\",\n    \"superscript\": \"Superscript\",\n    \"subscript\": \"Subscript\",\n    \"bold-abbr\": \"B\",\n    \"italic-abbr\": \"I\",\n    \"deleted-abbr\": \"S\",\n    \"underline-abbr\": \"U\",\n    \"superscript-abbr\": \"Sup\",\n    \"subscript-abbr\": \"Sub\",\n    \"lists\": \"Lists\",\n    \"link-insert\": \"Insert Link\",\n    \"link-edit\": \"Edit Link\",\n    \"link-in-new-tab\": \"Open link in new tab\",\n    \"unlink\": \"Unlink\",\n    \"cancel\": \"Cancel\",\n    \"close\": \"Close\",\n    \"insert\": \"Insert\",\n    \"save\": \"Save\",\n    \"delete\": \"Delete\",\n    \"text\": \"Text\",\n    \"edit\": \"Edit\",\n    \"title\": \"Title\",\n    \"paragraph\": \"Normal text\",\n    \"quote\": \"Quote\",\n    \"code\": \"Code\",\n    \"heading1\": \"Heading 1\",\n    \"heading2\": \"Heading 2\",\n    \"heading3\": \"Heading 3\",\n    \"heading4\": \"Heading 4\",\n    \"heading5\": \"Heading 5\",\n    \"heading6\": \"Heading 6\",\n    \"filename\": \"Name\",\n    \"optional\": \"optional\",\n    \"unorderedlist\": \"Unordered List\",\n    \"orderedlist\": \"Ordered List\",\n    \"outdent\": \"Outdent\",\n    \"indent\": \"Indent\",\n    \"horizontalrule\": \"Line\",\n    \"upload\": \"Upload\",\n    \"upload-label\": \"Drop files here or click to upload\",\n    \"accessibility-help-label\": \"Rich text editor\",\n    \"caption\": \"Caption\",\n    \"bulletslist\": \"Bullets\",\n    \"numberslist\": \"Numbers\",\n    \"image-position\": \"Position\",\n    \"none\": \"None\",\n    \"left\": \"Left\",\n    \"right\": \"Right\",\n    \"center\": \"Center\",\n    \"undo\": \"Undo\",\n    \"redo\": \"Redo\"\n};\n$R.buttons = {\n    html: {\n        title: 'HTML',\n        icon: true,\n        api: 'module.source.toggle'\n    },\n    undo: {\n        title: '## undo ##',\n        icon: true,\n        api: 'module.buffer.undo'\n    },\n    redo: {\n        title: '## redo ##',\n        icon: true,\n        api: 'module.buffer.redo'\n    },\n    format: {\n        title: '## format ##',\n        icon: true,\n        dropdown: {\n            p: {\n                title: '## paragraph ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'p'\n                }\n            },\n            blockquote: {\n                title: '## quote ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'blockquote'\n                }\n            },\n            pre: {\n                title: '## code ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'pre'\n                }\n            },\n            h1: {\n                title: '## heading1 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h1'\n                }\n            },\n            h2: {\n                title: '## heading2 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h2'\n                }\n            },\n            h3: {\n                title: '## heading3 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h3'\n                }\n            },\n            h4: {\n                title: '## heading4 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h4'\n                }\n            },\n            h5: {\n                title: '## heading5 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h5'\n                }\n            },\n            h6: {\n                title: '## heading6 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h6'\n                }\n            }\n        }\n    },\n    bold: {\n        title: '## bold-abbr ##',\n        icon: true,\n        tooltip: '## bold ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'b'\n        }\n    },\n    italic: {\n        title: '## italic-abbr ##',\n        icon: true,\n        tooltip: '## italic ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'i'\n        }\n    },\n    deleted: {\n        title: '## deleted-abbr ##',\n        icon: true,\n        tooltip: '## deleted ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'del'\n        }\n    },\n    underline: {\n        title: '## underline-abbr ##',\n        icon: true,\n        tooltip: '## underline ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'u'\n        }\n    },\n    sup: {\n        title: '## superscript-abbr ##',\n        icon: true,\n        tooltip: '## superscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sup'\n        }\n    },\n    sub: {\n        title: '## subscript-abbr ##',\n        icon: true,\n        tooltip: '## subscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sub'\n        }\n    },\n    lists: {\n        title: '## lists ##',\n        icon: true,\n        observe: 'list',\n        dropdown: {\n            observe: 'list',\n            unorderedlist: {\n                title: '&bull; ## unorderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ul'\n            },\n            orderedlist: {\n                title: '1. ## orderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ol'\n            },\n            outdent: {\n                title: '< ## outdent ##',\n                api: 'module.list.outdent'\n            },\n            indent: {\n                title: '> ## indent ##',\n                api: 'module.list.indent'\n            }\n        }\n    },\n    ul: {\n        title: '&bull; ## bulletslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ul'\n    },\n    ol: {\n        title: '1. ## numberslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ol'\n    },\n    outdent: {\n        title: '## outdent ##',\n        icon: true,\n        api: 'module.list.outdent',\n        observe: 'list'\n    },\n    indent: {\n        title: '## indent ##',\n        icon: true,\n        api: 'module.list.indent',\n        observe: 'list'\n    },\n    image: {\n        title: '## image ##',\n        icon: true,\n        api: 'module.image.open'\n    },\n    file: {\n        title: '## file ##',\n        icon: true,\n        api: 'module.file.open'\n    },\n    link: {\n        title: '## link ##',\n        icon: true,\n        observe: 'link',\n        dropdown: {\n            observe: 'link',\n            link: {\n                title: '## link-insert ##',\n                api: 'module.link.open'\n            },\n            unlink: {\n                title: '## unlink ##',\n                api: 'module.link.unlink'\n            }\n        }\n    },\n    line: {\n        title: '## horizontalrule ##',\n        icon: true,\n        api: 'module.line.insert'\n    }\n};\nvar App = function(element, options, uuid)\n{\n    this.module = {};\n    this.plugin = {};\n    this.instances = {};\n\n    // start/stop\n    this.started = false;\n    this.stopped = false;\n\n    // environment\n    this.uuid = uuid;\n    this.rootElement = element;\n    this.rootOpts = options;\n    this.dragInside = false;\n    this.dragComponentInside = false;\n    this.keycodes = $R.keycodes;\n    this.namespace = 'redactor';\n    this.$win = $R.dom(window);\n    this.$doc = $R.dom(document);\n    this.$body = $R.dom('body');\n    this.editorReadOnly = false;\n\n    // core services\n    this.opts = $R.create('service.options', options, element);\n    this.lang = $R.create('service.lang', this);\n\n    // build\n    this.buildServices();\n    this.buildModules();\n    this.buildPlugins();\n\n    // start\n    this.start();\n};\n\nApp.prototype = {\n    start: function()\n    {\n        // start\n        this.stopped = false;\n        this.broadcast('start');\n        this.broadcast('startcode');\n\n        if (this.opts.clickToEdit)\n        {\n            this.broadcast('startclicktoedit');\n        }\n        else\n        {\n            this.broadcast('enable');\n            if (this.opts.showSource) this.broadcast('startcodeshow');\n            this.broadcast('enablefocus');\n        }\n\n        // started\n        this.broadcast('started');\n        this.started = true;\n    },\n    stop: function()\n    {\n        this.started = false;\n        this.stopped = true;\n\n        this.broadcast('stop');\n        this.broadcast('disable');\n        this.broadcast('stopped');\n    },\n\n    // started & stopped\n    isStarted: function()\n    {\n        return this.started;\n    },\n    isStopped: function()\n    {\n        return this.stopped;\n    },\n\n    // build\n    buildServices: function()\n    {\n        var core = ['options', 'lang'];\n        var bindable = ['uuid', 'keycodes', 'opts', 'lang', '$win', '$doc', '$body'];\n        var services = [];\n        for (var name in $R.services)\n        {\n            if (core.indexOf(name) === -1)\n            {\n                this[name] = $R.create('service.' + name, this);\n                services.push(name);\n                bindable.push(name);\n            }\n        }\n\n        // binding\n        for (var i = 0; i < services.length; i++)\n        {\n            var service = services[i];\n            for (var z = 0; z < bindable.length; z++)\n            {\n                var inj = bindable[z];\n                if (service !== inj)\n                {\n                    this[service][inj] = this[inj];\n                }\n            }\n        }\n    },\n    buildModules: function()\n    {\n        for (var name in $R.modules)\n        {\n            this.module[name] = $R.create('module.' + name, this);\n            this.instances[name] = this.module[name];\n        }\n    },\n    buildPlugins: function()\n    {\n        var plugins = this.opts.plugins;\n        for (var i = 0; i < plugins.length; i++)\n        {\n            var name = plugins[i];\n            if (typeof $R.plugins[name] !== 'undefined')\n            {\n                this.plugin[name] = $R.create('plugin.' + name, this);\n                this.instances[name] = this.plugin[name];\n            }\n        }\n    },\n\n    // draginside\n    isDragInside: function()\n    {\n        return this.dragInside;\n    },\n    setDragInside: function(dragInside)\n    {\n        this.dragInside = dragInside;\n    },\n    isDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n    setDragComponentInside: function(dragInside)\n    {\n        this.dragComponentInside = dragInside;\n    },\n    getDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n\n    // readonly\n    isReadOnly: function()\n    {\n        return this.editorReadOnly;\n    },\n    enableReadOnly: function()\n    {\n        this.editorReadOnly = true;\n        this.broadcast('enablereadonly');\n        this.component.clearActive();\n        this.toolbar.disableButtons();\n    },\n    disableReadOnly: function()\n    {\n        this.editorReadOnly = false;\n        this.broadcast('disablereadonly');\n        this.toolbar.enableButtons();\n    },\n\n    // messaging\n    callMessageHandler: function(instance, name, args)\n    {\n        var arr = name.split('.');\n        if (arr.length === 1)\n        {\n            if (typeof instance['on' + name] === 'function')\n            {\n                instance['on' + name].apply(instance, args);\n            }\n        }\n        else\n        {\n            arr[0] = 'on' + arr[0];\n\n            var func = this.utils.checkProperty(instance, arr);\n            if (typeof func === 'function')\n            {\n                func.apply(instance, args);\n            }\n        }\n    },\n    broadcast: function(name)\n    {\n        var args = [].slice.call(arguments, 1);\n        for (var moduleName in this.instances)\n        {\n            this.callMessageHandler(this.instances[moduleName], name, args);\n        }\n\n        // callback\n        return this.callback.trigger(name, args);\n    },\n\n    // callback\n    on: function(name, func)\n    {\n        this.callback.add(name, func);\n    },\n    off: function(name, func)\n    {\n        this.callback.remove(name, func);\n    },\n\n    // api\n    api: function(name)\n    {\n        if (!this.isStarted() && name !== 'start') return;\n        if (this.isReadOnly() && name !== 'disableReadOnly') return;\n\n        this.broadcast('state');\n\n        var args = [].slice.call(arguments, 1);\n        var arr = name.split('.');\n\n        var isApp = (arr.length === 1);\n        var isCallback = (arr[0] === 'on' || arr[0] === 'off');\n        var isService = (!isCallback && arr.length === 2);\n        var isPlugin = (arr[0] === 'plugin');\n        var isModule = (arr[0] === 'module');\n\n        // app\n        if (isApp)\n        {\n            if (typeof this[arr[0]] === 'function')\n            {\n                return this.callInstanceMethod(this, arr[0], args);\n            }\n        }\n        // callback\n        else if (isCallback)\n        {\n            return (arr[0] === 'on') ? this.on(arr[1], args[0]) : this.off(arr[1], args[0] || undefined);\n        }\n        // service\n        else if (isService)\n        {\n            if (this.isInstanceExists(this, arr[0]))\n            {\n                return this.callInstanceMethod(this[arr[0]], arr[1], args);\n            }\n            else\n            {\n                $R.error(new Error('Service \"' + arr[0] + '\" not found'));\n            }\n        }\n        // plugin\n        else if (isPlugin)\n        {\n            if (this.isInstanceExists(this.plugin, arr[1]))\n            {\n                return this.callInstanceMethod(this.plugin[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Plugin \"' + arr[1] + '\" not found'));\n            }\n        }\n        // module\n        else if (isModule)\n        {\n            if (this.isInstanceExists(this.module, arr[1]))\n            {\n                return this.callInstanceMethod(this.module[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Module \"' + arr[1] + '\" not found'));\n            }\n        }\n\n    },\n    isInstanceExists: function(obj, name)\n    {\n        return (typeof obj[name] !== 'undefined');\n    },\n    callInstanceMethod: function(instance, method, args)\n    {\n        if (typeof instance[method] === 'function')\n        {\n            return instance[method].apply(instance, args);\n        }\n    }\n};\n$R.add('mixin', 'formatter', {\n\n    // public\n    buildArgs: function(args)\n    {\n        this.args = {\n            'class': args['class'] || false,\n            'style': args['style'] || false,\n            'attr': args['attr'] || false\n        };\n\n        if (!this.args['class'] && !this.args['style'] && !this.args['attr'])\n        {\n            this.args = false;\n        }\n    },\n    applyArgs: function(nodes, selection)\n    {\n        if (this.args)\n        {\n            nodes = this[this.type](this.args, false, nodes, selection);\n        }\n        else\n        {\n            nodes = this._clearAll(nodes, selection);\n        }\n\n        return nodes;\n    },\n    clearClass: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('class');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearStyle: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('style');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearAttr: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        this._removeAllAttr($elements);\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    set: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeAttr('class');\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            $elements.removeAttr('style');\n            $elements.css(args['style']);\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n            });\n        }\n\n        if (args['attr'])\n        {\n            this._removeAllAttr($elements);\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    toggle: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.toggleClass(args['class']);\n        }\n\n        var params;\n        if (args['style'])\n        {\n            params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    var newVal = params[key];\n                    var oldVal = $node.css(key);\n\n                    oldVal = (this.utils.isRgb(oldVal)) ? this.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                    newVal = (this.utils.isRgb(newVal)) ? this.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                    oldVal = this.utils.hex2long(oldVal);\n                    newVal = this.utils.hex2long(newVal);\n\n                    var compareNew = (typeof newVal === 'string') ? newVal.toLowerCase() : newVal;\n                    var compareOld = (typeof oldVal === 'string') ? oldVal.toLowerCase() : oldVal;\n\n                    if (compareNew === compareOld) $node.css(key, '');\n                    else $node.css(key, newVal);\n                }\n\n                this._convertStyleQuotes($node);\n\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            params = args['attr'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    if ($node.attr(key)) $node.removeAttr(key);\n                    else $node.attr(key, params[key]);\n                }\n            });\n\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    add: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            var params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(params);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n\n                this._convertStyleQuotes($node);\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    remove: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            var name = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(name, '');\n\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.removeAttr(args['attr']);\n        }\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n\n\n    // private\n    _removeAllAttr: function($elements)\n    {\n        $elements.each(function(node)\n        {\n            for (var i = node.attributes.length; i-->0;)\n            {\n                var nodeAttr = node.attributes[i];\n                var name = nodeAttr.name;\n                if (name !== 'style' && name !== 'class')\n                {\n                    node.removeAttributeNode(nodeAttr);\n                }\n            }\n        });\n    },\n    _convertStyleQuotes: function($node)\n    {\n        var style = $node.attr('style');\n        if (style) $node.attr('style', style.replace(/\"/g, '\\''));\n    },\n    _clearAll: function(nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            while (node.attributes.length > 0)\n            {\n                node.removeAttribute(node.attributes[0].name);\n            }\n        }\n\n        nodes = this._unwrapSpanWithoutAttr(nodes);\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n    _unwrapSpanWithoutAttr: function(nodes)\n    {\n        var finalNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            var len = node.attributes.length;\n            if (len <= 0 && node.nodeType !== 3 && node.tagName === 'SPAN')\n            {\n                $R.dom(node).unwrap();\n            }\n            else\n            {\n                finalNodes.push(node);\n            }\n        }\n\n        return finalNodes;\n    }\n});\n$R.add('mixin', 'dom', $R.Dom.prototype);\n$R.add('mixin', 'component', {\n    get cmnt()\n    {\n        return true;\n    }\n});\n$R.add('service', 'options', {\n    init: function(options, element)\n    {\n        var $el = $R.dom(element);\n        var opts = $R.extend({}, $R.opts, (element) ? $el.data() : {}, $R.options);\n        opts = $R.extend(true, opts, options);\n\n        return opts;\n    }\n});\n$R.add('service', 'lang', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // build\n        this.vars = this._build(this.opts.lang);\n    },\n\n    // public\n    rebuild: function(lang)\n    {\n        this.opts.lang = lang;\n        this.vars = this._build(lang);\n    },\n    extend: function(obj)\n    {\n        this.vars = $R.extend(this.vars, obj);\n    },\n    parse: function(str)\n    {\n        if (str === undefined)\n        {\n            return '';\n        }\n\n        var matches = str.match(/## (.*?) ##/g);\n        if (matches)\n        {\n            for (var i = 0; i < matches.length; i++)\n            {\n                var key = matches[i].replace(/^##\\s/g, '').replace(/\\s##$/g, '');\n                str = str.replace(matches[i], this.get(key));\n            }\n        }\n\n        return str;\n    },\n    get: function(name)\n    {\n        var str = '';\n        if (typeof this.vars[name] !== 'undefined')\n        {\n            str = this.vars[name];\n        }\n        else if (this.opts.lang !== 'en' && typeof $R.lang['en'][name] !== 'undefined')\n        {\n            str = $R.lang['en'][name];\n        }\n\n        return str;\n    },\n\n    // private\n    _build: function(lang)\n    {\n        var vars = $R.lang['en'];\n        if (lang !== 'en')\n        {\n            vars = ($R.lang[lang] !== undefined) ? $R.lang[lang] : vars;\n        }\n\n        return vars;\n    }\n});\n$R.add('service', 'callback', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.callbacks = {};\n\n        // build\n        if (this.opts.callbacks)\n        {\n            this._set(this.opts.callbacks, '');\n        }\n    },\n    stop: function()\n    {\n        this.callbacks = {};\n    },\n    add: function(name, handler)\n    {\n        if (!this.callbacks[name]) this.callbacks[name] = [];\n        this.callbacks[name].push(handler);\n    },\n    remove: function(name, handler)\n    {\n        if (handler === undefined)\n        {\n            delete this.callbacks[name];\n        }\n        else\n        {\n            for (var i = 0; i < this.callbacks[name].length; i++)\n            {\n                this.callbacks[name].splice(i, 1);\n            }\n\n            if (Object.keys(this.callbacks[name]).length === 0) delete this.callbacks[name];\n        }\n    },\n    trigger: function(name, args)\n    {\n        var value = this._loop(name, args, this.callbacks);\n        return (typeof value === 'undefined') ? args[0] : value;\n    },\n\n    // private\n    _set: function(obj, name)\n    {\n        for (var key in obj)\n        {\n            var path = (name === '') ? key : name + '.' + key;\n            if (typeof obj[key] === 'object')\n            {\n                this._set(obj[key], path);\n            }\n            else\n            {\n                this.callbacks[path] = [];\n                this.callbacks[path].push(obj[key]);\n            }\n        }\n    },\n    _loop: function(name, args, obj)\n    {\n        var value;\n        for (var key in obj)\n        {\n            if (name === key)\n            {\n                for (var i = 0; i < obj[key].length; i++)\n                {\n                    value = obj[key][i].apply(this.app, args);\n                }\n            }\n        }\n\n        return value;\n    }\n});\n$R.add('service', 'animate', {\n    init: function(app)\n    {\n        this.animationOpt = app.opts.animation;\n    },\n    start: function(element, animation, options, callback)\n    {\n        var defaults = {\n            duration: false,\n            iterate: false,\n            delay: false,\n            timing: false,\n            prefix: 'redactor-'\n        };\n\n        defaults = (typeof options === 'function') ? defaults : $R.extend(defaults, options);\n        callback = (typeof options === 'function') ? options : callback;\n\n        // play\n        return new $R.AnimatePlay(element, animation, defaults, callback, this.animationOpt);\n    },\n    stop: function(element)\n    {\n        this.$el = $R.dom(element);\n        this.$el.removeClass('redactor-animated');\n\n        var effect = this.$el.attr('redactor-animate-effect');\n        this.$el.removeClass(effect);\n\n        this.$el.removeAttr('redactor-animate-effect');\n        var hide = this.$el.attr('redactor-animate-hide');\n        if (hide)\n        {\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        this.$el.off('animationend webkitAnimationEnd');\n    }\n});\n\n$R.AnimatePlay = function(element, animation, defaults, callback, animationOpt)\n{\n    this.hidableEffects = ['fadeOut', 'flipOut', 'slideUp', 'zoomOut', 'slideOutUp', 'slideOutRight', 'slideOutLeft'];\n    this.prefixes = ['', '-webkit-'];\n\n    this.$el = $R.dom(element);\n    this.$body = $R.dom('body');\n    this.callback = callback;\n    this.animation = (!animationOpt) ? this.buildAnimationOff(animation) : animation;\n    this.defaults = defaults;\n\n    if (this.animation === 'slideUp')\n    {\n        this.$el.height(this.$el.height());\n    }\n\n    // animate\n    return (this.isInanimate()) ? this.inanimate() : this.animate();\n};\n\n$R.AnimatePlay.prototype = {\n    buildAnimationOff: function(animation)\n    {\n        return (this.isHidable(animation)) ? 'hide' : 'show';\n    },\n    buildHideClass: function()\n    {\n        return 'redactor-animate-hide';\n    },\n    isInanimate: function()\n    {\n        return (this.animation === 'show' || this.animation === 'hide');\n    },\n    isAnimated: function()\n    {\n        return this.$el.hasClass('redactor-animated');\n    },\n    isHidable: function(effect)\n    {\n        return (this.hidableEffects.indexOf(effect) !== -1);\n    },\n    inanimate: function()\n    {\n        this.defaults.timing = 'linear';\n\n        var hide;\n        if (this.animation === 'show')\n        {\n            hide = this.buildHideClass();\n            this.$el.attr('redactor-animate-hide', hide);\n            this.$el.removeClass(hide);\n        }\n        else\n        {\n            hide = this.$el.attr('redactor-animate-hide');\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        if (typeof this.callback === 'function') this.callback(this);\n\n        return this;\n    },\n    animate: function()\n    {\n        var delay = (this.defaults.delay) ? this.defaults.delay : 0;\n        setTimeout(function()\n        {\n            this.$body.addClass('no-scroll-x');\n            this.$el.addClass('redactor-animated');\n            if (!this.$el.attr('redactor-animate-hide'))\n            {\n                var hide = this.buildHideClass();\n                this.$el.attr('redactor-animate-hide', hide);\n                this.$el.removeClass(hide);\n            }\n\n            this.$el.addClass(this.defaults.prefix + this.animation);\n            this.$el.attr('redactor-animate-effect', this.defaults.prefix + this.animation);\n\n            this.set(this.defaults.duration + 's', this.defaults.iterate, this.defaults.timing);\n            this.complete();\n\n        }.bind(this), delay * 1000);\n\n        return this;\n    },\n    set: function(duration, iterate, timing)\n    {\n        var len = this.prefixes.length;\n\n        while (len--)\n        {\n            if (duration !== false || duration === '') this.$el.css(this.prefixes[len] + 'animation-duration', duration);\n            if (iterate !== false || iterate === '') this.$el.css(this.prefixes[len] + 'animation-iteration-count', iterate);\n            if (timing !== false || timing === '') this.$el.css(this.prefixes[len] + 'animation-timing-function', timing);\n        }\n    },\n    clean: function()\n    {\n        this.$body.removeClass('no-scroll-x');\n        this.$el.removeClass('redactor-animated');\n        this.$el.removeClass(this.defaults.prefix + this.animation);\n        this.$el.removeAttr('redactor-animate-effect');\n\n        this.set('', '', '');\n    },\n    complete: function()\n    {\n        this.$el.one('animationend webkitAnimationEnd', function()\n        {\n            if (this.$el.hasClass(this.defaults.prefix + this.animation)) this.clean();\n            if (this.isHidable(this.animation))\n            {\n                var hide = this.$el.attr('redactor-animate-hide');\n                this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n            }\n\n            if (this.animation === 'slideUp') this.$el.height('');\n            if (typeof this.callback === 'function') this.callback(this.$el);\n\n        }.bind(this));\n    }\n};\n$R.add('service', 'caret', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n\n    // set\n    setStart: function(el)\n    {\n        this._setCaret('Start', el);\n    },\n    setEnd: function(el)\n    {\n        this._setCaret('End', el);\n    },\n    setBefore: function(el)\n    {\n        this._setCaret('Before', el);\n    },\n    setAfter: function(el)\n    {\n        this._setCaret('After', el);\n    },\n\n    // is\n    isStart: function(el)\n    {\n        return this._isStartOrEnd(el, 'First');\n    },\n    isEnd: function(el)\n    {\n        return this._isStartOrEnd(el, 'Last');\n    },\n\n    // set side\n    setAtEnd: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var tag = data.getTag();\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            if (tag === 'a')\n            {\n                var textNode = this.utils.createInvisibleChar();\n                node.appendChild(textNode);\n\n                range.setStartBefore(textNode);\n                range.collapse(true);\n            }\n            else\n            {\n                range.selectNodeContents(node);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtStart: function(node)\n    {\n\t\tvar range = document.createRange();\n\t\tvar data = this.inspector.parse(node);\n        if (this._isInPage(node))\n        {\n            range.setStart(node, 0);\n            range.collapse(true);\n\n            if (data.isInline() || this.utils.isEmpty(node))\n            {\n                var textNode = this.utils.createInvisibleChar();\n                range.insertNode(textNode);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtBefore: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartBefore(node);\n            range.collapse(true);\n\n            if (data.isInline())\n            {\n                var textNode = this.utils.createInvisibleChar();\n                node.parentNode.insertBefore(textNode, node);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtAfter: function(node)\n    {\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartAfter(node);\n            range.collapse(true);\n\n            var textNode = this.utils.createInvisibleChar();\n            range.insertNode(textNode);\n            range.selectNodeContents(textNode);\n            range.collapse(false);\n            this.selection.setRange(range);\n        }\n    },\n    setAtPrev: function(node)\n    {\n        var prev = node.previousSibling;\n        if (prev)\n        {\n            prev = (prev.nodeType === 3 && this._isEmptyTextNode(prev)) ? prev.previousElementSibling : prev;\n            if (prev) this.setEnd(prev);\n        }\n    },\n    setAtNext: function(node)\n    {\n        var next = node.nextSibling;\n        if (next)\n        {\n            next = (next.nodeType === 3 && this._isEmptyTextNode(next)) ? next.nextElementSibling : next;\n            if (next) this.setStart(next);\n        }\n    },\n\n    // private\n    _setCaret: function(type, el)\n    {\n        var data = this.inspector.parse(el);\n        var node = data.getNode();\n\n        if (node)\n        {\n            this.component.clearActive();\n            this['_set' + type](node, data, data.getTag());\n        }\n    },\n    _setStart: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtStart(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findFirstNode('li');\n\n            var item = this.utils.getFirstElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setStart(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findFirstNode('dt');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setBefore(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getFirstElement(node);\n            if (el)\n            {\n                return this.setStart(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setStart(data.findFirstNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtStart(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setStart(tableData.findFirstNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'Start'))\n        {\n            this.setAtStart(node);\n        }\n    },\n    _setEnd: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtEnd(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findLastNode('li');\n\n            var item = this.utils.getLastElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setEnd(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findLastNode('dd');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setAfter(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getLastElement();\n            if (el)\n            {\n                return this.setEnd(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setEnd(data.findLastNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtEnd(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setEnd(tableData.findLastNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'End'))\n        {\n            // is element empty\n            if (this.utils.isEmpty(node))\n            {\n                return this.setStart(node);\n            }\n\n            this.setAtEnd(node);\n        }\n    },\n    _setBefore: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtBefore(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtBefore(node);\n        }\n        // td / th\n        else if (data.isFirstTableCell())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtPrev(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtPrev(data.getList());\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            return this.setStart(data.getComponent());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtPrev(node);\n        }\n\n        this.editor.focus();\n        this.setAtBefore(node);\n\n    },\n    _setAfter: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtAfter(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtAfter(node);\n        }\n        // td / th\n        else if (data.isLastTableCell())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtNext(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtNext(data.getList());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtNext(node);\n        }\n\n        this.editor.focus();\n        this.setAtAfter(node);\n    },\n    _setInline: function(node, type)\n    {\n        // is first element inline (FF only)\n        var inline = this._hasInlineChild(node, (type === 'Start') ? 'first' : 'last');\n        if (inline)\n        {\n            if (type === 'Start')\n            {\n                this.setStart(inline);\n            }\n            else\n            {\n                this.setEnd(inline);\n            }\n\n            return true;\n        }\n    },\n    _isStartOrEnd: function(el, type)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var data = this.inspector.parse(node);\n        node = this._getStartEndNode(node, data, type);\n\n        if (node)\n        {\n            var html = (node.nodeType === 3) ? node.textContent : node.innerHTML;\n            html = this.utils.trimSpaces(html);\n            if (html === '') return true;\n        }\n\n        if (!data.isFigcaption() && data.isComponent() && !data.isComponentEditable())\n        {\n            return true;\n        }\n\n        var offset = this.offset.get(node, true);\n        if (offset)\n        {\n            return (type === 'First') ? (offset.start === 0) : (offset.end === this.offset.size(node, true));\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _isInPage: function(node)\n    {\n        if (node && node.nodeType)\n        {\n            return (node === document.body) ? false : document.body.contains(node);\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _hasInlineChild: function(el, pos)\n    {\n        var data = this.inspector.parse(el);\n        var node = (pos === 'first') ? data.getFirstNode() : data.getLastNode();\n        var $node = $R.dom(node);\n\n        if (node && node.nodeType !== 3\n            && this.inspector.isInlineTag(node.tagName)\n            && !$node.hasClass('redactor-component')\n             && !$node.hasClass('non-editable'))\n        {\n            return node;\n        }\n    },\n    _isEmptyTextNode: function(node)\n    {\n        var text = node.textContent.trim().replace(/\\n/, '');\n        text = this.utils.removeInvisibleChars(text);\n\n        return (text === '');\n    },\n    _getStartEndNode: function(node, data, type)\n    {\n        if (data.isFigcaption())\n        {\n            node = data.getFigcaption();\n        }\n        else if (data.isTable())\n        {\n            node = data['find' + type + 'Node']('th, td');\n        }\n        else if (data.isList())\n        {\n            node = data['find' + type + 'Node']('li');\n        }\n        else if (data.isComponentType('code'))\n        {\n            node = data.findLastNode('pre, code');\n        }\n\n        return node;\n    }\n});\n$R.add('service', 'selection', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // is\n    is: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var node = sel.anchorNode;\n            var data = this.inspector.parse(node);\n\n            return (data.isInEditor() || data.isEditor());\n        }\n\n        return false;\n    },\n    isCollapsed: function()\n    {\n        var sel = this.get();\n        var range = this.getRange();\n\n        if (sel && sel.isCollapsed) return true;\n        else if (range && range.toString().length === 0) return true;\n\n        return false;\n    },\n    isBackwards: function()\n    {\n        var backwards = false;\n        var sel = this.get();\n\n        if (sel && !sel.isCollapsed)\n        {\n            var range = document.createRange();\n            range.setStart(sel.anchorNode, sel.anchorOffset);\n            range.setEnd(sel.focusNode, sel.focusOffset);\n            backwards = range.collapsed;\n            range.detach();\n        }\n\n        return backwards;\n    },\n    isIn: function(el)\n    {\n        var node = $R.dom(el).get();\n        var current = this.getCurrent();\n\n        return (current && node) ? node.contains(current) : false;\n    },\n    isText: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var el = sel.anchorNode;\n            var block = this.getBlock(el);\n            var blocks = this.getBlocks();\n\n            // td, th or hasn't block\n            if ((block && this.inspector.isTableCellTag(block.tagName)) || (block === false && blocks.length === 0))\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    isAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var data = this.inspector.parse(node);\n\n        // component\n        if (!data.isFigcaption() && this.component.isNonEditable(node) && this.component.isActive(node))\n        {\n            return true;\n        }\n\n        //\n        if (isEditor)\n        {\n            var $editor = this.editor.getElement();\n            var output = this.cleaner.output($editor.html());\n            output = output.replace(/<p><\\/p>$/i, '');\n\n            var htmlLen = this.getHtml().length;\n            var outputLen = output.length;\n\n            if (htmlLen !== outputLen)\n            {\n                return false;\n            }\n\n        }\n\n        // editor empty or collapsed\n        if ((isEditor && this.editor.isEmpty()) || this.isCollapsed())\n        {\n            return false;\n        }\n\n        // all\n        var offset = this.offset.get(node, true);\n        var size = this.offset.size(node, true);\n\n        // pre, table, or pre/code in figure\n        if (!isEditor && data.isComponentType('code'))\n        {\n            size = this.getText().trim().length;\n        }\n\n        if (offset && offset.start === 0 && offset.end === size)\n        {\n            return true;\n        }\n\n        return false;\n    },\n\n    // has\n    hasNonEditable: function()\n    {\n        var selected = this.getHtml();\n        var $wrapper = $R.dom('<div>').html(selected);\n\n        return (!this.isCollapsed() && $wrapper.find('.non-editable').length !== 0);\n    },\n\n    // set\n    setRange: function(range)\n    {\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n    },\n    setAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var data = this.inspector.parse(node);\n\n        this.component.clearActive();\n\n        this.editor.focus();\n        this.editor.saveScroll();\n        this.editor.disableNonEditables();\n\n        if (node && node.tagName === 'TABLE')\n        {\n            var first = data.findFirstNode('td, th');\n            var last = data.findLastNode('td, th');\n\n            $R.dom(first).prepend(this.marker.build('start'));\n            $R.dom(last).append(this.marker.build('end'));\n\n            this.restoreMarkers();\n        }\n        else if (!data.isFigcaption() && this.component.isNonEditable(node))\n        {\n            this.component.setActive(node);\n        }\n        else\n        {\n            if (data.isComponentType('code'))\n            {\n                node = data.getComponentCodeElement();\n                node.focus();\n            }\n\n            var range = document.createRange();\n            range.selectNodeContents(node);\n\n            this.setRange(range);\n        }\n\n        this.editor.enableNonEditables();\n        this.editor.restoreScroll();\n    },\n\n    // get\n    get: function()\n    {\n        var sel = window.getSelection();\n        return (sel.rangeCount > 0) ? sel : null;\n    },\n    getRange: function()\n    {\n        var sel = this.get();\n        return (sel) ? ((sel.getRangeAt(0)) ? sel.getRangeAt(0) : null) : null;\n    },\n    getTextBeforeCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            range = range.cloneRange();\n            range.collapse(true);\n            range.setStart(el, 0);\n            text = range.toString().slice(-num);\n        }\n\n        return text;\n    },\n    getTextAfterCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(el);\n            clonedRange.setStart(range.endContainer, range.endOffset);\n\n            text = clonedRange.toString().slice(0, num);\n        }\n\n        return text;\n    },\n    getPosition: function()\n    {\n        var range = this.getRange();\n        var pos = { top: 0, left: 0, width: 0, height: 0 };\n        if (window.getSelection && range.getBoundingClientRect)\n        {\n            range = range.cloneRange();\n            var offset = (range.startOffset-1);\n            range.setStart(range.startContainer, (offset < 0) ? 0 : offset);\n            var rect = range.getBoundingClientRect();\n            pos = { top: rect.top, left: rect.left, width: (rect.right - rect.left) , height: (rect.bottom - rect.top) };\n        }\n\n        return pos;\n    },\n    getCurrent: function()\n    {\n        var node = false;\n        var sel = this.get();\n        var component = this.component.getActive();\n\n        if (component)\n        {\n            node = component;\n        }\n        else if (sel && this.is())\n        {\n            var data = this.inspector.parse(sel.anchorNode);\n            node = (!data.isEditor()) ? sel.anchorNode : false;\n        }\n\n        return node;\n    },\n    getParent: function()\n    {\n        var node = false;\n        var current = this.getCurrent();\n        if (current)\n        {\n            var parent = current.parentNode;\n            var data = this.inspector.parse(parent);\n\n            node = (!data.isEditor()) ? parent : false;\n        }\n\n        return node;\n    },\n    getElement: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            if (data.isElement() && data.isInEditor())\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInline: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inline = false;\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inline = node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return inline;\n    },\n    getInlineFirst: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlineAll: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inlines = [];\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inlines.push(node);\n            }\n\n            node = node.parentNode;\n        }\n\n        return inlines;\n    },\n    getBlock: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            var isBlock = this.inspector.isBlockTag(node.tagName);\n\n            if (isBlock && data.isInEditor(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlinesAllSelected: function(options)\n    {\n        if (this.isAll()) return [];\n\n        var inlines = this.getInlines({ all: true });\n        var textNodes = this.getNodes({ textnodes: true, inline: false });\n        var selected = this.getText().replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n        var finalNodes = [];\n\n        if (textNodes.length !== 0)\n        {\n            return finalNodes;\n        }\n\n        if (selected === '')\n        {\n            finalNodes = inlines;\n        }\n        else if (inlines.length > 1)\n        {\n            for (var i = 0; i < inlines.length; i++)\n            {\n                if (this._isTextSelected(inlines[i], selected))\n                {\n                    finalNodes.push(inlines[i]);\n                }\n            }\n        }\n        else if (inlines.length === 1)\n        {\n            if (this._isTextSelected(inlines[0], selected))\n            {\n                finalNodes = inlines;\n            }\n        }\n\n        finalNodes = (options && options.tags) ? this._filterNodesByTags(finalNodes, options.tags) : finalNodes;\n\n        return finalNodes;\n    },\n    getInlines: function(options)\n    {\n        var nodes = this.getNodes();\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node;\n            if (options && options.all)\n            {\n                node = nodes[i];\n                while (node)\n                {\n                    if (this._isInlineNode(node) && !this._isInNodesArray(filteredNodes, node))\n                    {\n                        filteredNodes.push(node);\n                    }\n\n                    node = node.parentNode;\n                }\n            }\n            else\n            {\n                node = this.getInline(nodes[i]);\n                if (node && !this._isInNodesArray(filteredNodes, node))\n                {\n                    filteredNodes.push(node);\n                }\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.inside) ? this._filterInlinesInside(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getBlocks: function(options)\n    {\n        var nodes = this.getNodes();\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = this.getBlock(nodes[i]);\n            if (node && !this._isInNodesArray(filteredNodes, node))\n            {\n                filteredNodes.push(node);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.first) ? this._filterBlocksFirst(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getElements: function(options)\n    {\n        var nodes = this.getNodes({ textnodes: false });\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (!this._isInNodesArray(filteredNodes, nodes[i]))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getNodes: function(options)\n    {\n        var nodes = [];\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            nodes = this._getNodesComponent(activeComponent);\n        }\n        else if (this.isCollapsed())\n        {\n            var current = this.getCurrent();\n            nodes = (current) ? [current] : [];\n        }\n        else if (this.is() && !activeComponent)\n        {\n            nodes = this._getRangeSelectedNodes();\n        }\n\n        // filter\n        nodes = this._filterServicesNodes(nodes);\n        nodes = this._filterEditor(nodes);\n\n        // options\n        nodes = (options && options.tags) ? this._filterNodesByTags(nodes, options.tags) : nodes;\n        nodes = (options && options.textnodes) ? this._filterNodesTexts(nodes, options) : nodes;\n        nodes = (options && !options.textnodes) ? this._filterNodesElements(nodes) : nodes;\n\n        return nodes;\n    },\n\n    // text & html\n    getText: function()\n    {\n        var sel = this.get();\n        return (sel) ? this.utils.removeInvisibleChars(sel.toString()) : '';\n    },\n    getHtml: function(clean)\n    {\n        var html = '';\n        var sel = this.get();\n        if (sel)\n        {\n            var container = document.createElement('div');\n            var len = sel.rangeCount;\n            for (var i = 0; i < len; ++i)\n            {\n                container.appendChild(sel.getRangeAt(i).cloneContents());\n            }\n\n            html = container.innerHTML;\n            html = (clean !== false) ? this.cleaner.output(html) : html;\n            html = html.replace(/<p><\\/p>$/i, '');\n        }\n\n        return html;\n    },\n\n    // clear\n    clear: function()\n    {\n        this.component.clearActive();\n        this.get().removeAllRanges();\n    },\n\n    // collapse\n    collapseToStart: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToStart();\n    },\n    collapseToEnd: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToEnd();\n    },\n\n    // save\n    saveActiveComponent: function()\n    {\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            this.savedComponent = activeComponent;\n            return true;\n        }\n\n        return false;\n    },\n    restoreActiveComponent: function()\n    {\n        if (this.savedComponent)\n        {\n            this.component.setActive(this.savedComponent);\n            return true;\n        }\n\n        return false;\n    },\n    save: function()\n    {\n        this._clearSaved();\n\n        var el = this.getElement();\n        if (el && (el.tagName === 'TD' || el.tagName === 'TH') && el.innerHTML === '')\n        {\n            this.savedElement = el;\n        }\n        else if (!this.saveActiveComponent())\n        {\n            this.saved = this.offset.get();\n        }\n    },\n    restore: function()\n    {\n        if (!this.saved && !this.savedComponent && !this.savedElement) return;\n\n        this.editor.saveScroll();\n\n        if (this.savedElement)\n        {\n            this.caret.setStart(this.savedElement);\n        }\n        else if (!this.restoreActiveComponent())\n        {\n            this.offset.set(this.saved);\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n    saveMarkers: function()\n    {\n        this._clearSaved();\n\n        if (!this.saveActiveComponent())\n        {\n            this.marker.insert();\n        }\n    },\n    restoreMarkers: function()\n    {\n        this.editor.saveScroll();\n\n        if (!this.restoreActiveComponent())\n        {\n            this.marker.restore();\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n\n    // private\n    _getNextNode: function(node)\n    {\n        if (node.hasChildNodes()) return node.firstChild;\n\n        while (node && !node.nextSibling)\n        {\n            node = node.parentNode;\n        }\n\n        if (!node) return null;\n\n        return node.nextSibling;\n    },\n    _getNodesComponent: function(component)\n    {\n        var current = this.getCurrent();\n        var data = this.inspector.parse(current);\n\n        return (data.isFigcaption()) ? [data.getFigcaption()] : [component];\n    },\n    _getRangeSelectedNodes: function()\n    {\n        var nodes = [];\n        var range = this.getRange();\n        var node = range.startContainer;\n        var startNode = range.startContainer;\n        var endNode = range.endContainer;\n        var $editor = this.editor.getElement();\n\n        // editor\n        if (startNode === $editor.get() && this.isAll())\n        {\n            nodes = this.utils.getChildNodes($editor);\n        }\n        // single node\n        else if (node == endNode)\n        {\n            nodes = [node];\n        }\n        else\n        {\n            while (node && node != endNode)\n            {\n                nodes.push(node = this._getNextNode(node));\n            }\n\n            node = range.startContainer;\n            while (node && node != range.commonAncestorContainer)\n            {\n                nodes.unshift(node);\n                node = node.parentNode;\n            }\n        }\n\n        return nodes;\n    },\n    _isInNodesArray: function(nodes, node)\n    {\n        return (nodes.indexOf(node) !== -1);\n    },\n    _filterEditor: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var data = this.inspector.parse(nodes[i]);\n            if (data.isInEditor())\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterServicesNodes: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var skip = false;\n\n            if (nodes[i] && nodes[i].nodeType === 3 && this.utils.isEmpty(nodes[i])) skip = true;\n            if ($el.hasClass('redactor-script-tag')\n                || $el.hasClass('redactor-component-caret')\n                || $el.hasClass('redactor-selection-marker')\n                || $el.hasClass('non-editable')) skip = true;\n\n            if (!skip)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesTexts: function(nodes, options)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType === 3 || (options.keepbr && nodes[i].tagName === 'BR'))\n            {\n                var inline = this.getInline(nodes[i]);\n                var isInline = (inline && options && options.inline === false);\n                if (!isInline)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesElements: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesByTags: function(nodes, tags, passtexts)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (passtexts && nodes[i].nodeType === 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n            else if (nodes[i].nodeType !== 3)\n            {\n                var nodeTag = nodes[i].tagName.toLowerCase();\n                if (tags.indexOf(nodeTag.toLowerCase()) !== -1)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterBlocksFirst: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var parent = $node.parent().get();\n            var isFirst = ($node.parent().hasClass('redactor-in'));\n            var isCellParent = (parent && (parent.tagName === 'TD' || parent.tagName === 'TH'));\n            if (isFirst || isCellParent)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterInlinesInside: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (window.getSelection().containsNode(nodes[i], true))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _isTextSelected: function(node, selected)\n    {\n        var text = this.utils.removeInvisibleChars(node.textContent);\n\n        return (\n            selected === text\n            || text.search(selected) !== -1\n            || selected.search(new RegExp('^' + text)) !== -1\n            || selected.search(new RegExp(text + '$')) !== -1\n        );\n    },\n    _isInlineNode: function(node)\n    {\n        var data = this.inspector.parse(node);\n\n        return (this.inspector.isInlineTag(node.tagName) && data.isInEditor());\n    },\n    _clearSaved: function()\n    {\n        this.saved = false;\n        this.savedComponent = false;\n        this.savedElement = false;\n    }\n});\n$R.add('service', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.rootElement = app.rootElement;\n\n        // local\n        this.$element = {};\n        this.type = 'inline';\n    },\n    start: function()\n    {\n        this._build();\n        this._buildType();\n    },\n\n    // public\n    isType: function(type)\n    {\n        return (type === this.type);\n    },\n    getType: function()\n    {\n        return this.type;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n\n    // private\n    _build: function()\n    {\n        this.$element = $R.dom(this.rootElement);\n    },\n    _buildType: function()\n    {\n        var tag = this.$element.get().tagName;\n\n        this.type = (tag === 'TEXTAREA') ? 'textarea' : this.type;\n        this.type = (tag === 'DIV') ? 'div' : this.type;\n        this.type = (this.opts.inline) ? 'inline' : this.type;\n    }\n});\n$R.add('service', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.scrolltop = false;\n        this.pasting = false;\n    },\n\n    // start\n    start: function()\n    {\n        this._build();\n    },\n\n    // focus\n    focus: function()\n    {\n        if (!this.isFocus() && !this._isContenteditableFocus())\n        {\n            this.saveScroll();\n            this.$editor.focus();\n            this.restoreScroll();\n        }\n    },\n    startFocus: function()\n    {\n        this.caret.setStart(this.getFirstNode());\n    },\n    endFocus: function()\n    {\n        this.caret.setEnd(this.getLastNode());\n    },\n\n    // pasting\n    isPasting: function()\n    {\n        return this.pasting;\n    },\n    enablePasting: function()\n    {\n        this.pasting = true;\n    },\n    disablePasting: function()\n    {\n        this.pasting = false;\n    },\n\n    // scroll\n    saveScroll: function()\n    {\n        this.scrolltop = this._getScrollTarget().scrollTop();\n    },\n    restoreScroll: function()\n    {\n        if (this.scrolltop !== false)\n        {\n            this._getScrollTarget().scrollTop(this.scrolltop);\n            this.scrolltop = false;\n        }\n    },\n\n    // non editables\n    disableNonEditables: function()\n    {\n        this.$noneditables = this.$editor.find('[contenteditable=false]');\n        this.$noneditables.attr('contenteditable', true);\n    },\n    enableNonEditables: function()\n    {\n        if (this.$noneditables)\n        {\n            setTimeout(function() { this.$noneditables.attr('contenteditable', false); }.bind(this), 1);\n        }\n    },\n\n    // nodes\n    getFirstNode: function()\n    {\n        return this.$editor.contents()[0];\n    },\n    getLastNode: function()\n    {\n        var nodes = this.$editor.contents();\n\n        return nodes[nodes.length-1];\n    },\n\n    // utils\n    isSourceMode: function()\n    {\n        var $source = this.source.getElement();\n\n        return $source.hasClass('redactor-source-open');\n    },\n    isEditor: function(el)\n    {\n        var node = $R.dom(el).get();\n\n        return (node === this.$editor.get());\n    },\n    isEmpty: function(keeplists)\n    {\n        return this.utils.isEmptyHtml(this.$editor.html(), false, keeplists);\n    },\n    isFocus: function()\n    {\n        var $active = $R.dom(document.activeElement);\n        var isComponentSelected = (this.$editor.find('.redactor-component-active').length !== 0);\n\n        return (isComponentSelected || $active.closest('.redactor-in-' + this.uuid).length !== 0);\n    },\n    setEmpty: function()\n    {\n        this.$editor.html(this.opts.emptyHtml);\n    },\n\n    // element\n    getElement: function()\n    {\n        return this.$editor;\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var editableElement = (this.element.isType('textarea')) ? '<div>' : $element.get();\n\n        this.$editor = $R.dom(editableElement);\n    },\n    _getScrollTarget: function()\n    {\n        return (this.opts.scrollTarget) ? $R.dom(this.opts.scrollTarget) : this.$doc;\n    },\n    _isContenteditableFocus: function()\n    {\n        var block = this.selection.getBlock();\n        var $blockParent = (block) ? $R.dom(block).closest('[contenteditable=true]').not('.redactor-in') : [];\n\n        return ($blockParent.length !== 0);\n    }\n});\n$R.add('service', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    getElement: function()\n    {\n        return this.$container;\n    },\n\n    // private\n    _build: function()\n    {\n        var tag = (this.element.isType('inline')) ? '<span>' : '<div>';\n        this.$container = $R.dom(tag);\n    }\n});\n$R.add('service', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$source = {};\n        this.content = '';\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildName();\n        this._buildStartedContent();\n    },\n    getElement: function()\n    {\n        return this.$source;\n    },\n    getCode: function()\n    {\n        return this.$source.val();\n    },\n    getName: function()\n    {\n        return this.$source.attr('name');\n    },\n    getStartedContent: function()\n    {\n        return this.content;\n    },\n    setCode: function(html)\n    {\n        return this.insertion.set(html, true, false);\n    },\n    isNameGenerated: function()\n    {\n        return (this.name);\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var isTextarea = this.element.isType('textarea');\n        var sourceElement = (isTextarea) ? $element.get() : '<textarea>';\n\n        this.$source = $R.dom(sourceElement);\n    },\n    _buildName: function()\n    {\n        var $element = this.element.getElement();\n\n        this.name = $element.attr('name');\n        this.$source.attr('name', (this.name) ? this.name : 'content-' + this.uuid);\n    },\n    _buildStartedContent: function()\n    {\n        var $element = this.element.getElement();\n        var content = (this.element.isType('textarea')) ? $element.val() : $element.html();\n\n        this.content = content.trim();\n    }\n});\n$R.add('service', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$statusbar = {};\n        this.items = [];\n    },\n    // public\n    start: function()\n    {\n        this.$statusbar = $R.dom('<ul>');\n        this.$statusbar.attr('dir', this.opts.direction);\n    },\n    add: function(name, html)\n    {\n        return this.update(name, html);\n    },\n    update: function(name, html)\n    {\n        var $item;\n        if (typeof this.items[name] !== 'undefined')\n        {\n            $item = this.items[name];\n        }\n        else\n        {\n            $item = $R.dom('<li>');\n            this.$statusbar.append($item);\n            this.items[name] = $item;\n        }\n\n        return $item.html(html);\n    },\n    get: function(name)\n    {\n        return (this.items[name]) ? this.items[name] : false;\n    },\n    remove: function(name)\n    {\n        if (this.items[name])\n        {\n            this.items[name].remove();\n            delete this.items[name];\n        }\n    },\n    getItems: function()\n    {\n        return this.items;\n    },\n    removeItems: function()\n    {\n        this.items = {};\n        this.$statusbar.html('');\n    },\n    getElement: function()\n    {\n        return this.$statusbar;\n    }\n});\n$R.add('service', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.dropdownOpened = false;\n        this.buttonsObservers = {};\n    },\n    // public\n    start: function()\n    {\n        if (this.is())\n        {\n            this.opts.activeButtons = (this.opts.activeButtonsAdd) ? this._extendActiveButtons() : this.opts.activeButtons;\n            this.create();\n        }\n    },\n    stopObservers: function()\n    {\n        this.buttonsObservers = {};\n    },\n    create: function()\n    {\n        this.$wrapper = $R.dom('<div>');\n        this.$toolbar = $R.dom('<div>');\n    },\n    observe: function()\n    {\n        if (!this.is()) return;\n\n        this.setButtonsInactive();\n\n        var button, observer;\n\n        // observers\n        for (var name in this.buttonsObservers)\n        {\n            observer = this.buttonsObservers[name];\n            button = this.getButton(name);\n            this.app.broadcast('button.' + observer + '.observe', button);\n        }\n\n        // inline buttons\n        var buttons = this.opts.activeButtons;\n        var inlines = this.selection.getInlinesAllSelected();\n        var tags = this._inlinesToTags(inlines);\n        for (var key in buttons)\n        {\n            if (tags.indexOf(key) !== -1)\n            {\n                button = this.getButton(buttons[key]);\n                button.setActive();\n            }\n\n        }\n    },\n\n    // is\n    is: function()\n    {\n        return !(!this.opts.toolbar || (this.detector.isMobile() && this.opts.air));\n    },\n    isAir: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-air') : false;\n    },\n    isFixed: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-toolbar-fixed') : false;\n    },\n    isContextBar: function()\n    {\n        var $bar = this.$body.find('#redactor-context-toolbar-' + this.uuid);\n        return $bar.hasClass('open');\n    },\n    isTarget: function()\n    {\n        return (this.opts.toolbarFixedTarget !== document);\n    },\n\n    // get\n    getElement: function()\n    {\n        return this.$toolbar;\n    },\n    getWrapper: function()\n    {\n        return this.$wrapper;\n    },\n    getDropdown: function()\n    {\n        return this.dropdownOpened;\n    },\n    getTargetElement: function()\n    {\n        return $R.dom(this.opts.toolbarFixedTarget);\n    },\n    getButton: function(name)\n    {\n        var $btn = this._findButton('.re-' + name);\n\n        return ($btn.length !== 0) ? $btn.dataget('data-button-instance') : false;\n    },\n    getButtonByIndex: function(index)\n    {\n        var $btn = this.$toolbar.find('.re-button').eq(index);\n\n        return ($btn.length !== 0) ? $btn.dataget('data-button-instance') : false;\n    },\n    getButtons: function()\n    {\n        var buttons = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            buttons.push($node.dataget('data-button-instance'));\n        });\n\n        return buttons;\n    },\n    getButtonsKeys: function()\n    {\n        var keys = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            keys.push($node.attr('data-re-name'));\n        });\n\n        return keys;\n    },\n\n    // add\n    addButton: function(name, btnObj, position, $el, start)\n    {\n        position = position || 'end';\n\n        var $button = $R.create('toolbar.button', this.app, name, btnObj);\n\n        if (btnObj.observe)\n        {\n            this.opts.activeButtonsObservers[name] = { observe: btnObj.observe, button: $button };\n        }\n\n        if (start !== true)\n        {\n            var index = (this.opts.buttons.indexOf(name));\n\n            if (index === 0) position = 'first';\n            else if (index !== -1)\n            {\n                $el = this.getButtonByIndex(index-1);\n                if ($el) position = 'after';\n            }\n        }\n\n        if (this.is())\n        {\n            if (position === 'first') this.$toolbar.prepend($button);\n            else if (position === 'after') $el.after($button);\n            else if (position === 'before') $el.before($button);\n            else this.$toolbar.append($button);\n        }\n\n        return $button;\n    },\n    addButtonFirst: function(name, btnObj)\n    {\n        return this.addButton(name, btnObj, 'first');\n    },\n    addButtonAfter: function(after, name, btnObj)\n    {\n        var $btn = this.getButton(after);\n\n        return ($btn) ? this.addButton(name, btnObj, 'after', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonBefore: function(before, name, btnObj)\n    {\n        var $btn = this.getButton(before);\n\n        return ($btn) ? this.addButton(name, btnObj, 'before', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonObserver: function(name, observer)\n    {\n        this.buttonsObservers[name] = observer;\n    },\n\n    // set\n    setDropdown: function(dropdown)\n    {\n        this.dropdownOpened = dropdown;\n    },\n    setButtonsInactive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setInactive();\n        }\n    },\n    setButtonsActive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setActive();\n        }\n    },\n\n    // disable & enable\n    disableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].disable();\n        }\n    },\n    enableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].enable();\n        }\n\n    },\n\n    // private\n    _findButton: function(selector)\n    {\n        return (this.is()) ? this.$toolbar.find(selector) : $R.dom();\n    },\n    _findButtons: function()\n    {\n        return (this.is()) ? this.$toolbar.find('.re-button') : $R.dom();\n    },\n    _extendActiveButtons: function()\n    {\n        return $R.extend({}, this.opts.activeButtons, this.opts.activeButtonsAdd);\n    },\n    _inlinesToTags: function(inlines)\n    {\n        var tags = [];\n        for (var i = 0; i < inlines.length; i++)\n        {\n            tags.push(inlines[i].tagName.toLowerCase());\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'toolbar.button', {\n    mixins: ['dom'],\n    init: function(app, name, btnObj)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.obj = btnObj;\n        this.name = name;\n        this.dropdown = false;\n        this.tooltip = false;\n\n        // init\n        this._init();\n    },\n    // is\n    isActive: function()\n    {\n        return this.hasClass('redactor-button-active');\n    },\n    isDisabled: function()\n    {\n        return this.hasClass('redactor-button-disabled');\n    },\n\n    // has\n    hasIcon: function()\n    {\n        return (this.obj.icon && !this.opts.buttonsTextLabeled);\n    },\n\n    // set\n    setDropdown: function(dropdown)\n    {\n        this.obj.dropdown = dropdown;\n        this.obj.message = false;\n        this.dropdown = $R.create('toolbar.dropdown', this.app, this.name, this.obj.dropdown);\n        this.attr('data-dropdown', true);\n    },\n    setMessage: function(message, args)\n    {\n        this.obj.message = message;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setApi: function(api, args)\n    {\n        this.obj.api = api;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setTitle: function(title)\n    {\n        this.obj.title = this.lang.parse(title);\n        this.obj.tooltip = this.obj.title;\n\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n        if (!this.attr('data-re-icon')) this.html(this.obj.title);\n    },\n    setTooltip: function(tooltip)\n    {\n        this.obj.tooltip = this.lang.parse(tooltip);\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n    },\n    setIcon: function(icon)\n    {\n        if (this.opts.buttonsTextLabeled) return;\n\n        this.obj.icon = true;\n        this.$icon = $R.dom(icon);\n\n        this.html('');\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n        this.setTooltip(this.obj.title);\n        this._buildTooltip();\n    },\n    setActive: function()\n    {\n        this.addClass('redactor-button-active');\n    },\n    setInactive: function()\n    {\n        this.removeClass('redactor-button-active');\n    },\n\n    // hide\n    hideTooltip: function()\n    {\n        this.$body.find('.re-button-tooltip').remove();\n    },\n\n    // get\n    getDropdown: function()\n    {\n        return this.dropdown;\n    },\n\n    // enable & disable\n    disable: function()\n    {\n        this.addClass('redactor-button-disabled');\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-button-disabled');\n    },\n\n    // toggle\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.isDisabled()) return;\n\n        if (this.obj.dropdown)\n        {\n            this.dropdown.toggle(e);\n        }\n        else if (this.obj.api)\n        {\n            // broadcast\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n        else if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n\n        this.hideTooltip();\n    },\n\n    // private\n    _init: function()\n    {\n        // parse\n        this._parseTitle();\n        this._parseTooltip();\n\n        // build\n        this._build();\n        this._buildCallback();\n        this._buildAttributes();\n        this._buildObserver();\n\n        if (this.hasIcon())\n        {\n            this._buildIcon();\n            this._buildTooltip();\n        }\n        else\n        {\n            this.html(this.obj.title);\n        }\n    },\n    _parseTooltip: function()\n    {\n        this.obj.tooltip = (this.obj.tooltip) ? this.lang.parse(this.obj.tooltip) : this.obj.title;\n    },\n    _parseTitle: function()\n    {\n        this.obj.title = this.lang.parse(this.obj.title);\n    },\n    _build: function()\n    {\n        this.parse('<a>');\n        this.addClass('re-button re-' + this.name);\n        this.attr('data-re-name', this.name);\n        this.dataset('data-button-instance', this);\n\n        if (this.obj.dropdown) this.setDropdown(this.obj.dropdown);\n    },\n    _buildCallback: function()\n    {\n        this.on('click', this.toggle.bind(this));\n    },\n    _buildAttributes: function()\n    {\n        var attrs = {\n            'href': '#',\n            'alt': this.obj.tooltip,\n            'rel': this.name,\n            'role': 'button',\n            'aria-label': this.obj.tooltip,\n            'tabindex': '-1'\n        };\n\n        this.attr(attrs);\n    },\n    _buildObserver: function()\n    {\n        if (typeof this.obj.observe !== 'undefined')\n        {\n            this.toolbar.addButtonObserver(this.name, this.obj.observe);\n        }\n    },\n    _buildIcon: function()\n    {\n        var icon = this.obj.icon;\n        var isHtml = (/(<([^>]+)>)/ig.test(icon));\n\n        this.$icon = (isHtml) ? $R.dom(icon) : $R.dom('<i>');\n        if (!isHtml) this.$icon.addClass('re-icon-' + this.name);\n\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n    },\n    _buildTooltip: function()\n    {\n        if (this.detector.isDesktop())\n        {\n            this.tooltip = $R.create('toolbar.button.tooltip', this.app, this);\n        }\n    }\n});\n$R.add('class', 'toolbar.button.tooltip', {\n    mixins: ['dom'],\n    init: function(app, $button)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.$button = $button;\n        this.created = false;\n\n        // init\n        this._init();\n    },\n    open: function()\n    {\n        if (this.$button.hasClass('redactor-button-disabled') || this.$button.hasClass('redactor-button-active')) return;\n\n        this.created = true;\n        this.parse('<span>');\n        this.addClass('re-button-tooltip');\n        this.$body.append(this);\n        this.html(this.$button.attr('alt'));\n\n        var offset = this.$button.offset();\n        var position = 'absolute';\n        var height = this.$button.height();\n        var width = this.$button.width();\n        var arrowOffset = 4;\n\n        this.css({\n            top: (offset.top + height + arrowOffset) + 'px',\n            left: (offset.left + width/2 - this.width()/2) + 'px',\n            position: position\n        });\n\n        this.show();\n    },\n    close: function()\n    {\n        if (!this.created || this.$button.hasClass('redactor-button-disabled')) return;\n\n        this.remove();\n        this.created = false;\n    },\n\n    // private\n    _init: function()\n    {\n        this.$button.on('mouseover', this.open.bind(this));\n        this.$button.on('mouseout', this.close.bind(this));\n    }\n});\n$R.add('class', 'toolbar.dropdown', {\n    mixins: ['dom'],\n    init: function(app, name, items)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.name = name;\n        this.started = false;\n        this.items = items;\n        this.$items = [];\n    },\n    // public\n    toggle: function(e)\n    {\n        if (!this.started)\n        {\n            this._build();\n        }\n\n        // toggle\n        if (this.isOpened() && this.isActive())\n        {\n            this.close(false);\n        }\n        else\n        {\n            this.open(e);\n        }\n    },\n    isOpened: function()\n    {\n        var $dropdown = this.$body.find('.redactor-dropdown-' + this.uuid + '.open');\n\n        return ($dropdown.length !== 0 && $dropdown.attr('data-re-name') === this.name);\n    },\n    isActive: function()\n    {\n        var $dropdown = this.$body.find('#redactor-dropdown-' + this.uuid + '-' + this.name + '.open');\n        return ($dropdown.length !== 0);\n    },\n    getName: function()\n    {\n        return this.attr('data-re-name');\n    },\n    getItem: function(name)\n    {\n        return this.$items[name];\n    },\n    getItemsByClass: function(classname)\n    {\n        var result = [];\n        for (var key in this.$items)\n        {\n            if (this.$items[key].hasClass(classname)) result.push(this.$items[key]);\n        }\n\n        return result;\n    },\n    open: function(e)\n    {\n        this._closeAll();\n\n        this.$btn = this.toolbar.getButton(this.name);\n        this.app.broadcast('dropdown.open', e, this, this.$btn);\n        this.toolbar.setDropdown(this);\n\n        this.show();\n        this.removeClass('redactor-animate-hide');\n        this.addClass('open');\n        this._observe();\n\n        this.$btn.hideTooltip();\n        this.$btn.setActive();\n\n        this.$doc.on('keyup.redactor.dropdown-' + this.uuid, this._handleKeyboard.bind(this));\n        this.$doc.on('click.redactor.dropdown-' + this.uuid + ' touchstart.redactor.dropdown-' + this.uuid, this.close.bind(this));\n\n        this.updatePosition();\n        this.app.broadcast('dropdown.opened', e, this, this.$btn);\n\n    },\n    close: function(e, animate)\n    {\n        if (e)\n        {\n            var $el = $R.dom(e.target);\n            if (this._isButton(e) || $el.hasClass('redactor-dropdown-not-close') || $el.hasClass('redactor-dropdown-item-disabled'))\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        this.app.broadcast('dropdown.close', this, this.$btn);\n        this.toolbar.setDropdown(false);\n\n        this.$btn.setInactive();\n        if (animate === false)\n        {\n            this._close();\n        }\n        else\n        {\n            this.animate.start(this, 'fadeOut', this._close.bind(this));\n        }\n    },\n    updatePosition: function()\n    {\n        var isFixed = this.toolbar.isFixed();\n        var pos = this.$btn.offset();\n        pos.top = (isFixed) ? this.$btn.position().top : pos.top;\n\n        var btnHeight = this.$btn.height();\n        var btnWidth = this.$btn.width();\n        var position = (isFixed) ? 'fixed' : 'absolute';\n        var topOffset = 2;\n        var leftOffset = 0;\n        var left = (pos.left + leftOffset);\n        var width = parseFloat(this.css('width'));\n        var leftFix = (this.$win.width() < (left + width)) ? (width - btnWidth) : 0;\n\n        this.css({ position: position, top: (pos.top + btnHeight + topOffset) + 'px', left: (left - leftFix) + 'px' });\n    },\n\n    // private\n    _build: function()\n    {\n        this.parse('<div>');\n        this.attr('dir', this.opts.direction);\n        this.attr('id', 'redactor-dropdown-' + this.uuid + '-' + this.name);\n        this.attr('data-re-name', this.name);\n\n        this.addClass('redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-' + this.name);\n        this.dataset('data-dropdown-instance', this);\n        var isDom = (this.items.dom || typeof this.items === 'string');\n\n        if (isDom) this._buildDom();\n        else this._buildItems();\n\n        this.$body.append(this);\n        this.started = true;\n    },\n    _buildDom: function()\n    {\n        this.html('').append($R.dom(this.items));\n    },\n    _buildItems: function()\n    {\n        this.items = (this.name === 'format') ? this._buildFormattingItems() : this.items;\n\n        for (var key in this.items)\n        {\n            var obj = this.items[key];\n\n            if (key === 'observe')\n            {\n                this.attr('data-observe', this.items[key]);\n            }\n            else\n            {\n                var $item = $R.create('toolbar.dropdown.item', this.app, key, obj, this);\n\n                this.$items[key] = $item;\n                this.append($item);\n            }\n        }\n    },\n    _buildFormattingItems: function()\n    {\n        // build the format set\n        for (var key in this.items)\n        {\n            if (this.opts.formatting.indexOf(key) === -1) delete this.items[key];\n        }\n\n        // remove from the format set\n        if (this.opts.formattingHide)\n        {\n            for (var key in this.items)\n            {\n                if (this.opts.formattingHide.indexOf(key) !== -1) delete this.items[key];\n            }\n        }\n\n        // add to the format set\n        if (this.opts.formattingAdd)\n        {\n            for (var key in this.opts.formattingAdd)\n            {\n                this.items[key] = this.opts.formattingAdd[key];\n            }\n        }\n\n        return this.items;\n    },\n    _handleKeyboard: function(e)\n    {\n        if (e.which === 27) this.close();\n    },\n    _isButton: function(e)\n    {\n        var $el = $R.dom(e.target);\n        var $btn = $el.closest('.re-button');\n\n        return ($btn.get() === this.$btn.get());\n    },\n    _close: function()\n    {\n        this.$btn.setInactive();\n        this.$doc.off('.redactor.dropdown-' + this.uuid);\n        this.removeClass('open');\n        this.addClass('redactor-animate-hide');\n        this.app.broadcast('dropdown.closed', this, this.$btn);\n    },\n    _closeAll: function()\n    {\n        this.$body.find('.redactor-dropdown-' + this.uuid + '.open').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var instance =  $node.dataget('data-dropdown-instance');\n            instance._close();\n        });\n    },\n    _observe: function()\n    {\n        var observer = this.attr('data-observe');\n        if (observer)\n        {\n            this.app.broadcast('dropdown.' + observer + '.observe', this);\n        }\n    }\n});\n$R.add('class', 'toolbar.dropdown.item', {\n    mixins: ['dom'],\n    init: function(app, name, obj, dropdown)\n    {\n        this.app = app;\n        this.lang = app.lang;\n\n        // local\n        this.dropdown = dropdown;\n        this.name = name;\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    setTitle: function(html)\n    {\n        this.$span.html(html);\n    },\n    getTitle: function()\n    {\n        return this.$span.html();\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-dropdown-item-disabled');\n    },\n    disable: function()\n    {\n        this.addClass('redactor-dropdown-item-disabled');\n    },\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.hasClass('redactor-dropdown-item-disabled')) return;\n\n        if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n    },\n\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n        this.attr('href', '#');\n        this.addClass('redactor-dropdown-item-' + this.name);\n\n        if (this.obj.classname)\n        {\n            this.addClass(this.obj.classname);\n        }\n\n        this.attr('data-re-name', this.name);\n        this.on('click', this.toggle.bind(this));\n\n        this.$span = $R.dom('<span>');\n        this.append(this.$span);\n        this.setTitle(this.lang.parse(this.obj.title));\n    }\n});\n$R.add('service', 'cleaner', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.storedComponents = [];\n        this.storedImages = [];\n        this.storedLinks = [];\n        this.deniedTags = ['font', 'html', 'head', 'link', 'title', 'body', 'meta', 'applet'];\n        this.convertRules = {};\n        this.unconvertRules = {};\n\n        // regex\n        this.reComments = /<!--[\\s\\S]*?-->/g;\n        this.reSpacedEmpty = /^(||\\s||<br\\s?\\/?>||&nbsp;)$/i;\n        this.reScriptTag = /<script(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi;\n    },\n    // public\n    addConvertRules: function(name, func)\n    {\n        this.convertRules[name] = func;\n    },\n    addUnconvertRules: function(name, func)\n    {\n        this.unconvertRules[name] = func;\n    },\n    input: function(html, paragraphize, started)\n    {\n        // pre/code\n        html = this.encodePreCode(html);\n\n        // converting entity\n        html = html.replace(/\\$/g, '&#36;');\n        html = html.replace(/&amp;/g, '&');\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.convert(html, this.convertRules);\n\n        // store components\n        html = this.storeComponents(html);\n\n        // clean\n        html = this.replaceTags(html, this.opts.replaceTags);\n        html = this._setSpanAttr(html);\n        html = this._setStyleCache(html);\n        html = this.removeTags(html, this.deniedTags);\n        html = (this.opts.removeScript) ? this._removeScriptTag(html) : this._replaceScriptTag(html);\n        html = (this.opts.removeComments) ? this.removeComments(html) : html;\n        html = (this._isSpacedEmpty(html)) ? this.opts.emptyHtml : html;\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        // clear wrapped components\n        html = this._cleanWrapped(html);\n\n        // paragraphize\n        html = (paragraphize) ? this.paragraphize(html) : html;\n\n        return html;\n    },\n    output: function(html, removeMarkers)\n    {\n        html = this.removeInvisibleSpaces(html);\n\n        // empty\n        if (this._isSpacedEmpty(html)) return '';\n        if (this._isParagraphEmpty(html)) return '';\n\n        html = this.removeServiceTagsAndAttrs(html, removeMarkers);\n\n        // store components\n        html = this.storeComponents(html);\n\n        html = this.removeSpanWithoutAttributes(html);\n        html = this.removeFirstBlockBreaklineInHtml(html);\n\n        html = (this.opts.removeScript) ? html : this._unreplaceScriptTag(html);\n        html = (this.opts.preClass) ? this._setPreClass(html) : html;\n        html = (this.opts.linkNofollow) ? this._setLinkNofollow(html) : html;\n        html = (this.opts.removeNewLines) ? this.cleanNewLines(html) : html;\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.unconvert(html, this.unconvertRules);\n\n        // final clean up\n        html = this.removeEmptyAttributes(html, ['style', 'class', 'rel', 'alt', 'title']);\n        html = this.cleanSpacesInPre(html);\n        html = this.tidy(html);\n\n        // converting entity\n        html = html.replace(/&amp;/g, '&');\n\n        return html;\n    },\n    paste: function(html)\n    {\n        // store components\n        html = this.storeComponents(html);\n\n        // remove tags\n        var deniedTags = this.deniedTags.concat(['iframe']);\n        html = this.removeTags(html, deniedTags);\n\n        // remove doctype tag\n        html = html.replace(new RegExp(\"<\\!doctype([\\\\s\\\\S]+?)>\", 'gi'), '');\n\n        // remove style tag\n        html = html.replace(new RegExp(\"<style([\\\\s\\\\S]+?)</style>\", 'gi'), '');\n\n        // remove br between\n        html = html.replace(new RegExp(\"</p><br /><p\", 'gi'), '</p><p');\n\n        // gdocs & word\n        var isMsWord = this._isHtmlMsWord(html);\n\n        html = this._cleanGDocs(html);\n        html = (isMsWord) ? this._cleanMsWord(html) : html;\n\n        // do not clean\n        if (!this.opts.pasteClean)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return html;\n        }\n\n        // plain text\n        if (this.opts.pastePlainText)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return this.pastePlainText(html);\n        }\n\n        // remove tags\n        var exceptedTags = this.opts.pasteBlockTags.concat(this.opts.pasteInlineTags);\n        html = this.removeTagsExcept(html, exceptedTags);\n\n\n        // links & images\n        html = (this.opts.pasteLinks) ? html : this.removeTags(html, ['a']);\n        html = (this.opts.pasteImages) ? html : this.removeTags(html, ['img']);\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // clean attrs\n        var $elms = $wrapper.find('*');\n\n        // remove style\n        var filterStyle = (this.opts.pasteKeepStyle.length !== 0) ? ',' + this.opts.pasteKeepStyle.join(',') : '';\n        $elms.not('[data-redactor-style-cache]' + filterStyle).removeAttr('style');\n\n        // remove class\n        var filterClass = (this.opts.pasteKeepClass.length !== 0) ? ',' + this.opts.pasteKeepClass.join(',') : '';\n        $elms.not('[data-redactor-style-cache]' + filterClass).removeAttr('class');\n\n        // remove attrs\n        var filterAttrs = (this.opts.pasteKeepAttrs.length !== 0) ? ',' + this.opts.pasteKeepAttrs.join(',') : '';\n        $elms.not('img, a, [data-redactor-style-cache]' + filterAttrs).each(function(node)\n        {\n            while(node.attributes.length > 0)\n            {\n                node.removeAttribute(node.attributes[0].name);\n            }\n        });\n\n        // paste link target\n        if (this.opts.pasteLinks && this.opts.pasteLinkTarget !== false)\n        {\n            $wrapper.find('a').attr('target', this.opts.pasteLinkTarget);\n        }\n\n        // keep style\n        $wrapper.find('[data-redactor-style-cache]').each(function(node)\n        {\n            var style = node.getAttribute('data-redactor-style-cache');\n            node.setAttribute('style', style);\n        });\n\n        // remove empty span\n        $wrapper.find('span').each(function(node)\n        {\n            if (node.attributes.length === 0)\n            {\n                $R.dom(node).unwrap();\n            }\n        });\n\n        // remove empty inline\n        $wrapper.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.attributes.length === 0 && this.utils.isEmptyHtml(node.innerHTML))\n            {\n                $R.dom(node).unwrap();\n            }\n\n        }.bind(this));\n\n        // place ul/ol into li\n        $wrapper.find('ul, ol').each(function(node)\n        {\n            var prev = node.previousSibling;\n            if (prev && prev.tagName === 'LI')\n            {\n                var $li = $R.dom(prev);\n                $li.find('p').unwrap();\n                $li.append(node);\n            }\n        });\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // remove paragraphs form lists (google docs bug)\n        html = html.replace(/<li><p>/gi, '<li>');\n        html = html.replace(/<\\/p><\\/li>/gi, '</li>');\n\n        // clean empty p\n        html = html.replace(/<p>&nbsp;<\\/p>/gi, '<p></p>');\n        html = html.replace(/<p><br\\s?\\/?><\\/p>/gi, '<p></p>');\n\n        if (isMsWord)\n        {\n            html = html.replace(/<p><\\/p>/gi, '');\n            html = html.replace(/<p>\\s<\\/p>/gi, '');\n        }\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        return html;\n    },\n    pastePlainText: function(html)\n    {\n        html = (this.opts.pasteLinks) ? this.storeLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.storeImages(html) : html;\n\n        html = this.getPlainText(html);\n        html = this._replaceNlToBr(html);\n\n        html = (this.opts.pasteLinks) ? this.restoreLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.restoreImages(html) : html;\n\n        return html;\n    },\n    tidy: function(html)\n    {\n        return html;\n    },\n    paragraphize: function(html)\n    {\n        var paragraphize = $R.create('cleaner.paragraphize', this.app);\n\n        return paragraphize.convert(html);\n    },\n\n    // get\n    getFlatText: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (!html.nodeType && !html.dom)\n        {\n            html = html.toString();\n            html = html.trim();\n            $div.html(html);\n        }\n        else\n        {\n            $div.append(html);\n        }\n\n        html = $div.get().textContent || $div.get().innerText || '';\n\n        return (html === undefined) ? '' : html;\n    },\n\tgetPlainText: function(html)\n\t{\n\t\thtml = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\thtml = html.replace(/<style[\\s\\S]*?style>/gi, '');\n        html = html.replace(/<p><\\/p>/g, '');\n\t\thtml = html.replace(/<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\thtml = html.replace(/<\\/p>/gi, '\\n\\n');\n\t\thtml = html.replace(/<\\/H[1-6]>/gi, '\\n\\n');\n\n\t\tvar tmp = document.createElement('div');\n\t\ttmp.innerHTML = html;\n\n\t\thtml = tmp.textContent || tmp.innerText;\n\n\t\treturn html.trim();\n\t},\n\n    // replace\n    replaceTags: function(html, tags)\n    {\n        if (tags)\n        {\n            var self = this;\n            var keys = Object.keys(tags);\n            var $wrapper = this.utils.buildWrapper(html);\n            $wrapper.find(keys.join(',')).each(function(node)\n            {\n                self.utils.replaceToTag(node, tags[node.tagName.toLowerCase()]);\n            });\n\n            html = this.utils.getWrapperHtml($wrapper);\n        }\n\n        return html;\n    },\n    replaceNbspToSpaces: function(html)\n    {\n        return html.replace('&nbsp;', ' ');\n    },\n    replaceBlocksToBr: function(html)\n    {\n        html = html.replace(/<\\/div>|<\\/li>|<\\/td>|<\\/p>|<\\/H[1-6]>/gi, '<br>');\n\n        return html;\n    },\n\n    // clean\n    cleanNewLines: function(html)\n    {\n        return html.replace(/\\r?\\n/g, \"\");\n    },\n    cleanSpacesInPre: function(html)\n    {\n        return html.replace('&nbsp;&nbsp;&nbsp;&nbsp;', '    ');\n    },\n\n    // remove\n    removeInvisibleSpaces: function(html)\n    {\n        html = this.utils.removeInvisibleChars(html);\n        html = html.replace(/&#x200b;/gi, '');\n        html = html.replace(/&#65279;/gi, '');\n\n        return html;\n    },\n    removeNl: function(html)\n    {\n        html = html.replace(/\\n/g, \" \");\n        html = html.replace(/\\s+/g, \"\\s\");\n\n        return html;\n    },\n    removeBrAtEnd: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>$/gi, ' ');\n        html = html.replace(/<br\\s?\\/?><li/gi, '<li');\n\n        return html;\n    },\n    removeTags: function(input, denied)\n    {\n        var re = (denied) ? /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi : /(<([^>]+)>)/gi;\n        var replacer = (!denied) ? '' : function ($0, $1)\n        {\n            return denied.indexOf($1.toLowerCase()) === -1 ? $0 : '';\n        };\n\n        return input.replace(re, replacer);\n    },\n    removeTagsExcept: function(input, except)\n    {\n        if (except === undefined) return input.replace(/(<([^>]+)>)/gi, '');\n\n        var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n        return input.replace(tags, function($0, $1)\n        {\n            return except.indexOf($1.toLowerCase()) === -1 ? '' : $0;\n        });\n    },\n    removeComments: function(html)\n    {\n        return html.replace(this.reComments, '');\n    },\n    removeServiceTagsAndAttrs: function(html, removeMarkers)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        var self = this;\n        if (removeMarkers !== false)\n        {\n            $wrapper.find('.redactor-selection-marker').each(function(node)\n            {\n                var $el = $R.dom(node);\n                var text = self.utils.removeInvisibleChars($el.text());\n\n                return (text === '') ? $el.remove() : $el.unwrap();\n            });\n        }\n\n        $wrapper.find('[data-redactor-style-cache]').removeAttr('data-redactor-style-cache');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeSpanWithoutAttributes: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').removeAttr('data-redactor-span data-redactor-style-cache').each(function(node)\n        {\n            if (node.attributes.length === 0) $R.dom(node).unwrap();\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeFirstBlockBreaklineInHtml: function(html)\n    {\n        return html.replace(new RegExp('</li><br\\\\s?/?>', 'gi'), '</li>');\n    },\n    removeEmptyAttributes: function(html, attrs)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        for (var i = 0; i < attrs.length; i++)\n        {\n            $wrapper.find('[' + attrs[i] + '=\"\"]').removeAttr(attrs[i]);\n        }\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // encode / decode\n    encodeHtml: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>/g, \"\\n\");\n        html = html.replace(/&nbsp;/g, ' ');\n        html = html.replace(/”/g, '\"');\n        html = html.replace(/“/g, '\"');\n        html = html.replace(/‘/g, '\\'');\n        html = html.replace(/’/g, '\\'');\n        html = this.encodeEntities(html);\n        html = html.replace(/\\$/g, '&#36;');\n\n        if (this.opts.preSpaces)\n        {\n            html = html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n        }\n\n        return html;\n    },\n    encodePreCode: function(html)\n    {\n        var matched = html.match(new RegExp('<code(.*?)>(.*?)<pre(.*?)>(.*?)</pre>(.*?)</code>', 'gi'));\n        if (matched !== null)\n        {\n            for (var i = 0; i < matched.length; i++)\n            {\n                var arr = matched[i].match(new RegExp('<pre(.*?)>([\\\\w\\\\W]*?)</pre>', 'i'));\n                html = html.replace(arr[0], this.encodeEntities(arr[0]));\n            }\n        }\n\n        var $wrapper = this.utils.buildWrapper(html);\n\n        $wrapper.find('code code').replaceWith(this._encodeOuter.bind(this));\n        $wrapper.find('code pre').replaceWith(this._encodeOuter.bind(this));\n        $wrapper.find('pre pre').replaceWith(this._encodeOuter.bind(this));\n        $wrapper.find('code, pre').each(this._encodePreCodeLine.bind(this));\n\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // restore markers\n        html = this._decodeMarkers(html);\n\n        return html;\n    },\n    encodeEntities: function(str)\n    {\n        str = this.decodeEntities(str);\n        str = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n        return str;\n    },\n    encodePhpCode: function(html)\n    {\n        html = html.replace('<?php', '&lt;?php');\n        html = html.replace('<?', '&lt;?');\n        html = html.replace('?>', '?&gt;');\n\n        return html;\n    },\n    decodeEntities: function(str)\n    {\n        return String(str).replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&amp;/g, '&');\n    },\n\n    // store / restore\n    storeComponents: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'figure', 'table');\n\n        return this._storeMatched(html, matched, 'Components', 'figure');\n    },\n    restoreComponents: function(html)\n    {\n        return this._restoreMatched(html, 'Components', 'figure');\n    },\n    storeLinks: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'a');\n\n        return this._storeMatched(html, matched, 'Links', 'a');\n    },\n    storeImages: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'img');\n\n        return this._storeMatched(html, matched, 'Images', 'img');\n    },\n    restoreLinks: function(html)\n    {\n        return this._restoreMatched(html, 'Links', 'a');\n    },\n    restoreImages: function(html)\n    {\n        return this._restoreMatched(html, 'Images', 'img');\n    },\n\n    // PRIVATE\n\n    // clean\n    _cleanWrapped: function(html)\n    {\n        html = html.replace(new RegExp('<p><figure([\\\\w\\\\W]*?)</figure></p>', 'gi'), '<figure$1</figure>');\n\n        return html;\n    },\n    _cleanGDocs: function(html)\n    {\n        // remove google docs markers\n        html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n        html = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n\n        html = html.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*font-style: italic[^>]*>([\\w\\W]*?)<\\/span>/gi, '<i>$1</i>');\n        html = html.replace(/<span[^>]*font-weight: bold[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n        html = html.replace(/<span[^>]*font-weight: 700[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n\n        return html;\n    },\n    _cleanMsWord: function(html)\n    {\n        html = html.replace(/<!--[\\s\\S]+?-->/gi, '');\n        html = html.replace(/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|img|meta|link|style|\\w:\\w+)(?=[\\s\\/>]))[^>]*>/gi, '');\n        html = html.replace(/<(\\/?)s>/gi, \"<$1strike>\");\n        html = html.replace(/&nbsp;/gi, ' ');\n        html = html.replace(/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi, function(str, spaces) {\n            return (spaces.length > 0) ? spaces.replace(/./, \" \").slice(Math.floor(spaces.length/2)).split(\"\").join(\"\\u00a0\") : '';\n        });\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        $wrapper.find('p').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var str = $node.attr('style');\n            var matches = /mso-list:\\w+ \\w+([0-9]+)/.exec(str);\n            if (matches)\n            {\n                $node.data('_listLevel',  parseInt(matches[1], 10));\n            }\n        });\n\n        // parse Lists\n        this._parseWordLists($wrapper);\n\n        $wrapper.find('[style]').removeAttr('style');\n        $wrapper.find('[align]').removeAttr('align');\n        $wrapper.find('[name]').removeAttr('name');\n        $wrapper.find('span').unwrap();\n        $wrapper.find(\"[class^='Mso']\").removeAttr('class');\n        $wrapper.find('a').filter(function(node) { return !node.hasAttribute('href'); }).unwrap();\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<p[^>]*><\\/p>/gi, '');\n        html = html.trim();\n\n        // remove spaces between\n        html = html.replace(/\\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi, '/$1>\\n<$2');\n\n        var result = '';\n        var lines = html.split(/\\n/);\n        for (var i = 0; i < lines.length; i++)\n        {\n            var space = (lines[i] !== '' && lines[i].search(/>$/) === -1) ? ' ' : '\\n';\n\n            result += lines[i] + space;\n        }\n\n        return result;\n    },\n    _parseWordLists: function($wrapper)\n    {\n        var lastLevel = 0;\n        var pnt = null;\n\n        $wrapper.find('p').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var currentLevel = $node.data('_listLevel');\n            if (currentLevel !== null)\n            {\n                var txt = $node.text();\n                var listTag = '<ul></ul>';\n                if (/^\\s*\\w+\\./.test(txt))\n                {\n                    var matches = /([0-9])\\./.exec(txt);\n                    if (matches)\n                    {\n                        var start = parseInt(matches[1], 10);\n                        listTag = (start > 1) ? '<ol start=\"' + start + '\"></ol>' : '<ol></ol>';\n                    }\n                    else\n                    {\n                        listTag = '<ol></ol>';\n                    }\n                }\n\n                if (currentLevel > lastLevel)\n                {\n                    if (lastLevel === 0)\n                    {\n                        $node.before(listTag);\n                        pnt = $node.prev();\n                    }\n                    else\n                    {\n                        var $list = $R.dom(listTag);\n                        pnt.append($list);\n                    }\n                }\n\n                if (currentLevel < lastLevel)\n                {\n                    for (var i = 0; i < (lastLevel - currentLevel); i++)\n                    {\n                        pnt = pnt.parent();\n                    }\n                }\n\n                $node.find('span').first().unwrap();\n                pnt.append('<li>' + $node.html() + '</li>');\n                $node.remove();\n                lastLevel = currentLevel;\n            }\n            else\n            {\n                lastLevel = 0;\n            }\n        });\n    },\n\n    // is\n    _isSpacedEmpty: function(html)\n    {\n        return (html.search(this.reSpacedEmpty) !== -1);\n    },\n    _isParagraphEmpty: function(html)\n    {\n        return (html.search(/^<p><\\/p>$/i) !== -1);\n    },\n    _isHtmlMsWord: function(html)\n    {\n        return html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n    },\n\n    // set\n    _setSpanAttr: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').attr('data-redactor-span', true);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setStyleCache: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('[style]').each(function(node)\n        {\n            var $el = $R.dom(node);\n            $el.attr('data-redactor-style-cache', $el.attr('style'));\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setPreClass: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('pre').addClass(this.opts.preClass);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setLinkNofollow: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a').attr('rel', 'nofollow');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // replace\n    _replaceScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '<pre class=\"redactor-script-tag\" $1>$2</pre>');\n    },\n    _unreplaceScriptTag: function(html)\n    {\n        return html.replace(/<pre class=\"redactor-script-tag\"(.*?[^>]?)>([\\w\\W]*?)<\\/pre>/gi, '<script$1>$2</script>');\n    },\n\t_replaceNlToBr: function(html)\n\t{\n\t\treturn html.replace(/\\n/g, '<br />');\n\t},\n\n    // remove\n    _removeScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '');\n    },\n\n    // private\n    _storeMatched: function(html, matched, stored, name)\n    {\n        this['stored' + stored] = [];\n        if (matched)\n        {\n            for (var i = 0; i < matched.length; i++)\n            {\n                this['stored' + stored][i] = matched[i];\n                html = html.replace(matched[i], '####' + name + i + '####');\n            }\n        }\n\n        return html;\n    },\n    _restoreMatched: function(html, stored, name)\n    {\n        if (this['stored' + stored])\n        {\n            for (var i = 0; i < this['stored' + stored].length; i++)\n            {\n                html = html.replace('####' + name + i + '####', this['stored' + stored][i]);\n            }\n        }\n\n        return html;\n    },\n    _decodeMarkers: function(html)\n    {\n        var decodedMarkers = '<span id=\"selection-marker-$1\" class=\"redactor-selection-marker\">​</span>';\n        return html.replace(/&lt;span\\sid=\"selection-marker-(start|end)\"\\sclass=\"redactor-selection-marker\"&gt;(.*?[^>]?)&lt;\\/span&gt;/g, decodedMarkers);\n    },\n    _encodeOuter: function(node)\n    {\n        return this.encodeEntities(node.outerHTML);\n    },\n    _encodePreCodeLine: function(node)\n    {\n        var first = node.firstChild;\n        if (node.tagName == 'PRE' && (first && first.tagName === 'CODE')) return;\n\n        var encoded = this.decodeEntities(node.innerHTML);\n        encoded = encoded.replace(/&nbsp;/g, ' ').replace(/<br\\s?\\/?>/g, '\\n');\n        encoded = (this.opts.preSpaces) ? encoded.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' ')) : encoded;\n\n        node.textContent = encoded;\n    }\n});\n$R.add('class', 'cleaner.figure', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n    },\n    // public\n    convert: function(html, rules)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // convert\n        $wrapper.find('img').each(this._convertImage.bind(this));\n        $wrapper.find('hr').each(this._convertLine.bind(this));\n        $wrapper.find('iframe').each(this._convertIframe.bind(this));\n        $wrapper.find('table').each(this._convertTable.bind(this));\n        $wrapper.find('form').each(this._convertForm.bind(this));\n        $wrapper.find('figure pre').each(this._convertCode.bind(this));\n\n        // variables\n        $wrapper.find('[data-redactor-type=variable]').addClass('redactor-component');\n\n        // widgets\n        $wrapper.find('figure').not('.redactor-component, .redactor-figure-code').each(this._convertWidget.bind(this));\n\n        // contenteditable\n        $wrapper.find('figure pre').each(this._setContenteditableCode.bind(this));\n        $wrapper.find('.redactor-component, .non-editable').attr('contenteditable', false);\n\n        $wrapper.find('figcaption, td, th').attr('contenteditable', true);\n        $wrapper.find('.redactor-component, figcaption').attr('tabindex', '-1');\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    unconvert: function(html, rules)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // contenteditable\n        $wrapper.find('th, td, figcaption, figure, pre, code, .redactor-component').removeAttr('contenteditable tabindex');\n\n        // remove class\n        $wrapper.find('figure').removeClass('redactor-component redactor-component-active redactor-uploaded-figure');\n\n        // unconvert\n        $wrapper.find('[data-redactor-type=variable]').removeClass('redactor-component');\n        $wrapper.find('figure[data-redactor-type=line]').unwrap();\n        $wrapper.find('figure[data-redactor-type=widget]').each(this._unconvertWidget.bind(this));\n        $wrapper.find('figure[data-redactor-type=form]').each(this._unconvertForm.bind(this));\n        $wrapper.find('figure[data-redactor-type=table]').each(this._unconvertTable.bind(this));\n        $wrapper.find('figure[data-redactor-type=image]').removeAttr('rel').each(this._unconvertImages.bind(this));\n\n        $wrapper.find('img').removeAttr('data-redactor-type').removeClass('redactor-component');\n        $wrapper.find('.non-editable').removeAttr('contenteditable');\n\n        // remove types\n        $wrapper.find('figure').each(this._removeTypes.bind(this));\n\n        // remove caret\n        $wrapper.find('span.redactor-component-caret').remove();\n\n        if (this.opts.breakline)\n        {\n            $wrapper.find('[data-redactor-tag=\"br\"]').each(function(node)\n            {\n                if (node.lastChild && node.lastChild.tagName !== 'BR')\n                {\n                    node.appendChild(document.createElement('br'));\n                }\n            }).unwrap();\n        }\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<br\\s?\\/?>$/, '');\n\n        return html;\n    },\n\n    // private\n    _convertImage: function(node)\n    {\n        var $node = $R.dom(node);\n        if (this._isNonEditable($node)) return;\n\n        // set id\n        if (!$node.attr('data-image'))\n        {\n            $node.attr('data-image', this.utils.getRandomId());\n        }\n\n        var $link = $node.closest('a');\n        var $figure = $node.closest('figure');\n        var isImage = ($figure.children().not('a, img, br, figcaption').length === 0);\n        if (!isImage) return;\n\n        if ($figure.length === 0)\n        {\n            $figure = ($link.length !== 0) ? $link.wrap('<figure>') : $node.wrap('<figure>');\n        }\n        else\n        {\n            if ($figure.hasClass('redactor-uploaded-figure'))\n            {\n                $figure.removeClass('redactor-uploaded-figure');\n            }\n            else\n            {\n                $figure.addClass('redactor-keep-figure');\n            }\n        }\n\n        this._setFigure($figure, 'image');\n    },\n    _convertTable: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'table');\n    },\n    _convertLine: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'line');\n    },\n    _convertForm: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this.utils.replaceToTag(node, 'figure');\n        this._setFigure($figure, 'form');\n    },\n    _convertIframe: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var src = node.getAttribute('src');\n        var isVideo = (src && (src.match(this.opts.regex.youtube) || src.match(this.opts.regex.vimeo)));\n        var $figure = this._wrapFigure(node);\n\n        if (isVideo)\n        {\n            this._setFigure($figure, 'video');\n        }\n    },\n    _convertCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'code');\n    },\n    _convertWidget: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        $node.addClass('redactor-component');\n        $node.attr('data-redactor-type', 'widget');\n        $node.attr('data-widget-code', encodeURI(node.innerHTML.trim()));\n    },\n\n    // unconvert\n    _unconvertForm: function(node)\n    {\n        this.utils.replaceToTag(node, 'form');\n    },\n    _unconvertTable: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.unwrap();\n    },\n    _unconvertWidget: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.html(decodeURI($node.attr('data-widget-code')));\n        $node.removeAttr('data-widget-code');\n    },\n    _unconvertImages: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.removeClass('redactor-component');\n\n        var isList = ($node.closest('li').length !== 0);\n        var isTable = ($node.closest('table').length !== 0);\n        var hasFigcaption = ($node.find('figcaption').length !== 0);\n\n        var style = $node.attr('style');\n        var hasStyle = !(style === null || style === '');\n        var hasClass = ($node.attr('class') !== '');\n\n        if (isList || (isTable && !hasFigcaption && !hasStyle && !hasClass))\n        {\n            $node.unwrap();\n        }\n    },\n    _removeTypes: function(node)\n    {\n        var $node = $R.dom(node);\n        var type = $node.attr('data-redactor-type');\n        var removed = ['image', 'widget', 'line', 'video', 'code', 'form', 'table'];\n        if (type && removed.indexOf(type) !== -1)\n        {\n            $node.removeAttr('data-redactor-type');\n        }\n\n        // keep figure\n        if ($node.hasClass('redactor-keep-figure'))\n        {\n            $node.removeClass('redactor-keep-figure');\n        }\n        // unwrap figure\n        else if (this.opts.imageFigure === false)\n        {\n            var hasFigcaption = ($node.find('figcaption').length !== 0);\n            if (!hasFigcaption)\n            {\n                $node.unwrap();\n            }\n        }\n    },\n\n    // wrap\n    _wrapFigure: function(node)\n    {\n        var $node = $R.dom(node);\n        var $figure = $node.closest('figure');\n\n        return ($figure.length === 0) ? $node.wrap('<figure>') : $figure;\n    },\n\n    // set\n    _setFigure: function($figure, type)\n    {\n        $figure.addClass('redactor-component');\n        $figure.attr('data-redactor-type', type);\n    },\n    _setContenteditableCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        var $code = $node.children('code').first();\n\n        var $el = ($code.length !== 0) ? $code : $node;\n        $el.attr('contenteditable', true).attr('tabindex', '-1');\n    },\n\n    // utils\n    _acceptExtraRules: function($wrapper, rules)\n    {\n        for (var key in rules)\n        {\n            if (typeof rules[key] === 'function')\n            {\n                rules[key]($wrapper);\n            }\n        }\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    }\n});\n$R.add('class', 'cleaner.paragraphize', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.element = app.element;\n\n        // local\n        this.stored = [];\n        this.remStart = '#####replace';\n        this.remEnd = '#####';\n        this.paragraphizeTags = ['table', 'div', 'pre', 'form', 'ul', 'ol', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'dl', 'blockquote', 'figcaption',\n                'address', 'section', 'header', 'footer', 'aside', 'article', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n                'button', 'option', 'map', 'area', 'math', 'hr', 'fieldset', 'legend', 'hgroup', 'nav', 'figure', 'details', 'menu', 'summary', 'p'];\n    },\n    // public\n    convert: function(html)\n    {\n        var value = this._isConverted(html);\n\n        return (value === true) ? this._convert(html) : value;\n    },\n\n    // private\n    _convert: function(html)\n    {\n        // build markup tag\n        var markupTag = (this.opts.breakline) ? 'sdivtag' : this.opts.markup;\n\n        // store tags\n        html = this._storeTags(html);\n\n        // remove new lines\n        html = html.trim();\n\n        if (this.opts.breakline)\n        {\n            html = html.replace(new RegExp('\\\\n#####', 'gi'), 'xnonbreakmarkerz#####');\n            html = html.replace(new RegExp('#####\\\\n\\\\n', 'gi'), \"#####\\nxnonbreakmarkerz\");\n            html = html.replace(new RegExp('#####\\\\n', 'gi'), \"#####xnonbreakmarkerz\");\n            html = html.replace(/<br\\s?\\/?>\\n/gi, \"<br>\");\n            html = html.replace(/\\n/g, \"<br>\");\n            html = html.replace(/xnonbreakmarkerz/gi, \"\\n\");\n        }\n        else\n        {\n            html = html.replace(/[\\n]+/g, \"\\n\");\n        }\n\n        html = this._trimEmptyLines(html);\n\n        // paragraph and break markers\n        html = (this.opts.breakline) ? html : html.replace(/<br\\s?\\/?>\\n/gi, \"xbreakmarkerz\\n\");\n        html = html.replace(/(?:\\r\\n|\\r|\\n)/g, \"xparagraphmarkerz\");\n\n        // replace markers\n        html = html.replace(/xparagraphmarkerz/gi, \"</\" + markupTag + \">\\n<\" + markupTag + \">\");\n        html = (this.opts.breakline) ? html : html.replace(/xbreakmarkerz/gi, \"<br>\");\n\n        // wrap all\n        html = '<' + markupTag + '>' + html + '</' + markupTag + '>';\n\n        // clean\n        html = html.replace(new RegExp('<' + markupTag + '>#####', 'gi'), '#####');\n        html = html.replace(new RegExp('#####</' + markupTag + '>', 'gi'), '#####');\n\n        // restore tags\n        html = this._restoreTags(html);\n\n        // clean restored\n        html = (this.opts.breakline) ? html : html.replace(new RegExp('<' + markupTag + '><br\\\\s?/?></' + markupTag + '>', 'gi'), '<' + markupTag + '></' + markupTag + '>');\n        html = html.replace(new RegExp('<sdivtag>', 'gi'), '<div data-redactor-tag=\"br\">');\n        html = html.replace(new RegExp('sdivtag', 'gi'), 'div');\n\n        return html;\n    },\n    _storeTags: function(html)\n    {\n        var self = this;\n        var $wrapper = this.utils.buildWrapper(html);\n\n        if (this.opts.breakline)\n        {\n            $wrapper.find('p').each(function(node)\n            {\n                var $node = $R.dom(node);\n                var isUnwrap = ($node.closest('figure[data-redactor-type=widget],figure[data-redactor-type=form],.non-editable').length === 0);\n\n                if (isUnwrap)\n                {\n                    $node.append('<br><br>');\n                    $node.unwrap();\n                }\n            });\n        }\n\n        $wrapper.find(this.paragraphizeTags.join(', ')).each(function(node, i)\n        {\n            var replacement = document.createTextNode(\"\\n\" + self.remStart + i + self.remEnd + \"\\n\");\n            self.stored.push(node.outerHTML);\n            node.parentNode.replaceChild(replacement, node);\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _restoreTags: function(html)\n    {\n        for (var i = 0; i < this.stored.length; i++)\n        {\n            this.stored[i] = this.stored[i].replace(/\\$/g, '&#36;');\n            html = html.replace(this.remStart + i + this.remEnd, this.stored[i]);\n        }\n\n        return html;\n    },\n    _trimEmptyLines: function(html)\n    {\n        var str = '';\n        var arr = html.split(\"\\n\");\n        for (var i = 0; i < arr.length; i++)\n        {\n            if (arr[i].trim() !== '')\n            {\n                str += arr[i] + \"\\n\";\n            }\n        }\n\n        return str.replace(/\\n$/, '');\n    },\n    _isConverted: function(html)\n    {\n        if (this._isDisabled(html)) return html;\n        else if (this._isEmptyHtml(html)) return this.opts.emptyHtml;\n        else return true;\n    },\n    _isDisabled: function()\n    {\n        return (this.opts.paragraphize === false || this.element.isType('inline'));\n    },\n    _isEmptyHtml: function(html)\n    {\n        return (html === '' || html === '<p></p>' || html === '<div></div>');\n    }\n});\n$R.add('service', 'detector', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.userAgent = navigator.userAgent.toLowerCase();\n    },\n\tisWebkit: function()\n\t{\n\t\treturn /webkit/.test(this.userAgent);\n\t},\n\tisFirefox: function()\n\t{\n\t\treturn (this.userAgent.indexOf('firefox') > -1);\n\t},\n\tisIe: function(v)\n\t{\n        if (document.documentMode || /Edge/.test(navigator.userAgent)) return 'edge';\n\n\t\tvar ie;\n\t\tie = RegExp('msie' + (!isNaN(v)?('\\\\s'+v):''), 'i').test(navigator.userAgent);\n\t\tif (!ie) ie = !!navigator.userAgent.match(/Trident.*rv[ :]*11\\./);\n\n\t\treturn ie;\n\t},\n\tisMobile: function()\n\t{\n\t\treturn /(iPhone|iPod|Android)/.test(navigator.userAgent);\n\t},\n\tisDesktop: function()\n\t{\n\t\treturn !/(iPhone|iPod|iPad|Android)/.test(navigator.userAgent);\n\t},\n\tisIpad: function()\n\t{\n\t\treturn /iPad/.test(navigator.userAgent);\n\t}\n});\n$R.add('service', 'offset', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    get: function(el, trimmed)\n    {\n        var offset = { start: 0, end: 0 };\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var isIn = (isEditor) ? true : this.selection.isIn(node);\n        var range = this.selection.getRange();\n\n        if (!isEditor && !isIn)\n        {\n            offset = false;\n        }\n        else if (this.selection.is() && isIn)\n        {\n            var $startNode = $R.dom(range.startContainer);\n            var fix = ($startNode.hasClass('redactor-component')) ? range.startOffset : 0;\n            var clonedRange = range.cloneRange();\n\n            clonedRange.selectNodeContents(node);\n            clonedRange.setEnd(range.startContainer, range.startOffset);\n\n            offset.start = this._getString(clonedRange, trimmed).length - fix;\n            offset.end = offset.start + this._getString(range, trimmed).length + fix;\n        }\n\n        return offset;\n    },\n    set: function(offset, el)\n    {\n        if (this._setComponentOffset(el)) return;\n\n        this.component.clearActive();\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var size = this.size(node);\n        var charIndex = 0, range = document.createRange();\n\n        offset.end = (offset.end > size) ? size : offset.end;\n\n        range.setStart(node, 0);\n        range.collapse(true);\n\n        var nodeStack = [node], foundStart = false, stop = false;\n        while (!stop && (node = nodeStack.pop()))\n        {\n            if (node.nodeType == 3)\n            {\n                var nextCharIndex = charIndex + node.length;\n\n                if (!foundStart && !this._isFigcaptionNext(node)\n                    && offset.start >= charIndex && offset.start <= nextCharIndex)\n                {\n                    range.setStart(node, offset.start - charIndex);\n                    foundStart = true;\n                }\n\n                if (foundStart && offset.end >= charIndex && offset.end <= nextCharIndex)\n                {\n                    range.setEnd(node, offset.end - charIndex);\n                    stop = true;\n                }\n\n                charIndex = nextCharIndex;\n            }\n            else\n            {\n                var i = node.childNodes.length;\n                while (i--)\n                {\n                    nodeStack.push(node.childNodes[i]);\n                }\n            }\n        }\n\n        this.selection.setRange(range);\n    },\n    size: function(el, trimmed)\n    {\n        var node = this.utils.getNode(el);\n        if (node)\n        {\n            var range = document.createRange();\n\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(node);\n\n            return this._getString(clonedRange, trimmed).length;\n        }\n\n        return 0;\n    },\n\n    // private\n    _getString: function(obj, trimmed)\n    {\n        var str = obj.toString();\n        str = (this.editor.isEmpty()) ? str.replace(/\\uFEFF/g, '') : str;\n        str = (trimmed) ? str.trim() : str;\n\n        return str;\n    },\n    _setComponentOffset: function(el)\n    {\n        return (this.component.isNonEditable(el)) ? this.component.setActive(el) : false;\n    },\n    _isFigcaptionNext: function(node)\n    {\n        var next = node.nextSibling;\n        return (node.nodeValue.trim() === '' && next && next.tagName === 'FIGCAPTION');\n    }\n});\n$R.add('service', 'inspector', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // parse\n    parse: function(el)\n    {\n        return $R.create('inspector.parser', this.app, this, el);\n    },\n\n    // text detection\n    isText: function(el)\n    {\n        if (typeof el === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(el))\n        {\n            return true;\n        }\n\n        var node = $R.dom(el).get();\n        return (node && node.nodeType === 3); //  && !this.selection.getBlock(el)\n    },\n\n    // tag detection\n    isInlineTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.inlineTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isBlockTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.blockTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isTableCellTag: function(tag)\n    {\n        return (['td', 'th'].indexOf(tag.toLowerCase()) !== -1);\n    },\n    isHeadingTag: function(tag)\n    {\n        return (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(tag.toLowerCase()) !== -1);\n    },\n\n\n    _isTag: function(tag)\n    {\n        return (tag !== undefined && tag);\n    },\n    _extendTags: function(tags, extend)\n    {\n        tags = tags.concat(tags);\n\n        if (extend)\n        {\n            for (var i = 0 ; i < extend.length; i++)\n            {\n                tags.push(extend[i]);\n            }\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'inspector.parser', {\n    init: function(app, inspector, el)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.selection = app.selection;\n        this.inspector = inspector;\n\n        // local\n        this.el = el;\n        this.$el = $R.dom(this.el);\n        this.node = this.$el.get();\n        this.$component = this.$el.closest('.redactor-component', '.redactor-in');\n    },\n    // is\n    isEditor: function()\n    {\n        return (this.node === this.editor.getElement().get());\n    },\n    isInEditor: function()\n    {\n        return (this.$el.parents('.redactor-in-' + this.uuid).length !== 0);\n    },\n    isComponent: function()\n    {\n        return (this.$component.length !== 0);\n    },\n    isComponentType: function(type)\n    {\n        return (this.getComponentType() === type);\n    },\n    isComponentActive: function()\n    {\n        return (this.isComponent() && this.$component.hasClass('redactor-component-active'));\n    },\n    isComponentEditable: function()\n    {\n        var types = ['code', 'table'];\n        var type = this.getComponentType();\n\n        return (this.isComponent() && types.indexOf(type) !== -1);\n    },\n    isFigcaption: function()\n    {\n        return this.getFigcaption();\n    },\n    isPre: function()\n    {\n        return this.getPre();\n    },\n    isCode: function()\n    {\n        var $code = this.$el.closest('code');\n        var $parent = $code.parent('pre');\n\n        return ($code.length !== 0 && $parent.length === 0);\n    },\n    isList: function()\n    {\n        return this.getList();\n    },\n    isFirstListItem: function()\n    {\n        return this._getLastOrFirstListItem('first');\n    },\n    isLastListItem: function()\n    {\n        return this._getLastOrFirstListItem('last');\n    },\n    isFirstTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('first');\n    },\n    isLastTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('last');\n    },\n    isTable: function()\n    {\n        return (this.isComponentType('table') || this.getTable());\n    },\n    isHeading: function()\n    {\n        return this.getHeading();\n    },\n    isBlockquote: function()\n    {\n        return this.getBlockquote();\n    },\n    isDl: function()\n    {\n        return this.getDl();\n    },\n    isParagraph: function()\n    {\n        return this.getParagraph();\n    },\n    isLink: function()\n    {\n        return this.getLink();\n    },\n    isFile: function()\n    {\n        return this.getFile();\n    },\n    isText: function()\n    {\n        return this.inspector.isText(this.el);\n    },\n    isInline: function()\n    {\n        var tags = this.opts.inlineTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isBlock: function()\n    {\n        var tags = this.opts.blockTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isElement: function()\n    {\n        return (this.node && this.node.nodeType && this.node.nodeType !== 3);\n    },\n\n    // has\n    hasParent: function(tags)\n    {\n        return (this.$el.closest(tags.join(',')).length !== 0);\n    },\n\n    // get\n    getNode: function()\n    {\n        return this.node;\n    },\n    getTag: function()\n    {\n        return (this.isElement()) ? this.node.tagName.toLowerCase() : false;\n    },\n    getComponent: function()\n    {\n        return (this.isComponent()) ? this.$component.get() : false;\n    },\n    getComponentType: function()\n    {\n        return (this.isComponent()) ? this.$component.attr('data-redactor-type') : false;\n    },\n    getFirstNode: function()\n    {\n        return this.utils.getFirstNode(this.node);\n    },\n    getLastNode: function()\n    {\n        return this.utils.getLastNode(this.node);\n    },\n    getFirstElement: function()\n    {\n        return this.utils.getFirstElement(this.node);\n    },\n    getLastElement: function()\n    {\n        return this.utils.getLastElement(this.node);\n    },\n    getFigcaption: function()\n    {\n        return this._getClosestNode('figcaption');\n    },\n    getPre: function()\n    {\n        return this._getClosestNode('pre');\n    },\n    getCode: function()\n    {\n        return this._getClosestNode('code');\n    },\n    getList: function()\n    {\n        return this._getClosestNode('ul, ol');\n    },\n    getParentList: function()\n    {\n        return this._getClosestUpNode('ul, ol');\n    },\n    getListItem: function()\n    {\n        return this._getClosestNode('li');\n    },\n    getTable: function()\n    {\n        if (this.getComponentType('table'))\n        {\n            return this.$component.find('table').get();\n        }\n        else\n        {\n            return this._getClosestNode('table');\n        }\n    },\n    getTableCell: function()\n    {\n        var $td = this.$el.closest('td, th');\n\n        return ($td.length !== 0) ? $td.get() : false;\n    },\n    getComponentCodeElement: function()\n    {\n        return (this.isComponentType('code')) ? this.$component.find('pre code, pre').last().get() : false;\n    },\n    getImageElement: function()\n    {\n        return (this.isComponentType('image')) ? this.$component.find('img').get() : false;\n    },\n    getParagraph: function()\n    {\n        return this._getClosestNode('p');\n    },\n    getHeading: function()\n    {\n        return this._getClosestNode('h1, h2, h3, h4, h5, h6');\n    },\n    getDl: function()\n    {\n        return this._getClosestNode('dl');\n    },\n    getBlockquote: function()\n    {\n        return this._getClosestNode('blockquote');\n    },\n    getLink: function()\n    {\n        var isComponent = (this.isComponent() && !this.isFigcaption());\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && !$el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n    getFile: function()\n    {\n        var isComponent = this.isComponent();\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && $el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n\n    // find\n    findFirstNode: function(selector)\n    {\n        return this.$el.find(selector).first().get();\n    },\n    findLastNode: function(selector)\n    {\n        return this.$el.find(selector).last().get();\n    },\n\n    // private\n    _getLastOrFirstListItem: function(type)\n    {\n        var list = this.getList();\n        var tag = this.getTag();\n        if (list && tag === 'li')\n        {\n            var item = $R.dom(list).find('li')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getLastOrFirstTableCell: function(type)\n    {\n        var table = this.getTable();\n        var tag = this.getTag();\n        if (table && (tag === 'td' || tag === 'th'))\n        {\n            var item = $R.dom(table).find('td, th')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getClosestUpNode: function(selector)\n    {\n        var $el = this.$el.parents(selector, '.redactor-in').last();\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestNode: function(selector)\n    {\n        var $el = this.$el.closest(selector, '.redactor-in');\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestElement: function(selector)\n    {\n        var $el = this.$el.closest(selector, '.redactor-in');\n\n        return ($el.length !== 0) ? $el : false;\n    }\n});\n$R.add('service', 'marker', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    build: function(pos, html)\n    {\n        var marker = document.createElement('span');\n\n        marker.id = 'selection-marker-' + this._getPos(pos);\n        marker.className = 'redactor-selection-marker';\n        marker.innerHTML = this.opts.markerChar;\n\n        return (html) ? marker.outerHTML : marker;\n    },\n    buildHtml: function(pos)\n    {\n        return this.build(pos, true);\n    },\n    insert: function(side)\n    {\n        this.remove();\n\n        var atStart = (side !== 'both' && (side === 'start' || this.selection.isCollapsed()));\n\n        if (!this.selection.is()) this.editor.focus();\n\n        var range = this.selection.getRange();\n        if (range)\n        {\n            var start = this.build('start');\n            var end = this.build('end');\n\n            var cloned = range.cloneRange();\n\n            if (!atStart)\n            {\n                cloned.collapse(false);\n                cloned.insertNode(end);\n            }\n\n            cloned.setStart(range.startContainer, range.startOffset);\n            cloned.collapse(true);\n            cloned.insertNode(start);\n\n            range.setStartAfter(start);\n\n            if (!atStart)\n            {\n                range.setEndBefore(end);\n            }\n\n            this.selection.setRange(range);\n\n            return start;\n        }\n    },\n    find: function(pos, $context)\n    {\n        var $editor = this.editor.getElement();\n        var $marker = ($context || $editor).find('span#selection-marker-' + this._getPos(pos));\n\n        return ($marker.length !== 0) ? $marker.get() : false;\n    },\n    restore: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        var range = this.selection.getRange();\n        if (!range || !this.selection.is())\n        {\n            this.editor.focus();\n            range = document.createRange();\n        }\n\n        if (start)\n        {\n            var prev = (end) ? end.previousSibling : false;\n            var next = start.nextSibling;\n            next = (next && next.nodeType === 3 && next.textContent.replace(/[\\n\\t]/g, '') === '') ? false : next;\n\n            if (!end)\n            {\n                if (next)\n                {\n                    range.selectNodeContents(next);\n                    range.collapse(true);\n                }\n                else\n                {\n                    this._restoreInject(range, start);\n                }\n            }\n            else if (next && next.id === 'selection-marker-end')\n            {\n                this._restoreInject(range, start);\n            }\n            else\n            {\n                if (prev && next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStart(next, 0);\n                }\n                else if (prev && !next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStartAfter(start);\n                }\n                else\n                {\n                    range.setStartAfter(start);\n                    range.setEndBefore(end);\n                }\n            }\n\n            this.selection.setRange(range);\n\n            if (start) start.parentNode.removeChild(start);\n            if (end) end.parentNode.removeChild(end);\n        }\n    },\n    remove: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        if (start) start.parentNode.removeChild(start);\n        if (end) end.parentNode.removeChild(end);\n    },\n\n    // private\n    _getPos: function(pos)\n    {\n        return (pos === undefined) ? 'start' : pos;\n    },\n    _restoreInject: function(range, start)\n    {\n        var textNode = this.utils.createInvisibleChar();\n        $R.dom(start).after(textNode);\n\n        range.selectNodeContents(textNode);\n        range.collapse(false);\n    }\n});\n$R.add('service', 'component', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.activeClass = 'redactor-component-active';\n    },\n    create: function(type, el)\n    {\n        return $R.create(type + '.component', this.app, el);\n    },\n    build: function(el)\n    {\n        var $el = $R.dom(el);\n        var component;\n        var type = $el.attr('data-redactor-type');\n        if (type)\n        {\n            component = this.create(type, el);\n        }\n\n        return (component) ? component : el;\n    },\n    remove: function(el, caret)\n    {\n        var $component = $R.dom(el).closest('.redactor-component');\n        var type = $component.attr('data-redactor-type');\n        var current = $component.parent();\n        var data = this.inspector.parse(current);\n        var prev = this.utils.findSiblings($component, 'prev');\n        var next = this.utils.findSiblings($component, 'next');\n        var stop = this.app.broadcast(type + '.delete', $component);\n        if (stop !== false)\n        {\n            $component.remove();\n\n            // callback\n            this.app.broadcast(type + '.deleted', $component);\n            this.app.broadcast('contextbar.close');\n            this.app.broadcast('imageresizer.stop');\n\n            if (caret !== false)\n            {\n                var cell = data.getTableCell();\n                if (cell && this.utils.isEmptyHtml(cell.innerHTML))\n                {\n                    this.caret.setStart(cell);\n                }\n                else if (next) this.caret.setStart(next);\n                else if (prev) this.caret.setEnd(prev);\n                else\n                {\n                    this.editor.startFocus();\n                }\n            }\n\n            // is empty\n            if (this.editor.isEmpty())\n            {\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                this.app.broadcast('empty');\n            }\n        }\n    },\n    isNonEditable: function(el)\n    {\n        var data = this.inspector.parse(el);\n        return (data.isComponent() && !data.isComponentEditable());\n    },\n    isActive: function(el)\n    {\n        var $component;\n        if (el)\n        {\n            var data = this.inspector.parse(el);\n            $component = $R.dom(data.getComponent());\n\n            return $component.hasClass(this.activeClass);\n        }\n        else\n        {\n            $component = this._find();\n\n            return ($component.length !== 0);\n        }\n    },\n    getActive: function(dom)\n    {\n        var $component = this._find();\n\n        return ($component.length !== 0) ? ((dom) ? $component : $component.get()) : false;\n    },\n    setActive: function(el)\n    {\n        this.clearActive();\n        this.editor.focus();\n\n        var data = this.inspector.parse(el);\n        var component = data.getComponent();\n        var $component = $R.dom(component);\n\n        if (!data.isFigcaption())\n        {\n            var $caret = $component.find('.redactor-component-caret');\n            if ($caret.length === 0)\n            {\n                $caret = this._buildCaret();\n                $component.prepend($caret);\n            }\n\n            this.caret.setAtStart($caret.get());\n        }\n\n        $component.addClass(this.activeClass);\n    },\n    clearActive: function()\n    {\n        var $component = this._find();\n\n        $component.removeClass(this.activeClass);\n        $component.find('.redactor-component-caret').remove();\n\n        this.app.broadcast('imageresizer.stop');\n    },\n    setOnEvent: function(e, contextmenu)\n    {\n        this.clearActive();\n\n        var data = this.inspector.parse(e.target);\n        if (data.isFigcaption() || data.isComponentEditable())\n        {\n            return;\n        }\n\n        // component\n        if (data.isComponent())\n        {\n            this.setActive(e.target);\n            if (contextmenu !== true) e.preventDefault();\n        }\n    },\n    executeScripts: function()\n    {\n        var $editor = this.editor.getElement();\n        var scripts = $editor.find('[data-redactor-type]').find(\"script\").getAll();\n\n        for (var i = 0; i < scripts.length; i++)\n        {\n            if (scripts[i].src !== '')\n            {\n                var src = scripts[i].src;\n                this.$doc.find('head script[src=\"' + src + '\"]').remove();\n\n                var tag = document.createElement('script');\n                tag.src = src;\n                document.getElementsByTagName('head')[0].appendChild(tag);\n            }\n            else\n            {\n                eval(scripts[i].innerHTML);\n            }\n        }\n    },\n\n    // private\n    _find: function()\n    {\n        return this.editor.getElement().find('.' + this.activeClass);\n    },\n    _buildCaret: function()\n    {\n        var $caret = $R.dom('<span>');\n        $caret.addClass('redactor-component-caret');\n        $caret.attr('contenteditable', true);\n\n        return $caret;\n    }\n});\n$R.add('service', 'insertion', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    set: function(html, clean, focus)\n    {\n        html = (clean !== false) ? this.cleaner.input(html) : html;\n        html = (clean !== false) ? this.cleaner.paragraphize(html) : html;\n\n        // set html\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        // set focus at the end\n        if (focus !== false) this.editor.endFocus();\n\n        return html;\n    },\n    insertNode: function(node, caret)\n    {\n        this.editor.focus();\n        var fragment = (this.utils.isFragment(node)) ? node : this.utils.createFragment(node);\n\n        this._collapseSelection();\n        this._insertFragment(fragment);\n        this._setCaret(caret, fragment);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    insertBreakLine: function()\n    {\n        return this.insertNode(document.createElement('br'), 'after');\n    },\n    insertNewline: function()\n    {\n        return this.insertNode(document.createTextNode('\\n'), 'after');\n    },\n    insertText: function(text)\n    {\n        return this.insertHtml(this.cleaner.getFlatText(text));\n    },\n    insertChar: function(charhtml)\n    {\n        return this.insertNode(charhtml, 'after');\n    },\n    insertRaw: function(html)\n    {\n        return this.insertHtml(html, false);\n    },\n    insertPoint: function(e)\n    {\n        var range, data;\n        var marker = this.marker.build('start');\n        var markerInserted = false;\n        var x = e.clientX, y = e.clientY;\n\n        if (document.caretPositionFromPoint)\n        {\n            var pos = document.caretPositionFromPoint(x, y);\n            var sel = document.getSelection();\n\n            data = this.inspector.parse(pos.offsetNode);\n            if (data.isInEditor())\n            {\n                range = sel.getRangeAt(0);\n                range.setStart(pos.offsetNode, pos.offset);\n                range.collapse(true);\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n        else if (document.caretRangeFromPoint)\n        {\n            range = document.caretRangeFromPoint(x, y);\n\n            data = this.inspector.parse(range.startContainer);\n            if (data.isInEditor())\n            {\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n\n        return markerInserted;\n    },\n    insertToPoint: function(e, html, point)\n    {\n        var pointInserted = (point === true) ? true : this.insertPoint(e);\n        if (!pointInserted)\n        {\n            var lastNode = this.editor.getLastNode();\n            $R.dom(lastNode).after(this.marker.build('start'));\n        }\n\n        this.component.clearActive();\n        this.selection.restoreMarkers();\n\n        return this.insertHtml(html);\n    },\n    insertToOffset: function(start, html)\n    {\n        this.offset.set({ start: start, end: start });\n\n        return this.insertHtml(html);\n    },\n    insertHtml: function(html, clean)\n    {\n        if (!this.opts.input) return;\n\n        // parse\n        var parsedInput = this.utils.parseHtml(html);\n\n        // all selection\n        if (this.selection.isAll())\n        {\n            return this._insertToAllSelected(parsedInput);\n        }\n\n        // there is no selection\n        if (!this.selection.is())\n        {\n            this.editor.startFocus();\n        }\n\n        // environment\n        var isCollapsed = this.selection.isCollapsed();\n        var isText = this.selection.isText();\n        var current = this.selection.getCurrent();\n        var dataCurrent = this.inspector.parse(current);\n\n        // collapse air\n        this._collapseSelection();\n\n        // clean\n        parsedInput = this._getCleanedInput(parsedInput, dataCurrent, clean);\n\n        // input is figure or component span\n        var isFigure = this._isFigure(parsedInput.html);\n        var isComponentSpan = this._isComponentSpan(parsedInput.html);\n        var isInsertedText = this.inspector.isText(parsedInput.html);\n        var fragment, except;\n\n        // empty editor\n        if (this.editor.isEmpty())\n        {\n            return this._insertToEmptyEditor(parsedInput.html);\n        }\n        // to component\n        else if (dataCurrent.isComponent() && !dataCurrent.isComponentEditable())\n        {\n            return this._insertToWidget(current, dataCurrent, parsedInput.html);\n        }\n        // component span\n        else if (isComponentSpan)\n        {\n            return this.insertNode(parsedInput.nodes, 'end');\n        }\n        // inserting figure & split node\n        else if (isFigure && !isText && !dataCurrent.isList())\n        {\n            if (dataCurrent.isInline())\n            {\n                return this._insertToInline(current, parsedInput);\n            }\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to code\n        else if (dataCurrent.isCode())\n        {\n            return this._insertToCode(parsedInput, current, clean);\n        }\n        // to pre\n        else if (dataCurrent.isPre())\n        {\n            return this._insertToPre(parsedInput, clean);\n        }\n        // to h1-h6 & figcaption\n        else if (dataCurrent.isHeading() || dataCurrent.isFigcaption())\n        {\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, ['a']) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceNbspToSpaces(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // text inserting\n        else if (isInsertedText)\n        {\n            if (!isText && this.opts.markup !== 'br' && this._hasBlocksAndImages(parsedInput.nodes))\n            {\n                parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n                fragment = this.utils.createFragment(parsedInput.html);\n\n                this.utils.splitNode(current, fragment);\n                this.caret.setEnd(fragment.last);\n\n                return this._sendNodes(fragment.nodes);\n            }\n\n            return this.insertNode(parsedInput.nodes, 'end');\n        }\n        // uncollapsed\n        else if (!isCollapsed && !isFigure)\n        {\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to inline tag\n        else if (dataCurrent.isInline() && !this._isPlainHtml(parsedInput.html))\n        {\n            return this._insertToInline(current, parsedInput);\n        }\n        // to blockquote or dt, dd\n        else if (dataCurrent.isBlockquote() || dataCurrent.isDl())\n        {\n            except = this.opts.inlineTags;\n            except.concat(['br']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to p\n        else if (dataCurrent.isParagraph())\n        {\n            if (this._isPlainHtml(parsedInput.html))\n            {\n                return this.insertNode(parsedInput.nodes, 'end');\n            }\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to li\n        else if (dataCurrent.isList())\n        {\n            except = this.opts.inlineTags;\n            except = except.concat(['br', 'li', 'ul', 'ol', 'img']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeBrAtEnd(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n            parsedInput.nodes = fragment.nodes;\n\n            if (this._containsTags(parsedInput.html, ['ul', 'ol', 'li']))\n            {\n                var element = this.selection.getElement(current);\n                if (element && element.tagName === 'LI' && this.caret.isStart(element))\n                {\n                    parsedInput.nodes = $R.dom(fragment.nodes).unwrap('ul, ol').getAll();\n                    $R.dom(element).before(parsedInput.nodes);\n\n                    var lastNode = parsedInput.nodes[parsedInput.nodes.length-1];\n                    this.caret.setEnd(lastNode);\n\n                    return this._sendNodes(parsedInput.nodes);\n                }\n                else if (this._isPlainHtml(parsedInput.html))\n                {\n                    return this.insertNode(fragment, 'end');\n                }\n                else\n                {\n                    fragment = this._buildList(parsedInput, element, fragment);\n\n                    this.utils.splitNode(current, fragment, true);\n                    this.caret.setEnd(fragment.last);\n\n                    return this._sendNodes(fragment.nodes);\n                }\n            }\n        }\n\n        // other cases\n        return this.insertNode(parsedInput.nodes, 'end');\n    },\n\n    // private\n    _insertToAllSelected: function(parsedInput)\n    {\n        var insertedHtml = this.set(parsedInput.html);\n        var dataInserted = this.utils.parseHtml(insertedHtml);\n\n        return this._sendNodes(dataInserted.nodes);\n    },\n    _insertToEmptyEditor: function(html)\n    {\n        html = this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var $editor = this.editor.getElement();\n\n        $editor.html('');\n        $editor.append(fragment.frag);\n\n        this.caret.setEnd($editor);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToInline: function(current, parsedInput)\n    {\n        var fragment = this.utils.createFragment(parsedInput.html);\n        this.utils.splitNode(current, fragment, false, true);\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToCode: function(parsedInput, current, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n        parsedInput.html = (clean !== false) ? this.cleaner.removeNl(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n        var nodes = this.insertNode(fragment, 'end');\n\n        this.utils.normalizeTextNodes(current);\n\n        return nodes;\n    },\n    _insertToPre: function(parsedInput, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n\n        return this.insertNode(fragment, 'end');\n    },\n    _insertToWidget: function(current, dataCurrent, html)\n    {\n        html = (this._isComponentSpan(html)) ? html : this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var component = dataCurrent.getComponent();\n        var $component = $R.dom(component);\n\n        $component.after(fragment.frag);\n        $component.remove();\n\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertFragment: function(fragment)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            if (this.selection.isCollapsed())\n            {\n                var startNode = range.startContainer;\n                if (startNode.nodeType !== 3 && startNode.tagName === 'BR')\n                {\n                    this.caret.setAfter(startNode);\n                    startNode.parentNode.removeChild(startNode);\n                }\n            }\n            else\n            {\n                range.deleteContents();\n            }\n\n            range.insertNode(fragment.frag);\n        }\n    },\n    _sendNodes: function(nodes)\n    {\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var el = nodes[i];\n            var type = (el.nodeType !== 3 && typeof el.getAttribute === 'function') ? el.getAttribute('data-redactor-type') : false;\n            if (type)\n            {\n                this.app.broadcast(type + '.inserted', this.component.build(el));\n            }\n        }\n\n        // callback\n        this.app.broadcast('inserted', nodes);\n\n        // widget's scripts\n        this.component.executeScripts();\n\n        return nodes;\n    },\n    _setCaret: function(caret, fragment)\n    {\n        var isLastInline = this._isLastInline(fragment);\n\n        if (caret)\n        {\n            caret = (isLastInline && caret === 'end') ? 'after' : caret;\n            this.caret['set' + this.utils.ucfirst(caret)](fragment.last);\n        }\n        else if (caret !== false)\n        {\n            if (isLastInline) this.caret.setAfter(fragment.last);\n        }\n    },\n    _isLastInline: function(fragment)\n    {\n        if (fragment.last)\n        {\n            var data = this.inspector.parse(fragment.last);\n\n            return data.isInline();\n        }\n\n        return false;\n    },\n    _getCleanedInput: function(parsedInput, dataCurrent, clean)\n    {\n        var isPreformatted = (dataCurrent.isCode() || dataCurrent.isPre());\n\n        parsedInput.html = (!isPreformatted && clean !== false) ? this.cleaner.input(parsedInput.html) : parsedInput.html;\n        parsedInput = (!isPreformatted && clean !== false) ? this.utils.parseHtml(parsedInput.html) : parsedInput;\n\n        return parsedInput;\n    },\n    _getContainer: function(nodes)\n    {\n        return $R.dom(this.utils.createTmpContainer(nodes));\n    },\n    _buildList: function(parsedInput, list, fragment)\n    {\n        var nodes = parsedInput.nodes;\n        var first = nodes[0];\n\n        if (first && first.nodeType !== 3 && first.tagName === 'li')\n        {\n            var $parent = $R.dom(list);\n            var parentListTag = $parent.get().tagName.toLowerCase();\n            var $list = $R.dom('<' + parentListTag + ' />');\n            $list.append(fragment.nodes);\n\n            return this.utils.createFragment($list.get().outerHTML);\n        }\n\n        return fragment;\n    },\n    _containsTags: function(html, tags)\n    {\n        return (this._getContainer(html).find(tags.join(',')).length !== 0);\n    },\n    _collapseSelection: function()\n    {\n        //if (this.app.isAirToolbar()) this.selection.collapseToEnd();\n    },\n    _hasFigureOrTable: function(nodes)\n    {\n        return (this._getContainer(nodes).find('figure, table').length !== 0);\n    },\n    _hasBlocks: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',')).length !== 0);\n    },\n    _hasBlocksAndImages: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',') + ',img').length !== 0);\n    },\n    _isPlainHtml: function(html)\n    {\n        return (this._getContainer(html).find(this.opts.blockTags.join(',') + ', img').length === 0);\n    },\n    _isFigure: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('figure').length !== 0);\n        }\n    },\n    _isComponentSpan: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('span.redactor-component').length !== 0);\n        }\n    },\n    _isHtmlString: function(html)\n    {\n        return !(typeof html === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(html));\n    }\n});\n$R.add('service', 'block', {\n    mixins: ['formatter'],\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // public\n    format: function(args)\n    {\n        // type of applying styles and attributes\n        this.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n\n        // tag\n        this.tag = (typeof args === 'string') ? args : args.tag;\n        this.tag = this._prepareTag(this.tag);\n        this.tag = this.tag.toLowerCase();\n\n        if (typeof args === 'string') this.args = false;\n        else this.buildArgs(args);\n\n        // format\n        return this._format();\n    },\n    getBlocks: function(tags)\n    {\n        return this.selection.getBlocks({ tags: tags || this._getTags(), first: true });\n    },\n    getElements: function(tags)\n    {\n        var block = this.selection.getBlock();\n        if (!this.selection.isCollapsed() && block && (block.tagName === 'TD' || block.tagName === 'TH'))\n        {\n            return this._wrapInsideTable('div');\n        }\n        else\n        {\n            return $R.dom(this.getBlocks(tags));\n        }\n    },\n    clearFormat: function(tags)\n\t{\n\t\tthis.selection.save();\n\n        var $elements = this.getElements(tags || this._getTags());\n        $elements.each(function(node)\n        {\n            while(node.attributes.length > 0)\n            {\n                node.removeAttribute(node.attributes[0].name);\n            }\n        });\n\n\t\tthis.selection.restore();\n\n        return $elements.getAll();\n\t},\n\n    // private\n    _format: function()\n    {\n        this.selection.save();\n        var blocks = this.getBlocks();\n        var block = this.selection.getBlock();\n        var nodes = [];\n        var data, replacedTag, $wrapper, nextBr;\n\n        // div break format\n        if (blocks.length === 1 && blocks[0].tagName === 'DIV')\n        {\n            data = this._getTextNodesData();\n            if (!data || data.nodes.length === 0)\n            {\n                nodes = this._replaceBlocks(blocks);\n                nodes = this._sendNodes(nodes);\n\n                setTimeout(function() { this.selection.restore(); }.bind(this), 0);\n\n                return nodes;\n            }\n\n            replacedTag = this._getReplacedTag('set');\n            $wrapper = $R.dom('<' + replacedTag + '>');\n\n            nextBr = data.last.nextSibling;\n            if (nextBr && nextBr.tagName === 'BR')\n            {\n                $R.dom(nextBr).remove();\n            }\n\n            for (var i = 0; i < data.nodes.length; i++)\n            {\n                $wrapper.append(data.nodes[i]);\n            }\n\n            this.utils.splitNode(blocks[0], [$wrapper.get()]);\n            nodes = this._sendNodes([$wrapper.get()]);\n\n            if (this.utils.isEmptyHtml($wrapper.html()))\n            {\n                this.caret.setStart($wrapper);\n            }\n            else\n            {\n                setTimeout(function() { this.selection.restore(); }.bind(this), 0);\n            }\n\n            return nodes;\n        }\n        // standard format\n        else if (blocks.length > 0)\n        {\n            nodes = this._replaceBlocks(blocks);\n            nodes = this._sendNodes(nodes);\n\n            setTimeout(function() { this.selection.restore(); }.bind(this), 0);\n\n            return nodes;\n        }\n        // td/th format\n        else if (!this.selection.isCollapsed() && block && (block.tagName === 'TD' || block.tagName === 'TH'))\n        {\n            replacedTag = this._getReplacedTag('set');\n            $wrapper = this._wrapInsideTable(replacedTag);\n\n            this.selection.setAll($wrapper);\n\n            return this._sendNodes([$wrapper.get()]);\n        }\n    },\n    _wrapInsideTable: function(replacedTag)\n    {\n        var data = this._getTextNodesData();\n        var $wrapper = $R.dom('<' + replacedTag + '>');\n\n        $R.dom(data.first).before($wrapper);\n\n        for (var i = 0; i < data.nodes.length; i++)\n        {\n            $wrapper.append(data.nodes[i]);\n        }\n\n        var nextBr = $wrapper.get().nextSibling;\n        if (nextBr && nextBr.tagName === 'BR')\n        {\n            $R.dom(nextBr).remove();\n        }\n\n        return $wrapper;\n    },\n    _prepareTag: function(tag)\n    {\n        return (typeof tag === 'undefined') ? this.opts.markup : tag;\n    },\n    _sendNodes: function(nodes)\n    {\n        if (nodes.length > 0)\n        {\n            // clean & appliyng styles and attributes\n            nodes = this.applyArgs(nodes, false);\n            nodes = this._combinePre(nodes);\n            nodes = this._cleanBlocks(nodes);\n        }\n\n        return nodes;\n    },\n    _getTags: function()\n    {\n        return ['div', 'p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n    },\n    _replaceBlocks: function(blocks)\n    {\n        var nodes = [];\n        var type = (this._isToggleFormatType(blocks)) ? 'toggle' : 'set';\n        var replacedTag = this._getReplacedTag(type);\n\n        for (var i = 0; i < blocks.length; i++)\n        {\n            var $node = this.utils.replaceToTag(blocks[i], replacedTag);\n            nodes.push($node.get());\n        }\n\n        return nodes;\n    },\n    _getReplacedTag: function(type)\n    {\n        var replacedTag = (type === 'toggle') ? this.opts.markup : this.tag;\n\n        return (this.opts.breakline && replacedTag === 'p') ? 'div' : replacedTag;\n    },\n    _getTextNodesData: function()\n    {\n        var nodes = this.selection.getNodes({ textnodes: true, keepbr: true });\n        if (nodes.length === 0) return false;\n\n        var firstNode = nodes[0];\n        var lastNode = nodes[nodes.length-1];\n        var node = lastNode;\n        var stop = false;\n\n        while (!stop)\n        {\n            var inline = this.selection.getInline(node);\n            node = (inline) ? inline.nextSibling : node.nextSibling;\n            if (!node)\n            {\n                stop = true;\n            }\n            else if (node.nodeType !== 3 && (node.tagName === 'BR' || this.inspector.isBlockTag(node.tagName)))\n            {\n                stop = true;\n            }\n            else\n            {\n                nodes.push(node);\n            }\n        }\n\n        return {\n            nodes: nodes,\n            first: firstNode,\n            last: lastNode\n        };\n    },\n    _isToggleFormatType: function(blocks)\n    {\n        var count = 0;\n        var len = blocks.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (blocks[i] && this.tag === blocks[i].tagName.toLowerCase()) count++;\n        }\n\n        return (count === len);\n    },\n    _combinePre: function(nodes)\n    {\n        var combinedNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var next = nodes[i].nextElementSibling;\n            if (next && nodes[i].tagName === 'PRE' && next.tagName === 'PRE')\n            {\n                var $current = $R.dom(nodes[i]);\n                var $next = $R.dom(next);\n                var newline = document.createTextNode('\\n');\n\n                $current.append(newline);\n                $current.append($next);\n                $next.unwrap('pre');\n            }\n\n            combinedNodes.push(nodes[i]);\n        }\n\n        return combinedNodes;\n    },\n    _cleanBlocks: function(nodes)\n    {\n        var headings = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n        var tags = this.opts.inlineTags;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var tag = nodes[i].tagName.toLowerCase();\n            var $node = $R.dom(nodes[i]);\n\n            if (headings.indexOf(tag) !== - 1)\n            {\n                $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker').unwrap();\n            }\n            else if (tag === 'pre')\n            {\n                $node.find(tags.join(',')).not('.redactor-selection-marker').unwrap();\n            }\n\n            // breakline attr\n            if (this.opts.breakline && tag === 'div')\n            {\n                $node.attr('data-redactor-tag', 'br');\n            }\n            else\n            {\n                $node.removeAttr('data-redactor-tag');\n            }\n\n            this.utils.normalizeTextNodes(nodes[i]);\n        }\n\n        return nodes;\n    }\n});\n$R.add('service', 'inline', {\n    mixins: ['formatter'],\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // public\n    format: function(args)\n    {\n        if (!this._isFormat()) return [];\n\n        // type of applying styles and attributes\n        this.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n\n        // tag\n        this.tag = (typeof args === 'string') ? args : args.tag;\n        this.tag = this.tag.toLowerCase();\n        this.tag = this.arrangeTag(this.tag);\n\n        if (typeof args === 'string') this.args = false;\n        else this.buildArgs(args);\n\n        // format\n        var nodes = (this.selection.isCollapsed()) ? this.formatCollapsed() : this.formatUncollapsed();\n\n        return nodes;\n    },\n\n    // private\n    _isFormat: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isComponent = (data.isComponent() && !data.isComponentType('table') && !data.isFigcaption());\n\n        if (!current || data.isPre() || data.isCode() || isComponent)\n        {\n            return false;\n        }\n\n        return true;\n    },\n    arrangeTag: function(tag)\n    {\n        var replaced = this.opts.replaceTags;\n        for (var key in replaced)\n        {\n            if (tag === key) tag = replaced[key];\n        }\n\n        return tag;\n    },\n    formatCollapsed: function()\n    {\n        var nodes = [];\n        var inline = this.selection.getInlineFirst();\n        var inlines = this.selection.getInlines({ all: true });\n        var $inline = $R.dom(inline);\n        var $parent, parent, $secondPart, extractedContent;\n\n        // 1) not inline\n        if (!inline)\n        {\n            nodes = this.insertInline(nodes);\n        }\n        else\n        {\n            var dataInline = this.inspector.parse(inline);\n            var isEmpty = this.utils.isEmptyHtml(inline.innerHTML);\n\n            // 2) inline is empty\n            if (isEmpty)\n            {\n                // 2.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 2.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        this.caret.setAfter(inline);\n                        $inline.remove();\n\n                        var el = this.selection.getElement();\n                        this.utils.normalizeTextNodes(el);\n                    }\n                    // 2.1.2) has different args and it is span tag\n                    else if (this.tag === 'span')\n                    {\n                        nodes = this.applyArgs([inline], false);\n                        this.caret.setStart(inline);\n                    }\n                    // 2.1.3) has different args and it is not span tag\n                    else\n                    {\n                       nodes = this.insertInline(nodes);\n                    }\n\n                }\n                // 2.2) has another tag\n                else\n                {\n                    // 2.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            $parent.unwrap();\n                            this.caret.setStart(inline);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 2.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n            // 3) inline isn't empty\n            else\n            {\n                // 3.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 3.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        // insert break\n                        extractedContent = this.utils.extractHtmlFromCaret(inline);\n                        $secondPart = $R.dom('<' + this.tag + ' />');\n                        $secondPart = this.utils.cloneAttributes(inline, $secondPart);\n\n                        $inline.after($secondPart.append(extractedContent));\n\n                        this.caret.setAfter(inline);\n                    }\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n                // 3.2) has another tag\n                else\n                {\n                    // 3.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            // insert break\n                            extractedContent = this.utils.extractHtmlFromCaret(parent, parent);\n                            $secondPart = $R.dom('<' + this.tag + ' />');\n                            $secondPart = this.utils.cloneAttributes(parent, $secondPart);\n\n                            var $breaked, $last;\n                            var z = 0;\n                            inlines = inlines.reverse();\n                            for (var i = 0; i < inlines.length; i++)\n                            {\n                                if (inlines[i] !== parent)\n                                {\n                                    $last = $R.dom('<' + inlines[i].tagName.toLowerCase() + '>');\n                                    if (z === 0)\n                                    {\n                                        $breaked = $last;\n                                    }\n                                    else\n                                    {\n                                        $breaked.append($last);\n                                    }\n\n                                    z++;\n                                }\n                            }\n\n                            $parent.after($secondPart.append(extractedContent));\n                            $parent.after($breaked);\n\n                            this.caret.setStart($last);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 3.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n        }\n\n        return nodes;\n    },\n    insertInline: function(nodes)\n    {\n        var node = document.createElement(this.tag);\n        nodes = this.insertion.insertNode(node, 'start');\n\n        return this.applyArgs(nodes, false);\n    },\n    hasSameArgs: function(inline)\n    {\n        if (inline.attributes.length === 0 && this.args === false)\n        {\n            return true;\n        }\n        else\n        {\n            var same = true;\n            if (this.args)\n            {\n                var count = 0;\n                for (var key in this.args)\n                {\n                    var $node = $R.dom(inline);\n                    var args = (this.args[key]);\n                    var value = this.utils.toParams(args);\n                    var nodeAttrValue = $node.attr(key);\n                    if (args)\n                    {\n                        if (key === 'style')\n                        {\n                            value = value.trim().replace(/;$/, '');\n\n                            var origRules = this.utils.styleToObj($node.attr('style'));\n                            var rules = value.split(';');\n                            var innerCount = 0;\n\n                            for (var i = 0; i < rules.length; i++)\n                            {\n                                var arr = rules[i].split(':');\n                                var ruleName = arr[0].trim();\n                                var ruleValue = arr[1].trim();\n\n                                if (ruleName.search(/color/) !== -1)\n                                {\n                                    var val = $node.css(ruleName);\n                                    if (val && (val === ruleValue || this.utils.rgb2hex(val) === ruleValue))\n                                    {\n                                        innerCount++;\n                                    }\n                                }\n                                else if ($node.css(ruleName) === ruleValue)\n                                {\n                                    innerCount++;\n                                }\n                            }\n\n                            if (innerCount === rules.length && Object.keys(origRules).length === rules.length)\n                            {\n                                count++;\n                            }\n                        }\n                        else\n                        {\n                            if (nodeAttrValue === value)\n                            {\n                                count++;\n                            }\n                        }\n                    }\n                    else\n                    {\n                        if (!nodeAttrValue || nodeAttrValue === '')\n                        {\n                            count++;\n                        }\n                    }\n                }\n\n                same = (count === Object.keys(this.args).length);\n            }\n\n            return same;\n        }\n    },\n    formatUncollapsed: function()\n    {\n        var inlines = this.selection.getInlines({ all: true, inside: true });\n\n        this.selection.save();\n\n        // convert del / u\n        this._convertTags('u');\n        this._convertTags('del');\n\n        // convert target tags\n        this._convertToStrike(inlines);\n\n        this.selection.restore();\n\n        // apply strike\n        document.execCommand('strikethrough');\n\n        // clear decoration\n        this._clearDecoration();\n\n        this.selection.save();\n\n        // revert and set style\n        var nodes = this._revertToInlines();\n        nodes = this.applyArgs(nodes, false);\n\n        this.selection.restore();\n\n        // clear and normalize\n        this._clearEmptyStyle();\n        nodes = this._normalizeBlocks(nodes);\n\n        return nodes;\n    },\n    _convertTags: function(tag)\n    {\n        if (this.tag !== tag)\n        {\n            var $editor = this.editor.getElement();\n            $editor.find(tag).each(function(node)\n            {\n                var $el = this.utils.replaceToTag(node, 'span');\n                $el.addClass('redactor-convertable-' + tag);\n            }.bind(this));\n        }\n    },\n    _revertTags: function(tag)\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.find('span.redactor-convertable-' + tag).each(function(node)\n        {\n            var $el = this.utils.replaceToTag(node, tag);\n            $el.removeClass('redactor-convertable-' + tag);\n            if (this.utils.removeEmptyAttr($el, 'class')) $el.removeAttr('class');\n\n        }.bind(this));\n    },\n    _convertToStrike: function(inlines)\n    {\n        var selected = this.selection.getText().replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n\n        for (var i = 0; i < inlines.length; i++)\n        {\n            var tag = this.arrangeTag(inlines[i].tagName.toLowerCase());\n            var inline = inlines[i];\n            var $inline = $R.dom(inline);\n            var hasSameArgs = this.hasSameArgs(inline);\n\n            if (tag === this.tag)\n            {\n                if (this.tag === 'span' && this._isTextSelected(inline, selected))\n                {\n                    $inline.addClass('redactor-convertable-apply');\n                }\n                else if (hasSameArgs)\n                {\n                    this._replaceToStrike($inline);\n                }\n                else if (this.tag === 'span')\n                {\n                    $inline.addClass('redactor-unconvertable-apply');\n                }\n            }\n        }\n    },\n    _replaceToStrike: function($el)\n    {\n        $el.replaceWith(function()\n        {\n            return $R.dom('<strike>').append($el.contents());\n        });\n    },\n    _revertToInlines: function()\n    {\n        var nodes = [];\n        var $editor = this.editor.getElement();\n\n        if (this.tag !== 'u') $editor.find('u').unwrap();\n\n        // span convertable\n        $editor.find('span.redactor-convertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            $node.find('strike').unwrap();\n\n            this._forceRemoveClass($node, 'redactor-convertable-apply');\n            nodes.push(node);\n\n        }.bind(this));\n\n        // span unconvertable\n        $editor.find('span.redactor-unconvertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            this._forceRemoveClass($node, 'redactor-unconvertable-apply');\n\n        }.bind(this));\n\n        // strike\n        $editor.find('strike').each(function(node)\n        {\n            var $node = this.utils.replaceToTag(node, this.tag);\n            nodes.push($node.get());\n\n        }.bind(this));\n\n\n        this._revertTags('u');\n        this._revertTags('del');\n\n        return nodes;\n    },\n    _normalizeBlocks: function(nodes)\n    {\n        var tags = this.opts.inlineTags;\n        var blocks = this.selection.getBlocks();\n        if (blocks)\n        {\n            for (var i = 0; i < blocks.length; i++)\n            {\n                if (blocks[i].tagName === 'PRE')\n                {\n                    var $node = $R.dom(blocks[i]);\n                    $node.find(tags.join(',')).not('.redactor-selection-marker').each(function(inline)\n                    {\n                        if (nodes.indexOf(inline) !== -1)\n                        {\n                            nodes = this.utils.removeFromArrayByValue(nodes, inline);\n                        }\n\n                        $R.dom(inline).unwrap();\n                    }.bind(this));\n                }\n            }\n        }\n\n        return nodes;\n    },\n    _clearDecoration: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.style.textDecoration === 'line-through' || node.style.textDecorationLine === 'line-through')\n            {\n                var $el = $R.dom(node);\n                $el.css('textDecorationLine', '');\n                $el.css('textDecoration', '');\n                $el.wrap('<strike>');\n            }\n        });\n    },\n    _clearEmptyStyle: function()\n    {\n        var inlines = this.getInlines();\n        for (var i = 0; i < inlines.length; i++)\n        {\n            this._clearEmptyStyleAttr(inlines[i]);\n\n            var childNodes = inlines[i].childNodes;\n            if (childNodes)\n            {\n                for (var z = 0; z < childNodes.length; z++)\n                {\n                    this._clearEmptyStyleAttr(childNodes[z]);\n                }\n            }\n        }\n    },\n    _clearEmptyStyleAttr: function(node)\n    {\n        if (node.nodeType !== 3 && this.utils.removeEmptyAttr(node, 'style'))\n        {\n            node.removeAttribute('style');\n            node.removeAttribute('data-redactor-style-cache');\n        }\n    },\n    _forceRemoveClass: function($node, classname)\n    {\n        $node.removeClass(classname);\n        if (this.utils.removeEmptyAttr($node, 'class')) $node.removeAttr('class');\n    },\n    _isTextSelected: function(node, selected)\n    {\n        var text = this.utils.removeInvisibleChars(node.textContent);\n\n        return (selected === text || selected.search(new RegExp('^' + this.utils.escapeRegExp(text) + '$')) !== -1);\n    },\n\n    getInlines: function(tags)\n    {\n        return (tags) ? this.selection.getInlines({ tags: tags, all: true }) : this.selection.getInlines({ all: true });\n    },\n    getElements: function(tags)\n    {\n        return $R.dom(this.getInlines(tags));\n    },\n    clearFormat: function()\n    {\n        this.selection.save();\n\n        var nodes = this.selection.getInlines({ all: true });\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var inline = this.selection.getInline(nodes[i]);\n            if (inline)\n            {\n                $el.unwrap();\n            }\n        }\n\n        this.selection.restore();\n    }\n});\n$R.add('service', 'autoparser', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    observe: function()\n    {\n        var $editor = this.editor.getElement();\n        var $objects = $editor.find('.redactor-autoparser-object').each(function(node)\n        {\n           var $node = $R.dom(node);\n           $node.removeClass('redactor-autoparser-object');\n           if ($node.attr('class') === '') $node.removeAttr('class');\n        });\n\n        if ($objects.length > 0)\n        {\n            $objects.each(function(node)\n            {\n                var type;\n                var $object = false;\n                var tag = node.tagName;\n\n                if (tag === 'A') type = 'link';\n                else if (tag === 'IMG') type = 'image';\n                else if (tag === 'IFRAME') type = 'video';\n\n                if (type)\n                {\n                    $object = $R.create(type + '.component', this.app, node);\n                    this.app.broadcast(type + '.inserted', $object);\n                    this.app.broadcast('autoparse', type, $object);\n                }\n\n            }.bind(this));\n        }\n    },\n    format: function(e, key)\n    {\n        if (this._isKey(key))\n        {\n            this._format();\n        }\n    },\n    parse: function(html)\n    {\n        var tags = ['figure', 'pre', 'code', 'a', 'iframe', 'img', 'i', 'em', 'span'];\n        var singleReplace = ['img', 'i', 'em', 'span'];\n        var stored = [];\n        var z = 0;\n\n        // encode\n        html = this.cleaner.encodePreCode(html);\n\n        // store tags\n        for (var i = 0; i < tags.length; i++)\n        {\n            var reTags = (singleReplace.indexOf(tags[i]) !== -1) ? '<' + tags[i] + '[^>]*>' : '<' + tags[i] + '([\\\\w\\\\W]*?)</' + tags[i] + '>';\n            var matched = html.match(new RegExp(reTags, 'gi'));\n\n            if (matched !== null)\n            {\n                for (var y = 0; y < matched.length; y++)\n                {\n                    html = html.replace(matched[y], '#####replaceparse' + z + '#####');\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n        }\n\n        // images\n        if (this.opts.autoparseImages && html.match(this.opts.regex.imageurl))\n        {\n            var imagesMatches = html.match(this.opts.regex.imageurl);\n            for (var i = 0; i < imagesMatches.length; i++)\n            {\n                html = html.replace(imagesMatches[i], '<img class=\"redactor-autoparser-object\" src=\"' + imagesMatches[i] + '\">');\n            }\n        }\n\n        // video\n        if (this.opts.autoparseVideo && (html.match(this.opts.regex.youtube) || html.match(this.opts.regex.vimeo)))\n        {\n            var iframeStart = '<iframe width=\"500\" height=\"281\" class=\"redactor-autoparser-object\" src=\"';\n            var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n            var str, re;\n            if (html.match(this.opts.regex.youtube))\n            {\n                str = '//www.youtube.com/embed/$1';\n                re = this.opts.regex.youtube;\n            }\n            else if (html.match(this.opts.regex.vimeo))\n            {\n                str = '//player.vimeo.com/video/$2';\n                re = this.opts.regex.vimeo;\n            }\n\n            html = html.replace(re, iframeStart + str + iframeEnd);\n        }\n\n        // links\n        if (this.opts.autoparseLinks && html.match(this.opts.regex.url))\n        {\n            html = this._formatLinks(html);\n        }\n\n        // restore\n        for (var i = 0; i < stored.length; i++)\n        {\n            html = html.replace('#####replaceparse' + i + '#####', stored[i]);\n        }\n\n        return html;\n    },\n\n    // private\n    _isKey: function(key)\n    {\n        return (key === this.keycodes.ENTER || key === this.keycodes.SPACE);\n    },\n    _format: function()\n    {\n        var parent = this.selection.getParent();\n        var $parent = $R.dom(parent);\n\n        var isNotFormatted = (parent && $parent.closest('figure, pre, code, img, a, iframe').length !== 0);\n        if (isNotFormatted || !this.selection.isCollapsed())\n        {\n            return;\n        }\n\n        // add split marker\n        var marker = this.utils.createInvisibleChar();\n        var range = this.selection.getRange();\n        range.insertNode(marker);\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $current = $R.dom(current);\n\n        // remove split marker\n        marker.parentNode.removeChild(marker);\n\n        if (current && current.nodeType === 3)\n        {\n            var content = current.textContent;\n            var type;\n\n            // images\n            if (this.opts.autoparseImages && content.match(this._convertToRegExp(this.opts.regex.imageurl)))\n            {\n                var isList = data.isList();\n                var matches = content.match(this.opts.regex.imageurl);\n                var el = (isList) ? undefined : '<figure><img></figure>';\n\n                var $img = this.component.create('image', el);\n                $img.setSrc(matches[0]);\n                $img.addClass('redactor-autoparser-object');\n\n                content = content.replace(matches[0], $img.get().outerHTML);\n                type = 'image';\n            }\n            // video\n            else if (this.opts.autoparseVideo && (content.match(this._convertToRegExp(this.opts.regex.youtube)) || content.match(this._convertToRegExp(this.opts.regex.vimeo))))\n            {\n                var iframeStart = '<iframe width=\"500\" height=\"281\" src=\"';\n                var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n                var str, re;\n\n                if (content.match(this.opts.regex.youtube))\n                {\n                    str = '//www.youtube.com/embed/$1';\n                    re = this.opts.regex.youtube;\n                }\n                else if (content.match(this.opts.regex.vimeo))\n                {\n                    str = '//player.vimeo.com/video/$2';\n                    re = this.opts.regex.vimeo;\n                }\n\n                var $video = this.component.create('video', iframeStart + str + iframeEnd);\n                $video.addClass('redactor-autoparser-object');\n\n                content = content.replace(re, $video.get().outerHTML);\n                type = 'video';\n            }\n            // links\n            else if (this.opts.autoparseLinks && content.match(this._convertToRegExp(this.opts.regex.url)))\n            {\n                content = this._formatLinks(content);\n                type = 'link';\n            }\n\n            // replace\n            if (type)\n            {\n                $current.replaceWith(content);\n\n                // object\n                var $editor = this.editor.getElement();\n                var $object = $editor.find('.redactor-autoparser-object').removeClass('redactor-autoparser-object');\n                $object = (type === 'link') ? $R.create('link.component', this.app, $object) : $object;\n\n                // caret\n                if (type === 'link')\n                {\n                    this.caret.setAfter($object);\n                    this.app.broadcast('link.inserted', $object);\n                }\n                else\n                {\n                    this.caret.setAfter($object);\n\n                    var $cloned = $object.clone();\n                    $object.remove();\n                    $object = this.insertion.insertHtml($cloned);\n                    $object = this.component.build($object);\n                }\n\n                // callback\n                this.app.broadcast('autoparse', type, $object);\n            }\n        }\n    },\n    _formatLinks: function(content)\n    {\n        var matches = content.match(this.opts.regex.url);\n        var obj = {};\n        for (var i = 0; i < matches.length; i++)\n        {\n            var href = matches[i], text = href;\n            var linkProtocol = (href.match(/(https?|ftp):\\/\\//i) !== null) ? '' : 'http://';\n            var regexB = ([\"/\", \"&\", \"=\"].indexOf(href.slice(-1)) !== -1) ? \"\" : \"\\\\b\";\n            var target = (this.opts.pasteLinkTarget !== false) ? ' target=\"' + this.opts.pasteLinkTarget + '\"' : '';\n\n            text = (text.length > this.opts.linkSize) ? text.substring(0, this.opts.linkSize) + '...' : text;\n            text = (text.search('%') === -1) ? decodeURIComponent(text) : text;\n\n            // escaping url\n            var regexp = '(' + href.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\") + regexB + ')';\n            var classstr = ' class=\"redactor-autoparser-object\"';\n\n            obj[regexp] = '<a href=\"' + linkProtocol + href.trim() + '\"' + target + classstr + '>' + text.trim() + '</a>';\n        }\n\n        // replace\n        for (var key in obj)\n        {\n            content = content.replace(new RegExp(key, 'g'), obj[key]);\n        }\n\n        return content;\n    },\n    _convertToRegExp: function(str)\n    {\n        return new RegExp(String(str).replace(/^\\//, '').replace(/\\/ig$/, '').replace(/\\/gi$/, '') + '$', 'gi');\n    }\n});\n$R.add('service', 'storage', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.data = [];\n    },\n    // public\n    observeImages: function()\n    {\n        var $editor = this.editor.getElement();\n        var $images = $editor.find('[data-image]');\n\n        $images.each(this._addImage.bind(this));\n    },\n    observeFiles: function()\n    {\n        var $editor = this.editor.getElement();\n        var $files = $editor.find('[data-file]');\n\n\t\t$files.each(this._addFile.bind(this));\n    },\n\tsetStatus: function(url, status)\n\t{\n\t\tthis.data[url].status = status;\n\t},\n    getChanges: function()\n    {\n        var $editor = this.editor.getElement();\n\n        // check status\n        for (var key in this.data)\n\t\t{\n\t\t\tvar data = this.data[key];\n\t\t\tvar $el = $editor.find('[data-' + data.type + '=\"' + data.id + '\"]');\n\n\t\t\tthis.setStatus(data.id, ($el.length === 0) ? false : true);\n\t\t}\n\n        return this.data;\n    },\n\tadd: function(type, node)\n\t{\n        var $node = $R.dom(node);\n        var id = $node.attr('data-' + type);\n\n        this.data[id] = { type: type, status: true, node: $node.get(), id: $node.attr('data-' + type) };\n\t},\n\n    // private\n    _addImage: function(node)\n    {\n        this.add('image', node);\n    },\n    _addFile: function(node)\n    {\n        this.add('file', node);\n    }\n});\n$R.add('service', 'utils', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // empty\n    isEmpty: function(el)\n    {\n        var isEmpty = false;\n        el = $R.dom(el).get();\n        if (el)\n        {\n            isEmpty = (el.nodeType === 3) ? (el.textContent.trim().replace(/\\n/, '') === '') : (el.innerHTML === '');\n        }\n\n        return isEmpty;\n    },\n    isEmptyHtml: function(html, keepbr, keeplists)\n    {\n        html = this.removeInvisibleChars(html);\n        html = html.replace(/&nbsp;/gi, '');\n        html = html.replace(/<\\/?br\\s?\\/?>/g, ((keepbr) ? 'br' : ''));\n        html = html.replace(/\\s/g, '');\n        html = html.replace(/^<p>[^\\W\\w\\D\\d]*?<\\/p>$/i, '');\n        html = html.replace(/^<div>[^\\W\\w\\D\\d]*?<\\/div>$/i, '');\n\n        if (keeplists)\n        {\n            html = html.replace(/<ul(.*?[^>])>$/i, 'ul');\n            html = html.replace(/<ol(.*?[^>])>$/i, 'ol');\n        }\n\n        html = html.replace(/<hr(.*?[^>])>$/i, 'hr');\n        html = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n        html = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n        // remove empty tags\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\n        // trim\n        html = html.trim();\n\n        return html === '';\n    },\n    trimSpaces: function(html)\n    {\n        return html = this.removeInvisibleChars(html.trim());\n    },\n\n    // invisible chars\n    createInvisibleChar: function()\n    {\n        return document.createTextNode(this.opts.markerChar);\n    },\n    searchInvisibleChars: function(str)\n    {\n        return str.search(/^[\\u200B-\\u200D\\uFEFF]$/g);\n    },\n    removeInvisibleChars: function(html)\n    {\n        return html.replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n    },\n\n    // wrapper\n    buildWrapper: function(html)\n    {\n        return $R.dom('<div>').html(html);\n    },\n    getWrapperHtml: function($wrapper)\n    {\n        var html = $wrapper.html();\n        $wrapper.remove();\n\n        return html;\n    },\n\n    // fragment\n    createTmpContainer: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (typeof html === 'string')\n        {\n            $div.html(html);\n        }\n        else\n        {\n            $div.append($R.dom(html).clone(true));\n        }\n\n        return $div.get();\n    },\n    createFragment: function(html)\n    {\n        var el = this.createTmpContainer(html);\n        var frag = document.createDocumentFragment(), node, firstNode, lastNode;\n        var nodes = [];\n        var i = 0;\n        while ((node = el.firstChild))\n        {\n            i++;\n            var n = frag.appendChild(node);\n            if (i === 1) firstNode = n;\n\n            nodes.push(n);\n            lastNode = n;\n        }\n\n        return { frag: frag, first: firstNode, last: lastNode, nodes: nodes };\n    },\n    isFragment: function(obj)\n    {\n        return (typeof obj === 'object' && obj.frag);\n    },\n    parseHtml: function(html)\n    {\n        var div = this.createTmpContainer(html);\n\n        return { html: div.innerHTML, nodes: div.childNodes };\n    },\n\n    splitNode: function(current, nodes, isList, inline)\n    {\n        nodes = (this.isFragment(nodes)) ? nodes.frag : nodes;\n\n        var element;\n        if (inline)\n        {\n            element = (this.inspector.isInlineTag(current.tagName)) ? current : this.selection.getInline(current);\n        }\n        else\n        {\n            element = (this.inspector.isBlockTag(current.tagName)) ? current : this.selection.getBlock(current);\n        }\n\n        var $element = $R.dom(element);\n\n        // replace is empty\n        if (!inline && this.isEmptyHtml(element.innerHTML, true))\n        {\n            $element.after(nodes);\n            $element.remove();\n\n            return nodes;\n        }\n\n        var tag = $element.get().tagName.toLowerCase();\n        var isEnd = this.caret.isEnd(element);\n        var isStart = this.caret.isStart(element);\n\n        if (!isEnd && !isStart)\n        {\n            var extractedContent = this.extractHtmlFromCaret(inline);\n\n            var $secondPart = $R.dom('<' + tag + ' />');\n            $secondPart = this.cloneAttributes(element, $secondPart);\n\n            $element.after($secondPart.append(extractedContent));\n        }\n\n        if (isStart)\n        {\n            return $element.before(nodes);\n        }\n        else\n        {\n            if (isList)\n            {\n                return $element.append(nodes);\n            }\n            else\n            {\n                nodes = $element.after(nodes);\n\n                var html = $element.html();\n                html = this.removeInvisibleChars(html);\n                html = html.replace(/&nbsp;/gi, '');\n\n                if (html === '') $element.remove();\n\n                return nodes;\n            }\n        }\n    },\n    extractHtmlFromCaret: function(inline, element)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            element = (element) ? element : ((inline) ? this.selection.getInline() : this.selection.getBlock());\n            if (element)\n            {\n                var clonedRange = range.cloneRange();\n                clonedRange.selectNodeContents(element);\n                clonedRange.setStart(range.endContainer, range.endOffset);\n\n                return clonedRange.extractContents();\n            }\n        }\n    },\n    createMarkup: function(el)\n    {\n        var markup = document.createElement(this.opts.markup);\n        if (this.opts.breakline) markup.setAttribute('data-redactor-tag', 'br');\n\n        var $el = $R.dom(el);\n\n        $el.after(markup);\n        this.caret.setStart(markup);\n    },\n    getNode: function(el)\n    {\n        var node = $R.dom(el).get();\n        var editor = this.editor.getElement().get();\n\n        return (typeof el === 'undefined') ? editor : ((node) ? node : false);\n    },\n    findSiblings: function(node, type)\n    {\n        node = $R.dom(node).get();\n        type = (type === 'next') ? 'nextSibling' : 'previousSibling';\n\n        while (node = node[type])\n        {\n            if ((node.nodeType === 3 && node.textContent.trim() === '') || node.tagName === 'BR')\n            {\n                continue;\n            }\n\n            return node;\n        }\n\n        return false;\n    },\n    getElementsFromHtml: function(html, selector, exclude)\n    {\n        var div = document.createElement(\"div\");\n        div.innerHTML = html;\n\n        var elems = div.querySelectorAll(selector);\n\n        // array map polyfill\n        var mapping = function(callback, thisArg)\n        {\n            if (typeof this.length !== 'number') return;\n            if (typeof callback !== 'function') return;\n\n            var newArr = [];\n            if (typeof this == 'object')\n            {\n                for (var i = 0; i < this.length; i++)\n                {\n                    if (i in this) newArr[i] = callback.call(thisArg || this, this[i], i, this);\n                    else return;\n                }\n            }\n\n            return newArr;\n        };\n\n        return mapping.call(elems, function(el)\n        {\n            var type = el.getAttribute('data-redactor-type');\n            if (exclude && type && type === exclude) {}\n            else return el.outerHTML;\n        });\n    },\n\n    // childnodes\n    getChildNodes: function(el, recursive, elements)\n    {\n        el = (el && el.nodeType && el.nodeType === 11) ? el : $R.dom(el).get();\n\n        var nodes = el.childNodes;\n        var result = [];\n        if (nodes)\n        {\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (elements === true && nodes[i].nodeType === 3) continue;\n                else if (nodes[i].nodeType === 3 && this.isEmpty(nodes[i])) continue;\n\n                result.push(nodes[i]);\n\n                if (recursive !== false)\n                {\n                    var nestedNodes = this.getChildNodes(nodes[i], elements);\n                    if (nestedNodes.length > 0)\n                    {\n                        result = result.concat(nestedNodes);\n                    }\n                }\n            }\n        }\n\n        return result;\n    },\n    getChildElements: function(el)\n    {\n        return this.getChildNodes(el, true, true);\n    },\n    getFirstNode: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false));\n    },\n    getLastNode: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false));\n    },\n    getFirstElement: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false, true));\n    },\n    getLastElement: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false, true));\n    },\n\n    // replace\n    replaceToTag: function(node, tag)\n    {\n        var $node = $R.dom(node);\n        return $node.replaceWith(function(node)\n        {\n            var $replaced = $R.dom('<' + tag + '>').append($R.dom(node).contents());\n            if (node.attributes)\n            {\n                var attrs = node.attributes;\n                for (var i = 0; i < attrs.length; i++)\n                {\n                    $replaced.attr(attrs[i].nodeName, attrs[i].value);\n                }\n            }\n\n            return $replaced;\n\n        });\n    },\n\n    // string\n    ucfirst: function(str)\n    {\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n\n    // array\n    removeFromArrayByValue: function(arr, value)\n    {\n        var a = arguments, len = a.length, ax;\n        while (len > 1 && arr.length)\n        {\n            value = a[--len];\n            while ((ax= arr.indexOf(value)) !== -1)\n            {\n                arr.splice(ax, 1);\n            }\n        }\n\n        return arr;\n    },\n\n    // attributes\n    removeEmptyAttr: function(el, attr)\n    {\n        var $el = $R.dom(el);\n\n        if (typeof $el.attr(attr) === 'undefined' || $el.attr(attr) === null) return true;\n        else if ($el.attr(attr) === '')\n        {\n            $el.removeAttr(attr);\n            return true;\n        }\n\n        return false;\n    },\n    cloneAttributes: function(elFrom, elTo)\n    {\n        elFrom = $R.dom(elFrom).get();\n        elTo = $R.dom(elTo);\n\n        var attrs = elFrom.attributes;\n        var len = attrs.length;\n        while (len--)\n        {\n            var attr = attrs[len];\n            elTo.attr(attr.name, attr.value);\n        }\n\n        return elTo;\n    },\n\n    // object\n    toParams: function(obj)\n    {\n        var keys = Object.keys(obj);\n        if (!keys.length) return '';\n        var result = '';\n\n        for (var i = 0; i < keys.length; i++)\n        {\n            var key = keys[i];\n            result += key + ':' + obj[key] + ';';\n        }\n\n        return result;\n    },\n    styleToObj: function(str)\n    {\n        var obj = {};\n\n        if (str)\n        {\n            var style = str.replace(/;$/, '').split(';');\n            for (var i = 0; i < style.length; i++)\n            {\n                var rule = style[i].split(':');\n                obj[rule[0].trim()] = rule[1].trim();\n            }\n        }\n\n        return obj;\n    },\n    checkProperty: function(obj)\n    {\n        var args = (arguments[1] && Array.isArray(arguments[1])) ? arguments[1] : [].slice.call(arguments, 1);\n\n        for (var i = 0; i < args.length; i++)\n        {\n            if (!obj || (typeof obj[args[i]] === 'undefined'))\n            {\n                return false;\n            }\n\n            obj = obj[args[i]];\n        }\n\n        return obj;\n    },\n\n    // data\n    extendData: function(data, obj)\n    {\n        for (var key in obj)\n        {\n            if (key === 'elements')\n            {\n                var $elms = $R.dom(obj[key]);\n                $elms.each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    if (node.tagName === 'FORM')\n                    {\n                        var serializedData = $node.serialize(true);\n                        for (var z in serializedData)\n                        {\n                            data = this._setData(data, z, serializedData[z]);\n                        }\n                    }\n                    else\n                    {\n                        var name = ($node.attr('name')) ? $node.attr('name') : $node.attr('id');\n                        data = this._setData(data, name, $node.val());\n                    }\n                }.bind(this));\n            }\n            else\n            {\n                data = this._setData(data, key, obj[key]);\n            }\n        }\n\n        return data;\n    },\n    _setData: function(data, name, value)\n    {\n        if (data instanceof FormData) data.append(name, value);\n        else data[name] = value;\n\n        return data;\n    },\n\n    // normalize\n    normalizeTextNodes: function(el)\n    {\n        el = $R.dom(el).get();\n        if (el) el.normalize();\n    },\n\n    // color\n    isRgb: function(str)\n    {\n        return (str.search(/^rgb/i) === 0);\n    },\n    rgb2hex: function(rgb)\n    {\n        rgb = rgb.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\n        return (rgb && rgb.length === 4) ? \"#\" +\n        (\"0\" + parseInt(rgb[1],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[2],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';\n    },\n    hex2long: function(val)\n    {\n        if (val.search(/^#/) !== -1 && val.length === 4)\n        {\n            val = '#' + val[1] + val[1] + val[2] + val[2] + val[3] + val[3];\n        }\n\n        return val;\n    },\n\n    // escape\n    escapeRegExp: function(s)\n    {\n        return s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n    },\n\n    // random\n    getRandomId: function()\n    {\n        var id = '';\n        var possible = 'abcdefghijklmnopqrstuvwxyz0123456789';\n\n        for (var i = 0; i < 12; i++)\n        {\n            id += possible.charAt(Math.floor(Math.random() * possible.length));\n        }\n\n        return id;\n    },\n\n    // private\n    _getFirst: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[0] : false;\n    },\n    _getLast: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[nodes.length-1] : false;\n    }\n});\n$R.add('service', 'progress', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$box = null;\n        this.$bar = null;\n    },\n\n    // public\n    show: function()\n    {\n        if (!this._is()) this._build();\n        this.$box.show();\n    },\n    hide: function()\n    {\n        if (this._is())\n        {\n            this.animate.start(this.$box, 'fadeOut', this._destroy.bind(this));\n        }\n    },\n    update: function(value)\n    {\n        this.show();\n        this.$bar.css('width', value + '%');\n    },\n\n    // private\n    _is: function()\n    {\n        return (this.$box !== null);\n    },\n    _build: function()\n    {\n        this.$bar = $R.dom('<span />');\n        this.$box = $R.dom('<div id=\"redactor-progress\" />');\n\n        this.$box.append(this.$bar);\n        this.$body.append(this.$box);\n    },\n    _destroy: function()\n    {\n        if (this._is()) this.$box.remove();\n\n        this.$box = null;\n        this.$bar = null;\n    }\n});\n$R.add('module', 'starter', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.plugin = app.plugin;\n        this.module = app.module;\n    },\n    // messages\n    onstart: function()\n    {\n        var services = ['element', 'container', 'source', 'editor', 'statusbar', 'toolbar'];\n        var modules = ['element', 'container', 'source', 'editor', 'statusbar', 'contextbar', 'input'];\n\n        this._startStop('start', this.app, services);\n        this._startStop('start', this.module, modules);\n    },\n    onstop: function()\n    {\n        var modules = ['observer', 'element', 'container', 'source', 'editor', 'contextbar'];\n\n        this._startStop('stop', this.module, modules);\n    },\n    onenable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('start', this.module, modules);\n        this._startStop('start', this.plugin, plugins);\n    },\n    ondisable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('stop', this.module, modules);\n        this._startStop('stop', this.plugin, plugins);\n    },\n\n    // private\n    _startStop: function(type, obj, arr)\n    {\n        for (var i = 0; i < arr.length; i++)\n        {\n            if (typeof obj[arr[i]] !== 'undefined')\n            {\n                this.app.callInstanceMethod(obj[arr[i]], type);\n            }\n        }\n    }\n});\n$R.add('module', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.namespace = app.namespace;\n        this.element = app.element;\n        this.rootOpts = $R.extend({}, true, $R.options, app.rootOpts);\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildModes();\n        this._buildMarkup();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        $element.removeData(this.namespace + '-uuid');\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        $element.data(this.namespace + '-uuid', this.uuid);\n    },\n    _buildModes: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline') this._redefineOptions(this.opts.modes['inline']);\n        if (type === 'div') this._redefineOptions(this.opts.modes['original']);\n\n        if (type !== 'inline')\n        {\n            if (this._isRootOption('styles') && this.rootOpts.styles) this.opts.styles = true;\n            if (this._isRootOption('source') && !this.rootOpts.source) this.opts.showSource = false;\n        }\n    },\n    _buildMarkup: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline')\n        {\n            this.opts.emptyHtml = '';\n        }\n        else if (this.opts.breakline)\n        {\n            this.opts.markup = 'div';\n            this.opts.emptyHtml = '<div data-redactor-tag=\"br\">' + this.opts.markerChar + '</div>';\n        }\n        else\n        {\n            this.opts.emptyHtml = '<' + this.opts.markup + '></' + this.opts.markup + '>';\n        }\n    },\n    _redefineOptions: function(opts)\n    {\n        for (var key in opts)\n        {\n            this.opts[key] = opts[key];\n        }\n    },\n    _isRootOption: function()\n    {\n        return (typeof this.rootOpts['styles'] !== 'undefined');\n    }\n});\n$R.add('module', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.source = app.source;\n        this.element = app.element;\n        this.component = app.component;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.placeholder = false;\n        this.events = false;\n    },\n    // messages\n    onenable: function()\n    {\n        this.enable();\n    },\n    ondisable: function()\n    {\n        this.disable();\n    },\n    onenablefocus: function()\n    {\n        this._enableFocus();\n    },\n    oncontextmenu: function(e)\n    {\n        this.component.setOnEvent(e, true);\n    },\n    onclick: function(e)\n    {\n        this.component.setOnEvent(e);\n    },\n    onkeyup: function(e)\n    {\n        var data = this.inspector.parse(e.target);\n        if (!data.isComponent())\n        {\n            this.component.clearActive();\n        }\n    },\n    onenablereadonly: function()\n    {\n        this._enableReadOnly();\n    },\n    ondisablereadonly: function()\n    {\n        this._disableReadOnly();\n    },\n    onautoparseobserve: function()\n    {\n        this.autoparser.observe();\n    },\n    onplaceholder: {\n        build: function()\n        {\n            this._buildPlaceholder();\n        },\n        toggle: function()\n        {\n            this._togglePlacehodler();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildEvents();\n        this._buildOptions();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        var classesEditor = ['redactor-in', 'redactor-in-' + this.uuid, 'redactor-structure', 'redactor-placeholder', this.opts.stylesClass];\n        var classesContainer = ['redactor-focus', 'redactor-blur', 'redactor-over', 'redactor-styles-on',\n                                'redactor-styles-off', 'redactor-toolbar-on', 'redactor-text-labeled-on', 'redactor-source-view'];\n\n        $editor.removeAttr('spellcheck');\n        $editor.removeAttr('dir');\n        $editor.removeAttr('contenteditable');\n        $editor.removeAttr('placeholder');\n        $editor.removeAttr('data-gramm_editor');\n        $editor.removeClass(classesEditor.join(' '));\n\n        $container.removeClass(classesContainer.join(' '));\n\n        this._destroyEvents();\n\n        if ($editor.get().classList.length === 0) $editor.removeAttr('class');\n    },\n    enable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.addClass('redactor-in redactor-in-' + this.uuid);\n        $editor.attr({ 'contenteditable': true });\n\n        if (this.opts.structure)\n        {\n            $editor.addClass('redactor-structure');\n        }\n\n        if (this.opts.toolbar && !this.opts.air && !this.opts.toolbarExternal)\n        {\n            $container.addClass('redactor-toolbar-on');\n        }\n\n        // prevent editing\n        this._disableBrowsersEditing();\n    },\n    disable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.removeClass('redactor-in redactor-in-' + this.uuid);\n        $editor.removeClass('redactor-structure');\n        $editor.removeAttr('contenteditable');\n\n        $container.addClass('redactor-toolbar-on');\n    },\n\n    // private\n    _build: function()\n    {\n        var $editor = this.editor.getElement();\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-blur');\n\n        if (!this.opts.grammarly)\n        {\n            $editor.attr('data-gramm_editor', false);\n        }\n\n        if (this.opts.styles)\n        {\n            $editor.addClass(this.opts.stylesClass);\n            $container.addClass('redactor-styles-on');\n        }\n        else\n        {\n            $container.addClass('redactor-styles-off');\n        }\n\n        if (this.opts.buttonsTextLabeled)\n        {\n            $container.addClass('redactor-text-labeled-on');\n        }\n\n        if (this.element.isType('textarea')) $element.before($editor);\n    },\n    _buildEvents: function()\n    {\n        this.events = $R.create('editor.events', this.app);\n    },\n    _buildOptions: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr('dir', this.opts.direction);\n\n        if (this.opts.tabindex)  $editor.attr('tabindex', this.opts.tabindex);\n        if (this.opts.minHeight) $editor.css('min-height', this.opts.minHeight);\n        if (this.opts.maxHeight) $editor.css('max-height', this.opts.maxHeight);\n        if (this.opts.maxWidth)  $editor.css({ 'max-width': this.opts.maxWidth, 'margin': 'auto' });\n    },\n    _buildAccesibility: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr({ 'aria-labelledby': 'redactor-voice-' + this.uuid, 'role': 'presentation' });\n    },\n    _buildPlaceholder: function()\n    {\n        this.placeholder = $R.create('editor.placeholder', this.app);\n    },\n    _enableFocus: function()\n    {\n        if (this.opts.showSource) this._enableFocusSource();\n        else this._enableFocusEditor();\n    },\n    _enableFocusSource: function()\n    {\n        var $source = this.source.getElement();\n\n        if (this.opts.focus)\n        {\n            $source.focus();\n            $source.get().setSelectionRange(0, 0);\n        }\n        else if (this.opts.focusEnd)\n        {\n            $source.focus();\n        }\n    },\n    _enableFocusEditor: function()\n    {\n        if (this.opts.focus)\n        {\n            setTimeout(this.editor.startFocus.bind(this.editor), 100);\n        }\n        else if (this.opts.focusEnd)\n        {\n            setTimeout(this.editor.endFocus.bind(this.editor), 100);\n        }\n    },\n    _togglePlacehodler: function()\n    {\n        if (this.placeholder) this.placeholder.toggle();\n    },\n    _disableBrowsersEditing: function()\n    {\n        try {\n            // FF fix\n            document.execCommand('enableObjectResizing', false, false);\n            document.execCommand('enableInlineTableEditing', false, false);\n            // IE prevent converting links\n            document.execCommand(\"AutoUrlDetect\", false, false);\n\n            // IE disable image resizing\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            if (el.addEventListener) el.addEventListener('mscontrolselect', function(e) { e.preventDefault(); });\n            else el.attachEvent('oncontrolselect', function(e) { e.returnValue = false; });\n\n        } catch (e) {}\n    },\n    _destroyEvents: function()\n    {\n        if (this.events)\n        {\n            this.events.destroy();\n        }\n    },\n    _enableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).removeAttr('contenteditable');\n        $editor.removeAttr('contenteditable');\n        $editor.addClass('redactor-read-only');\n\n        if (this.events) this.events.destroy();\n    },\n    _disableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).attr({ 'contenteditable': true });\n        $editor.removeClass('redactor-read-only');\n        $editor.attr({ 'contenteditable': true });\n\n        this._buildEvents();\n    },\n    _getEditables: function($editor)\n    {\n        return $editor.find('figcaption, td, th');\n    }\n});\n$R.add('class', 'editor.placeholder', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.element = app.element;\n\n        // build\n        this.build();\n    },\n    build: function()\n    {\n        var $element = this.element.getElement();\n        var $editor = this.editor.getElement();\n\n        if (this.opts.placeholder !== false || $element.attr('placeholder'))\n        {\n            var text = (this.opts.placeholder !== false) ? this.opts.placeholder : $element.attr('placeholder');\n            $editor.attr('placeholder', text);\n            this.toggle();\n        }\n    },\n    toggle: function()\n    {\n        return (this.editor.isEmpty(true)) ? this.show() : this.hide();\n    },\n    show: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.addClass('redactor-placeholder');\n    },\n    hide: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('redactor-placeholder');\n    }\n});\n$R.add('class', 'editor.events', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.uuid = app.uuid;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n        this.component = app.component;\n\n        // local\n        this.blurNamespace = '.redactor-blur.' + this.uuid;\n        this.eventsList = ['paste', 'click', 'contextmenu', 'keydown', 'keyup', 'mouseup', 'touchstart',\n                           'cut', 'copy', 'dragenter', 'dragstart', 'drop', 'dragover', 'dragleave'];\n\n        // init\n        this._init();\n    },\n    destroy: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.off('.redactor-focus');\n        this.$doc.off('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace);\n\n        // all events\n        this._loop('off');\n    },\n    focus: function(e)\n    {\n        var $container = this.container.getElement();\n\n        if (this.editor.isPasting() || $container.hasClass('redactor-focus')) return;\n\n        $container.addClass('redactor-focus');\n        $container.removeClass('redactor-blur');\n\n        this.app.broadcast('observe', e);\n        this.app.broadcast('focus', e);\n\n        this.isFocused = true;\n        this.isBlured = false;\n    },\n    blur: function(e)\n    {\n        var $container = this.container.getElement();\n        var $target = $R.dom(e.target);\n        var targets = ['.redactor-in-' + this.uuid,  '.redactor-toolbar', '.redactor-dropdown',\n        '.redactor-context-toolbar', '#redactor-modal-box', '#redactor-image-resizer'];\n\n        this.app.broadcast('originalblur', e);\n        if (this.app.stopBlur) return;\n\n        if (!this.app.isStarted() || this.editor.isPasting()) return;\n        if ($target.closest(targets.join(',')).length !== 0) return;\n\n        if (!this.isBlured && !$container.hasClass('redactor-blur'))\n        {\n            $container.removeClass('redactor-focus');\n            $container.addClass('redactor-blur');\n            this.app.broadcast('blur', e);\n\n            this.isFocused = false;\n            this.isBlured = true;\n        }\n    },\n    cut: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, true);\n            e.preventDefault();\n        }\n    },\n    copy: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, false);\n            e.preventDefault();\n        }\n    },\n    drop: function(e)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        this._removeOverClass();\n\n        if (this.app.isDragComponentInside())\n        {\n            var $dragComponent = $R.dom(this.app.getDragComponentInside());\n            var $component = $dragComponent.clone(true);\n            this.insertion.insertToPoint(e, $component);\n\n            $dragComponent.remove();\n\n            this.app.setDragComponentInside(false);\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n            this.app.broadcast('image.observe', e);\n\n            e.preventDefault();\n\n            return;\n        }\n        else if (this.app.isDragInside() && this.opts.input)\n        {\n            this.insertion.insertPoint(e);\n\n            var dt = e.dataTransfer;\n            var html = dt.getData('text/html');\n\n            // clear selected\n            var range = this.selection.getRange();\n            if (range)\n            {\n                var blocks = this.selection.getBlocks();\n                range.deleteContents();\n\n                // remove empty blocks\n                for (var i = 0; i < blocks.length; i++)\n                {\n                    if (blocks[i].innerHTML === '') $R.dom(blocks[i]).remove();\n                }\n            }\n\n            // paste\n            $R.create('input.paste', this.app, e, true, html, true);\n\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n\n            this.app.setDragInside(false);\n            e.preventDefault();\n\n            return;\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('paste', e, e.dataTransfer);\n        this.app.broadcast('drop', e);\n\n    },\n    dragenter: function(e)\n    {\n        e.preventDefault();\n    },\n    dragstart: function(e)\n    {\n        this.app.setDragComponentInside(false);\n        this.app.setDragInside(false);\n\n        var data = this.inspector.parse(e.target);\n        if (data.isComponent() && !data.isComponentEditable() && !data.isFigcaption())\n        {\n            this.app.setDragComponentInside(data.getComponent());\n        }\n        else if (this.selection.is() && !this.selection.isCollapsed())\n        {\n            // drag starts inside editor\n            this.app.setDragInside(true);\n            this._setDragData(e);\n        }\n\n        this.app.broadcast('dragstart', e);\n    },\n    dragover: function(e)\n    {\n        this.app.broadcast('dragover', e);\n    },\n    dragleave: function(e)\n    {\n        this.app.broadcast('dragleave', e);\n    },\n    paste: function(e)\n    {\n        this.app.broadcast('paste', e);\n    },\n    contextmenu: function(e)\n    {\n        // chrome crashes fix\n        this.editor.disableNonEditables();\n\n        setTimeout(function()\n        {\n            this.editor.enableNonEditables();\n            this.app.broadcast('contextmenu', e);\n\n        }.bind(this), 0);\n    },\n    click: function(e)\n    {\n        // triple click selection\n        if (e.detail === 3)\n        {\n            e.preventDefault();\n\n            var block = this.selection.getBlock();\n            var range = document.createRange();\n            range.selectNodeContents(block);\n            this.selection.setRange(range)\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('click', e);\n    },\n    keydown: function(e)\n    {\n        this.app.broadcast('state', e);\n        var stop = this.app.broadcast('keydown', e);\n        if (stop === false)\n        {\n            return e.preventDefault();\n        }\n    },\n    keyup: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('keyup', e);\n    },\n    mouseup: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n    touchstart: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.on('focus.redactor-focus click.redactor-focus', this.focus.bind(this));\n        this.$doc.on('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace, this.blur.bind(this));\n\n        // all events\n        this._loop('on');\n    },\n    _removeOverClass: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('over');\n    },\n    _loop: function(func)\n    {\n        var $editor = this.editor.getElement();\n        for (var i = 0; i < this.eventsList.length; i++)\n        {\n            var event = this.eventsList[i] + '.redactor-events';\n            var method = this.eventsList[i];\n\n            $editor[func](event, this[method].bind(this));\n        }\n    },\n    _passSelectionToClipboard: function(e, data, remove)\n    {\n        var clipboard = e.clipboardData;\n        var node = data.getComponent();\n        var $node = $R.dom(node);\n        var $cloned = $node.clone();\n\n        // clean\n        $cloned.find('.redactor-component-caret').remove();\n        $cloned.removeClass('redactor-component-active');\n        $cloned.removeAttr('contenteditable');\n        $cloned.removeAttr('tabindex');\n\n        // html\n        var content = $cloned.get().outerHTML;\n\n        if (remove) this.component.remove(node);\n\n        clipboard.setData('text/html', content);\n        clipboard.setData('text/plain', content.toString().replace(/\\n$/, \"\"));\n    },\n    _setDragData: function(e)\n    {\n        e = e.originalEvent || e;\n\n        var dt = e.dataTransfer;\n        dt.effectAllowed = 'move';\n        dt.setData('text/Html', this.selection.getHtml());\n    }\n});\n$R.add('module', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.element = app.element;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.after($element);\n        $container.remove();\n        $element.show();\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-box');\n        $container.attr('dir', this.opts.direction);\n\n        if (this.element.isType('inline')) $container.addClass('redactor-inline');\n\n        $element.after($container);\n        $container.append($element);\n    },\n    _buildAccesibility: function()\n    {\n        var $container = this.container.getElement();\n        var $label = $R.dom('<span />');\n\n        $label.addClass('redactor-voice-label');\n        $label.attr({ 'id': 'redactor-voice-' + this.uuid, 'aria-hidden': false });\n        $label.html(this.lang.get('accessibility-help-label'));\n\n        $container.prepend($label);\n    }\n});\n$R.add('module', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.element = app.element;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.cleaner = app.cleaner;\n        this.component = app.component;\n        this.container = app.container;\n        this.autoparser = app.autoparser;\n        this.selection = app.selection;\n\n        // local\n        this.syncedHtml = '';\n    },\n    // messages\n    onstartcode: function()\n    {\n        var sourceContent = this.source.getStartedContent();\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n\n        // autoparse\n        if (this.opts.autoparse && this.opts.autoparseStart)\n        {\n            sourceContent = this.autoparser.parse(sourceContent);\n        }\n\n        // started content\n        var startContent = this.cleaner.input(sourceContent, true, true);\n        var syncContent = this.cleaner.output(startContent);\n\n        // set content\n        $editor.html(startContent);\n        $source.val(syncContent);\n\n        this.syncedHtml = syncContent;\n        this.app.broadcast('placeholder.build');\n        this.app.broadcast('autoparseobserve');\n\n        // widget's scripts\n        this.component.executeScripts();\n    },\n    onstartcodeshow: function()\n    {\n        this.show();\n    },\n    ontrytosync: function()\n    {\n        this.sync();\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildClasses();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $source = this.source.getElement();\n\n        $element.removeClass('redactor-source redactor-source-open');\n        $source.off('input.redactor-source');\n        $source.removeAttr('data-gramm_editor');\n\n        if ($source.get().classList.length === 0) $source.removeAttr('class');\n        if (!this.source.isNameGenerated()) $element.removeAttr('name');\n        if (!this.element.isType('textarea')) $source.remove();\n\n    },\n    getCode: function()\n    {\n        return this.source.getCode();\n    },\n\n    // public\n    toggle: function()\n    {\n        if (!this.opts.source) return;\n\n        var $source = this.source.getElement();\n\n        return ($source.hasClass('redactor-source-open')) ? this.hide() : this.show();\n    },\n    show: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n\n        if (this.app.isStarted()) html = this.app.broadcast('source.open', html);\n\n        // insert markers\n        var sourceSelection = $R.create('source.selection', this.app);\n\n        var editorHtml = sourceSelection.insertMarkersToEditor();\n        editorHtml = this.cleaner.output(editorHtml, false);\n        editorHtml = editorHtml.trim();\n\n        // get height\n        var editorHeight = $editor.height();\n\n        $editor.hide();\n        $source.height(editorHeight);\n        $source.val(html.trim());\n        $source.show();\n        $source.addClass('redactor-source-open');\n        $source.on('input.redactor-source-events', this._onChangedSource.bind(this));\n        $source.on('keydown.redactor-source-events', this._onTabKey.bind(this));\n        $source.on('focus.redactor-source-events', this._onFocus.bind(this));\n\n        $container.addClass('redactor-source-view');\n\n        // offset markers\n        sourceSelection.setSelectionOffsetSource(editorHtml);\n\n        // buttons\n        setTimeout(function()\n        {\n            this._disableButtons();\n            this._setActiveSourceButton();\n\n        }.bind(this), 100);\n\n        if (this.app.isStarted()) this.app.broadcast('source.opened');\n    },\n    hide: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n\n        // insert markers\n        var sourceSelection = $R.create('source.selection', this.app);\n        html = sourceSelection.insertMarkersToSource(html);\n\n        // clean\n        html = this.cleaner.input(html, true);\n        html = (this.utils.isEmptyHtml(html)) ? this.opts.emptyHtml : html;\n        html = this.app.broadcast('source.close', html);\n\n        // buttons\n        this._enableButtons();\n        this._setInactiveSourceButton();\n\n        $source.hide();\n        $source.removeClass('redactor-source-open');\n        $source.off('.redactor-source-events');\n        $editor.show();\n        $editor.html(html);\n\n        $container.removeClass('redactor-source-view');\n\n        setTimeout(function()\n        {\n            if (sourceSelection.isOffset()) this.selection.restoreMarkers();\n            else if (sourceSelection.isOffsetEnd()) this.editor.endFocus();\n            else this.editor.startFocus();\n\n            // widget's scripts\n            this.component.executeScripts();\n\n        }.bind(this), 0);\n\n        this.app.broadcast('source.closed');\n    },\n    sync: function()\n    {\n        var self = this;\n        var $editor = this.editor.getElement();\n        var html = $editor.html();\n\n        html = this.app.broadcast('syncBefore', html);\n        html = this.cleaner.output(html);\n\n        if (this._isSync(html))\n        {\n            if (this.timeout) clearTimeout(this.timeout);\n            this.timeout = setTimeout(function() { self._syncing(html); }, 200);\n        }\n    },\n\n    // private\n    _build: function()\n    {\n        var $source = this.source.getElement();\n        var $element = this.element.getElement();\n\n        $source.hide();\n\n        if (!this.opts.grammarly)\n        {\n            $source.attr('data-gramm_editor', false);\n        }\n\n        if (!this.element.isType('textarea'))\n        {\n            $element.after($source);\n        }\n    },\n    _buildClasses: function()\n    {\n        var $source = this.source.getElement();\n\n        $source.addClass('redactor-source');\n    },\n    _syncing: function(html)\n    {\n        html = this.app.broadcast('syncing', html);\n\n        var $source = this.source.getElement();\n        $source.val(html);\n\n        this.app.broadcast('synced', html);\n        this.app.broadcast('changed', html);\n    },\n    _isSync: function(html)\n    {\n        if (this.syncedHtml !== html)\n        {\n            this.syncedHtml = html;\n            return true;\n        }\n\n        return false;\n    },\n    _onChangedSource: function()\n    {\n        var $source = this.source.getElement();\n        var html = $source.val();\n\n        this.app.broadcast('changed', html);\n        this.app.broadcast('source.changed', html);\n    },\n    _onTabKey: function(e)\n    {\n        if (e.keyCode !== 9) return true;\n\n        e.preventDefault();\n\n        var $source = this.source.getElement();\n        var el = $source.get();\n        var start = el.selectionStart;\n\n        $source.val($source.val().substring(0, start) + \"    \" + $source.val().substring(el.selectionEnd));\n        el.selectionStart = el.selectionEnd = start + 4;\n    },\n    _onFocus: function()\n    {\n        this.app.broadcast('sourcefocus');\n    },\n    _disableButtons: function()\n    {\n        this.toolbar.disableButtons();\n    },\n    _enableButtons: function()\n    {\n        this.toolbar.enableButtons();\n    },\n    _setActiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.enable();\n        $btn.setActive();\n    },\n    _setInactiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.setInactive();\n    }\n});\n$R.add('class', 'source.selection', {\n    init: function(app)\n    {\n        this.app = app;\n        this.utils = app.utils;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.marker = app.marker;\n        this.component = app.component;\n        this.selection = app.selection;\n\n        // local\n        this.markersOffset = false;\n        this.markersOffsetEnd = false;\n    },\n    insertMarkersToEditor: function()\n    {\n        var $editor = this.editor.getElement();\n        var start = this.marker.build('start');\n        var end = this.marker.build('end');\n        var component = this.component.getActive();\n        if (component)\n        {\n            this.marker.remove();\n            var $component = $R.dom(component);\n\n            $component.after(end);\n            $component.after(start);\n        }\n        else if (window.getSelection && this.selection.is())\n        {\n            this.marker.insert('both');\n        }\n\n        return this._getHtmlAndRemoveMarkers($editor);\n    },\n    setSelectionOffsetSource: function(editorHtml)\n    {\n        var start = 0;\n        var end = 0;\n        var $source = this.source.getElement();\n        if (editorHtml !== '')\n        {\n            var startMarker = this.utils.removeInvisibleChars(this.marker.buildHtml('start'));\n            var endMarker = this.utils.removeInvisibleChars(this.marker.buildHtml('end'));\n\n            start = this._strpos(editorHtml, startMarker);\n            end = this._strpos(editorHtml, endMarker) - endMarker.toString().length - 2;\n\n            if (start === false)\n            {\n                start = 0;\n                end = 0;\n            }\n        }\n\n        $source.get().setSelectionRange(start, end);\n        $source.get().scrollTop = 0;\n\n        setTimeout(function() { $source.focus(); }.bind(this), 0);\n    },\n    isOffset: function()\n    {\n        return this.markersOffset;\n    },\n    isOffsetEnd: function()\n    {\n        return this.markersOffsetEnd;\n    },\n    insertMarkersToSource: function(html)\n    {\n        var $source = this.source.getElement();\n        var markerStart = this.marker.buildHtml('start');\n        var markerEnd = this.marker.buildHtml('end');\n\n        var markerLength = markerStart.toString().length;\n        var startOffset = this._enlargeOffset(html, $source.get().selectionStart);\n        var endOffset = this._enlargeOffset(html, $source.get().selectionEnd);\n        var sizeOffset = html.length;\n\n        if (startOffset === sizeOffset)\n        {\n            this.markersOffsetEnd = true;\n        }\n        else if (startOffset !== 0 && endOffset !== 0)\n        {\n            this.markersOffset = true;\n\n            html = html.substr(0, startOffset) + markerStart + html.substr(startOffset);\n            html = html.substr(0, endOffset + markerLength) + markerEnd + html.substr(endOffset + markerLength);\n        }\n        else\n        {\n            this.markersOffset = false;\n        }\n\n        return html;\n    },\n\n    // private\n    _getHtmlAndRemoveMarkers: function($editor)\n    {\n        var html = $editor.html();\n        $editor.find('.redactor-selection-marker').remove();\n\n        return html;\n    },\n    _strpos: function(haystack, needle, offset)\n    {\n        var i = haystack.indexOf(needle, offset);\n        return i >= 0 ? i : false;\n    },\n    _enlargeOffset: function(html, offset)\n    {\n        var htmlLength = html.length;\n        var c = 0;\n\n        if (html[offset] === '>')\n        {\n            c++;\n        }\n        else\n        {\n            for(var i = offset; i <= htmlLength; i++)\n            {\n                c++;\n\n                if (html[i] === '>')\n                {\n                    break;\n                }\n                else if (html[i] === '<' || i === htmlLength)\n                {\n                    c = 0;\n                    break;\n                }\n            }\n        }\n\n        return offset + c;\n    }\n});\n$R.add('module', 'observer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.editor = app.editor;\n\n        // local\n        this.observerUnit = false;\n    },\n    // public\n    start: function()\n    {\n        if (window.MutationObserver)\n        {\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            this.observerUnit = this._build(el);\n            this.observerUnit.observe(el, {\n                 attributes: true,\n                 subtree: true,\n                 childList: true,\n                 characterData: true,\n                 characterDataOldValue: true\n            });\n        }\n    },\n    stop: function()\n    {\n        if (this.observerUnit) this.observerUnit.disconnect();\n    },\n\n    // private\n    _build: function(el)\n    {\n        var self = this;\n        return new MutationObserver(function(mutations)\n        {\n            mutations.forEach(function(mutation)\n            {\n                self._iterate(mutation, el);\n            });\n        });\n    },\n    _iterate: function(mutation, el)\n    {\n        if (this.app.isReadOnly() || (mutation.type === 'attributes' && mutation.target === el))\n        {\n            return;\n        }\n\n        this.app.broadcast('observe');\n        this.app.broadcast('trytosync');\n        this.app.broadcast('placeholder.toggle');\n    }\n});\n$R.add('module', 'clicktoedit', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.container = app.container;\n        this.selection = app.selection;\n    },\n    // messages\n    onstartclicktoedit: function()\n    {\n        this.start();\n    },\n    onenablereadonly: function()\n    {\n        if (!this._isEnabled()) this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        if (!this._isEnabled()) this.start();\n    },\n    onstop: function()\n    {\n        this.stop();\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    stop: function()\n    {\n        if (this.buttonSave) this.buttonSave.stop();\n        if (this.buttonCancel) this.buttonCancel.stop();\n\n        this._destroy();\n        this.app.broadcast('disable');\n    },\n    enable: function()\n    {\n        this.app.broadcast('clickStart');\n\n        var isEmpty = this.editor.isEmpty();\n        if (!isEmpty) this.selection.saveMarkers();\n\n        this._setFocus();\n        this._destroy();\n        this.app.broadcast('enable');\n        this.buttonSave.enable();\n        this.buttonCancel.enable();\n\n        if (!isEmpty) this.selection.restoreMarkers();\n        if (isEmpty) this.editor.focus();\n\n        var $container = this.container.getElement();\n        $container.addClass('redactor-clicktoedit-enabled');\n    },\n    save: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.source.getCode();\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickSave', html);\n        this.app.broadcast('clickStop');\n        this._build();\n    },\n    cancel: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.saved;\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        this.saved = '';\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickCancel', html);\n        this.app.broadcast('clickStop');\n        this._build();\n    },\n\n    // private\n    _build: function()\n    {\n        // buttons\n        this.buttonSave = $R.create('clicktoedit.button', 'save', this.app, this);\n        this.buttonCancel = $R.create('clicktoedit.button', 'cancel', this.app, this);\n\n        this.buttonSave.stop();\n        this.buttonCancel.stop();\n\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.on('click.redactor-click-to-edit mouseup.redactor-click-to-edit', this.enable.bind(this));\n        $container.addClass('redactor-over');\n        $container.removeClass('redactor-clicktoedit-enabled');\n    },\n    _isEnabled: function()\n    {\n        return this.container.getElement().hasClass('redactor-clicktoedit-enabled');\n    },\n    _destroy: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.off('.redactor-click-to-edit');\n        $container.removeClass('redactor-over redactor-clicktoedit-enabled');\n    },\n    _setFocus: function()\n    {\n        this.saved = this.source.getCode();\n\n        this.buttonSave.start();\n        this.buttonCancel.start();\n    }\n});\n$R.add('class', 'clicktoedit.button', {\n    init: function(type, app, context)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.toolbar = app.toolbar;\n        this.context = context;\n\n        // local\n        this.type = type;\n        this.name = (type === 'save') ? 'clickToSave' : 'clickToCancel';\n        this.objected = false;\n        this.enabled = false;\n        this.namespace = '.redactor-click-to-edit';\n\n        // build\n        this._build();\n    },\n    enable: function()\n    {\n        if (!this.objected) return;\n\n        var data = this.opts[this.name];\n        data.api = 'module.clicktoedit.' + this.type;\n\n        this.toolbar.addButton(this.type, data);\n        this.enabled = true;\n    },\n    start: function()\n    {\n        if (this.objected) return;\n\n        this.$button.off(this.namespace);\n        this.$button.show();\n        this.$button.on('click' + this.namespace, this.context[this.type].bind(this.context));\n    },\n    stop: function()\n    {\n        if (this.objected || !this.enabled) return;\n\n        this.$button.hide();\n    },\n\n    // private\n    _build: function()\n    {\n        this.objected = (typeof this.opts[this.name] === 'object');\n\n        if (!this.objected)\n        {\n            this.$button = $R.dom(this.opts[this.name]);\n            this.enabled = true;\n        }\n    }\n});\n$R.add('module', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.element = app.element;\n        this.statusbar = app.statusbar;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        if (!this.element.isType('inline'))\n        {\n            var $statusbar = this.statusbar.getElement();\n            var $container = this.container.getElement();\n\n            $statusbar.addClass('redactor-statusbar');\n            $container.append($statusbar);\n        }\n    }\n});\n$R.add('module', 'contextbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n    },\n    // messages\n    onenablereadonly: function()\n    {\n        this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        this.start();\n    },\n    oncontextbar: {\n        close: function()\n        {\n            this.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.opts.toolbarContext)\n        {\n            var $editor = this.editor.getElement();\n\n            this._build();\n            $editor.on('click.redactor-context mouseup.redactor-context', this.open.bind(this));\n        }\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-context');\n\n        this.$doc.off('.redactor-context');\n        this.$win.off('.redactor-context');\n\n        if (this.$contextbar) this.$contextbar.remove();\n    },\n    is: function()\n    {\n        return (this.$contextbar && this.$contextbar.hasClass('open'));\n    },\n    set: function(e, node, buttons, position)\n    {\n        this.$contextbar.html('');\n        this.$el = $R.dom(node);\n\n        // buttons\n        for (var key in buttons)\n        {\n            var $btn = $R.create('contextbar.button', this.app, buttons[key]);\n            if ($btn.html() !== '')\n            {\n                this.$contextbar.append($btn);\n            }\n        }\n\n        // show\n        var pos = this._buildPosition(e, this.$el, position);\n\n        this.$contextbar.css(pos);\n        this.$contextbar.show();\n        this.$contextbar.addClass('open');\n        this.$doc.on('click.redactor-context mouseup.redactor-context', this.close.bind(this));\n        this.$win.on('resize.redactor-context', this.close.bind(this));\n    },\n    open: function(e)\n    {\n        setTimeout(function()\n        {\n            this.app.broadcast('contextbar', e, this);\n        }.bind(this), 0);\n    },\n    close: function(e)\n    {\n        if (!this.$contextbar) return;\n        if (e)\n        {\n            var $target = $R.dom(e.target);\n            if (this.$el && $target.closest(this.$el).length !== 0)\n            {\n                return;\n            }\n        }\n\n        this.$contextbar.hide();\n        this.$contextbar.removeClass('open');\n        this.$doc.off('.redactor.context');\n    },\n\n    // private\n    _build: function()\n    {\n        this.$contextbar = $R.dom('<div>');\n        this.$contextbar.attr('id', 'redactor-context-toolbar-' + this.uuid);\n        this.$contextbar.attr('dir', this.opts.direction);\n        this.$contextbar.addClass('redactor-context-toolbar');\n        this.$contextbar.hide();\n\n        this.$target.append(this.$contextbar);\n    },\n    _buildPosition: function(e, $el, position)\n    {\n        var top, left;\n        var isTarget = this.toolbar.isTarget();\n        var offset = (isTarget) ? $el.position() : $el.offset();\n        var width = $el.width();\n        var height = $el.height();\n\n        var barWidth = this.$contextbar.width();\n        var barHeight = this.$contextbar.height();\n        var docScrollTop = (isTarget) ? (this.$target.scrollTop() + this.$doc.scrollTop()) : this.$doc.scrollTop();\n\n        var targetOffset = this.$target.offset();\n        var leftFix = (isTarget) ? targetOffset.left : 0;\n        var topFix = (isTarget) ? targetOffset.top : 0;\n\n        if (!position)\n        {\n            top = (e.clientY + docScrollTop - barHeight);\n            left = (e.clientX - barWidth/2);\n        }\n        else if (position === 'top')\n        {\n            top = (offset.top - barHeight);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n        else if (position === 'bottom')\n        {\n            top = (offset.top + height);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n\n        if (left < 0) left = 0;\n\n        return { top: (top - topFix) + 'px', left: (left - leftFix) + 'px' };\n    }\n});\n$R.add('class', 'contextbar.button', {\n    mixins: ['dom'],\n    init: function(app, obj)\n    {\n        this.app = app;\n\n        // local\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n        this.attr('href', '#');\n\n        this._buildTitle();\n        this._buildMessage();\n    },\n    _buildTitle: function()\n    {\n        this.html(this.obj.title);\n    },\n    _buildMessage: function()\n    {\n        if (typeof this.obj.message !== 'undefined' || typeof this.obj.api !== 'undefined')\n        {\n            this.on('click', this._toggle.bind(this));\n        }\n    },\n    _toggle: function(e)\n    {\n        e.preventDefault();\n\n        if (this.obj.message)\n        {\n            this.app.broadcast(this.obj.message, this.obj.args);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args);\n        }\n    }\n});\n$R.add('module', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.buttons = [];\n        this.toolbarModule = false;\n    },\n    // messages\n    onsource: {\n        open: function()\n        {\n            if (!this.toolbar.isAir() && this.toolbar.isFixed())\n            {\n                this.toolbarModule.resetPosition();\n            }\n        },\n        opened: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.createSourceHelper();\n            }\n        },\n        close: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.destroySourceHelper();\n            }\n        },\n        closed: function()\n        {\n            if (this.toolbar.is() && this.opts.air)\n            {\n                this.toolbarModule.openSelected();\n            }\n        }\n    },\n    onobserve: function()\n    {\n        if (this.toolbar.is())\n        {\n            this.toolbar.observe();\n        }\n    },\n    onfocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onsourcefocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onempty: function()\n    {\n        if (this.toolbar.isFixed())\n        {\n            this.toolbarModule.resetPosition();\n        }\n    },\n    onenablereadonly: function()\n    {\n        if (this.toolbar.isAir())\n        {\n            this.toolbarModule.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.toolbar.is())\n        {\n            this._buildButtons();\n            this._initToolbar();\n            this._initButtons();\n        }\n    },\n    stop: function()\n    {\n        if (this.toolbarModule)\n        {\n            this.toolbarModule.stop();\n        }\n    },\n\n    // private\n    _buildButtons: function()\n    {\n        this.buttons = this.opts.buttons.concat();\n\n        this._buildImageButton();\n        this._buildFileButton();\n        this._buildSourceButton();\n        this._buildAdditionalButtons();\n        this._buildHiddenButtons();\n    },\n    _buildImageButton: function()\n    {\n        if (!this.opts.imageUpload) this.utils.removeFromArrayByValue(this.buttons, 'image');\n    },\n    _buildFileButton: function()\n    {\n        if (!this.opts.fileUpload) this.utils.removeFromArrayByValue(this.buttons, 'file');\n    },\n    _buildSourceButton: function()\n    {\n        if (!this.opts.source) this.utils.removeFromArrayByValue(this.buttons, 'html');\n    },\n    _buildAdditionalButtons: function()\n    {\n        // end\n        if (this.opts.buttonsAdd.length !== 0)\n        {\n            this.opts.buttonsAdd = this._removeExistButtons(this.opts.buttonsAdd);\n            this.buttons = this.buttons.concat(this.opts.buttonsAdd);\n        }\n\n        // beginning\n        if (this.opts.buttonsAddFirst.length !== 0)\n        {\n            this.opts.buttonsAddFirst = this._removeExistButtons(this.opts.buttonsAddFirst);\n            this.buttons.unshift(this.opts.buttonsAddFirst);\n        }\n\n        var index, btns;\n\n        // after\n        if (this.opts.buttonsAddAfter !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddAfter.after) + 1;\n            btns = this.opts.buttonsAddAfter.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index+i, 0, btns[i]);\n            }\n        }\n\n        // before\n        if (this.opts.buttonsAddBefore !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddBefore.before)+1;\n            btns = this.opts.buttonsAddBefore.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index-(1-i), 0, btns[i]);\n            }\n        }\n    },\n    _buildHiddenButtons: function()\n    {\n        if (this.opts.buttonsHide.length !== 0)\n        {\n            var buttons = this.opts.buttonsHide;\n            for (var i = 0; i < buttons.length; i++)\n            {\n                this.utils.removeFromArrayByValue(this.buttons, buttons[i]);\n            }\n        }\n    },\n    _removeExistButtons: function(buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            if (this.opts.buttons.indexOf(buttons[i]) !== -1)\n            {\n                this.utils.removeFromArrayByValue(buttons, buttons[i]);\n            }\n        }\n\n        return buttons;\n    },\n    _setExternalOnFocus: function()\n    {\n        if (!this.opts.air && this.opts.toolbarExternal)\n        {\n            this.toolbarModule.setExternal();\n        }\n    },\n    _initToolbar: function()\n    {\n        this.toolbarModule = (this.opts.air) ? $R.create('toolbar.air', this.app) : $R.create('toolbar.standard', this.app);\n    },\n    _initButtons: function()\n    {\n        for (var i = 0; i < this.buttons.length; i++)\n        {\n            var name = this.buttons[i];\n            if ($R.buttons[name])\n            {\n                this.toolbar.addButton(name, $R.buttons[name], false, false, true);\n            }\n        }\n    }\n});\n$R.add('class', 'toolbar.air', {\n    init: function(app)\n    {\n        this.app = app;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.clicks = 0;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-air-trigger');\n\n        this.$doc.off('.redactor-air');\n        this.$doc.off('.redactor-air-trigger');\n\n        this.toolbar.stopObservers();\n    },\n    createSourceHelper: function()\n    {\n        this.$airHelper = $R.dom('<span>');\n        this.$airHelper.addClass('redactor-air-helper');\n        this.$airHelper.html('<i class=\"re-icon-html\"></i>');\n        this.$airHelper.on('click', function(e)\n        {\n            e.preventDefault();\n            this.app.api('module.source.hide');\n\n        }.bind(this));\n\n        var $container = this.container.getElement();\n        $container.append(this.$airHelper);\n    },\n    destroySourceHelper: function()\n    {\n        if (this.$airHelper) this.$airHelper.remove();\n    },\n    openSelected: function()\n    {\n        setTimeout(function()\n        {\n            if (this._isSelection()) this._open(false);\n\n        }.bind(this), 0);\n    },\n    close: function()\n    {\n        this.$doc.off('.redactor-air');\n\n        var $toolbar = this.toolbar.getElement();\n        $toolbar.removeClass('open');\n        $toolbar.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper-air');\n        $toolbar.addClass('redactor-air');\n        //$toolbar.addClass('redactor-animate-hide');\n        $toolbar.hide();\n\n        $wrapper.append($toolbar);\n        $container.prepend($wrapper);\n\n        // open selected\n        this.openSelected();\n\n        // events\n        this.$doc.on('mouseup.redactor-air-trigger', this._open.bind(this));\n        $editor.on('keyup.redactor-air-trigger', this._openCmd.bind(this));\n    },\n    _isSelection: function()\n    {\n        return (this.selection.is() && !this.selection.isCollapsed());\n    },\n    _isOpened: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n\n        return $toolbar.hasClass('open');\n    },\n    _open: function(e)\n    {\n        var target = (e) ? e.target : false;\n        var $el = (e) ? $R.dom(e.target) : false;\n        var dataTarget = this.inspector.parse(target);\n        var isComponent = (dataTarget.isComponent() && !dataTarget.isComponentType('table'));\n        var isFigcaption = (dataTarget.isFigcaption());\n        var isModalTarget = ($el && $el.closest('.redactor-modal').length !== 0);\n        var isButtonCall = (e && $el.closest('.re-button').length !== 0);\n        var isDropdownCall = (e && $el.closest('.redactor-dropdown').length !== 0);\n\n        if (isDropdownCall || isButtonCall || isModalTarget || isFigcaption || isComponent || this.toolbar.isContextBar() || !this._isSelection())\n        {\n            return;\n        }\n\n        var pos = this.selection.getPosition();\n\n        setTimeout(function()\n        {\n            if (this.app.isReadOnly()) return;\n            if (this._isSelection()) this._doOpen(pos);\n\n        }.bind(this), 1);\n\n    },\n    _openCmd: function()\n    {\n        if (this.selection.isAll())\n        {\n            var $toolbar = this.toolbar.getElement();\n            var pos = this.selection.getPosition();\n\n            pos.top = (pos.top < 20) ? 0 : pos.top - $toolbar.height();\n            pos.height = 0;\n\n            this._doOpen(pos);\n        }\n    },\n    _doOpen: function(pos)\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $container = this.container.getElement();\n        var containerOffset = $container.offset();\n        var leftFix = 0;\n\n        $wrapper.css({\n            left: (pos.left - containerOffset.left - leftFix) + 'px',\n            top: (pos.top - containerOffset.top + pos.height + this.$doc.scrollTop()) + 'px'\n        });\n\n        this.app.broadcast('airOpen');\n        $toolbar.addClass('open');\n        $toolbar.show();\n\n        this.$doc.on('click.redactor-air', this._close.bind(this));\n        this.$doc.on('keydown.redactor-air', this._close.bind(this));\n        this.app.broadcast('airOpened');\n    },\n    _close: function(e)\n    {\n        var $el = (e) ? $R.dom(e.target) : false;\n        var isDropdownCall = (e && $el.closest('[data-dropdown], .redactor-dropdown-not-close').length !== 0);\n        var isButtonCall = (!isDropdownCall && e && $el.closest('.re-button').length !== 0);\n\n        if (!isButtonCall && (isDropdownCall || !this._isOpened()))\n        {\n            return;\n        }\n\n        // close\n        this.app.broadcast('airClose');\n\n        this.close();\n        this.app.broadcast('airClosed');\n    }\n});\n$R.add('class', 'toolbar.fixed', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n        this.container = app.container;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        this.$fixedTarget.off('.redactor-toolbar');\n        this.$win.off('.redactor-toolbar');\n    },\n    reset: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        $wrapper.css('height', '');\n        $toolbar.removeClass('redactor-toolbar-fixed');\n        $toolbar.css({ position: '', top: '', left: '', width: '' });\n\n        var dropdown = this.toolbar.getDropdown();\n        if (dropdown) dropdown.updatePosition();\n    },\n\n    // private\n    _init: function()\n    {\n        this.$fixedTarget = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$win;\n        this._doFixed();\n\n        if (this.toolbar.isTarget())\n        {\n            this.$win.on('scroll.redactor-toolbar', this._doFixed.bind(this));\n            this.$win.on('resize.redactor-toolbar', this._doFixed.bind(this));\n        }\n\n        this.$fixedTarget.on('scroll.redactor-toolbar', this._doFixed.bind(this));\n        this.$fixedTarget.on('resize.redactor-toolbar', this._doFixed.bind(this));\n    },\n    _doFixed: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        var $targets = $container.parents().filter(function(node)\n        {\n            return (getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        // has hidden parent\n        if ($targets.length !== 0) return;\n\n        var isHeight = ($editor.height() < 100);\n        var isEmpty = this.editor.isEmpty();\n\n        if (isHeight || isEmpty || this.editor.isSourceMode()) return;\n\n        /* BEGIN ORIGINAL:\n        var toolbarHeight = $toolbar.height();\n        var toleranceEnd = 60;\n        var containerOffset = $container.offset();\n        var boxOffset = containerOffset.top;\n        var boxEnd = boxOffset + $container.height() - (toleranceEnd + this.opts.toolbarFixedTopOffset);\n        var scrollOffset = this.$fixedTarget.scrollTop();\n        var top = (!this.toolbar.isTarget()) ? 0 : this.$fixedTarget.offset().top - this.$win.scrollTop();\n\n        if (scrollOffset > boxOffset && scrollOffset < boxEnd)\n        END ORIGINAL */\n        /* BEGIN HACK */\n        // Fix figuring out when to pin the toolbar and when not.\n        var toolbarHeight = $toolbar.height();\n        var toleranceEnd = 60;\n        var containerOffset = $container.offset();\n        var boxOffset = containerOffset.top;\n        var scrollOffset = this.$fixedTarget.scrollTop();\n        var top = (!this.toolbar.isTarget()) ? 0 : this.$fixedTarget.offset().top - this.$win.scrollTop();\n        var relativeTopPoint = boxOffset - toleranceEnd;\n\n        if (relativeTopPoint < 0 && Math.abs(relativeTopPoint) < $container.height() - toleranceEnd)\n        /* END HACK */\n        {\n            var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\n            top = (this.detector.isDesktop()) ? top : (scrollOffset - boxOffset + this.opts.toolbarFixedTopOffset);\n\n            if (this.detector.isMobile())\n            {\n                if (this.fixedScrollTimeout)\n                {\n                    clearTimeout(this.fixedScrollTimeout);\n                }\n\n                $toolbar.hide();\n                this.fixedScrollTimeout = setTimeout(function()\n                {\n                    $toolbar.show();\n                }, 250);\n            }\n\n            $wrapper.height(toolbarHeight);\n            $toolbar.addClass('redactor-toolbar-fixed');\n            $toolbar.css({\n                position: position,\n                top: (top + this.opts.toolbarFixedTopOffset) + 'px',\n                width: $container.width() + 'px'\n            });\n\n            var dropdown = this.toolbar.getDropdown();\n            if (dropdown) dropdown.updatePosition();\n\n            this.app.broadcast('toolbar.fixed');\n        }\n        else\n        {\n            this.reset();\n            this.app.broadcast('toolbar.unfixed');\n        }\n    }\n});\n$R.add('class', 'toolbar.standard', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n\n        // local\n        this.isExternalMultiple = false;\n        this.toolbarFixed = false;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        if (this.toolbarFixed) this.toolbarFixed.stop();\n        if (this.opts.toolbarExternal) this._findToolbars();\n\n        this.toolbar.stopObservers();\n    },\n    setExternal: function()\n    {\n        this._findToolbars();\n        if (this.isExternalMultiple)\n        {\n            this.$toolbars.hide();\n            var $current = this.$external.find('.redactor-toolbar-external-' + this.uuid);\n            $current.show();\n        }\n    },\n    resetPosition: function()\n    {\n        if (this.toolbarFixed) this.toolbarFixed.reset();\n    },\n\n    // private\n    _init: function()\n    {\n        this._build();\n\n        if (this.opts.toolbarExternal)\n        {\n            this._buildExternal();\n        }\n        else\n        {\n            this._buildFixed();\n\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _build: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper');\n        $toolbar.addClass('redactor-toolbar');\n        $toolbar.hide();\n        $wrapper.append($toolbar);\n\n        if (!this.opts.toolbarExternal)\n        {\n            var $container = this.container.getElement();\n            $container.prepend($wrapper);\n        }\n    },\n    _buildExternal: function()\n    {\n        this._initExternal();\n        this._findToolbars();\n\n        if (this.isExternalMultiple)\n        {\n            this._hideToolbarsExceptFirst();\n        }\n        else\n        {\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _buildFixed: function()\n    {\n        if (this.opts.toolbarFixed)\n        {\n            this.toolbarFixed = $R.create('toolbar.fixed', this.app);\n        }\n    },\n    _initExternal: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getElement();\n\n        $toolbar.addClass('redactor-toolbar-external redactor-toolbar-external-' + this.uuid);\n\n        this.$external = $R.dom(this.opts.toolbarExternal);\n        this.$external.append($wrapper);\n\n    },\n    _findToolbars: function()\n    {\n        this.$toolbars = this.$external.find('.redactor-toolbar-external');\n        this.isExternalMultiple = (this.$toolbars.length > 1);\n    },\n    _hideToolbarsExceptFirst: function()\n    {\n        this.$toolbars.hide();\n        var $first = this.$toolbars.first();\n        $first.show();\n    }\n});\n$R.add('module', 'line', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n    },\n    // messages\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('line'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.line.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n\n    },\n\n    // public\n    insert: function()\n    {\n        var line = this.component.create('line');\n        this.insertion.insertRaw(line);\n    },\n    remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'line.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        var wrapper, element;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var node = $node.get();\n\n            if (node.tagName === 'HR') element = node;\n            else if (node.tagName === 'FIGURE')\n            {\n                wrapper = node;\n                element = $node.find('hr').get();\n            }\n        }\n\n        this._buildWrapper(wrapper);\n        this._buildElement(element);\n        this._initWrapper();\n    },\n    _buildElement: function(node)\n    {\n        if (node)\n        {\n            this.$element = $R.dom(node);\n        }\n        else\n        {\n            this.$element = $R.dom('<hr>');\n            this.append(this.$element);\n        }\n    },\n    _buildWrapper: function(node)\n    {\n        node = node || '<figure>';\n\n        this.parse(node);\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'line',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'link', {\n    modals: {\n        'link':\n            '<form action=\"\"> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-url\">URL <span class=\"req\">*</span></label> \\\n                    <input type=\"text\" id=\"modal-link-url\" name=\"url\"> \\\n                </div> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-text\">## text ##</label> \\\n                    <input type=\"text\" id=\"modal-link-text\" name=\"text\"> \\\n                </div> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-link-title\">## title ##</label> \\\n                    <input type=\"text\" id=\"modal-link-title\" name=\"title\"> \\\n                </div> \\\n                <div class=\"form-item form-item-target\"> \\\n                    <label class=\"checkbox\"> \\\n                        <input type=\"checkbox\" name=\"target\"> ## link-in-new-tab ## \\\n                    </label> \\\n                </div> \\\n            </form>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.utils = app.utils;\n        this.inline = app.inline;\n        this.editor = app.editor;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    // messages\n    onmodal: {\n        link: {\n            open: function($modal, $form)\n            {\n                this._setFormData($form, $modal);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            update: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._update(data);\n                }\n            },\n            insert: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._insert(data);\n                }\n            },\n            unlink: function()\n            {\n                this._unlink();\n            }\n        }\n    },\n    onbutton: {\n        link: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        link: {\n            observe: function(dropdown)\n            {\n                this._observeUnlink(dropdown);\n                this._observeEdit(dropdown);\n            }\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        if (data.isLink())\n        {\n            var node = data.getLink();\n            var $el = $R.dom(node);\n\n            var $point = $R.dom('<a>');\n            var url = $el.attr('href');\n\n            $point.text(this._truncateText(url));\n            $point.attr('href', url);\n            $point.attr('target', '_blank');\n\n            var buttons = {\n                \"link\": {\n                    title: $point\n                },\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.link.open'\n                },\n                \"unlink\": {\n                    title: this.lang.get('unlink'),\n                    api: 'module.link.unlink'\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$link = this._buildCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    update: function(data)\n    {\n        this._update(data);\n    },\n    unlink: function()\n    {\n        this._unlink();\n    },\n\n    // private\n    _observeButton: function(button)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if (data.isPre() || data.isCode())\n        {\n            button.disable();\n        }\n        else\n        {\n            button.enable();\n        }\n    },\n    _observeUnlink: function(dropdown)\n    {\n        var $item = dropdown.getItem('unlink');\n        var links = this._getLinks();\n\n        if (links.length === 0) $item.disable();\n        else                    $item.enable();\n    },\n    _observeEdit: function(dropdown)\n    {\n        var current = this._getCurrent();\n        var $item = dropdown.getItem('link');\n\n        var data = this.inspector.parse(current);\n        var title = (data.isLink()) ? this.lang.get('link-edit') : this.lang.get('link-insert');\n\n        $item.setTitle(title);\n    },\n    _unlink: function()\n    {\n        this.app.api('module.modal.close');\n\n        var elms = [];\n        var nodes = this._getLinks();\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            elms.push(this.selection.getElement(nodes[i]));\n\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $link);\n        }\n        this.selection.restore();\n\n        // normalize\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = (elms[i]) ? elms[i] : this.editor.getElement();\n            this.utils.normalizeTextNodes(el);\n        }\n\n        this._resetCurrent();\n    },\n    _update: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var nodes = this._getLinks();\n        this._setLinkData(nodes, data, 'updated');\n        this._resetCurrent();\n    },\n    _insert: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var links = this._getLinks();\n        if (!this._insertSingle(links, data))\n        {\n            this._removeInSelection(links);\n            this._insertMultiple(data);\n        }\n\n        this._resetCurrent();\n    },\n    _removeInSelection: function(links)\n    {\n        this.selection.save();\n        for (var i = 0; i < links.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, links[i]);\n            var $clonedLink = $link.clone();\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $clonedLink);\n        }\n        this.selection.restore();\n    },\n    _insertMultiple: function(data)\n    {\n        var range = this.selection.getRange();\n        if (range && this._isCurrentTextChanged(data))\n        {\n            this._deleteContents(range);\n        }\n\n        var nodes = this.inline.format({ tag: 'a' });\n\n        this._setLinkData(nodes, data, 'inserted');\n    },\n    _insertSingle: function(links, data)\n    {\n        var inline = this.selection.getInline();\n        if (links.length === 1 && (links[0].textContext === this.selection.getText()) || (inline && inline.tagName === 'A'))\n        {\n            var $link = $R.create('link.component', this.app, links[0]);\n\n            $link.setData(data);\n            this.selection.setAll($link);\n\n            // callback\n            this.app.broadcast('link.inserted', $link);\n\n            return true;\n        }\n\n        return false;\n    },\n    _setLinkData: function(nodes, data, type)\n    {\n        data.text = (data.text.trim() === '') ? this._truncateText(data.url) : data.text;\n\n        var isTextChanged = (!this.currentText || this.currentText !== data.text);\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            var linkData = {};\n\n            if (data.text && isTextChanged) linkData.text = data.text;\n            if (data.url) linkData.url = data.url;\n            if (data.title !== undefined) linkData.title = data.title;\n            if (data.target !== undefined) linkData.target = data.target;\n\n            $link.setData(linkData);\n\n            // callback\n            this.app.broadcast('link.' + type, $link);\n        }\n\n        setTimeout(this.selection.restore.bind(this.selection), 0);\n    },\n    _deleteContents: function(range)\n    {\n        var html = this.selection.getHtml();\n        var parsed = this.utils.parseHtml(html);\n        var first = parsed.nodes[0];\n\n        if (first && first.nodeType !== 3)\n        {\n            var tag = first.tagName.toLowerCase();\n            var container = document.createElement(tag);\n\n            this.insertion.insertNode(container, 'start');\n        }\n        else\n        {\n            range.deleteContents();\n        }\n    },\n    _getModalData: function()\n    {\n        var commands;\n        if (this._isLink())\n        {\n           commands = {\n                update: { title: this.lang.get('save') },\n                unlink: { title: this.lang.get('unlink'), type: 'danger' },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n        else\n        {\n            commands = {\n                insert: { title: this.lang.get('insert') },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n\n        var modalData = {\n            name: 'link',\n            title: (this._isLink()) ? this.lang.get('link-edit') : this.lang.get('link-insert'),\n            handle: (this._isLink()) ? 'update' : 'insert',\n            commands: commands\n        };\n\n\n        return modalData;\n    },\n    _isLink: function()\n    {\n        return this.currentLink;\n    },\n    _isCurrentTextChanged: function(data)\n    {\n        return (this.currentText && this.currentText !== data.text);\n    },\n    _buildCurrent: function()\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        var $link;\n\n        if (data.isLink())\n        {\n            this.currentLink = true;\n\n            $link = data.getLink();\n            $link = $R.create('link.component', this.app, $link);\n        }\n        else\n        {\n            this.currentLink = false;\n\n            $link = $R.create('link.component', this.app);\n            var linkData = {\n                text: this.selection.getText()\n            };\n\n            $link.setData(linkData);\n        }\n\n        return $link;\n    },\n    _getCurrent: function()\n    {\n        return this.selection.getInlinesAllSelected({ tags: ['a'] })[0];\n    },\n    _getLinks: function()\n    {\n        var links = this.selection.getInlines({ all: true, tags: ['a'] });\n        var arr = [];\n        for (var i = 0; i < links.length; i++)\n        {\n            var data = this.inspector.parse(links[i]);\n            if (data.isLink())\n            {\n                arr.push(links[i]);\n            }\n        }\n\n        return arr;\n    },\n    _resetCurrent: function()\n    {\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    _truncateText: function(url)\n    {\n        return (url.length > this.opts.linkSize) ? url.substring(0, this.opts.linkSize) + '...' : url;\n    },\n    _validateData: function($form, data)\n    {\n        return (data.url.trim() === '') ? $form.setError('url') : true;\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('url').focus();\n    },\n    _setFormData: function($form, $modal)\n    {\n        var linkData = this.$link.getData();\n        var data = {\n            url: linkData.url,\n            text: linkData.text,\n            title: linkData.title,\n            target: (this.opts.linkTarget || linkData.target)\n        };\n\n        if (!this.opts.linkNewTab) $modal.find('.form-item-target').hide();\n        if (!this.opts.linkTitle) $modal.find('.form-item-title').hide();\n\n        $form.setData(data);\n        this.currentText = $form.getField('text').val();\n    }\n});\n$R.add('class', 'link.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.reUrl = /^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el :  this._init(el);\n    },\n\n    // public\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['url', 'text', 'target', 'title'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            this.parse($el);\n        }\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _get_target: function()\n    {\n        return (this.attr('target')) ? this.attr('target') : false;\n    },\n    _get_url: function()\n    {\n        return this.attr('href');\n    },\n    _get_title: function()\n    {\n        return this.attr('title');\n    },\n    _get_text: function()\n    {\n        return this._getContext().text();\n    },\n    _getContext: function()\n    {\n        return this._findDeepestChild(this).element;\n    },\n    _set_target: function(target)\n    {\n        if (target === false) this.removeAttr('target');\n        else if (target)\n        {\n            this.attr('target', (target === true) ? '_blank' : target);\n        }\n    },\n    _set_text: function(text)\n    {\n        this._getContext().html(text);\n    },\n    _set_title: function(title)\n    {\n        if (!title || title === '') this.removeAttr('title');\n        else this.attr('title', title);\n    },\n    _set_url: function(url)\n    {\n        if (this.opts.linkValidation)\n        {\n            url = this._cleanUrl(url);\n\n            if (this._isMailto(url))\n            {\n                url = 'mailto:' + url.replace('mailto:', '');\n            }\n            else if (this._isUrl(url) && url.search(/^(ftp|https?)/i) === -1)\n            {\n                url = 'http://' + url.replace(/(ftp|https?):\\/\\//i, '');\n            }\n        }\n\n        this.attr('href', url);\n    },\n    _isMailto: function(url)\n    {\n        return (url.search('@') !== -1 && /(ftp|https?):\\/\\//i.test(url) === false);\n    },\n    _isUrl: function(url)\n    {\n        return this.reUrl.test(url);\n    },\n    _cleanUrl: function(url)\n    {\n        return url.trim().replace(/[^\\W\\w\\D\\d+&\\'@#/%?=~_|!:,.;\\(\\)]/gi, '');\n    },\n    _findDeepestChild: function(parent)\n    {\n        var result = {depth: 0, element: parent };\n\n        parent.children().each(function(node)\n        {\n            var child = $R.dom(node);\n\n            if (node.outerHTML !== parent.html())\n            {\n                return;\n            }\n            else\n            {\n                var childResult = this._findDeepestChild(child);\n                if (childResult.depth + 1 > result.depth)\n                {\n                    result = {\n                        depth: 1 + childResult.depth,\n                        element: childResult.element\n                    };\n                }\n            }\n        }.bind(this));\n\n        return result;\n    }\n});\n$R.add('module', 'modal', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.animate = app.animate;\n        this.detector = app.detector;\n        this.selection = app.selection;\n\n        // local\n        this.$box = false;\n        this.$modal = false;\n\n        // defaults\n        this.defaults = {\n            name: false,\n            url: false,\n            title: false,\n            width: '600px',\n            height: false,\n            handle: false,\n            commands: false\n        };\n    },\n    // public\n    build: function(data)\n    {\n        this._open(data);\n    },\n    close: function()\n    {\n        this._close();\n    },\n    stop: function()\n    {\n        if (this.$box)\n        {\n            this.$box.remove();\n            this.$box = false;\n            this.$modal = false;\n\n            this.$doc.off('.redactor.modal');\n            this.$win.off('.redactor.modal');\n        }\n\n        if (this.$overlay)\n        {\n            this.$overlay.remove();\n        }\n    },\n    resize: function()\n    {\n        this.$modal.setWidth(this.p.width);\n        this.$modal.updatePosition();\n    },\n\n    // private\n    _isOpened: function()\n    {\n        return (this.$modal && this.$modal.hasClass('open'));\n    },\n    _open: function(data)\n    {\n        this._buildDefaults(data);\n\n        if (this.p.url) this._openUrl();\n        else this._openTemplate();\n    },\n    _openUrl: function()\n    {\n        $R.ajax.post({\n            url: this.p.url,\n            success: this._doOpen.bind(this)\n        });\n    },\n    _openTemplate: function()\n    {\n        if (typeof $R.modals[this.p.name] !== 'undefined')\n        {\n            var template = this.lang.parse($R.modals[this.p.name]);\n            this._doOpen(template);\n        }\n    },\n    _doOpen: function(template)\n    {\n        this.stop();\n        this.selection.save();\n\n        if (!this.detector.isDesktop())\n        {\n            document.activeElement.blur();\n        }\n\n        this._createModal(template);\n\n        this._buildModalBox();\n        this._buildOverlay();\n        this._buildModal();\n        this._buildModalForm();\n        this._buildModalCommands();\n\n        this._broadcast('open');\n\n        this.$modal.updatePosition();\n        this._buildModalTabs();\n\n        this.animate.start(this.$box, 'fadeIn', this._opened.bind(this));\n        this.animate.start(this.$overlay, 'fadeIn');\n\n    },\n    _opened: function()\n    {\n        this.$modal.addClass('open');\n        this.$box.on('mousedown.redactor.modal', this._close.bind(this));\n        this.$doc.on('keyup.redactor.modal', this._handleEscape.bind(this));\n        this.$win.on('resize.redactor.modal', this.resize.bind(this));\n        this.$modal.getBody().find('input[type=text],input[type=url],input[type=email]').on('keydown.redactor.modal', this._handleEnter.bind(this));\n\n        // fix bootstrap modal focus\n        if (window.jQuery) jQuery(document).off('focusin.modal');\n\n        this._broadcast('opened');\n    },\n    _close: function(e)\n    {\n        if (!this.$box || !this._isOpened()) return;\n\n        if (e)\n        {\n            if (!this._needToClose(e.target))\n            {\n                return;\n            }\n\n            e.stopPropagation();\n            e.preventDefault();\n        }\n\n        this.selection.restore();\n\n        this._broadcast('close');\n\n        this.animate.start(this.$box, 'fadeOut', this._closed.bind(this));\n        this.animate.start(this.$overlay, 'fadeOut');\n    },\n    _closed: function()\n    {\n        this.$modal.removeClass('open');\n        this.$box.off('.redactor.modal');\n        this.$doc.off('.redactor.modal');\n        this.$win.off('.redactor.modal');\n\n        this._broadcast('closed');\n    },\n    _createModal: function(template)\n    {\n        this.$modal = $R.create('modal.element', this.app, template);\n    },\n    _broadcast: function(message)\n    {\n        this.app.broadcast('modal.' + message, this.$modal, this.$modalForm);\n        this.app.broadcast('modal.' + this.p.name + '.' + message, this.$modal, this.$modalForm);\n    },\n    _buildDefaults: function(data)\n    {\n         this.p = $R.extend({}, this.defaults, data);\n    },\n    _buildModalBox: function()\n    {\n        this.$box = $R.dom('<div>');\n        this.$box.attr('id', 'redactor-modal');\n        this.$box.addClass('redactor-animate-hide');\n        this.$box.html('');\n        this.$body.append(this.$box);\n    },\n    _buildOverlay: function()\n    {\n        this.$overlay = $R.dom('#redactor-overlay');\n        if (this.$overlay.length === 0)\n        {\n            this.$overlay = $R.dom('<div>');\n            this.$overlay.attr('id', 'redactor-overlay');\n            this.$overlay.addClass('redactor-animate-hide');\n            this.$body.prepend(this.$overlay);\n        }\n    },\n    _buildModal: function()\n    {\n        this.$box.append(this.$modal);\n\n        this.$modal.setTitle(this.p.title);\n        this.$modal.setHeight(this.p.height);\n        this.$modal.setWidth(this.p.width);\n    },\n    _buildModalCommands: function()\n    {\n        if (this.p.commands)\n        {\n            var commands = this.p.commands;\n            var $footer = this.$modal.getFooter();\n            for (var key in commands)\n            {\n                var $btn = $R.dom('<button>');\n\n                $btn.html(commands[key].title);\n                $btn.attr('data-command', key);\n\n                // cancel\n                if (key === 'cancel')\n                {\n                    $btn.attr('data-action', 'close');\n                    $btn.addClass('redactor-button-unstyled');\n                }\n\n                // danger\n                if (typeof commands[key].type !== 'undefined' && commands[key].type === 'danger')\n                {\n                    $btn.addClass('redactor-button-danger');\n                }\n\n                $btn.on('click', this._handleCommand.bind(this));\n\n                $footer.append($btn);\n            }\n        }\n\n    },\n    _buildModalTabs: function()\n    {\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n        var $box = $body.find('.redactor-modal-tabs');\n\n        if ($tabs.length > 1)\n        {\n            $box = ($box.length === 0) ? $R.dom('<div>') : $box.html('');\n            $box.addClass('redactor-modal-tabs');\n\n            $tabs.each(function(node, i)\n            {\n                var $node = $R.dom(node);\n                var $item = $R.dom('<a>');\n                $item.attr('href', '#');\n                $item.attr('rel', i);\n                $item.text($node.attr('data-title'));\n                $item.on('click', this._showTab.bind(this));\n\n                if (i === 0)\n                {\n                    $item.addClass('active');\n                }\n\n                $box.append($item);\n\n            }.bind(this));\n\n            $body.prepend($box);\n        }\n    },\n    _buildModalForm: function()\n    {\n        this.$modalForm = $R.create('modal.form', this.app, this.$modal.getForm());\n    },\n    _showTab: function(e)\n    {\n        e.preventDefault();\n\n        var $el = $R.dom(e.target);\n        var index = $el.attr('rel');\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n\n        $tabs.hide();\n        $tabs.eq(index).show();\n\n        $body.find('.redactor-modal-tabs a').removeClass('active');\n        $el.addClass('active');\n\n    },\n    _needToClose: function(el)\n    {\n        var $target = $R.dom(el);\n        if ($target.attr('data-action') === 'close' || this.$modal.isCloseNode(el) || $target.closest('.redactor-modal').length === 0)\n        {\n            return true;\n        }\n\n        return false;\n    },\n    _handleCommand: function(e)\n    {\n        var $btn = $R.dom(e.target).closest('button');\n        var command = $btn.attr('data-command');\n\n        if (command !== 'cancel') e.preventDefault();\n\n        this._broadcast(command);\n\n    },\n    _handleEnter: function(e)\n    {\n        if (e.which === 13)\n        {\n            if (this.p.handle)\n            {\n                e.preventDefault();\n                this._broadcast(this.p.handle);\n            }\n        }\n    },\n    _handleEscape: function(e)\n    {\n        if (e.which === 27) this._close();\n    }\n});\n$R.add('class', 'modal.element', {\n    mixins: ['dom'],\n    init: function(app, template)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$win = app.$win;\n\n        // init\n        this._init(template);\n    },\n\n    // get\n    getForm: function()\n    {\n        return this.find('form');\n    },\n    getHeader: function()\n    {\n        return this.$modalHeader;\n    },\n    getBody: function()\n    {\n        return this.$modalBody;\n    },\n    getFooter: function()\n    {\n        return this.$modalFooter;\n    },\n\n    // set\n    setTitle: function(title)\n    {\n        if (title) this.$modalHeader.html(title);\n    },\n    setWidth: function(width)\n    {\n        width = (parseInt(width) >= this.$win.width()) ? '96%' : width;\n\n        this.css('max-width', width);\n    },\n    setHeight: function(height)\n    {\n        if (height !== false) this.$modalBody.css('height', height);\n    },\n\n    // update\n    updatePosition: function()\n    {\n        var width = this.width();\n        this.css({ 'left': '50%', 'margin-left': '-' + (width/2) + 'px' });\n\n        var windowHeight = this.$win.height();\n        var height = this.height();\n        var marginTop = (windowHeight/2 - height/2);\n\n        if (height < windowHeight && marginTop !== 0)\n        {\n            this.css('margin-top', marginTop + 'px');\n        }\n    },\n\n    // is\n    isCloseNode: function(el)\n    {\n        return (el === this.$modalClose.get());\n    },\n\n    // private\n    _init: function(template)\n    {\n        this._build();\n        this._buildClose();\n        this._buildHeader();\n        this._buildBody();\n        this._buildFooter();\n        this._buildTemplate(template);\n    },\n    _build: function()\n    {\n        this.parse('<div>');\n        this.addClass('redactor-modal');\n        this.attr('dir', this.opts.direction);\n    },\n    _buildClose: function()\n    {\n        this.$modalClose = $R.dom('<span>');\n        this.$modalClose.addClass('redactor-close');\n\n        this.append(this.$modalClose);\n    },\n    _buildHeader: function()\n    {\n        this.$modalHeader = $R.dom('<div>');\n        this.$modalHeader.addClass('redactor-modal-header');\n\n        this.append(this.$modalHeader);\n    },\n    _buildBody: function()\n    {\n        this.$modalBody = $R.dom('<div>');\n        this.$modalBody.addClass('redactor-modal-body');\n\n        this.append(this.$modalBody);\n    },\n    _buildFooter: function()\n    {\n        this.$modalFooter = $R.dom('<div>');\n        this.$modalFooter.addClass('redactor-modal-footer');\n\n        this.append(this.$modalFooter);\n    },\n    _buildTemplate: function(template)\n    {\n        this.$modalBody.html(template);\n    }\n});\n$R.add('class', 'modal.form', {\n    mixins: ['dom'],\n    init: function(app, element)\n    {\n        this.app = app;\n\n        // build\n        this.build(element);\n    },\n\n    // public\n    build: function(element)\n    {\n        this.parse(element);\n    },\n    getData: function()\n    {\n        var data = {};\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            data[$node.attr('name')] = $node.val();\n        });\n\n        return data;\n    },\n    setData: function(data)\n    {\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var name = $node.attr('name');\n            if (data.hasOwnProperty(name))\n            {\n                if (node.type && node.type === 'checkbox') node.checked = data[name];\n                else $node.val(data[name]);\n            }\n        });\n    },\n    getField: function(name)\n    {\n        return this.find('[name=' + name + ']');\n    },\n    setError: function(name)\n    {\n        var $el = this.getField(name);\n\n        $el.addClass('error');\n        $el.one(this._getFieldEventName($el.get()), this._clearError);\n\n        return false;\n    },\n\n    // private\n    _clearError: function()\n    {\n        return $R.dom(this).removeClass('error');\n    },\n    _getFieldEventName: function(el)\n    {\n        return (el.tagName === 'SELECT' || el.type === 'checkbox' || el.type === 'radio') ? 'change' : 'keyup';\n    }\n});\n$R.add('module', 'block', {\n    init: function(app)\n    {\n        this.app = app;\n        this.block = app.block;\n    },\n    // public\n    format: function(args)\n    {\n        var nodes = this.block.format(args);\n\n        // callback\n        this.app.broadcast('format', 'block', nodes);\n    },\n    clearformat: function()\n    {\n        this.block.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.block.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.block.clearClass();\n    },\n    clearattr: function()\n    {\n        this.block.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.block.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.block.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.block.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.block.remove(args, tags);\n    }\n});\n$R.add('module', 'inline', {\n    init: function(app)\n    {\n        this.app = app;\n        this.inline = app.inline;\n    },\n    format: function(args)\n    {\n        var nodes = this.inline.format(args);\n\n        // callback\n        this.app.broadcast('format', 'inline', nodes);\n    },\n    clearformat: function()\n    {\n        this.inline.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.inline.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.inline.clearClass();\n    },\n    clearattr: function()\n    {\n        this.inline.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.inline.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.inline.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.inline.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.inline.remove(args, tags);\n    }\n});\n$R.add('module', 'autosave', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.source = app.source;\n    },\n    // messages\n    onsynced: function()\n    {\n        if (this.opts.autosave)\n        {\n            this._send();\n        }\n    },\n\n    // private\n    _send: function()\n    {\n        var name = (this.opts.autosaveName) ? this.opts.autosaveName : this.source.getName();\n\n        var data = {};\n        data[name] = this.source.getCode();\n        data = this.utils.extendData(data, this.opts.autosaveData);\n\n        $R.ajax.post({\n            url: this.opts.autosave,\n            data: data,\n            success: function(response)\n            {\n                this._complete(response, name, data);\n            }.bind(this)\n        });\n    },\n    _complete: function(response, name, data)\n    {\n        var callback = (response && response.error) ? 'autosaveError' : 'autosave';\n        this.app.broadcast(callback, name, data, response);\n    }\n});\n$R.add('module', 'input', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.element = app.element;\n        this.selection = app.selection;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.lastShiftKey = false;\n    },\n    // messages\n    onpaste: function(e, dataTransfer)\n    {\n        if (!this.opts.input) return;\n\n        return $R.create('input.paste', this.app, e, dataTransfer);\n    },\n    onkeydown: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shortcuts\n        var shortcut = $R.create('input.shortcut', this.app, e);\n        if (shortcut.is()) return;\n\n        // select all\n        if ((e.ctrlKey || e.metaKey) && !e.altKey && key === 65)\n        {\n            e.preventDefault();\n            return this._selectAll();\n        }\n\n        // set empty if all selected\n        var keys = [this.keycodes.ENTER, this.keycodes.SPACE, this.keycodes.BACKSPACE, this.keycodes.DELETE];\n        if (this.selection.isAll() && (keys.indexOf(key) !== -1))\n        {\n            e.preventDefault();\n\n            if (this.element.isType('inline'))\n            {\n                var $editor = this.editor.getElement();\n                $editor.html('');\n\n                this.editor.startFocus();\n            }\n            else\n            {\n                this.insertion.set(this.opts.emptyHtml);\n            }\n\n            return;\n        }\n\n        // autoparse\n        if (this.opts.autoparse)\n        {\n            this.autoparser.format(e, key);\n        }\n\n        // a-z, 0-9 - non editable\n        if ((!e.ctrlKey && !e.metaKey) && ((key >= 48 && key <= 57) || (key >= 65 && key <= 90)))\n        {\n            // has non-editable\n            if (this.selection.hasNonEditable())\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // enter, shift/ctrl + enter\n        if (key === this.keycodes.ENTER)\n        {\n            return $R.create('input.enter', this.app, e, key);\n        }\n        // cmd + [\n        else if (e.metaKey && key === 219)\n        {\n            e.preventDefault();\n            this.app.api('module.list.outdent');\n            return;\n        }\n        // tab or cmd + ]\n        else if (key === this.keycodes.TAB || e.metaKey && key === 221)\n        {\n            return $R.create('input.tab', this.app, e, key);\n        }\n        // space\n        else if (key === this.keycodes.SPACE)\n        {\n            return $R.create('input.space', this.app, e, key, this.lastShiftKey);\n        }\n        // backspace or delete\n        else if (this._isDeleteKey(key))\n        {\n            return $R.create('input.delete', this.app, e, key);\n        }\n        else if (this._isArrowKey(key))\n        {\n            return $R.create('input.arrow', this.app, e, key);\n        }\n    },\n    onkeyup: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shift key\n        this.lastShiftKey = e.shiftKey;\n\n        // hide context toolbar\n        this.app.broadcast('contextbar.close');\n\n        // shortcode\n        var shortcode = $R.create('input.shortcode', this.app, e, key);\n        if (shortcode.is()) return;\n\n        // is empty\n        if (key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n            html = html.replace(/<br\\s?\\/?>/g, '');\n            html = html.replace(/<div><\\/div>/, '');\n\n            if (html === '')\n            {\n                e.preventDefault();\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                return;\n            }\n        }\n\n        if (this.editor.isEmpty())\n        {\n            this.app.broadcast('empty');\n        }\n    },\n\n    // public\n    start: function()\n    {\n        // extend shortcuts\n        if (this.opts.shortcutsAdd)\n        {\n            this.opts.shortcuts = $R.extend({}, true, this.opts.shortcuts, this.opts.shortcutsAdd);\n        }\n    },\n\n    // private\n    _selectAll: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var el;\n\n        if (data.isComponentType('table'))\n        {\n            el = data.getTable();\n            this.selection.setAll(el);\n            return;\n        }\n        else if (data.isComponentType('code'))\n        {\n            el = data.getComponentCodeElement();\n            this.selection.setAll(el);\n            return;\n        }\n\n        this.selection.setAll();\n    },\n    _isArrowKey: function(key)\n    {\n        return ([this.keycodes.UP, this.keycodes.DOWN, this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(key) !== -1);\n    },\n    _isDeleteKey: function(key)\n    {\n        return (key === this.keycodes.BACKSPACE || key === this.keycodes.DELETE);\n    }\n});\n$R.add('class', 'input.arrow', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.marker = app.marker;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._isRightLeftKey() && this._isExitVariable(e)) return;\n\n        if (this._isRightDownKey())\n        {\n            if (this._isExitOnDownRight(e)) return;\n            if (this._selectComponent(e, 'End', 'next')) return;\n        }\n\n        if (this._isLeftUpKey())\n        {\n            if (this._isExitOnUpLeft(e)) return;\n            if (this._selectComponent(e, 'Start', 'prev')) return;\n        }\n\n        if (this._isRightLeftKey())\n        {\n            this._removeInvisibleSpace();\n        }\n    },\n    _isRightDownKey: function()\n    {\n        return ([this.keycodes.DOWN, this.keycodes.RIGHT].indexOf(this.key) !== -1);\n    },\n    _isLeftUpKey: function()\n    {\n        return ([this.keycodes.UP, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isRightLeftKey: function()\n    {\n        return ([this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isExitVariable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponentType('variable') && data.isComponentActive())\n        {\n            e.preventDefault();\n            var func = (this.key === this.keycodes.LEFT) ? 'setBefore' : 'setAfter';\n            this.caret[func](component);\n            return;\n        }\n    },\n    _isExitOnUpLeft: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(current);\n        var prev = block.previousElementSibling;\n        var isStart = this.caret.isStart(block);\n\n        // prev table\n        if (isStart && prev && prev.tagName === 'TABLE')\n        {\n            e.preventDefault();\n            this.caret.setEnd(prev);\n            return true;\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            var $component = $R.dom(block).closest('.redactor-component');\n            if (isStart && $component.length !== 0)\n            {\n                e.preventDefault();\n                this.caret.setEnd($component);\n                return true;\n            }\n        }\n        // exit table\n        else if (data.isTable() && isStart)\n        {\n            e.preventDefault();\n            this.caret.setEnd(block.previousElementSibling);\n            return true;\n        }\n        // component\n        else if (!data.isComponentEditable() && data.isComponent() && !data.isComponentType('variable'))\n        {\n            var component = data.getComponent();\n            if (component.previousElementSibling)\n            {\n                e.preventDefault();\n                this.component.clearActive();\n                this.caret.setEnd(component.previousElementSibling);\n                return true;\n            }\n        }\n    },\n    _isExitOnDownRight: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isEndEditor = this.caret.isEnd();\n        var block, isEnd;\n\n        // table\n        if (data.isTable())\n        {\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            var component = data.getComponent();\n            var pre = $R.dom(data.getComponentCodeElement()).closest('pre');\n\n            isEnd = this.caret.isEnd(block);\n\n            var isNext = (pre && pre.get().nextElementSibling);\n            if (isEnd && !isNext)\n            {\n                return this._exitNextElement(e, component);\n            }\n        }\n        // pre & blockquote & dl\n        else if (data.isPre() || data.isBlockquote() || data.isDl())\n        {\n            if (isEndEditor)\n            {\n                if (data.isPre()) return this._exitNextElement(e, data.getPre());\n                else if (data.isBlockquote()) return this._exitNextElement(e, data.getBlockquote());\n                else if (data.isDl()) return this._exitNextElement(e, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var $list = $R.dom(current).parents('ul, ol', $editor).last();\n            isEnd = this.caret.isEnd($list);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, $list.get());\n            }\n        }\n        // component\n        else if (data.isComponent() && !data.isComponentType('variable'))\n        {\n            this.component.clearActive();\n            return this._exitNextElement(e, data.getComponent());\n        }\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextElementSibling) this.caret.setStart(node.nextElementSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _removeInvisibleSpace: function()\n    {\n        var current = this.selection.getCurrent();\n        var isEmpty = (current) ? this.utils.isEmptyHtml(((current.nodeType === 3) ? current.textContent : current.innerHTML)) : false;\n        if (isEmpty && current && current.nodeType === 3 && this.utils.searchInvisibleChars(current.textContent) === 0)\n        {\n            current.parentNode.removeChild(current);\n        }\n    },\n    _selectComponent: function(e, caret, type)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var sibling = this.utils.findSiblings(current, type);\n        var siblingBlock = this.utils.findSiblings(block, type);\n\n        if (sibling && this.caret['is' + caret](current))\n        {\n            this._selectComponentItem(e, sibling, caret);\n        }\n        else if (siblingBlock && this.caret['is' + caret](block))\n        {\n            this._selectComponentItem(e, siblingBlock, caret);\n        }\n    },\n    _selectComponentItem: function(e, item, caret)\n    {\n        if (this.component.isNonEditable(item))\n        {\n            e.preventDefault();\n            this.caret['set' + caret](item);\n            return true;\n        }\n    }\n});\n$R.add('class', 'input.delete', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._removeActiveComponent(e)) return;\n        if (this._removeAllSelectedTable(e)) return;\n\n        // is empty\n        if (this.key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n\n            if (html === this.opts.emptyHtml)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // variable or non editable prev/next or selection\n        if (this._detectVariableOrNonEditable() || this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // collapsed\n        if (this.selection.isCollapsed())\n        {\n            // next / prev\n            if (this.key === this.keycodes.BACKSPACE) this._traverseBackspace(e);\n            else if (this.key === this.keycodes.DELETE) this._traverseDelete(e);\n        }\n\n        this._removeInvisibleSpace();\n        this._removeUnwantedStyles();\n        this._removeEmptySpans();\n        this._removeSpanTagsInHeadings();\n        this._removeInlineTagsInPre();\n    },\n    _detectVariableOrNonEditable: function()\n    {\n        var block = this.selection.getBlock();\n        var isBlockStart = this.caret.isStart(block);\n        var isBlockEnd = this.caret.isEnd(block);\n        var el;\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isBlockStart)\n        {\n            el = block.previousSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isBlockEnd)\n        {\n            el = block.nextSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n\n        var current = this.selection.getCurrent();\n        var isCurrentStart = this.caret.isStart(current);\n        var isCurrentEnd = this.caret.isEnd(current);\n        var isCurrentStartSpace = (this.selection.getTextBeforeCaret().trim() === '');\n        var isCurrentEndSpace = (this.selection.getTextAfterCaret().trim() === '');\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isCurrentStart && !isCurrentStartSpace)\n        {\n            el = current.previousSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setEnd(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isCurrentEnd && !isCurrentEndSpace)\n        {\n            el = current.nextSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setStart(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n    },\n    _isVariable: function(node)\n    {\n        return ($R.dom(node).closest('[data-redactor-type=\"variable\"]').length !== 0);\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    },\n    _getBlock: function()\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n\n        block = (data.isList()) ? $R.dom(block).parents('ul, ol', $editor).last().get() : block;\n        block = (data.isDl()) ? data.getDl() : block;\n        block = (data.isTable()) ? data.getTable() : block;\n\n        return block;\n    },\n    _traverseDelete: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isEnd, $next;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // next\n        block = this._getBlock();\n        var next = this.utils.findSiblings(block, 'next');\n        if (!next) return;\n\n        isEnd = this.caret.isEnd(block);\n        var dataNext = this.inspector.parse(next);\n        var isNextBlock = (next.tagName === 'P' || next.tagName === 'DIV');\n\n        // figure/code or table\n        if (isEnd && dataNext.isComponentEditable())\n        {\n            e.preventDefault();\n            this.component.remove(next, false);\n            return;\n        }\n        // component\n        else if (isEnd && dataNext.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(next);\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // combine list\n        else if (isEnd && dataNext.isList())\n        {\n            var $currentList = $R.dom(block);\n            $next = $R.dom(next);\n\n            // current list\n            if (data.isList())\n            {\n                e.preventDefault();\n\n                $currentList.append($next);\n                $next.unwrap();\n\n                return;\n            }\n            else\n            {\n                var $first = $next.children('li').first();\n                var $lists = $first.find('ul, ol');\n\n                if ($lists.length !== 0)\n                {\n                    e.preventDefault();\n\n                    $next.prepend($lists);\n                    $lists.unwrap();\n\n                    $currentList.append($first);\n                    $first.unwrap();\n\n                    return;\n                }\n            }\n        }\n        // block\n        else if (isEnd && !data.isTable() && isNextBlock && !this.utils.isEmptyHtml(block.innerHTML))\n        {\n            e.preventDefault();\n\n            var $current = $R.dom(block);\n            $next = $R.dom(next);\n\n            $current.append($next);\n            $next.unwrap();\n\n            return;\n        }\n    },\n    _traverseBackspace: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isStart, $prev, $currentList;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            if (isStart)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isStart = this.caret.isStart(block);\n\n            if (isStart && block.previousElementSibling)\n            {\n                e.preventDefault();\n                this.caret.setEnd(block.previousElementSibling);\n                return true;\n            }\n        }\n\n        // prev\n        block = this._getBlock();\n        var prev = this.utils.findSiblings(block, 'prev');\n\n        if (!prev)\n        {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n\n        isStart = this.caret.isStart(block);\n        var dataPrev = this.inspector.parse(prev);\n        var isPrevBlock = (prev.tagName === 'P' || prev.tagName === 'DIV');\n\n        // figure/code or table\n        if (isStart && dataPrev.isComponentEditable())\n        {\n            e.preventDefault();\n            this.component.remove(prev, false);\n            return;\n        }\n        // component\n        else if (isStart && dataPrev.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(prev);\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // lists\n        else if (isStart && data.isList())\n        {\n            e.preventDefault();\n\n            $currentList = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            if (dataPrev.isList())\n            {\n                $currentList.children('li').first().prepend(this.marker.build('start'));\n                $prev.append($currentList);\n                $currentList.unwrap();\n\n                this.selection.restoreMarkers();\n            }\n            else\n            {\n                var $first = $currentList.children('li').first();\n                var first = $first.get();\n                var $lists = $first.find('ul, ol');\n\n                var $newnode = this.utils.replaceToTag(first, this.opts.markup);\n                if (this.opts.breakline) $newnode.attr('data-redactor-tag', 'br');\n                $currentList.before($newnode);\n                this.caret.setStart($newnode);\n\n                if ($lists.length !== 0)\n                {\n                    $currentList.prepend($lists);\n                    $lists.unwrap();\n                }\n            }\n\n            return;\n        }\n        // block\n        else if (isStart && isPrevBlock)\n        {\n            e.preventDefault();\n\n            var textNode = this.utils.createInvisibleChar();\n            var $current = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            this.caret.setEnd($prev);\n\n            $current.prepend(textNode);\n            $prev.append($current.contents());\n            $current.remove();\n\n            return;\n        }\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            $block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _removeActiveComponent: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponent() && this.component.isActive(component))\n        {\n            e.preventDefault();\n            this.component.remove(component);\n            return true;\n        }\n    },\n    _removeAllSelectedTable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var table = data.getTable();\n        if (table && this.selection.isAll(table))\n        {\n            e.preventDefault();\n            this.component.remove(table);\n            return true;\n        }\n    },\n    _removeUnwantedStyles: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            var $tags = $editor.find('*[style]');\n            $tags.not('img, figure, iframe, [data-redactor-style-cache], [data-redactor-span]').removeAttr('style');\n\n        }, 0);\n    },\n    _removeEmptySpans: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('span').each(function(node)\n            {\n                if (node.attributes.length === 0)\n                {\n                    $R.dom(node).replaceWith(node.childNodes);\n                }\n            });\n\n        }, 0);\n    },\n    _removeInvisibleSpace: function()\n    {\n        var current = this.selection.getCurrent();\n        var prev = (current) ? current.previousSibling : false;\n        var isEmpty = (current) ? this.utils.isEmptyHtml(((current.nodeType === 3) ? current.textContent : current.innerHTML)) : false;\n\n        if (isEmpty && current && current.nodeType === 3 && this.utils.searchInvisibleChars(current.textContent) === 0)\n        {\n            current.parentNode.removeChild(current);\n        }\n\n        if (this.key === this.keycodes.DELETE && prev && prev.nodeType === 3 && this.utils.searchInvisibleChars(prev.textContent) === 0)\n        {\n            prev.parentNode.removeChild(prev);\n        }\n    },\n    _removeSpanTagsInHeadings: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('h1, h2, h3, h4, h5, h6').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker, [data-redactor-style-cache], [data-redactor-span]').unwrap();\n                }\n            });\n\n        }, 1);\n    },\n    _removeInlineTagsInPre: function()\n    {\n        var $editor = this.editor.getElement();\n        var tags = this.opts.inlineTags;\n\n        setTimeout(function()\n        {\n            $editor.find('pre').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find(tags.join(',')).not('code, .redactor-selection-marker').unwrap();\n                }\n            });\n\n        }, 1);\n    }\n});\n$R.add('class', 'input.enter', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.editor = app.editor;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.inspector = app.inspector;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off\n        if (!this.opts.enterKey) return this._disable(e);\n\n        // callback\n        var stop = this.app.broadcast('enter', e);\n        if (stop === false) return e.preventDefault();\n\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift enter\n        if (e.ctrlKey || e.shiftKey) return this._insertBreak(e);\n\n        // enter & exit\n        if (this._isExit(e)) return;\n\n        // traverse\n        this._traverse(e);\n    },\n    _disable: function(e)\n    {\n        e.preventDefault();\n        var range = this.selection.getRange();\n        if (range && !range.collapsed) range.deleteContents();\n    },\n    _insertBreak: function(e)\n    {\n        e.preventDefault();\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if (data.isComponent() || data.isCode()) return;\n        else if (data.isPre()) this.insertion.insertNewline();\n        else this.insertion.insertBreakLine();\n    },\n    _isExit: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n        var isEnd = this.caret.isEnd(block);\n        var current = this.selection.getCurrent();\n        var prev = current.previousSibling;\n\n        // blockquote\n        if (data.isBlockquote())\n        {\n            var isParagraphExit = (isEnd && this._isExitableBlock(block, 'P'));\n            var isBreaklineExit = (isEnd && this._isExitableDblBreak(prev));\n\n            if (isParagraphExit || isBreaklineExit)\n            {\n                return this._exitFromElement(e, ((isBreaklineExit) ? prev : block), data.getBlockquote());\n            }\n        }\n        // pre\n        else if (!data.isComponentType('code') && data.isPre())\n        {\n            if (isEnd)\n            {\n                var html = block.innerHTML;\n                html = this.utils.removeInvisibleChars(html);\n                if (html.match(/(\\n\\n\\n)$/) !== null)\n                {\n                    $R.dom(prev.previousSibling.previousSibling).remove();\n                    return this._exitFromElement(e, prev, block);\n                }\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            if (isEnd && this._isExitableBlock(block, 'DT'))\n            {\n                return this._exitFromElement(e, block, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var list = $R.dom(current).parents('ul, ol', $editor).last();\n\n            isEnd = this.caret.isEnd(list);\n            if (isEnd && this._isExitableBlock(block, 'LI'))\n            {\n                return this._exitFromElement(e, block, list);\n            }\n        }\n        else if (data.isComponent() && data.isComponentActive() && !data.isFigcaption() && !data.isComponentEditable())\n        {\n            return this._exitFromElement(e, false, data.getComponent());\n        }\n    },\n    _isExitableDblBreak: function(prev)\n    {\n        var next = (prev) ? prev.nextSibling : false;\n        if (next)\n        {\n            var text = this.utils.removeInvisibleChars(next.textContent);\n\n            return (next.nodeType === 3 && text.trim() === '');\n        }\n    },\n    _isExitableBlock: function(block, tag)\n    {\n        return (block && block.tagName === tag && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _exitFromElement: function(e, prev, el)\n    {\n        e.preventDefault();\n        if (prev) $R.dom(prev).remove();\n        this.utils.createMarkup(el);\n\n        return true;\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextSibling) this.caret.setStart(node.nextSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var isText = this.selection.isText();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(current);\n        var blockTag = (block) ? block.tagName.toLowerCase() : false;\n\n        // pre\n        if (data.isPre())\n        {\n            e.preventDefault();\n            return this.insertion.insertNewline();\n        }\n        // blockquote\n        else if (data.isBlockquote())\n        {\n            block = this.selection.getBlock(current);\n            if (block && block.tagName === 'BLOCKQUOTE')\n            {\n                e.preventDefault();\n                return this.insertion.insertBreakLine();\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            var isEnd = this.caret.isEnd(block);\n            var isEndEditor = this.caret.isEnd();\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n            else\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            e.preventDefault();\n            return this._traverseDl(current);\n        }\n        // text\n        else if (isText || (this.opts.breakline && blockTag === 'div'))\n        {\n            e.preventDefault();\n            return this.insertion.insertBreakLine();\n        }\n        // div / p\n        else\n        {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n    },\n    _traverseDl: function(current)\n    {\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(block);\n        var tag = data.getTag();\n        var $el = $R.dom(block);\n        var next = $el.get().nextSibling || false;\n        var $next = $R.dom(next);\n        var nextDd = (next && $next.is('dd'));\n        var nextDt = (next && $next.is('dt'));\n        var isEnd = this.caret.isEnd(block);\n\n        if (tag === 'dt' && !nextDd && isEnd)\n        {\n            var dd = document.createElement('dd');\n            $el.after(dd);\n\n            this.caret.setStart(dd);\n            return;\n        }\n        else if (tag === 'dd' && !nextDt && isEnd)\n        {\n            var dt = document.createElement('dt');\n            $el.after(dt);\n\n            this.caret.setStart(dt);\n            return;\n        }\n\n        return this.insertion.insertBreakLine();\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n        else\n        {\n            if (block)\n            {\n                if (this.utils.isEmptyHtml(block.innerHTML))\n                {\n                    this._clearBlock($block, block);\n                }\n                else\n                {\n                    var first = this.utils.getFirstNode(block);\n                    if (first && first.tagName === 'BR')\n                    {\n                        $R.dom(first).remove();\n                        this.caret.setStart(block);\n                    }\n                }\n            }\n        }\n\n        if (block && this._isNeedToCleanBlockStyle(block) && this.opts.cleanOnEnter)\n        {\n            $block.removeAttr('class style');\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            $block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _clearBlock: function($block, block)\n    {\n        if (this.opts.cleanInlineOnEnter || block.innerHTML === '<br>')\n        {\n            $block.html('');\n        }\n\n        this.caret.setStart(block);\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _isNeedToCleanBlockStyle: function(block)\n    {\n        return (block.tagName === 'P' && this.utils.isEmptyHtml(block.innerHTML));\n    }\n});\n$R.add('class', 'input.paste', {\n    init: function(app, e, dataTransfer, html, point)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.pasteHtml = html;\n        this.pointInserted = point;\n        this.dataTransfer = dataTransfer;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        var clipboard = this.dataTransfer || e.clipboardData;\n        var current = this.selection.getCurrent();\n        var dataCurrent = this.inspector.parse(current);\n\n        this.dropPasted = this.dataTransfer;\n        this.isRawCode = (dataCurrent.isPre() || dataCurrent.isCode());\n\n        this.editor.enablePasting();\n        this.editor.saveScroll();\n\n        if (!this.dropPasted)\n        {\n            this.selection.saveMarkers();\n        }\n\n        if (this.isRawCode || !clipboard)\n        {\n            var text = clipboard.getData(\"text/plain\");\n\n            e.preventDefault();\n            this._insert(e, text);\n            return;\n        }\n        else if (this.pasteHtml)\n        {\n            e.preventDefault();\n            this._insert(e, this.pasteHtml);\n        }\n        else\n        {\n            // html / text\n            var url = clipboard.getData('URL');\n            var html = (this._isPlainText(clipboard)) ? clipboard.getData(\"text/plain\") : clipboard.getData(\"text/html\");\n\n            // safari anchor links\n            html = (!url || url === '') ? html : url;\n\n            // file\n            var items = clipboard.items || clipboard.files;\n            var isFiles = (clipboard.items) ? false : (clipboard.files);\n\n            if (items && html === '')\n            {\n                var files = [];\n                for (var i = 0; i < items.length; i++)\n                {\n                    var file = (isFiles) ? items[i] : items[i].getAsFile();\n                    if (file) files.push(file);\n                }\n\n                if (files.length > 0)\n                {\n                    e.preventDefault();\n                    this._insertFiles(e, files);\n                    return;\n                }\n            }\n\n\n            e.preventDefault();\n            this._insert(e, html);\n        }\n    },\n    _isPlainText: function(clipboard)\n    {\n        var text = clipboard.getData(\"text/plain\");\n        var html = clipboard.getData(\"text/html\");\n\n        if (text && html)\n        {\n            var element = document.createElement(\"div\");\n            element.innerHTML = html;\n\n            if (element.textContent === text)\n            {\n                return !element.querySelector(\":not(meta)\");\n            }\n        }\n        else\n        {\n            return (text !== null);\n        }\n    },\n    _restoreSelection: function()\n    {\n        this.editor.restoreScroll();\n        this.editor.disablePasting();\n        if (!this.dropPasted)\n        {\n            this.selection.restoreMarkers();\n        }\n    },\n    _insert: function(e, html)\n    {\n        // pasteBefore callback\n        var returned = this.app.broadcast('pasteBefore', html);\n        html = (returned === undefined) ? html : returned;\n\n        // clean\n        html = (this.isRawCode) ? html : this.cleaner.paste(html);\n        html = (this.isRawCode) ? this.cleaner.encodePhpCode(html) : html;\n\n        // paste callback\n        returned = this.app.broadcast('pasting', html);\n        html = (returned === undefined) ? html : returned;\n\n        this._restoreSelection();\n\n        // autoparse\n        if (this.opts.autoparse && this.opts.autoparsePaste)\n        {\n            html = this.autoparser.parse(html);\n        }\n\n        var nodes = (this.dropPasted) ? this.insertion.insertToPoint(e, html, this.pointInserted) : this.insertion.insertHtml(html);\n\n        // pasted callback\n        this.app.broadcast('pasted', nodes);\n        this.app.broadcast('autoparseobserve');\n    },\n    _insertFiles: function(e, files)\n    {\n        this._restoreSelection();\n\n        // drop or clipboard\n        var isImage = (this.opts.imageTypes.indexOf(files[0].type) !== -1);\n        var isClipboard = (typeof this.dropPasted === 'undefined');\n\n        if (isImage) this.app.broadcast('dropimage', e, files, isClipboard);\n        else this.app.broadcast('dropfile', e, files, isClipboard);\n    }\n});\n$R.add('class', 'input.shortcode', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.worked = false;\n\n        // init\n        if (key === this.keycodes.SPACE) this._init();\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function()\n    {\n        var current = this.selection.getCurrent();\n        if (current && current.nodeType === 3)\n        {\n            var text = this.utils.removeInvisibleChars(current.textContent);\n            var shortcodes = this.opts.shortcodes;\n            for (var name in shortcodes)\n            {\n                var re = new RegExp('^' + this.utils.escapeRegExp(name));\n                var match = text.match(re);\n                if (match !== null)\n                {\n                    if (typeof shortcodes[name].format !== 'undefined')\n                    {\n                        return this._format(shortcodes[name].format, current, re);\n                    }\n                }\n            }\n        }\n    },\n    _format: function(tag, current, re)\n    {\n        var marker = this.marker.insert('start');\n        current = marker.previousSibling;\n\n        var text = current.textContent;\n        text = this.utils.trimSpaces(text);\n        text = text.replace(re, '');\n        current.textContent = text;\n\n        var api = (tag === 'ul' || tag === 'ol') ? 'module.list.toggle' : 'module.block.format';\n\n        this.app.api(api, tag);\n        this.selection.restoreMarkers();\n\n        this.worked = true;\n    }\n});\n$R.add('class', 'input.shortcut', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.worked = false;\n\n        // based on https://github.com/jeresig/jquery.hotkeys\n        this.hotkeys = {\n            8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n            20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n            37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n            96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n            104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n            112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n            120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n            188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n        };\n\n        this.hotkeysShiftNums = {\n            \"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n            \"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n            \".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n        };\n\n        // init\n        this._init(e);\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function(e)\n    {\n        // disable browser's hot keys for bold and italic if shortcuts off\n        if (this.opts.shortcuts === false)\n        {\n            if ((e.ctrlKey || e.metaKey) && (e.which === 66 || e.which === 73)) e.preventDefault();\n            return;\n        }\n\n        // build\n        for (var key in this.opts.shortcuts)\n        {\n            this._build(e, key, this.opts.shortcuts[key]);\n        }\n    },\n    _build: function(e, str, command)\n    {\n        var keys = str.split(',');\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (typeof keys[i] === 'string')\n            {\n                this._handler(e, keys[i].trim(), command);\n            }\n        }\n    },\n    _handler: function(e, keys, command)\n    {\n        keys = keys.toLowerCase().split(\" \");\n\n        var special = this.hotkeys[e.keyCode];\n        var character = String.fromCharCode(e.which).toLowerCase();\n        var modif = \"\", possible = {};\n        var cmdKeys = [\"alt\", \"ctrl\", \"meta\", \"shift\"];\n\n        for (var i = 0; i < cmdKeys.length; i++)\n        {\n            var specialKey = cmdKeys[i];\n            if (e[specialKey + 'Key'] && special !== specialKey)\n            {\n                modif += specialKey + '+';\n            }\n        }\n\n        if (special) possible[modif + special] = true;\n        if (character)\n        {\n            possible[modif + character] = true;\n            possible[modif + this.hotkeysShiftNums[character]] = true;\n\n            // \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n            if (modif === \"shift+\")\n            {\n                possible[this.hotkeysShiftNums[character]] = true;\n            }\n        }\n\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (possible[keys[i]])\n            {\n                e.preventDefault();\n                this.worked = true;\n\n                if (command.message)\n                {\n                    this.app.broadcast(command.message, command.args);\n                }\n                else if (command.api)\n                {\n                    this.app.api(command.api, command.args);\n                }\n\n                return;\n            }\n        }\n    }\n});\n$R.add('class', 'input.space', {\n    init: function(app, e, key, lastShiftKey)\n    {\n        this.app = app;\n        this.keycodes = app.keycodes;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n        this.lastShiftKey = lastShiftKey;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift/ctrl + space\n        if (!this.lastShiftKey && this.key === this.keycodes.SPACE && (e.ctrlKey || e.shiftKey))\n        {\n            e.preventDefault();\n            this.insertion.insertChar('&nbsp;');\n            return;\n        }\n    }\n});\n$R.add('class', 'input.tab', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off tab\n        if (!this.opts.tabKey) return this._disable(e);\n\n        // callback\n        var stop = this.app.broadcast('tab', e);\n        if (stop === false) return e.preventDefault();\n\n        // traverse\n        this._traverse(e);\n    },\n    _disable: function(e)\n    {\n        e.preventDefault();\n        return;\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        // hard tab\n        if (!data.isComponent() && e.shiftKey)\n        {\n            return this._insertHardTab(e, 4);\n        }\n\n        // list\n        if (data.isList())\n        {\n            e.preventDefault();\n            return this.app.api('module.list.indent');\n        }\n        // pre\n        if (data.isPre() || (data.isComponentType('code') && !data.isFigcaption()))\n        {\n            return this._tabCode(e);\n        }\n\n        // tab as spaces\n        if (this.opts.tabAsSpaces !== false)\n        {\n            return this._insertHardTab(e, this.opts.tabAsSpaces);\n        }\n    },\n    _insertHardTab: function(e, num)\n    {\n        e.preventDefault();\n        var node = document.createTextNode(Array(num + 1).join('\\u00a0'));\n        return this.insertion.insertNode(node, 'end');\n    },\n    _tabCode: function(e)\n    {\n        e.preventDefault();\n\n        var node = (this.opts.preSpaces) ? document.createTextNode(Array(this.opts.preSpaces + 1).join('\\u00a0')) : document.createTextNode('\\t');\n\n        return this.insertion.insertNode(node, 'end');\n    }\n});\n$R.add('module', 'upload', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.progress = app.progress;\n\n        // local\n        this.defaults = {\n            event: false,\n            element: false,\n            name: false,\n            files: false,\n            url: false,\n            data: false,\n            paramName: false\n        };\n    },\n    // public\n    build: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$el = $R.dom(this.p.element);\n\n        if (this.$el.get().tagName === 'INPUT') this._buildInput();\n        else                                    this._buildBox();\n    },\n    send: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$uploadbox = this.editor.getElement();\n        this._send(this.p.event, this.p.files);\n    },\n    complete: function(response, e)\n    {\n        this._complete(response, e);\n    },\n\n    // private\n    _buildInput: function()\n    {\n        this.box = false;\n        this.prefix = '';\n\n        this.$uploadbox = $R.dom('<div class=\"upload-box\" />');\n\n        this.$el.hide();\n        this.$el.after(this.$uploadbox);\n\n        if (this.opts.multipleUpload) this.$el.attr('multiple', 'multiple');\n        else this.$el.removeAttr('multiple');\n\n        this._buildPlaceholder();\n        this._buildEvents();\n    },\n    _buildBox: function()\n    {\n        this.box = true;\n        this.prefix = 'box-';\n\n        this.$uploadbox = this.$el;\n        this.$uploadbox.attr('ondragstart', 'return false;');\n\n        // events\n        this.$uploadbox.on('drop.redactor.upload', this._onDropBox.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _buildPlaceholder: function()\n    {\n        this.$placeholder = $R.dom('<div class=\"upload-placeholder\" />');\n        this.$placeholder.html(this.lang.get('upload-label'));\n        this.$uploadbox.append(this.$placeholder);\n    },\n    _buildEvents: function()\n    {\n        this.$el.on('change.redactor.upload', this._onChange.bind(this));\n        this.$uploadbox.on('click.redactor.upload', this._onClick.bind(this));\n        this.$uploadbox.on('drop.redactor.upload', this._onDrop.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _onClick: function(e)\n    {\n        e.preventDefault();\n        this.$el.click();\n    },\n    _onChange: function(e)\n    {\n        this.app.broadcast('upload.start');\n        this._send(e, this.$el.get().files);\n    },\n    _onDrop: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n\n        this.app.broadcast('upload.start');\n        this._send(e);\n    },\n    _onDragOver: function(e)\n    {\n        e.preventDefault();\n        this._setStatusHover();\n\n        return false;\n    },\n    _onDragLeave: function(e)\n    {\n        e.preventDefault();\n        this._removeStatusHover();\n\n        return false;\n    },\n    _onDropBox: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n\n        this.app.broadcast('upload.start');\n        this._send(e);\n    },\n    _removeStatusHover: function()\n    {\n        this.$uploadbox.removeClass('upload-' + this.prefix + 'hover');\n    },\n    _setStatusDrop: function()\n    {\n        this.$uploadbox.addClass('upload-' + this.prefix + 'drop');\n    },\n    _setStatusHover: function()\n    {\n        this.$uploadbox.addClass('upload-' + this.prefix + 'hover');\n    },\n    _setStatusError: function()\n    {\n        this.$uploadbox.addClass('upload-' + this.prefix + 'error');\n    },\n    _setStatusSuccess: function()\n    {\n        this.$uploadbox.addClass('upload-' + this.prefix + 'success');\n    },\n    _clear: function()\n    {\n        var classes = ['drop', 'hover', 'error', 'success'];\n        for (var i = 0; i < classes.length; i++)\n        {\n            this.$uploadbox.removeClass('upload-' + this.prefix + classes[i]);\n        }\n\n        this.$uploadbox.removeAttr('ondragstart');\n    },\n    _send: function(e, files)\n    {\n        e = e.originalEvent || e;\n\n        files = (files) ? files : e.dataTransfer.files;\n\n        var data = new FormData();\n        var name = this._getUploadParam();\n\n        data = this._buildData(name, files, data);\n        data = this.utils.extendData(data, this.p.data);\n\n        this._sendData(data, files, e);\n    },\n    _sendData: function(data, files, e)\n    {\n        this.progress.show();\n\n        if (typeof this.p.url === 'function')\n        {\n            var res = this.p.url(data, files, e, this);\n            if (!(res instanceof Promise))\n            {\n                this._complete(res);\n            }\n        }\n        else\n        {\n            $R.ajax.post({\n                url: this.p.url,\n                data: data,\n                before: function(xhr)\n                {\n                    return this.app.broadcast('upload.beforeSend', xhr);\n\n                }.bind(this),\n                success: function(response)\n                {\n                    this._complete(response, e);\n                }.bind(this)\n            });\n        }\n    },\n    _getUploadParam: function()\n    {\n        return (this.p.paramName) ? this.p.paramName : 'file';\n    },\n    _buildData: function(name, files, data)\n    {\n        if (files.length === 1)\n        {\n            data.append(name + '[]', files[0]);\n        }\n        else if (files.length > 1 && this.opts.multipleUpload !== false)\n        {\n            for (var i = 0; i < files.length; i++)\n            {\n                data.append(name + '[]', files[i]);\n            }\n        }\n\n        return data;\n    },\n    _complete: function (response, e)\n    {\n        this._clear();\n        this.progress.hide();\n\n        if (response && response.error)\n        {\n            this._setStatusError();\n\n            this.app.broadcast('upload.' + this.p.name + '.error', response, e);\n            this.app.broadcast('upload.error', response);\n        }\n        else\n        {\n            this._setStatusSuccess();\n\n            this.app.broadcast('upload.' + this.p.name + '.complete', response, e);\n            this.app.broadcast('upload.complete', response);\n\n            setTimeout(this._clear.bind(this), 500);\n        }\n    }\n});\n$R.add('class', 'code.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n\n    // private\n   _init: function(el)\n    {\n        var $pre;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('figure');\n            if ($wrapper.length !== 0)\n            {\n                this.parse($wrapper);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n\n            $pre = this.find('pre code, pre').last();\n        }\n        else\n        {\n            $pre = $R.dom('<pre>');\n\n            this.parse('<figure>');\n            this.append($pre);\n        }\n\n        this._initElement($pre);\n        this._initWrapper();\n    },\n    _initElement: function($pre)\n    {\n        $pre.attr({\n            'tabindex': '-1',\n            'contenteditable': true\n        });\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'code',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'form', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n    },\n    // messages\n    onform: {\n        remove: function(node)\n        {\n            this._remove(node);\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('form'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.form.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'top');\n        }\n\n    },\n\n    // private\n    _remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'form.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.utils = app.utils;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('form');\n            if ($wrapper.length !== 0)\n            {\n                var $figure = this.utils.replaceToTag(el, 'figure');\n                this.parse($figure);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n        this._initWrapper();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'form',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'image', {\n    modals: {\n        'image':\n            '<div class=\"redactor-modal-tab\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>',\n        'imageedit':\n            '<div class=\"redactor-modal-group\"> \\\n                <div id=\"redactor-modal-image-preview\" class=\"redactor-modal-side\"></div> \\\n                <form action=\"\" class=\"redactor-modal-area\"> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-image-title\"> ## title ##</label> \\\n                        <input type=\"text\" id=\"modal-image-title\" name=\"title\" /> \\\n                    </div> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-image-caption\">## caption ##</label> \\\n                        <input type=\"text\" id=\"modal-image-caption\" name=\"caption\" aria-label=\"## caption ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-align\"> \\\n                        <label>## image-position ##</label> \\\n                        <select name=\"align\" aria-label=\"## image-position ##\"> \\\n                            <option value=\"none\">## none ##</option> \\\n                            <option value=\"left\">## left ##</option> \\\n                            <option value=\"center\">## center ##</option> \\\n                            <option value=\"right\">## right ##</option> \\\n                        </select> \\\n                    </div> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-image-url\">## link ##</label> \\\n                        <input type=\"text\" id=\"modal-image-url\" name=\"url\" aria-label=\"## link ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item\"> \\\n                        <label class=\"checkbox\"><input type=\"checkbox\" name=\"target\" aria-label=\"## link-in-new-tab ##\"> ## link-in-new-tab ##</label> \\\n                    </div> \\\n                </form> \\\n            </div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.justResized = false;\n    },\n    // messages\n    oninsert: function()\n    {\n        this._observeImages();\n    },\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeImages();\n\n        // resize\n        if (this.opts.imageResizable)\n        {\n            this.resizer = $R.create('image.resize', this.app);\n        }\n\n        // observe\n        this._observeImages();\n    },\n    ondropimage: function(e, files, clipboard)\n    {\n        if (!this.opts.imageUpload) return;\n\n        var options = {\n            url: this.opts.imageUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'imagedrop',\n            data: this.opts.imageData\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onstop: function()\n    {\n        if (this.resizer) this.resizer.stop();\n    },\n    onimageresizer: {\n        stop: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        }\n    },\n    onsource: {\n        open: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        },\n        closed: function()\n        {\n            this._observeImages();\n            if (this.resizer) this.resizer.rebuild();\n        }\n    },\n    onupload: {\n        complete: function()\n        {\n            this._observeImages();\n        },\n        image: {\n            complete: function(response)\n            {\n                this._insert(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imageedit: {\n            complete: function(response)\n            {\n                this._change(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagereplace: {\n            complete: function(response)\n            {\n                this._change(response, false);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n    onmodal: {\n        image: {\n            open: function($modal, $form)\n            {\n                this._setUpload($form);\n            }\n        },\n        imageedit: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            remove: function()\n            {\n                this._remove(this.$image);\n            },\n            save: function($modal, $form)\n            {\n                this._save($modal, $form);\n            }\n        }\n    },\n    onimage: {\n        observe: function()\n        {\n            this._observeImages();\n        },\n        resized: function()\n        {\n            this.justResized = true;\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        if (this.justResized)\n        {\n            this.justResized = false;\n            return;\n        }\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if (!data.isFigcaption() && data.isComponentType('image'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.image.open'\n                },\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.image.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons);\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$image = this._getCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _getModalData: function()\n    {\n        var modalData;\n        if (this._isImage() && this.opts.imageEditable)\n        {\n            modalData = {\n                name: 'imageedit',\n                width: '800px',\n                title: this.lang.get('edit'),\n                handle: 'save',\n                commands: {\n                    save: { title: this.lang.get('save') },\n                    remove: { title: this.lang.get('delete'), type: 'danger' },\n                    cancel: { title: this.lang.get('cancel') }\n                }\n            };\n        }\n        else\n        {\n            modalData = {\n                name: 'image',\n                title: this.lang.get('image')\n            };\n        }\n\n        return modalData;\n    },\n    _isImage: function()\n    {\n        return this.$image;\n    },\n    _getCurrent: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        return (data.isComponentType('image') && data.isComponentActive()) ? this.component.create('image', data.getComponent()) : false;\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n\n        if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n            var multiple = (Object.keys(response).length  > 1);\n            if (multiple)\n            {\n                this._insertMultiple(response, e);\n            }\n            else\n            {\n                this._insertSingle(response, e);\n            }\n        }\n    },\n    _insertSingle: function(response, e)\n    {\n        for (var key in response)\n        {\n            var $img = this._createImageAndStore(response[key]);\n            var inserted = (e) ? this.insertion.insertToPoint(e, $img) : this.insertion.insertHtml($img);\n\n            this._removeSpaceBeforeFigure(inserted[0]);\n\n            // set is active\n            this.component.setActive(inserted[0]);\n            this.app.broadcast('image.uploaded', inserted[0], response);\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var last;\n        for (var key in response)\n        {\n            z++;\n\n            var $img = this._createImageAndStore(response[key]);\n\n            if (z === 1)\n            {\n                inserted = (e) ? this.insertion.insertToPoint(e, $img) : this.insertion.insertHtml($img);\n            }\n            else\n            {\n                var $inserted = $R.dom(inserted[0]);\n                $inserted.after($img);\n                inserted = [$img.get()];\n\n                this.app.broadcast('image.inserted', $img);\n            }\n\n            last = inserted[0];\n\n            this._removeSpaceBeforeFigure(inserted[0]);\n            this.app.broadcast('image.uploaded', inserted[0], response);\n        }\n\n        // set last is active\n        this.component.setActive(last);\n    },\n    _createImageAndStore: function(item)\n    {\n        var $img = this.component.create('image');\n\n        $img.addClass('redactor-uploaded-figure');\n        $img.setData({\n            src: item.url,\n            id: (item.id) ? item.id : this.utils.getRandomId()\n        });\n\n        // add to storage\n        this.storage.add('image', $img.getElement());\n\n        return $img;\n    },\n    _removeSpaceBeforeFigure: function(img)\n    {\n        if (!img) return;\n\n        var prev = img.previousSibling;\n        if (prev)\n        {\n            this._removeInvisibleSpace(prev);\n            this._removeInvisibleSpace(prev.previousSibling);\n        }\n    },\n    _removeInvisibleSpace: function(el)\n    {\n        if (el && el.nodeType === 3 && this.utils.searchInvisibleChars(el.textContent) !== -1)\n        {\n            el.parentNode.removeChild(el);\n        }\n    },\n    _save: function($modal, $form)\n    {\n        var data = $form.getData();\n        var imageData = {\n            title: data.title,\n            link: { url: data.url, target: data.target }\n        };\n\n        if (this.opts.imageCaption) imageData.caption = data.caption;\n        if (this.opts.imagePosition) imageData.align = data.align;\n\n        this.$image.setData(imageData);\n        if (this.resizer) this.resizer.rebuild();\n\n        this.app.broadcast('image.changed', this.$image);\n        this.app.api('module.modal.close');\n    },\n    _change: function(response, modal)\n    {\n        if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n            var $img;\n            for (var key in response)\n            {\n                $img = $R.dom('<img>');\n                $img.attr('src', response[key].url);\n\n                this.$image.changeImage(response[key]);\n\n                this.app.broadcast('image.changed', this.$image, response);\n                this.app.broadcast('image.uploaded', this.$image, response);\n\n                break;\n            }\n\n            if (modal !== false)\n            {\n                $img.on('load', function() { this.$previewBox.html($img); }.bind(this));\n            }\n        }\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('image.uploadError', response);\n    },\n    _remove: function(node)\n    {\n        this.app.api('module.modal.close');\n        this.component.remove(node);\n    },\n    _observeImages: function()\n    {\n        var $editor = this.editor.getElement();\n        var self = this;\n        $editor.find('img').each(function(node)\n        {\n            var $node = $R.dom(node);\n\n            $node.off('.drop-to-replace');\n            $node.on('dragover.drop-to-replace dragenter.drop-to-replace', function(e)\n            {\n                e.preventDefault();\n                return;\n            });\n\n            $node.on('drop.drop-to-replace', function(e)\n            {\n                if (!self.app.isDragComponentInside())\n                {\n                    return self._setReplaceUpload(e, $node);\n                }\n            });\n        });\n    },\n    _setFormData: function($modal, $form)\n    {\n        this._buildPreview();\n        this._buildPreviewUpload();\n\n        var imageData = this.$image.getData();\n        var data = {\n            title: imageData.title\n        };\n\n        // caption\n        if (this.opts.imageCaption) data.caption = imageData.caption;\n        else $modal.find('.form-item-caption').hide();\n\n        // position\n        if (this.opts.imagePosition) data.align = imageData.align;\n        else $modal.find('.form-item-align').hide();\n\n        if (imageData.link)\n        {\n            data.url = imageData.link.url;\n            if (imageData.link.target) data.target = true;\n        }\n\n        $form.setData(data);\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _setReplaceUpload: function(e, $node)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (!this.opts.imageUpload) return;\n\n        this.$image = this.component.create('image', $node);\n\n        var options = {\n            url: this.opts.imageUpload,\n            files: e.dataTransfer.files,\n            name: 'imagereplace',\n            data: this.opts.imageData\n        };\n\n        this.app.api('module.upload.send', options);\n\n        return;\n    },\n    _setUpload: function($form)\n    {\n        var options = {\n            url: this.opts.imageUpload,\n            element: $form.getField('file'),\n            name: 'image',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _buildPreview: function()\n    {\n        this.$preview = $R.dom('#redactor-modal-image-preview');\n\n        var imageData = this.$image.getData();\n        var $previewImg = $R.dom('<img>');\n        $previewImg.attr('src', imageData.src);\n\n        this.$previewBox = $R.dom('<div>');\n        this.$previewBox.append($previewImg);\n\n        this.$preview.html('');\n        this.$preview.append(this.$previewBox);\n    },\n    _buildPreviewUpload: function()\n    {\n        if (!this.opts.imageUpload) return;\n\n        var $desc = $R.dom('<div class=\"desc\">');\n        $desc.html('Drop a new image to change');\n\n        this.$preview.append($desc);\n\n        var options = {\n            url: this.opts.imageUpload,\n            element: this.$previewBox,\n            name: 'imageedit'\n        };\n\n        this.app.api('module.upload.build', options);\n    }\n});\n$R.add('class', 'image.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.selection = app.selection;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['src', 'title', 'caption', 'align', 'link', 'id'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n    changeImage: function(data)\n    {\n        this.$element.attr('src', data.url);\n    },\n\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        var $figure = $el.closest('figure');\n\n        if (el === undefined)\n        {\n            this.$element = $R.dom('<img>');\n            this.parse('<figure>');\n            this.append(this.$element);\n        }\n        else if ($figure.length === 0)\n        {\n            this.parse('<figure>');\n            this.$element = $el;\n            this.$element.wrap(this);\n        }\n        else\n        {\n            this.parse($figure);\n            this.$element = this.find('img');\n        }\n\n        this._initWrapper();\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _set_src: function(src)\n    {\n       this.$element.attr('src', src);\n    },\n    _set_id: function(id)\n    {\n       this.$element.attr('data-image', id);\n    },\n    _set_title: function(title)\n    {\n        title = title.trim().replace(/(<([^>]+)>)/ig,\"\");\n\n        if (title === '')\n        {\n            this.$element.removeAttr('alt');\n            this.$element.removeAttr('title');\n        }\n        else\n        {\n            this.$element.attr('alt', title);\n            this.$element.attr('title', title);\n        }\n\n    },\n    _set_caption: function(caption)\n    {\n        var $figcaption = this.find('figcaption');\n        if ($figcaption.length === 0)\n        {\n            $figcaption = $R.dom('<figcaption>');\n            $figcaption.attr('contenteditable', 'true');\n\n            this.append($figcaption);\n        }\n\n        if (caption === '') $figcaption.remove();\n        else $figcaption.html(caption);\n\n        return $figcaption;\n    },\n    _set_align: function(align)\n    {\n        var imageFloat = '';\n        var imageMargin = '';\n        var textAlign = '';\n        var $el = this;\n\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                $el.removeClass(positions[key]);\n            }\n\n            var alignClass = (typeof positions[align] !== 'undefined') ? positions[align] : false;\n            if (alignClass)\n            {\n                $el.addClass(alignClass);\n            }\n        }\n        else\n        {\n            switch (align)\n            {\n                case 'left':\n                    imageFloat = 'left';\n                    imageMargin = '0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin + ' 0';\n                break;\n                case 'right':\n                    imageFloat = 'right';\n                    imageMargin = '0 0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin;\n                break;\n                case 'center':\n                    textAlign = 'center';\n                break;\n            }\n\n            $el.css({ 'float': imageFloat, 'margin': imageMargin, 'text-align': textAlign });\n            $el.attr('rel', $el.attr('style'));\n        }\n    },\n    _set_link: function(data)\n    {\n        var $link = this._findLink();\n        if (data.url === '')\n        {\n            if ($link) $link.unwrap();\n\n            return;\n        }\n\n        if (!$link)\n        {\n            $link = $R.dom('<a>');\n            this.$element.wrap($link);\n        }\n\n        $link.attr('href', data.url);\n\n        if (data.target) $link.attr('target', data.target);\n        else $link.removeAttr('target');\n\n        return $link;\n    },\n    _get_src: function()\n    {\n        return this.$element.attr('src');\n    },\n    _get_id: function()\n    {\n        return this.$element.attr('data-image');\n    },\n    _get_title: function()\n    {\n        var alt = this.$element.attr('alt');\n        var title = this.$element.attr('title');\n\n        if (alt) return alt;\n        else if (title) return title;\n        else return '';\n    },\n    _get_caption: function()\n    {\n        var $figcaption = this.find('figcaption');\n\n        if ($figcaption.length === 0)\n        {\n            return '';\n        }\n        else\n        {\n            return $figcaption.html();\n        }\n    },\n    _get_align: function()\n    {\n        var align = '';\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            align = 'none';\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                if (this.hasClass(positions[key]))\n                {\n                    align = key;\n                    break;\n                }\n            }\n        }\n        else\n        {\n            align = (this.css('text-align') === 'center') ? 'center' : this.css('float');\n        }\n\n        return align;\n    },\n    _get_link: function()\n    {\n        var $link = this._findLink();\n        if ($link)\n        {\n            var target = ($link.attr('target')) ? true : false;\n\n            return {\n                url: $link.attr('href'),\n                target: target\n            };\n        }\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'image',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    },\n    _findLink: function()\n    {\n        var $link = this.find('a').filter(function(node)\n        {\n            return ($R.dom(node).closest('figcaption').length === 0);\n        });\n\n        if ($link.length !== 0)\n        {\n            return $link;\n        }\n\n        return false;\n    }\n});\n$R.add('class', 'image.resize', {\n    init: function(app)\n    {\n        this.app = app;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n\n        // init\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n        this._init();\n    },\n    // public\n    rebuild: function()\n    {\n        this._setResizerPosition();\n    },\n    hide: function()\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor.image-resize');\n\n        this.$doc.off('.redactor.image-resize');\n        this.$win.off('resize.redactor.image-resize');\n        this.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.on('click.redactor.image-resize', this._build.bind(this));\n\n        this.$win.on('resize.redactor.image-resize', this._setResizerPosition.bind(this));\n    },\n    _build: function(e)\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n\n        var data = this.inspector.parse(e.target);\n        var $editor = this.editor.getElement();\n\n        if (data.isComponentType('image'))\n        {\n            this.$resizableBox = $editor;\n            this.$resizableImage = $R.dom(data.getImageElement());\n\n            this.$resizer = $R.dom('<span>');\n            this.$resizer.attr('id', 'redactor-image-resizer');\n\n            this.$target.append(this.$resizer);\n\n            this._setResizerPosition();\n            this.$resizer.on('mousedown touchstart', this._set.bind(this));\n        }\n    },\n    _setResizerPosition: function()\n    {\n        if (this.$resizer)\n        {\n            var isTarget = this.toolbar.isTarget();\n            var targetOffset = this.$target.offset();\n            var offsetFix = 7;\n            var topOffset = (isTarget) ? (offsetFix - targetOffset.top + this.$target.scrollTop()) : offsetFix;\n            var leftOffset = (isTarget) ? (offsetFix - targetOffset.left) : offsetFix;\n            var pos = this.$resizableImage.offset();\n            var width = this.$resizableImage.width();\n            var height = this.$resizableImage.height();\n            var resizerWidth =  this.$resizer.width();\n            var resizerHeight =  this.$resizer.height();\n\n            this.$resizer.css({ top: (pos.top + height - resizerHeight + topOffset) + 'px', left: (pos.left + width - resizerWidth + leftOffset) + 'px' });\n        }\n    },\n    _set: function(e)\n    {\n        e.preventDefault();\n\n        this.resizeHandle = {\n            x : e.pageX,\n            y : e.pageY,\n            el : this.$resizableImage,\n            ratio: this.$resizableImage.width() / this.$resizableImage.height(),\n            h: this.$resizableImage.height()\n        };\n\n        e = e.originalEvent || e;\n\n        if (e.targetTouches)\n        {\n             this.resizeHandle.x = e.targetTouches[0].pageX;\n             this.resizeHandle.y = e.targetTouches[0].pageY;\n        }\n\n        this.app.broadcast('contextbar.close');\n        this.app.broadcast('image.resize', this.$resizableImage);\n        this._start();\n    },\n    _start: function()\n    {\n        this.$doc.on('mousemove.redactor.image-resize touchmove.redactor.image-resize', this._move.bind(this));\n        this.$doc.on('mouseup.redactor.image-resize touchend.redactor.image-resize', this._stop.bind(this));\n    },\n    _stop: function()\n    {\n        this.$doc.off('.redactor.image-resize');\n        this.app.broadcast('image.resized', this.$resizableImage);\n    },\n    _move: function(e)\n    {\n        e.preventDefault();\n\n        e = e.originalEvent || e;\n\n        var height = this.resizeHandle.h;\n\n        if (e.targetTouches) height += (e.targetTouches[0].pageY -  this.resizeHandle.y);\n        else height += (e.pageY -  this.resizeHandle.y);\n\n        var width = height * this.resizeHandle.ratio;\n\n        if (height < 50 || width < 100) return;\n        if (this._getResizableBoxWidth() <= width) return;\n\n        this.resizeHandle.el.attr({width: width, height: height});\n        this.resizeHandle.el.width(width);\n        this.resizeHandle.el.height(height);\n        this._setResizerPosition();\n    },\n    _getResizableBoxWidth: function()\n    {\n        var width = this.$resizableBox.width();\n        return width - parseInt(this.$resizableBox.css('padding-left')) - parseInt(this.$resizableBox.css('padding-right'));\n    }\n});\n$R.add('module', 'file', {\n    modals: {\n        'file':\n            '<div class=\"redactor-modal-tab\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-file-title\"> ## filename ## <span class=\"desc\">(## optional ##)</span></label> \\\n                    <input type=\"text\" id=\"modal-file-title\" name=\"title\" /> \\\n                </div> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n    },\n    // messages\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeFiles();\n    },\n    ondropfile: function(e, files, clipboard)\n    {\n        if (!this.opts.fileUpload) return;\n\n        var options = {\n            url: this.opts.fileUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'filedrop',\n            data: this.opts.fileData\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onmodal: {\n        file: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n                this._setUpload($form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n\n                this.$form = $form;\n            }\n        }\n    },\n    onupload: {\n        file: {\n            complete: function(response)\n            {\n                this._insert(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        filedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        if (data.isFile())\n        {\n            var node = data.getFile();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.file.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n\n    },\n\n    // public\n    open: function()\n    {\n        this._open();\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _open: function()\n    {\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    _getModalData: function()\n    {\n        var modalData = {\n            name: 'file',\n            title: this.lang.get('file')\n        };\n\n        return modalData;\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n        if (typeof response !== 'object') return;\n\n        var multiple = (Object.keys(response).length  > 1);\n\n        if (multiple)\n        {\n            this._insertMultiple(response, e);\n        }\n        else\n        {\n            this._insertSingle(response, e);\n        }\n\n        this.$form = false;\n    },\n    _insertSingle: function(response, e)\n    {\n        var inserted = [];\n        for (var key in response)\n        {\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file);\n            }\n            else\n            {\n                inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n            }\n\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var $last;\n        for (var key in response)\n        {\n            z++;\n\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file, response);\n            }\n            else\n            {\n                if (z === 1)\n                {\n                    inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n                }\n                else\n                {\n                    var $inserted = $R.dom(inserted[0]);\n                    $inserted.after($file);\n                    inserted = [$file.get()];\n\n                    this.app.broadcast('file.inserted', $file);\n                }\n            }\n\n            $last = $file;\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n\n        // set caret after last\n        if (!this.opts.fileAttachment)\n        {\n            this.caret.setAfter($last);\n        }\n    },\n    _insertAsAttachment: function($file, response)\n    {\n        var $box = $R.dom(this.opts.fileAttachment);\n        var $wrapper = $file.wrapAttachment();\n        $box.append($wrapper);\n\n        var inserted = [$wrapper.get()];\n        this.app.broadcast('file.appended', inserted[0], response);\n\n        return inserted;\n    },\n    _createFileAndStore: function(item)\n    {\n        var modalFormData = (this.$form) ? this.$form.getData() : false;\n        var name = (item.name) ? item.name : item.url;\n        var title = (!this.opts.fileAttachment && modalFormData && modalFormData.title !== '') ? modalFormData.title : this._truncateUrl(name);\n\n        var $file = this.component.create('file');\n        $file.attr('href', item.url);\n        $file.attr('data-file', (item.id) ? item.id : this.utils.getRandomId());\n        $file.attr('data-name', item.name);\n        $file.html(title);\n\n        // add to storage\n        this.storage.add('file', $file);\n\n        return $file;\n    },\n    _remove: function(node)\n    {\n        this.selection.save();\n\n        var $file = this.component.create('file', node);\n        var stop = this.app.broadcast('file.delete', $file);\n        if (stop !== false)\n        {\n            $file.unwrap();\n\n            this.selection.restore();\n\n            // callback\n            this.app.broadcast('file.deleted', $file);\n        }\n        else\n        {\n            this.selection.restore();\n        }\n    },\n    _truncateUrl: function(url)\n    {\n        return (url.search(/^http/) !== -1 && url.length > 20) ? url.substring(0, 20) + '...' : url;\n    },\n    _setUpload: function($form)\n    {\n        var options = {\n            url: this.opts.fileUpload,\n            element: $form.getField('file'),\n            name: 'file',\n            data: this.opts.fileData,\n            paramName: this.opts.fileUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _setFormData: function($modal, $form)\n    {\n        if (this.opts.fileAttachment)\n        {\n            $modal.find('.form-item-title').hide();\n        }\n        else\n        {\n            $form.setData({ title: this.selection.getText() });\n        }\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('file.uploadError', response);\n    }\n});\n$R.add('class', 'file.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    wrapAttachment: function()\n    {\n        this.$wrapper = $R.dom('<span class=\"redactor-file-item\">');\n        this.$remover = $R.dom('<span class=\"redactor-file-remover\">');\n        this.$remover.html('&times;');\n        this.$remover.on('click', this.removeAttachment.bind(this));\n\n        this.$wrapper.append(this);\n        this.$wrapper.append(this.$remover);\n\n        return this.$wrapper;\n    },\n    removeAttachment: function(e)\n    {\n        e.preventDefault();\n\n        var stop = this.app.broadcast('file.delete', this, this.$wrapper);\n        if (stop !== false)\n        {\n            this.$wrapper.remove();\n            this.app.broadcast('file.deleted', this);\n            this.app.broadcast('file.removeAttachment', this);\n        }\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            var $a = $R.dom(el).closest('a');\n            this.parse($a);\n        }\n    }\n});\n$R.add('module', 'buffer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.offset = app.offset;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.state = false;\n        this.passed = false;\n        this.keyPressed = false;\n        this.savedHtml = false;\n        this.savedOffset = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    // messages\n    onkeydown: function(e)\n    {\n        this._listen(e);\n    },\n    onsyncing: function()\n    {\n        if (!this.keyPressed)\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = false;\n    },\n    onstate: function(e, html, offset)\n    {\n        if ((e && (e.ctrlKey || e.metaKey)) || (e && (this._isUndo(e) || this._isRedo(e))))\n        {\n            return;\n        }\n\n        this.passed = false;\n        this._saveState(html, offset);\n    },\n    onenable: function()\n    {\n        this.clear();\n    },\n\n    // public\n    clear: function()\n    {\n        this.state = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    undo: function()\n    {\n        this._getUndo();\n    },\n    redo: function()\n    {\n        this._getRedo();\n    },\n    trigger: function()\n    {\n        if (this.state && this.passed === false) this._setUndo();\n    },\n\n    // private\n    _saveState: function(html, offset)\n    {\n        var $editor = this.editor.getElement();\n\n        this.state = {\n            html: html || $editor.html(),\n            offset: offset || this.offset.get()\n        };\n    },\n    _listen: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n        var cmd = ctrl || e.shiftKey || e.altKey;\n        var keys = [this.keycodes.SPACE, this.keycodes.ENTER, this.keycodes.BACKSPACE, this.keycodes.DELETE, this.keycodes.TAB,\n                    this.keycodes.LEFT, this.keycodes.RIGHT, this.keycodes.UP, this.keycodes.DOWN];\n\n        // undo\n        if (this._isUndo(e)) // z key\n        {\n            e.preventDefault();\n            this.undo();\n            return;\n        }\n        // redo\n        else if (this._isRedo(e))\n        {\n            e.preventDefault();\n            this.redo();\n            return;\n        }\n        // spec keys\n        else if (!ctrl && keys.indexOf(key) !== -1)\n        {\n            cmd = true;\n            this.trigger();\n        }\n        // cut & copy\n        else if (ctrl && (key === 88 || key === 67))\n        {\n            cmd = true;\n            this.trigger();\n        }\n\n        // empty buffer\n        if (!cmd && !this._hasUndo())\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = true;\n    },\n    _isUndo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && key === 90 && !e.shiftKey && !e.altKey);\n    },\n    _isRedo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && (key === 90 && e.shiftKey || key === 89 && !e.shiftKey) && !e.altKey);\n    },\n    _setUndo: function()\n    {\n        var last = this.undoStorage[this.undoStorage.length-1];\n        if (typeof last === 'undefined' || last[0] !== this.state.html)\n        {\n            this.undoStorage.push([this.state.html, this.state.offset]);\n            this._removeOverStorage();\n        }\n    },\n    _setRedo: function()\n    {\n        var $editor = this.editor.getElement();\n        var offset = this.offset.get();\n        var html = $editor.html();\n\n        this.redoStorage.push([html, offset]);\n        this.redoStorage = this.redoStorage.slice(0, this.opts.bufferLimit);\n    },\n    _getUndo: function()\n    {\n        if (!this._hasUndo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.undoStorage.pop();\n\n        this._setRedo();\n\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n        this.selection.restore();\n\n        this.app.broadcast('undo', buffer[0], buffer[1]);\n\n    },\n    _getRedo: function()\n    {\n        if (!this._hasRedo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.redoStorage.pop();\n\n        this._setUndo();\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n\n        this.app.broadcast('redo', buffer[0], buffer[1]);\n    },\n    _removeOverStorage: function()\n    {\n        if (this.undoStorage.length > this.opts.bufferLimit)\n        {\n            this.undoStorage = this.undoStorage.slice(0, (this.undoStorage.length - this.opts.bufferLimit));\n        }\n    },\n    _hasUndo: function()\n    {\n        return (this.undoStorage.length !== 0);\n    },\n    _hasRedo: function()\n    {\n        return (this.redoStorage.length !== 0);\n    }\n});\n$R.add('module', 'list', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n    },\n    // messages\n    onbutton: {\n        list: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        list: {\n            observe: function(dropdown)\n            {\n                this._observeDropdown(dropdown);\n            }\n        }\n    },\n\n    // public\n    toggle: function(type)\n    {\n        this.selection.saveMarkers();\n\n        var nodes = this._getBlocks();\n        var block = this.selection.getBlock();\n        var $list = $R.dom(block).parents('ul, ol',  '.redactor-in').last();\n        if (nodes.length === 0 && $list.length !== 0)\n        {\n            nodes = [$list.get()];\n        }\n\n        nodes = (this._isUnformat(type, nodes)) ? this._unformat(type, nodes) : this._format(type, nodes);\n\n        this.selection.restoreMarkers();\n\n        return nodes;\n    },\n    indent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (isIndent)\n        {\n            this.selection.saveMarkers();\n\n            $prev = $R.dom(prev);\n            var $prevChild = $prev.children('ul, ol');\n            var $list = $item.closest('ul, ol');\n\n            if ($prevChild.length !== 0)\n            {\n                $prevChild.append($item);\n            }\n            else\n            {\n                var listTag = $list.get().tagName.toLowerCase();\n                var $newList = $R.dom('<' + listTag + '>');\n\n                $newList.append($item);\n                $prev.append($newList);\n            }\n\n            this.selection.restoreMarkers();\n        }\n    },\n    outdent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n\n        if (isCollapsed && item)\n        {\n\n            var $listItem = $item.parent();\n            var $liItem = $listItem.closest('li');\n            var $prev = $item.prevElement();\n            var $next = $item.nextElement();\n            var prev = $prev.get();\n            var next = $next.get();\n            var nextItems, nextList, $newList, $nextList;\n            var isTop = (prev === false);\n            var isMiddle = (prev !== false && next !== false);\n            var isBottom = (!isTop && next === false);\n\n            this.selection.saveMarkers();\n\n            // out\n            if ($liItem.length !== 0)\n            {\n                if (isMiddle)\n                {\n                    nextItems = this._getAllNext($item.get());\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $liItem.after($item);\n                    $item.append($newList);\n                }\n                else\n                {\n                    $liItem.after($item);\n\n                    if ($listItem.children().length === 0)\n                    {\n                        $listItem.remove();\n                    }\n                    else\n                    {\n                        if (isTop) $item.append($listItem);\n                    }\n                }\n            }\n            // unformat\n            else\n            {\n                var $container =  this._createUnformatContainer($item);\n                var $childList = $container.find('ul, ol').first();\n\n                if (isTop) $listItem.before($container);\n                else if (isBottom) $listItem.after($container);\n                else if (isMiddle)\n                {\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n                    nextItems = this._getAllNext($item.get());\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $listItem.after($container);\n                    $container.after($newList);\n                }\n\n                if ($childList.length !== 0)\n                {\n                    $nextList = $container.nextElement();\n                    nextList = $nextList.get();\n                    if (nextList && nextList.tagName === $listItem.get().tagName)\n                    {\n                        $R.dom(nextList).prepend($childList);\n                        $childList.unwrap();\n                    }\n                    else\n                    {\n                        $container.after($childList);\n                    }\n                }\n\n                $item.remove();\n            }\n\n            this.selection.restoreMarkers();\n        }\n    },\n\n    // private\n    _getAllNext: function(next)\n    {\n        var nodes = [];\n\n        while (next)\n        {\n            var $next = $R.dom(next).nextElement();\n            next = $next.get();\n\n            if (next) nodes.push(next);\n            else return nodes;\n        }\n\n        return nodes;\n    },\n    _isUnformat: function(type, nodes)\n    {\n        var countLists = 0;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                var tag = nodes[i].tagName.toLowerCase();\n                if (tag === type || tag === 'figure')\n                {\n                    countLists++;\n                }\n            }\n        }\n\n        return (countLists === nodes.length);\n    },\n    _format: function(type, nodes)\n    {\n        var tags = ['p', 'div', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol'];\n        var blocks = this._uniteBlocks(nodes, tags);\n        var lists = [];\n\n        for (var key in blocks)\n        {\n            var items = blocks[key];\n            var $list = this._createList(type, blocks[key]);\n\n            for (var i = 0; i < items.length; i++)\n            {\n                var $item;\n\n                // lists\n                if (items[i].nodeType !== 3 && (items[i].tagName === 'UL' || items[i].tagName === 'OL'))\n                {\n                    var $oldList = $R.dom(items[i]);\n\n                    $item = $oldList.contents();\n                    $list.append($item);\n\n                    // old is empty\n                    if (this.utils.isEmpty($oldList)) $oldList.remove();\n                }\n                // other blocks or texts\n                else\n                {\n                    $item = this._createListItem(items[i]);\n                    this.utils.normalizeTextNodes($item);\n                    $list.append($item);\n                }\n            }\n\n            lists.push($list.get());\n        }\n\n        return lists;\n    },\n    _uniteBlocks: function(nodes, tags)\n    {\n        var z = 0;\n        var blocks = { 0: [] };\n        var lastcell = false;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var $cell = $node.closest('th, td');\n\n            if ($cell.length !== 0)\n            {\n                if ($cell.get() !== lastcell)\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n            }\n            else\n            {\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n                else\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n            }\n\n            lastcell = $cell.get();\n        }\n\n        return blocks;\n    },\n    _isUniteBlock: function(node, tags)\n    {\n        return (node.nodeType === 3 || tags.indexOf(node.tagName.toLowerCase()) !== -1);\n    },\n    _createList: function(type, blocks)\n    {\n        var last = blocks[blocks.length-1];\n        var $last = $R.dom(last);\n        var $list = $R.dom('<' + type + '>');\n        $last.after($list);\n\n        return $list;\n    },\n    _createListItem: function(item)\n    {\n        var $item = $R.dom('<li>');\n        if (item.nodeType === 3)\n        {\n            $item.append(item);\n        }\n        else\n        {\n            var $el = $R.dom(item);\n            $item.append($el.contents());\n            $el.remove();\n        }\n\n        return $item;\n    },\n    _unformat: function(type, nodes)\n    {\n        if (nodes.length === 1)\n        {\n            // one list\n            var $list = $R.dom(nodes[0]);\n            var $items = $list.find('li');\n\n            var selectedItems = this.selection.getNodes({ tags: ['li'] });\n            var block = this.selection.getBlock();\n            var $li = $R.dom(block).closest('li');\n            if (selectedItems.length === 0 && $li.length !== 0)\n            {\n                selectedItems = [$li.get()];\n            }\n\n\n            // 1) entire\n            if (selectedItems.length === $items.length)\n            {\n                return this._unformatEntire(nodes[0]);\n            }\n\n            var pos = this._getItemsPosition($items, selectedItems);\n\n            // 2) top\n            if (pos === 'Top')\n            {\n                return this._unformatAtSide('before', selectedItems, $list);\n            }\n\n            // 3) bottom\n            else if (pos === 'Bottom')\n            {\n                selectedItems.reverse();\n                return this._unformatAtSide('after', selectedItems, $list);\n            }\n\n            // 4) middle\n            else if (pos === 'Middle')\n            {\n                var $last = $R.dom(selectedItems[selectedItems.length-1]);\n\n                var ci = false;\n\n                var $parent = false;\n                var $secondList = $R.dom('<' + $list.get().tagName.toLowerCase() + '>');\n                $items.each(function(node)\n                {\n                    if (ci)\n                    {\n                        var $node = $R.dom(node);\n                        if ($node.closest('.redactor-split-item').length === 0 && ($parent === false || $node.closest($parent).length === 0))\n                        {\n                            $node.addClass('redactor-split-item');\n                        }\n\n                        $parent = $node;\n                    }\n\n                    if (node === $last.get())\n                    {\n                        ci = true;\n                    }\n                });\n\n                $items.filter('.redactor-split-item').each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    $node.removeClass('redactor-split-item');\n                    $secondList.append(node);\n                });\n\n                $list.after($secondList);\n\n                selectedItems.reverse();\n                for (var i = 0; i < selectedItems.length; i++)\n                {\n                    var $item = $R.dom(selectedItems[i]);\n                    var $container = this._createUnformatContainer($item);\n\n                    $list.after($container);\n                    $container.find('ul, ol').remove();\n                    $item.remove();\n                }\n\n\n                return;\n            }\n\n        }\n        else\n        {\n            // unformat all\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (nodes[i].nodeType !== 3 && nodes[i].tagName.toLowerCase() === type)\n                {\n                    this._unformatEntire(nodes[i]);\n                }\n            }\n        }\n    },\n    _unformatEntire: function(list)\n    {\n        var $list = $R.dom(list);\n        var $items = $list.find('li');\n        $items.each(function(node)\n        {\n            var $item = $R.dom(node);\n            var $container = this._createUnformatContainer($item);\n\n            $item.remove();\n            $list.before($container);\n\n        }.bind(this));\n\n        $list.remove();\n    },\n    _unformatAtSide: function(type, selectedItems, $list)\n    {\n        for (var i = 0; i < selectedItems.length; i++)\n        {\n            var $item = $R.dom(selectedItems[i]);\n            var $container = this._createUnformatContainer($item);\n\n            $list[type]($container);\n\n            var $innerLists = $container.find('ul, ol').first();\n            $item.append($innerLists);\n\n            $innerLists.each(function(node)\n            {\n                var $node = $R.dom(node);\n                var $parent = $node.closest('li');\n\n                if ($parent.get() === selectedItems[i])\n                {\n                    $node.unwrap();\n                    $parent.addClass('r-unwrapped');\n                }\n\n            });\n\n            if (this.utils.isEmptyHtml($item.html())) $item.remove();\n        }\n\n        // clear empty\n        $list.find('.r-unwrapped').each(function(node)\n        {\n            var $node = $R.dom(node);\n            if ($node.html().trim() === '') $node.remove();\n            else $node.removeClass('r-unwrapped');\n        });\n    },\n    _getItemsPosition: function($items, selectedItems)\n    {\n        var pos = 'Middle';\n\n        var sFirst = selectedItems[0];\n        var sLast = selectedItems[selectedItems.length-1];\n\n        var first = $items.first().get();\n        var last = $items.last().get();\n\n        if (first === sFirst && last !== sLast)\n        {\n            pos = 'Top';\n        }\n        else if (first !== sFirst && last === sLast)\n        {\n            pos = 'Bottom';\n        }\n\n        return pos;\n    },\n    _createUnformatContainer: function($item)\n    {\n        var $container = $R.dom('<' + this.opts.markup + '>');\n        if (this.opts.breakline) $container.attr('data-redactor-tag', 'br');\n\n        $container.append($item.contents());\n\n        return $container;\n    },\n    _getBlocks: function()\n    {\n        return this.selection.getBlocks({ first: true });\n    },\n    _observeButton: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isDisabled = (data.isPre() || data.isCode() || data.isFigcaption());\n\n        this._observeButtonsList(isDisabled, ['lists', 'ul', 'ol', 'outdent', 'indent']);\n\n        var itemOutdent = this.toolbar.getButton('outdent');\n        var itemIndent = this.toolbar.getButton('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeDropdown: function(dropdown)\n    {\n        var itemOutdent = dropdown.getItem('outdent');\n        var itemIndent = dropdown.getItem('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeIndent: function(itemIndent, itemOutdent)\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (itemOutdent)\n        {\n            if (item && isCollapsed) itemOutdent.enable();\n            else itemOutdent.disable();\n        }\n\n        if (itemIndent)\n        {\n            if (item && isIndent) itemIndent.enable();\n            else itemIndent.disable();\n        }\n    },\n    _observeButtonsList: function(param, buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            var button = this.toolbar.getButton(buttons[i]);\n            if (button)\n            {\n                if (param) button.disable();\n                else button.enable();\n            }\n        }\n    }\n});\n\n    window.Redactor = window.$R = $R;\n\n    // Data attribute load\n    window.addEventListener('load', function()\n    {\n        $R('[data-redactor]');\n    });\n\n}());\n"]}